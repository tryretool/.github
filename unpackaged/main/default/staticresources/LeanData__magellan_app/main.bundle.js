
//# sourceURL=magellan/main.bundle.js
!function(e){var t={};function __webpack_require__(i){if(t[i])return t[i].exports;var a=t[i]={i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,i){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=161)}([function(e,t){e.exports=' <div class=object-radio-options></div> <div class=match-rules-wrapper> <div class=filter-div style=padding-bottom:15px></div> <div class=circle><%- elementOrderInNode %></div><div class="header-font has-object-label" style=display:inline-block>Prioritize <%- isDupeNode ? "Duplicate" : "Matched" %> <%- pluralObjects %></div> <div style=margin-left:30px;margin-bottom:8px class=has-object-label> Identify the ultimate <%- isDupeNode ? "duplicate" : "matched" %> <%- (singleObject == \'CampaignMember\') ? \'campaign member\' : singleObject.toLowerCase() %> to be selected in cases where LeanData finds multiple. </div> <div id=criteria-list-partial class=match-node-criteria-list></div> </div> <div class=match-variable-setter-wrapper style="background-color:var(--lt-grey-1);display:flex;padding-left:0;width:calc(100% + 15px);margin-left:-15px;margin-top:20px;margin-bottom:20px"> <div class=circle style=margin-top:20px;margin-right:-10px;margin-left:15px;z-index:1;flex-shrink:0><%- elementOrderInNode + 1 %></div> <ld-variable-setter-angular class=angular-component-in-magellan id=output-variable> </ld-variable-setter-angular> </div> <hr class=horizontal-line-separator style="width:calc(100% + 15px);margin-left:-15px!important"> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports='<div> <ld-variable-setter-angular id=dupe-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div class=node-partial> <div id=main-div> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\') { %> <div class=header-font>Schedule Meeting with:</div> <% } else if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class="ld-tooltip-hint main-host-tooltip small-tooltip" style=margin-left:5px></span></div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } else {%> <span class=header-font><%- primaryObject %> Ownership</span> <% } %> <div class="horizontal-tabbing-option-div control-group" id=routing-type-radio-control style="<%- _LeanData.AppState.isHandoffGraph ? \'margin-left: 20px !important\' : \'\' %>"> <label class="control control--radio"><%- isMatched ? (primaryObject === "Lead" ? "Matched " : "") : "Duplicate" %> <%- recordType %> Owner <% if (isMatched || recordType === "Lead") { %> <input type=radio class=default-radio-option name=radio data-routing-type="lead owner"/> <% } else if (recordType === "Contact") { %> <input type=radio class=default-radio-option name=radio data-routing-type="contact owner"/> <% } %> <div class=control__indicator></div> </label> <label class="control control--radio"><%- isMatched ? (primaryObject === "Lead" ? "Matched " : "") : "Duplicate" %> <%- recordType %> Custom User Field <input type=radio name=radio data-routing-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container id=duplicate-record-custom-user-field-div> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%- primaryObject.toLowerCase() %> to</div></div> <div class="col horizontal-tabbing-dropdown-input" style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> <% if (actionNodeMetaData.hasCustomLeadBasedRouting) { %> <label class="control control--radio">Custom Interface <input type=radio name=radio data-routing-type="custom interface"/> <div class=control__indicator></div> </label> <% } %> </div> <% if (isMatched || recordType === "Lead") { %> <hr class=horizontal-line-separator> <div> <span class=header-font>Queue Owned <%- isMatched ?  "": "Duplicate " %> Lead</span> </div> <div id=excludeQueueOwnedDiv class=horizontal-tabbing-option-div> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText id=excludeQueueOwnedLabel> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\' || _LeanData.AppState.isHandoffGraph) { %> Prevent Scheduling a Meeting with a Queue <div class="ld-tooltip-hint prevent-schedule-queue-tooltip small-tooltip" style=vertical-align:top;margin-left:5px></div> <% } else { %> Prevent Routing to Queues <% } %> </span> <input type=checkbox id=excludeQueueOwned /> <span class=checkmark></span> </label> </div> <% } %> </div> <% if (_LeanData.AppState.PrimarySObjectType !== \'Meeting\' && !_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"additional-recipients-wrapper",template:_.template(i(165)),events:{"click .remove-additional-recipient-row":"_removeAdditionalRecipientRow"},initialize:function(e){this.additionalObjects=e.additionalObjects,this._getAdditionalObjectsLabels=e._getAdditionalObjectsLabels,this._validateAdditionalObjects=e._validateAdditionalObjects,this.model=e.model;var t=_.map(_LeanData.MetaDataController.getObjectContextDropdownOptions(this.model.get("primaryObjectType"),this.model.get("matchedObjectTypes"),this.model.get("createdObjectTypes"),this.model.get("triggeredObjectTypes")),e=>{if(e)return e.label});t=t.filter(e=>!_.isUndefined(e)&&!_.isNull(e)),this.contextOptionsSet=new Set(t),this.render()},getSelections:function(){return this.additionalObjects},_addAdditionalRecipientRow:function(e){if(this.additionalObjectsTypeahead.validate()){var t=_.cloneDeep(this.additionalObjectsTypeahead.selection);this.additionalObjects.push(_LeanData.StringUtil.bracketize(_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t))),this.render()}},_removeAdditionalRecipientRow:function(e){var t=$(e.target).data("index");this.additionalObjects.splice(t,1),this.model.set("additionalObjectUserFields",this.additionalObjects),this.render()},render:function(){var e=this.template({additionalObjectsLabels:this._getAdditionalObjectsLabels(this.additionalObjects),additionalObjectsValidity:this._validateAdditionalObjects(this.additionalObjects)});this.$el.html(e);var t=_LeanData.Util.createUserFieldsFilter(),i=_LeanData.Util.createChatterUserFieldsFilter(),a=_LeanData.Util.createOwnerToOwnerMappingFilter(),n=_LeanData.Util.createRelatedActivityUserFieldsFilter(this.model.get("matchedObjectTypes"));return this.additionalObjectsTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!1,root:_LeanData._function.VARIABLES_FIELDNAME,customRootLabel:"Variables",placeholder:"Find and Select Additional Recipients",getDynamicData:_LeanData.Util.getDynamicFieldMetaData(_LeanData._function.VARIABLES_FIELDNAME,this.model.get("primaryObjectType"),_.cloneDeep(window.fieldMetaData),null),filter:e=>{return e=_LeanData.Util.createBlacklistFilter()(e=_.filter(e,e=>!e.contextType&&"Audit Log Link"!=e.label||(this.contextOptionsSet.has(e.label)||_LeanData.AppState.getCurrentVariablesService().hasVariableByName(e.name)))),e=this.model.get("chatter")?i(e):t(e),this.model.get("matchedObjectTypes")&&this.model.get("matchedObjectTypes").includes("Activity")&&(e=n(e)),e=a(e),"Meeting"===this.model.get("primaryObjectType")&&(e=_.filter(e,e=>e.objectType!==_LeanData._function.VARIABLES_FIELDNAME)),e},customValidationFunction:function(){var e=this.selection[this.selection.length-1],t=e&&e.parent&&e.parent.length>0&&"REFERENCE"===e.type;return this.selection.length>1&&!t},onSelect:this._addAdditionalRecipientRow.bind(this)}),this.$el.find(".additional-recipient-typeahead").html(this.additionalObjectsTypeahead.$el),this}})}},function(e,t,i){e.exports=function(){const e=i(146)(),t=i(143)(),a=i(145)(),n=i(144)(),o=i(140)();return Backbone.View.extend({template:_.template(i(201)),initialize:function(e){this.isCalendaringRRPage=e.isCalendaringRRPage,this.enabledSalesforceLicenses=e.enabledSalesforceLicenses,this.advancedRRFeaturesEnabled=e.advancedRRFeaturesEnabled,this.isBulkSync="sync"===e.mode},render:function(){const e=this.template({isBulkSync:this.isBulkSync,showPoolList:this.model.showPoolList});return this.$el.html(e),this.model.set({memberListView:this.memberListView}),this.model.set({userListView:this.userListView}),this.model.set({nextUpAssignmentView:this.nextUpAssignmentView}),this.model.showPoolList&&(this.model.set({poolListView:this.poolListView}),this.poolListView.setElement(this.$el.find(".pools-list")).render()),this.memberListView.setElement(this.$el.find(".members-pane")).render(),this.userListView.setElement(this.$el.find(".users-col")).render(),this.nextUpAssignmentView.setElement(this.$el.find(".next-up-pane")),this},openSingle({onConfirm:e,rrpModel:t}){this.showPoolList=!1,this.$el.find(".pools-list").html(""),this.poolListView&&this.poolListView.remove(),this.rrpModel=t,this.open({onConfirm:e,poolIds:null,isSave:!1})},open({onConfirm:e,poolIds:t,isSave:i=!0,managerMode:a}){let n=null;n=this.isBulkSync?"Syncing Conditional Pools":`Loading Round Robin ${a?"Managers":"Members"}`,_LeanData.Notification.showLoadingOverlay(n);let l=this.rrpModel&&!this.rrpModel.get("Id");Promise.all([_LeanData.RemotingRouter.getRoundRobinPoolConfiguration(t),_LeanData.RemotingRouter.getFilteredRoundRobinOwnerList(JSON.stringify({isCalendaringRRPage:this.isCalendaringRRPage,filterKey:null}),null),_LeanData.RemotingRouter.getAllCappingConfigurations(),_LeanData.RemotingRouter.getCappingConfigurationsAppliedToPools(),_LeanData.RemotingRouter.getUserFilterMetaData(),_LeanData.MetaDataController.getFieldsMetaData()]).then(([n,s,r,d,c,h])=>{let p=n.pools||{},u={},m=null;l?m="NewPool":this.rrpModel?m=this.rrpModel.get("Id"):t&&t.length>0&&(m=Object.keys(p)[0]),n.users&&Object.assign(u,n.users),n.queues&&Object.assign(u,n.queues);const g=n.creditBackQueue||[];s.Users&&Object.assign(u,s.Users),s.Queues&&Object.assign(u,s.Queues),this.rrpModel&&(Object.assign(u,this.rrpModel.users),Object.assign(u,this.rrpModel.queues));const f=n.pools,b={},v={};for(let e in p){let t=f[e];"managerIds"in t?(b[e]=new Set(t.managerIds),t.managerIds.forEach(t=>{t in v||(v[t]=new Set),v[t].add(e)})):b[e]=new Set}for(let e of Object.values(u))e.Id in v||(v[e.Id]=new Set),e.productAccess&&(e.productAccess=new Set(e.productAccess));let y,w,T=t?p[t[0]]:null,D={};this.rrpModel&&(T={attributes:Object.assign({},this.rrpModel.attributes),members:this.getMembersFromRrpModel(this.rrpModel),conditionalMembersCount:_.cloneDeep(this.rrpModel.conditionalMembersCount)},p[m]=T),Object.values(p).forEach((e,t)=>{D[e.attributes.Grouping_Name__c]=e.attributes.Object_Type__c}),null!==T?(y=r.filter(e=>e.Object_Type__c===T.attributes.Object_Type__c),w=d.filter(e=>e.Pool__c===T.attributes.Id)):(y=r,w=d);let C=T.members;if(!l&&!T)return void this.showPoolNotFoundError(this.rrpModel.get("Id"));let S=c.userRoles,M=c.profiles,L={},I={};for(let e of S){let{Id:t,Name:i}=e;L[t]=i}for(let e of M){let{Id:t,Name:i}=e;I[t]=i}for(let e in p){let t=p[e],i={};if("managerIds"in t){t.originalManagers=[...t.managerIds];for(let e of t.managerIds){let t=this.buildManager(e,L,I,Object.values(u));i[e]=t}}else t.originalManagers=[],t.managerIds=[];if(t.managers=i,"members"in t){let e={};Object.values(t.members).forEach(t=>{let i=t.attributes;e[i.OwnerId__c]=i.Weighting_Value__c,i.productAccess&&(i.productAccess=new Set(i.productAccess))}),t.originalOwnersToWeightValues=e}}const O=_.cloneDeep(u);p[m].members.forEach(e=>{delete O[e.attributes.OwnerId__c]}),this.model=new o({showPoolList:t&&(t.length>1||this.isBulkSync),poolsData:p,poolIds:t,pool:T||null,rrpModel:this.rrpModel,selectedPoolId:m,poolNameToPoolTypeMap:D||{},members:C,filteredUserList:Object.values(O),ownerIdToWorkingHours:s.ownerIdToWorkingHours,creditBackQueue:g,idToOwner:u,cappingConfigurations:y,appliedRulesets:w,isCalendaringRRPage:this.isCalendaringRRPage,onConfirm:e,managerIdToPoolIds:v,poolIdToManagerIds:b,idToRole:L,idToProfile:I,managerMode:a,enabledSalesforceLicenses:this.enabledSalesforceLicenses||[],advancedRRFeaturesEnabled:this.advancedRRFeaturesEnabled}),this.initializeChildViews(),this.bulkPromises=[],this.isBulkSync&&Object.keys(p).forEach(e=>{this.bulkPromises.push(this.model.syncPool(e,{includeInactiveUsers:!1,doNotError:!0}).finally(()=>{this.memberListView.render(),this.poolListView&&this.poolListView.render()}))});let x=null;x=i||this.isBulkSync?"Save":"Done";let V=`<span class="semi-bold">${this.isBulkSync?"Bulk Sync Round Robin Pools":"Edit Members in Round Robin Pools"}</span>`,A={header:V,forwardButtonTextByPage:["Select 'Next Up'",x],backButtonTextByPage:["Cancel","Back"],cancelButtonText:"Cancel",selectorsByPage:[[".users-col",".members-col"],[".next-up-pane"]],viewsByPage:[[this.userListView,this.poolListView,this.memberListView],[this.nextUpAssignmentView]],largeModal:!0,message:" ",verticallyResizable:!0,contentElement:this.$el,pageIndex:0,onForward:[this.updateNextUp.bind(this),this.setNextUpAndSave.bind(this)],onBack:[null,null],confirmActionHandler:(t,i)=>{this.weightingChangesConfirm(async()=>{await t(),e()},i)},cancelActionHandler:(e,t)=>{this.unsavedChangesConfirm(e,t)},model:this.model,disableForward:[null,this.model.hasValidNextUp.bind(this.model)],modalClasses:"round-robin-modal",backdropClasses:"round-robin-modal-backdrop"};a&&(V="Edit Managers in Round Robin Pools",A.header=V,A.forwardButtonTextByPage=["Save"],A.backButtonTextByPage=["Back"],A.selectorsByPage=[[".users-col",".members-col"]],A.viewsByPage=[[this.userListView,this.poolListView,this.memberListView]],A.onBack=[null],A.onForward=[this.model.saveToServer.bind(this.model)],A.pageIndex=0),this.openModal(A),_LeanData.Notification.hideLoadingOverlay()}).catch(e=>{console.error("Error loading Bulk Edit:",e),this.isCalendaringRRPage&&e.includes("getFilteredRoundRobinOwnerList")&&_LeanData.Notification.showConfirmationDialog({header:"Error",message:"No users have been authorized for BookIt. Users must be authorized to be added to a BookIt Round Robin Pool. Please ensure users you would like to include are authorized.",confirmButtonText:"Ok",showRejectButton:!1,onConfirm:()=>{_LeanData.Notification.hideLoadingOverlay();var e=this.model.isCalendaringRRPage?"calendaring/round_robin_pools":"routing/round_robin_pools";_LeanData.Navigation.navigateByUrl(e)}})})},buildManager(e,t,i,a){let n={Id:e,Name:"",Role:"",Profile:"",IsActive:!1},o=a.find(t=>t.Id===e);if(!o)return n;let l=o.UserRoleId;n.Role=t[l]?t[l]:null;let s=o.ProfileId;return n.Profile=i[s]?i[s]:null,n.IsActive=!(!o||!o.IsActive)&&o.IsActive,n.Name=o.Name,n},initializeChildViews(){this.userListView=new e({model:this.model,readOnly:this.isBulkSync,disableDrag:!this.model.managerMode&&this.model.poolsData[this.model.selectedPoolId].members&&this.model.poolsData[this.model.selectedPoolId].members.length>=_LeanData._app.POOL_MEMBER_LIMIT,postSyncCallback:()=>{this.memberListView.render(),this.poolListView&&this.poolListView.render()},postValidateCallback:()=>{const e=$(".forward-button");this.isBulkSync?e.removeAttr("disabled"):e.attr("disabled",!this.userListView.conditionalView.soqlConditionValid)},defaultTab:this.isBulkSync?"conditional":null}),this.memberListView=new t({model:this.model,hideHeader:this.isBulkSync,onMemberAddCallback:e=>{!this.model.managerMode&&e.members&&this.userListView.manualView.toggleDraggable(e.members.length>=_LeanData._app.POOL_MEMBER_LIMIT)},postDeleteCallBack:e=>{this.userListView.manualView.toggleDraggable(!1)}}),this.poolListView=new a({model:this.model,isCalendaringRRPage:this.isCalendaringRRPage,isBulkSync:this.isBulkSync,postDeletePoolCallback:e=>{this.isBulkSync&&(Object.values(this.model.poolsData).reduce((e,t)=>e||t.updateStatus&&t.updateStatus.status,!1)||this.addUsersToPoolModal.toggleForwardButtonDisabled(!0))},poolSelectCallback:(e,t)=>{this.model.selectedPoolId=t||$(e.currentTarget).closest(".pool-row").data("pool-id"),this.model.selectedObjectType=this.model.poolsData[this.model.selectedPoolId].attributes.Object_Type__c,this.model.members=this.model.poolsData[this.model.selectedPoolId].members,this.model.originalMembers=_.cloneDeep(this.model.members);let i=this.userListView.conditionalView;i.updateSyncedUsersList(!0),i.render(),$(this.userListView.$el).LoadingOverlay("show"),this.model.updateUserList().then(()=>{this.memberListView.render(),this.userListView.render(),this.userListView.manualView.handleUserSelectionChange(),$(this.userListView.$el).LoadingOverlay("hide",!0)})},getConditionalTableHeader:()=>{let e=null,t=[],i=[],a=[];if(!this.isBulkSync)return null;Object.values(this.model.poolsData).forEach(e=>{let t=e.attributes.Id;if(e.updateStatus&&e.updateStatus.errMessage){e.updateStatus.errMessage.includes("LIMIT_ERROR")?a.push(t):i.push(t)}});let n=e=>e>1?"Round Robin Pools":"Round Robin Pool";return i.length>0&&t.push(`${i.length} ${n(i.length)} have invalid conditions`),a.length>0&&t.push(`${a.length} ${n(a.length)} exceed the limit of 500 members`),t.length>0&&(e=t.join(" and ")),e}}),this.nextUpAssignmentView=new n({model:this.model,filter:this.isBulkSync?this.filterSaveablePools:null,tableCol:[{name:"Pool Name"},{name:"Distribution Type"},{name:this.isBulkSync?"":"Weighted"},{name:"Received Last Record"},{name:"Expected 'Next Up'"},{name:"Select 'Next Up'"}]})},filterSaveablePools(e){let t={};return Object.keys(e).forEach(e=>{let i=this.model.poolsData[e];(!i.updateStatus||i.updateStatus&&i.updateStatus.status)&&(t[e]=i)}),t},openModal(e){this.render(),this.$el.height("100%"),this.addUsersToPoolModal=new Magellan.Views.PaginatedModal(e),this.addUsersToPoolModal.open(),this.addUsersToPoolModal.$el.find(".modal-content-section").css({"min-height":"520px",height:"520px","margin-bottom":"-15px"}),this.isBulkSync&&this.addUsersToPoolModal.$el.find(".forward-button").attr("disabled",!0)},filterUsers(e){const t=[];return e.forEach(e=>{"Queue"===e.Type?(e.IsActive=!0,e.type="Queue"):e.type="User",("Queue"!==e.type||_LeanData.FBUtil.isObjectTypeQueueOwnable(this.pool.attributes.Object_Type__c))&&t.push(e)}),t},getMembersFromRrpModel(e){return e.get("memberList").map(e=>({Id:e.Id,attributes:this.createMemberAttributes(e)}))},createMemberAttributes(e){let t=Object.assign({},e);return t.Type="string"==typeof e.Type?e.Type:"User",t.User_Owner__c="Queue"===t.Type?null:e.OwnerId__c,t},showPoolNotFoundError(e){_LeanData.Notification.showConfirmationDialog({header:"Error",message:`Round Robin Pool with Id ${e} no longer exists.`,confirmButtonText:"Ok",showRejectButton:!1,onConfirm:()=>{_LeanData.Notification.hideLoadingOverlay();var e=this.model.isCalendaringRRPage?"calendaring/round_robin_pools":"routing/round_robin_pools";_LeanData.Navigation.navigateByUrl(e)}})},getMemberListResult(){const e=this.model.getAllResult(),t=[],i=e.nextOwnerId||null,a=e.manualNextOwnerId||null;for(let a=0;a<e.members.length;++a){const n=e.members[a],o=n.attributes.OwnerId__c===i;t.push(Object.assign({Id:n.Id,Current_Cap_Value__c:n.attributes.Current_Cap_Value__c,Inactive_Reason__c:n.attributes.Inactive_Reason__c,Status__c:n.attributes.Status__c,Weighting_Next_Pointer__c:n.attributes.Weighting_Next_Pointer__c,Weighting_Value__c:50*n.attributes.Weighting_Value__c,isNextOwner:o,availabilityStatus:n.attributes.availabilityStatus},this.getAttributesMapFromType(n.attributes)))}return{memberList:t,manualNextOwnerId:a}},saveResultsToModel(e){let t=this.rrpModel&&this.rrpModel.get("Id")?this.rrpModel.get("Id"):"NewPool";const i=this.model.getPoolResult(t);e.set(_LeanData.Util.getPoolPayloadObject(i.attributes));const a=[],n={},o={};for(let e=0;e<i.members.length;++e){const t=i.members[e].attributes;t.Weighting_Value__c=50*t.Weighting_Value__c,t.conditionalStatus&&(t.conditionalStatus=null);let l=this.model.idToOwner[t.OwnerId__c];l&&("Queue"===l.Type?o[t.OwnerId__c]=l:n[t.OwnerId__c]=l);let s=this.createMemberAttributes(t);s.isNextOwner=t.OwnerId__c===i.nextOwnerId,a.push(s)}Object.assign(e.users,n),Object.assign(e.queues,o),e.conditionalMembersCount=i.conditionalMembersCount,e.set("memberList",a),e.poolIdsWithWeightingChanged=this.model.poolIdsWithWeightingChanged},updateNextUp:function(){let e=Object.keys(this.model.poolsData);return e=e.filter(e=>e&&(15===e.length||18===e.length)),Promise.all([new Promise(e=>{Promise.all(this.bulkPromises).finally(()=>e())}),_LeanData.RemotingRouter.getRoundRobinPoolConfiguration(e)]).then(([e,t])=>{let i=t.pools,a={};Object.assign(a,t.users),Object.assign(a,t.queues),_.each(i,(e,t)=>{this.model.poolIdToNextUpData[t]=["",""];const i=this.model.poolsData[t],n=e.attributes.Last_OwnerId_Routed_To__c;if(this.model.poolIdToNextUpData[t][0]=n&&a[n]?a[n].Name:n,this.model.poolIdsWithWeightingChanged.has(t)){const{memberName:e}=this.model.getFirstAvailableMember(t);this.model.poolIdToNextUpData[t][1]=e}else{let a;const n=i.members;_.each(e.members,e=>{if(e.isNextOwner)return a=e.attributes.OwnerId__c,!1}),_.each(n,(e,i)=>{e.attributes.OwnerId__c===a&&this.model.originalMemberToValidIndex[t][e.attributes.OwnerId__c]===i&&"remove"!==e.attributes.conditionalStatus?(e.isNextOwner=!0,this.model.poolIdToNextUpData[t][1]=this.model.getMemberName(e)):e.isNextOwner=!1})}})})},renderBulkConfirmation(e){let t=[],i=[],a=[],n=[];_.sortBy(this.model.attributes.poolsData,["attributes.Object_Type__c","attributes.Grouping_Name__c"]).forEach(o=>{let l=o.attributes.Id;e&&(e.savedPools&&_.some(e.savedPools,e=>e===l)?t.push(o):e.omittedPools&&_.some(e.omittedPools,e=>e===l)&&n.push(o)),o.updateStatus&&!o.updateStatus.status&&(o.updateStatus.errMessage.includes("LIMIT_ERROR")?i.push(o):a.push(o))});const o={key:"mainToast",type:"success",position:"top-right"};if(this.isBulkSync?o.message=`${t.length} ${t.length>1||0==t.length?"Conditional Pools":"Conditional Pool"} have been synced`:o.message=`${t.length} ${t.length>1||0==t.length?"Pools":"Pool"} have been saved`,!this.isBulkSync||0===i.length&&0===a.length&&0===n.length)_LeanData.Notification.showMessage(o);else{const e={selector:"ld-round-robin-sync-modal",inputs:{header:"Bulk Sync Round Robin Pool(s)",options:{successHighlightLabel:"Round Robin Pools",successHighlightMessage:"were successfully synced",successPools:[{header:"Synced Round Robin Pool(s)",pools:t}],failureHighlightLabel:"Round Robin Pools",failureHighlightMessage:"could not be synced",failurePools:[{header:"Members Limit (500) Exceeded After Sync",pools:i},{header:"Invalid Round Robin Pool(s)",pools:a},{header:"Concurrent Pool Edits",pools:n}]},confirmationButtonText:"Ok, I Understand",isVisible:!0},events:{onConfirm:()=>{_LeanData.Notification.showMessage(o)}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}},setNextUpAndSave(){if(_.each(Object.keys(this.model.poolsData),e=>{const t=this.model.poolsData[e];t.attributes.Is_Conditional_Membership_Enabled__c?this.model.removeConditionalMembers(e,"conditionalStatus","remove"):t.attributes.Soql_Condition__c&&delete t.attributes.Soql_Condition__c,this.model.updatePoolSettings(e);const i=t.members;this.model.originalMemberToValidIndex[e]={},_.each(i,(t,i)=>{this.model.originalMemberToValidIndex[e][t.attributes.OwnerId__c]=i});const a=this.nextUpAssignmentView.poolIdToDropdownView[e];if(a){const t=a.val();t&&t.id&&this.model.setNextMember(t.id,e)}}),!this.model.rrpModel){let e;return this.model.saveToServer(this.filterSaveablePools(this.model.poolsData)).then(t=>(e=t,this.isCalendaringRRPage?this.model.syncSavedPools(e.herokuPayload):"")).then(t=>{_LeanData.Util.log(t),setTimeout(()=>{this.renderBulkConfirmation(e)},1e3)})}this.saveResultsToModel(this.model.rrpModel)},weightingChangesConfirm(e,t){const i=[];if(i.push(...this.model.originalPoolDataMemberWeightsHasChanged()),i.length>0){const a=this.model.getWeightingDistributionResetText(i);new Magellan.Views.ConfirmationModal({header:"Weighting Changes Detected",warningText:"Warning: Routing Distribution will Reset",message:a,footer:`Are you sure you want to save the Pool${1===i.length?"":"s"} and reset the distribution?`,hasExtraContent:!0,innerModal:!0,onConfirmed:()=>{_.each(i,e=>{this.model.resetPoolAfterWeightingChange(!0,e)}),e()},onCancelled:t}).open()}else e()},unsavedChangesConfirm(e,t){if(this.model.hasChanged()){let i=null;(i=this.isBulkSync?new Magellan.Views.ConfirmationModal({header:"Pools Not Synced",message:"These pools will not be synced. Are you sure you want to leave?",primaryButtonText:"Leave Without Syncing",secondaryButtonText:"Cancel",innerModal:!0,onConfirmed:e,onCancelled:t}):new Magellan.Views.ConfirmationModal({header:"Changes Not Made",message:"You do not have any changes made to these Pools.<br/>Are you sure you want to leave?",primaryButtonText:"Yes, Leave without Changes",secondaryButtonText:"No, Stay on Page",innerModal:!0,onConfirmed:e,onCancelled:t})).open()}else e()}})}},function(e,t,i){const a=Backbone.View.extend({template:_.template(i(217)),initialize:function(e){this.idToOwnerMap=e.idToOwnerMap,this.manager=e.manager||[]},events:{"click .delete-icon":"handleDeleteIconClick"},handleDeleteIconClick:function(e){const t=$(e.target).closest(".manager-list-container").data("id");this.trigger("deleteManager",t)},render:function(){this.delegateEvents();const e=this.manager.map(e=>{const t=this.idToOwnerMap[e]&&this.idToOwnerMap[e].IsActive?this.idToOwnerMap[e].Name:"(Inactive Manager)";return _.template('<div class="manager-list-container" style="align-items: center;" data-id="<%- userId %>" title="<%- name %>"><div><%- name %></div><div><%- userId %></div><div class="ld-cross-icon-grey-large delete-icon pb10" style="margin: 7px;"></div></div>')({name:t,userId:e})}).join("");return this.$el.html(e),this}});e.exports=a},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.TerritoryGeo=Backbone.Model.extend({initialize:function(e,t){let i={};if(e)i=e;else if(t.isNewTerritory)i.Id="",i[ns+"Owner__c"]="",i[ns+"PostalCode__c"]="",i[ns+"City__c"]="",i[ns+"State__c"]="",i[ns+"Country__c"]="",i[ns+"Custom_Field__c"]="",i.Territory_Name="",this.newGeoId=t.collection.newGeoId;else{var a=t.rawTerritoryGeo;i.Id=a.Id||"",i[ns+"Owner__c"]=a[ns+"LD_Territory__r"][ns+"Owner__c"]||"",i[ns+"PostalCode__c"]=a[ns+"PostalCode__c"]||"",i[ns+"City__c"]=a[ns+"City__c"]||"",i[ns+"State__c"]=a[ns+"State__c"]||"",i[ns+"Country__c"]=a[ns+"Country__c"]||"",i[ns+"Custom_Field__c"]=a[ns+"Custom_Field__c"]||"",i.Territory_Name=a[ns+"LD_Territory__r"][ns+"Name__c"]||""}this.set(i),this.originalAttributes=_.clone(i),this.collection=t.collection,this.rawTerritoryGeo=a,this.on("change",this.onChange),this.on("remove",this.onRemove)},fieldsChanged:function(){var e=this;return _.reduce(this.attributes,function(t,i,a){return _.isEqual(i,e.originalAttributes[a])?t:t.concat(a)},[])},hasChanged:function(){return this.fieldsChanged().length>0},getValidationStatus:function(){var e=[],t=[];return this.collection.checkIfDuplicate(this)&&(e.push(ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c"),t.push("Duplicate Territory")),this.isUnsetOrEmpty("Territory_Name")?(e.push("Territory_Name"),t.push("Territory Name required")):this.get("Territory_Name").trim().length>80&&(e.push("Territory_Name"),t.push("Territory Name length cannot exceed 80 characters")),this.isUnsetOrEmpty(ns+"Owner__c")&&(e.push(ns+"Owner__c"),t.push("Owner required")),this.isUnsetOrEmpty(ns+"PostalCode__c")&&this.isUnsetOrEmpty(ns+"City__c")&&this.isUnsetOrEmpty(ns+"State__c")&&this.isUnsetOrEmpty(ns+"Country__c")&&this.isUnsetOrEmpty(ns+"Custom_Field__c")&&(e.push(ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c"),t.push("Missing geographical data")),this.isUnsetOrEmpty(ns+"Country__c")&&!this.isUnsetOrEmpty(ns+"PostalCode__c")&&(e.push(ns+"Country__c"),t.push("Country must be included with postal code")),this.isUnsetOrEmpty(ns+"Country__c")&&!this.isUnsetOrEmpty(ns+"City__c")&&(e.push(ns+"Country__c"),t.push("Country must be included with city")),["us","usa","united states"].includes(this.get(ns+"Country__c").toLowerCase())&&!this.isUnsetOrEmpty(ns+"City__c")&&this.isUnsetOrEmpty(ns+"State__c")&&(e.push(ns+"State__c"),t.push("State required")),!this.isUnsetOrEmpty(ns+"State__c")&&this.isUnsetOrEmpty(ns+"Country__c")&&(e.push(ns+"Country__c"),t.push("Country must be included with state")),{invalidFields:e,errorMessages:t}},isValid:function(){return 0===this.getValidationStatus().invalidFields.length},isUnsetOrEmpty:function(e){var t=this.get(e);return void 0===t||null===t||""===t.trim()},onChange:function(){this.hasChanged()?this.collection.modelsToChange.add(this):this.collection.modelsToChange.delete(this),this.isValid()?this.collection.invalidModels.delete(this):this.collection.invalidModels.add(this)},onRemove:function(){this.collection.invalidModels.delete(this),this.collection.modelsToChange.delete(this)}}),Magellan.Models.TerritoryGeos=Backbone.Collection.extend({model:Magellan.Models.TerritoryGeo,initialize:function(e,t){this.segmentId=t.segmentId,this.isDraft=t.isDraft,this.modelsToChange=new Set,this.modelsToDelete=new Set,this.invalidModels=new Set,this.originalGeoAttributes={},this.newGeoId=1},fetchRemoteData:function(){var e=$.Deferred(),t=this,i=new $.Deferred,a=new $.Deferred,n=new $.Deferred;return _LeanData.TerritoryRouting.getTerritoryRoutingObjects(this.segmentId,t.isDraft).then(function(e){let a=e.territorySegment;var n=a[ns+"Version__c"];t.segmentName=a[ns+"Name__c"],this.segmentId=a.Id,t.buName=a[ns+"LD_Business_Unit__c"]?a[ns+"LD_Business_Unit__r"][ns+"Is_Deleted__c"]?"Deleted BU":a[ns+"LD_Business_Unit__r"].Name:"Single Graph",t.buId=a[ns+"LD_Business_Unit__c"]||null,t.isDraft&&n++,Magellan.Models.TerritoryGeos.fetchGeoList(a.Id,n).then(function(e){var a=[];e.forEach(function(e){var i={rawTerritoryGeo:e,collection:t},n=new Magellan.Models.TerritoryGeo(null,i);a.push(n),t.originalGeoAttributes[n.cid]=_.cloneDeep(n.attributes)}),t.reset(a),i.resolve()}),1==t.isDraft&&(t.segmentName+=" - Draft")}),_LeanData.TerritoryRouting.getOwnerIdToName(this.segmentId,t.isDraft).then(function(e){t.ownerIdToNameMap=null!=t.ownerIdToNameMap?Object.assign(t.ownerIdToNameMap,e["name map"]):e["name map"],t.inactiveOwnerMap=null!=t.inactiveOwnerMap?t.inactiveOwnerMap:{},t.buIdsToRRNamesMap=null!=t.buIdsToRRNamesMap?Object.assign(t.buIdsToRRNamesMap,e.buIdsToRRNames):e.buIdsToRRNames,t.unprovisionedPools=new Set(e.unprovisionedPools),Object.keys(t.ownerIdToNameMap).forEach(function(i){e.inactiveUsers.includes(i)&&(t.inactiveOwnerMap[i]=t.ownerIdToNameMap[i])}),n.resolve()}),_LeanData.TerritoryRouting.getAllOwnerDataRemote("",!0).then(function(e){t.ownerIdToNameMap=null!=t.ownerIdToNameMap?Object.assign(t.ownerIdToNameMap,JSON.parse(e["name map"])):JSON.parse(e["name map"]),a.resolve()}),$.when(i,a,n).done(function(){hideLoadingOverlay(),e.resolve()}),e},checkIfDuplicate:function(e){var t=[],i=[ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c"];return this.models.forEach(function(a){if(a!==e){var n=!0;i.forEach(function(t){a.get(t).toLowerCase()!==e.get(t).toLowerCase()&&(n=!1)}),n&&t.push(a)}}),t.length>0},submitChanges:function(){var e=[],t=[],i=[];return this.modelsToChange.forEach(function(i){var a=[i.get(ns+"Custom_Field__c"),i.get(ns+"PostalCode__c"),i.get(ns+"City__c"),i.get(ns+"State__c"),i.get(ns+"Country__c")].join("!LD");e.push(a);var n=[i.newGeoId||i.get("Id"),i.get("Territory_Name").trim(),i.get(ns+"Owner__c")].join("!LD");t.push(n)}),this.modelsToDelete.forEach(function(e){i.push(e.get("Id"))}),_LeanData.TerritoryRouting.upsertTerritoryGeos(this.segmentId,e,t,i,this.isDraft)}},{fetchGeoList:function(e,t){var i,a=new $.Deferred,n=5001,o=new RecordsFetcher({segmentId:e,columns:["Id",ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c",ns+"LD_Territory__c",ns+"LD_Territory__r."+ns+"Name__c",ns+"LD_Territory__r."+ns+"Owner__c"],"sobject type":ns+"LD_Territory_Geo__c",conditions:[ns+"LD_Territory__r."+ns+"Territory_Segment__c=:segmentId",ns+"Version__c="+t],conditionValues:{segmentId:e,version:t},"has paginate behavior":!0,"has first pagination":!0,"has last pagination":!0,"page size":n});return o.getFirstPage().then(function(){i=o.currentRecords,0!==o.currentRecords.length&&function concatOtherPageIfAny(){o.isOnLastPage()||o.currentRecords.length!==n?a.resolve(i):o.getNextPage().then(function(){i=i.concat(o.currentRecords),concatOtherPageIfAny()})}()}),a}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.TerritorySegment=Backbone.Model.extend({initialize:function(e,t){this.set(e),this.setSegmentType(t),this.setUploadStatus(e),this.set({_cid:this.cid})},setSegmentType:function(e){e.isDraft?this.set({segmentType:"draft"}):0===this.get("segmentCount")?this.set({segmentType:"empty"}):this.set({segmentType:"default"})},setUploadStatus:function(e){var t="";if(null!=e[ns+"Upload_Status__c"]&&e[ns+"Upload_Status__c"].startsWith("Upload")){var i,a=e[ns+"Upload_Status__c"].split(", ");if(a.length>=6&&a.length<=10&&-1===e[ns+"Upload_Status__c"].indexOf("Duplicate Canonized Rows Detected"))void 0===a[7]&&(a[7]=""),void 0===a[8]&&(a[8]=0),void 0===a[9]&&(a[9]=""),i='<table class="upload-file-errors on-error-icon no-click"><tbody class="no-click"><tr class="no-hover"><td class="no-click upload-file-header" style="width:500px;">Upload Failed - Errors Below</td><td class="no-click"><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with PostalCode populated but missing Country: '+_.escape(a[1])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with City or State populated but missing Country (or State/Country for US): '+_.escape(a[2])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with missing data: '+_.escape(a[3])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with invalid/inactive owners or invalid round robin names: '+_.escape(a[4])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of rows with duplicate data: '+_.escape(a[5])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Duplicate Row Pairs: '+_.escape(a[6])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Invalid Owners: '+_.escape(a[7])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Number of Rows with Pools in other BU: '+_.escape(a[8])+'</td></td></tr><tr class="no-hover"><td class="no-click" style="width:500px">Pools not in Territory Business Unit: '+_.escape(a[9])+"</td></tr></tbody></table>";else if(-1!==e[ns+"Upload_Status__c"].indexOf("Duplicate Canonized Rows Detected")){let t=e[ns+"Upload_Status__c"].substring(0,e[ns+"Upload_Status__c"].indexOf(":")),a=e[ns+"Upload_Status__c"].substring(e[ns+"Upload_Status__c"].indexOf(":")+1).split("\\n").filter(e=>e.length>0);i='<table class="upload-file-errors on-error-icon no-click"><tbody class="no-click"><tr class="no-hover"><td class="no-click upload-file-header" style="width:750px;">Upload Failed - Errors Below</td></tr><tr class="no-hover"><td class="no-click" style="width:750px;">'+_.escape(t)+"</td>";for(let e=0;e<a.length;e++){let t=a[e].split("\\,");if(3==t.length){let e=(t[0].trim().length>0?"City = "+t[0].trim()+", ":"")+(t[1].trim().length>0?"State = "+t[1].trim()+", ":"")+(t[2].trim().length>0?"Country = "+t[2].trim()+", ":"");e.length>2&&(e=e.substring(0,e.length-2)),i+='<tr class="no-hover"><td class="no-click" style="width:750px;"><span>&#8226;</span>'+_.escape(e)+"</td>"}else a[e].length>0&&(i+='<tr class="no-hover"><td class="no-click" style="width:750px;"><span>&#8226;</span>'+_.escape(a[e])+"</td>")}i+="</tr></tbody></table>"}else i='<table class="upload-file-errors on-error-icon no-click"><tbody class="no-click"><tr class="no-hover"><td class="no-click upload-file-header" style="width:500px;">Upload Failed - Errors Below</td></tr><tr class="no-hover"><td class="no-click" style="width:500px;">'+_.escape(e[ns+"Upload_Status__c"])+"</td></tr></tbody></table>";t=i}else null!=e[ns+"Upload_Status__c"]&&e[ns+"Upload_Status__c"].indexOf("Processing")>-1||null!=e[ns+"Upload_Status__c"]&&e[ns+"Upload_Status__c"].indexOf("Deleting")>-1||(t="Success");this.set({uploadStatus:t})},deploy:function(){return _LeanData.TerritoryRouting.deployTerritorySegment(this.get("Id"))},rename:function(e){return _LeanData.TerritoryRouting.saveSegmentNameById(this.get("Id"),e,this.get(ns+"LD_Business_Unit__c")||null)},duplicate:function(e,t){return _LeanData.TerritoryRouting.duplicateTerritorySegment(this.get("Id"),e,t)},exportCSV:function(){var e=new $.Deferred;let t=this.get(ns+"Version__c");return"draft"===this.get("segmentType")&&t++,Promise.all([_LeanData.TerritoryRouting.getTerritoryRoutingObjects(this.get("Id"),"draft"===this.get("segmentType")),Magellan.Models.TerritoryGeos.fetchGeoList(this.get("Id"),t)]).then(([t,i])=>{!function handleTerritorySegmentCSVDownload(e,t,i){if(null!=e){var a="Territory,Owner Id,Round Robin Name,PostalCode,City,State,Country,Custom Field\n",n=i;n.forEach(function(e){a+=_LeanData.Util.formatDataForCSV(e[ns+"LD_Territory__r"][ns+"Name__c"]||""),a+=",",void 0===e[ns+"LD_Territory__r"][ns+"Owner__c"]?a+="":e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("005")||e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("00G")?a+=_LeanData.Util.formatDataForCSV(e[ns+"LD_Territory__r"][ns+"Owner__c"]):a+="",a+=",",void 0===e[ns+"LD_Territory__r"][ns+"Owner__c"]?a+="":e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("005")||e[ns+"LD_Territory__r"][ns+"Owner__c"].startsWith("00G")?a+="":a+=_LeanData.Util.formatDataForCSV(e[ns+"LD_Territory__r"][ns+"Owner__c"]),a+=",",a+=_LeanData.Util.formatDataForCSV(e[ns+"PostalCode__c"]||""),a+=",",a+=_LeanData.Util.formatDataForCSV(e[ns+"City__c"]||""),a+=",",a+=_LeanData.Util.formatDataForCSV(e[ns+"State__c"]||""),a+=",",a+=_LeanData.Util.formatDataForCSV(e[ns+"Country__c"]||""),a+=",",a+=_LeanData.Util.formatDataForCSV(e[ns+"Custom_Field__c"]||""),a+="\n"}),download(a,t+"-Territory.csv","text/plain")}hideLoadingOverlay()}(t,this.get(ns+"Name__c"),i),e.resolve()}),e},remove:function(){var e="draft"===this.get("segmentType");return _LeanData.TerritoryRouting.deleteTerritorySegment(this.get("Id"),e)}}),Magellan.Models.TerritorySegments=Backbone.Collection.extend({model:Magellan.Models.TerritorySegment,initialize:function(){},fetchRemoteData:function(){var e=this,t=$.Deferred();return _LeanData.TerritoryRouting.getTerritorySegments().then(function(t){var i=t.territorySegments,a=t.segmentsWithTerritory,n=t.segmentToManagers,o=[];e.territorySegments=i,e.segmentToManagers=n,i.forEach(function(e){e.isLoading=!0,e[ns+"LD_Business_Unit__c"]=e[ns+"LD_Business_Unit__c"]?e[ns+"LD_Business_Unit__c"]:null,e.buName=e[ns+"LD_Business_Unit__c"]?e[ns+"LD_Business_Unit__r"][ns+"Is_Deleted__c"]?null:e[ns+"LD_Business_Unit__r"].Name:"Single Graph",e.segmentCount=a[e.Id]||0;var t=new Magellan.Models.TerritorySegment(e,{isDraft:!1});if(o.push(t),e[ns+"Draft_FileName__c"]&&""!==e[ns+"Draft_FileName__c"]){var i=new Magellan.Models.TerritorySegment(e,{isDraft:!0});o.push(i)}}),e.reset(o)}).finally(()=>{t.resolve({ownerIdToNameMap:e.ownerIdToNameMap,segmentToManagers:e.segmentToManagers})}),t},createSingleTerritoryManagerPayload:function(e,t,i){const a={adminToAssign:[],adminToRevoke:[]};return t.forEach(t=>{a.adminToAssign.push({userId:t,territorySegmentId:e})}),(i||[]).filter(e=>!t.includes(e)).forEach(t=>{a.adminToRevoke.push({userId:t,territorySegmentId:e})}),JSON.stringify({adminToAssign:a.adminToAssign,adminToRevoke:a.adminToRevoke})},assignTerritorySegmentManager:function(e,t,i){const a=this.createSingleTerritoryManagerPayload(e,t,i);return _LeanData.RemotingRouter.assignOrRevokeAdminsForTerritorySegments(a).catch(e=>{console.error("Error during manager assignment:",e),_LeanData.Notification.showConfirmationDialog({header:"Error",message:"Territory Segment Managers can only be removed by LeanData admins with LeanData Custom Objects Full Access. Please reach out to your admin to remove a Territory Segment Manager from this Territory Segment",confirmButtonText:"OK",showRejectButton:!1})})}})}},function(e,t){e.exports={requestModalResponse:(e,t)=>{const i=$.Deferred(),a="#"+e+"-button-1",n="#"+e+"-button-2",o="#"+e+"-modal";return $(a+", "+n).off(),$(a).on("click",function(){i.reject()}),$(n).on("click",function(){const e={};_.each(t,function(t){e[t]=_.map($(t),function(e){return $(e).val()})}),i.resolve(e)}),$(o).on("hidden.bs.modal",function(e){i.reject()}),$(o).modal("show"),i},createBUTypeahead:(e={})=>{const{isCalendaringTMPage:t=!1,selectedBU:i=null,hasReadWriteAccess:a=_LeanData._getOrganizationData().hasReadWriteAccess,hasBUAdminAccess:n=_LeanData._getOrganizationData().hasBUAdminAccess}=e;return new Magellan.Views.NestedTypeaheadSelector({required:!a&&n,asyncServiceCall:_LeanData.FlowBuilderController.searchBusinessUnits,filter:e=>(a&&(e=e.concat([{label:"Single Graph",value:null,name:null,Id:null}])),t?e.filter(e=>"Single Graph"===e.label||i&&e.label===i.label):e),selection:i?[i]:[],disableBreadcrumbs:!0,size:"large",placeholder:"Select a Business Unit"})},createIdToOwnerMap:(e={})=>{const{idToOwnerMap:t={},manager:i=[],initialManagerFetchDone:a=!1}=e;return new Promise(e=>{_LeanData.FlowBuilderController.queryUsers(i).then(i=>{_.each(i,e=>{t[e.Id]=e}),e(t)})})},createTerritoryToolTip:e=>{_LeanDataUtil.Backbone.loadAngularComponent({el:$(`#${e}-modal`)[0]},{selector:"ldc-tooltip-angular#bu-tooltip",inputs:{content:{title:"Business Unit",body:"Associate the Segment with a Business Unit.  This Segment will then become available in the respective Business Unitâ€™s Graphs.  This setting cannot be adjusted at a later time."}}});_LeanDataUtil.Backbone.loadAngularComponent({el:$(`#${e}-modal`)[0]},{selector:"ldc-tooltip-angular#tm-tooltip",inputs:{content:{title:"Territory Segment Managers",body:"Select the Territory Segment Manager(s) who can edit the territories and owner assignments of this Territory Segment. Note that Territory Managers are not able to access or edit other sections of LeanData, such as routing graphs."}}})},hasDuplicateName:(e={})=>{const{inputName:t,buId:i,existingPoolNames:a={}}=e;return a.hasOwnProperty(t)&&a[t].has(i)},createExistingPoolNames:(e={})=>{const{existingPoolNames:t={},collection:i=null}=e;i.forEach(e=>{const i=e.get(ns+"Name__c"),a=e.get(ns+"LD_Business_Unit__c");t.hasOwnProperty()||(t[i]=new Set),t[i].add(a)})}}},function(e,t){e.exports={asyncServiceCallHelper:async(e,t,i,a)=>{let n;if(n="view"===a?await _LeanData.FlowBuilderController.getAllOwnerDataRemote(e):await _LeanData.FlowBuilderController.getAllOwnerDataActiveOnlyRemote(e),Array.isArray(n)){n.forEach(e=>{"view"===a?e.Id!==t&&e.label!==i||(e.disableSelectedField=!0):e.Id!==t&&e.name!==i||(e.disableSelectedField=!0)});let e={Lead:0,Contact:1,Account:2,Opportunity:3,Case:4},o={Lead:"L",Contact:"C",Account:"A",Opportunity:"O",Case:"Ca"},[l,s]=_.partition(n,e=>"Round_Robin_Pool__c"===e.attributes.type),r=_.groupBy(l,e=>e.name),d=[];for(let t in r){let i=r[t],a=[],n=[],l=!1;for(let e of i)e.Object_Type__c in o?(l=!0,n.push(e.Object_Type__c)):a.push(_LeanData.MetaDataController.getObjectMetaDataObject(e.Object_Type__c,!0).label||e.Object_Type__c);if(l){n=_.sortBy(n,t=>e[t]),a=a.sort();let t=[...n,...a].join(", ");if(n=n.map(e=>`<span title="${e}">${o[e]}</span>`),a.length>0){let e=a.map(e=>_.escape(e)).join("/");n.push(`<span title="${e}">${a.length} more</span>`)}i[0].categories=n.join(' <span class="divider">/</span> '),i[0].name=t,d.push(i[0])}else{let e=[...a=a.sort()].join(", "),t=a.map(e=>{const t=_.escape(e);return`<span title="${t}">${_LeanData.Util.truncateText(t,10)}</span>`}).join(' <span class="divider">/</span> ');i[0].categories=t,i[0].name=e,d.push(i[0])}}l=d,n=s.concat(l)}return n}}},function(e,t){e.exports="<div> <ld-variable-setter-angular id=lead-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-merge-partial class=node-partial data-node-type=action-merge> <% if (_LeanData.AppState.PrimarySObjectType.toLowerCase() !== 'lead') { %> <div class=info-row></div> <hr class=horizontal-line-separator> <% } %> <div id=email-notification-wrapper></div> <div id=advanced-settings-wrapper> </div> </div>"},function(e,t,i){e.exports=function(){const e=_.template('\n    <li class="actions-menu-option" data-model-index="<%- index %>">\n      <%- option.label %>\n    </li>\n  ');return $.fn.ButtonDropdown=function(e){const t=new Magellan.Views.ButtonDropdown(e);return $(this).html(t.$el),t},Magellan.Views.ButtonDropdown=Backbone.View.extend({template:_.template(i(162)),className:"button-dropdown",events:{"click .primary-action":"triggerPrimaryAction","click .actions-menu-option":"triggerSecondaryAction","click .expand-menu":"expandClickHandler"},initialize:function(e){(!e||e.length<2)&&console.warn("ButtonDropdown: There should be at least two options for button dropdown."),this.primaryOption=e.shift(),this.secondaryOptions=e,this.render(),this.mouseupHandler=(e=>{e.target.closest(".button-dropdown")!==this.$el[0]&&(this.$el.toggleClass("open",!1),$(document).off("mouseup",this.mouseupHandler))})},render:function(){return this.$el.html(this.template({primaryAction:this.primaryOption})),this.renderSecondaryActions(),this},expandClickHandler:function(e){this.toggleDropdown(!this.$el.hasClass("open"))},toggleDropdown:function(e){this.$el.toggleClass("open",e),e?$(document).on("mouseup",this.mouseupHandler):$(document).off("mouseup",this.mouseupHandler)},triggerPrimaryAction:function(){this.primaryOption.action()},triggerSecondaryAction:function(e){const t=e.currentTarget.dataset.modelIndex;this.secondaryOptions[t].action(),this.toggleDropdown(!1)},renderSecondaryActions:function(){const t=this.secondaryOptions.reduce((t,i,a)=>t+((t,i)=>e({option:t,index:i}))(i,a),"");this.$(".actions-menu").html(t)}})}},function(e,t,i){e.exports=function(){Magellan.Models.ChatterRecipientSelector=i(57)(),Magellan.Views.ChatterRecipientSelector=i(58)()}},function(e,t,i){e.exports=function(){var e=i(164);return Magellan.Views.ConfirmationModal=Backbone.View.extend({_promise:null,header:"Confirmation Dialog",message:"Are you sure?",footer:"",container:"#magellan-modals",showTypeahead:!1,template:_.template(e),events:{"click .cancel-button":"onCancel","click .confirm-button":"onConfirm","click .modal":"handleOutsideClick"},initialize:function(e){if(this._promise=$.Deferred(),this.container=e.container||this.container,"function"==typeof e.onConfirmed&&this._promise.then(e.onConfirmed),"function"==typeof e.onCancelled&&this._promise.fail(e.onCancelled),"function"==typeof e.cancelConfirmation&&(this.cancelConfirmation=e.cancelConfirmation),"function"==typeof e.confirmConfirmation&&(this.confirmConfirmation=e.confirmConfirmation),this._promise.always(this.close.bind(this)),this.header=e.header||this.header,this.message=e.message||this.message,this.$contentElement=e.contentElement||null,this.footer=e.footer||this.footer,this.warningText=e.warningText||null,this.largeModal=e.largeModal,this.innerModal=e.innerModal,this.verticallyResizable=e.verticallyResizable,this.noContentPadding=e.noContentPadding,this.primaryButtonText=e.primaryButtonText||"Confirm",this.hideSecondaryButton=e.hideSecondaryButton||!1,this.secondaryButtonText=e.secondaryButtonText||"Cancel",this.hasExtraContent="boolean"==typeof e.hasExtraContent&&e.hasExtraContent,this.showTypeahead=e.showTypeahead||!1,this.showTypeahead){const t={objects:[]};this.customOnConfirmWithNestedTypeahead=e.customOnConfirmWithNestedTypeahead||null,this.nestedTypeaheadPlaceholder=e.nestedTypeaheadPlaceholder||"Search",e.typeaheadData.forEach(e=>{"string"==typeof e?t.objects.push(_LeanData.Util.convertStringToTypeaheadObject(e)):t.objects.push(e)}),this.objTypeaheadSelector=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,data:t,root:"objects",selection:null,placeholder:this.nestedTypeaheadPlaceholder,onSelect:(e,t)=>{this.el=e,this.selection=t,this.enablePrimaryButton()}}),this.objTypeaheadSelector.validate()}this.render()},_cancel:function(e){this._promise.reject(e)},_confirm:function(e){this.showTypeahead&&this.customOnConfirmWithNestedTypeahead&&this.el&&this.selection&&this.customOnConfirmWithNestedTypeahead(this.el,this.selection),this._promise.resolve(e)},onCancel:function(e){this.cancelConfirmation?(e.preventDefault(),this.cancelConfirmation(()=>{this._cancel(e)},()=>!1)):this._cancel(e)},onConfirm:function(e){this.confirmConfirmation?(e.preventDefault(),this.confirmConfirmation(()=>{this._confirm(e)},()=>!1)):this._confirm(e)},handleOutsideClick:function(e){e.target===e.currentTarget&&(this.hideSecondaryButton?this.onConfirm(e):this.onCancel(e))},render:function(){return this.$el.html(this.template({header:this.header,message:this.message,footer:this.footer,warningText:this.warningText,primaryButtonText:this.primaryButtonText,hideSecondaryButton:this.hideSecondaryButton,secondaryButtonText:this.secondaryButtonText,hasExtraContent:this.hasExtraContent,largeModal:this.largeModal,innerModal:this.innerModal,verticallyResizable:this.verticallyResizable,noContentPadding:this.noContentPadding,showTypeahead:this.showTypeahead})),$(this.container).append(this.$el),this.showTypeahead&&(this.$el.find(".modal-nested-typeahead-selector").html(this.objTypeaheadSelector.$el),this.disablePrimaryButton()),this.verticallyResizable&&this.$el.find(".modal-content-section").resizable({handles:{s:$(".bottom-handle")},containment:$(".confirmation-modal"),resize:(e,t)=>{var i=t.size.height-t.originalSize.height,a=t.originalSize.height+1.33*i;t.size.height=a}}),this},open:function(){this.$el.find(".modal").modal({backdrop:"static"}),this.$el.find(".modal").modal("show"),this.$contentElement&&this.$el.find(".modal-content-section").html(this.$contentElement)},close:function(){var e=this;return this.$el.find(".modal").on("hidden.bs.modal",function(){e.remove()}),this.$el.find(".modal").modal("hide"),this},onConfirmed:function(e){if("function"!=typeof e)throw"ConfirmationModal Error: confirmation callback must be a function.";return this._promise.then(e),this},onCancelled:function(e){if("function"!=typeof e)throw"ConfirmationModal Error: cancellation callback must be a function.";return this._promise.fail(e),this},disablePrimaryButton:function(){this.$el.find(".confirm-button").attr("disabled",!0)},enablePrimaryButton:function(){this.$el.find(".confirm-button").attr("disabled",!1)}})}},function(e,t,i){e.exports=function(){Magellan.Models.EmailRecipientSelector=i(59)(),Magellan.Views.EmailRecipientSelector=i(60)()}},function(e,t,i){e.exports=function(){Magellan.Models.EmailTemplateSelector=i(61)(),Magellan.Views.EmailTemplateSelector=i(62)()}},function(e,t,i){e.exports=function(){const e=i(168),t=Backbone.View.extend({template:_.template(e),events:{"change input":"onSelect"},onSelect:function(e){e.currentTarget.checked&&this.onSelectCallback(this.value,e)},initialize:function(e){this.label=e.label,this.icon=e.icon,this.name=e.name,this.checked=e.checked,this.value=e.value,this.onSelectCallback=e.onSelectCallback,this.render()},render:function(){this.$el.html(this.template({label:this.label,icon:this.icon,name:this.name,checked:this.checked,value:this.value}))}});$.fn.LDCardFilter=function(e){const i=new t(e);return $(this).html(i.$el),i}}},function(e,t,i){e.exports=function(){var e=i(169);$(document).on("mouseup",function(){"function"!=typeof $&&(window.$=jQuery.noConflict()),$(".ld-dropdown.open").toggleClass("open",!1)});$.fn.LDDropdown=function(e){if("function"!=typeof $&&(window.$=jQuery.noConflict()),"val"===e)return this.magellanLDDropdown instanceof Magellan.Views.LDDropdown?this.magellanLDDropdown.val():null;if("LDDropdown"===e)return this.magellanLDDropdown||null;var t=new Magellan.Views.LDDropdown(e);return $(this).html(t.$el),this.magellanLDDropdown=t,$(this)};var t=Magellan.Models.LDDropdown=Backbone.Model.extend({defaults:{value:null,options:null,required:!1},isValid:function(){var e=!0;if(!1===this.get("required"))return e;var t=this.get("value");return(_.isNull(t)||_.isUndefined(t)||""===t||this.get("options").indexOf(t)<0)&&(e=!1),e}});return Magellan.Views.LDDropdown=Backbone.View.extend({tagName:"div",optionTemplate:_.template("<span><%-option%></span>"),customOptionTemplate:null,customSelectedOptionTemplate:null,customValues:null,template:_.template(e),bloodhound:null,datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,enableSearch:!1,menuAlignClass:"",placeholder:null,disabled:!1,onChangeCallback:null,isActionMenu:!1,alwaysEnableDropdown:!1,conditionalOpen:null,initialize:function(e){if(this.model=new t,this.width=e.width,_.isUndefined(e)||(this.model.set("value",_.isUndefined(e.value)?null:e.value),this.model.set("options",e.options||[]),this.model.set("required",!0===e.required),this.model.set("customValues",e.customValues||{}),this.model.set("preferredOptions",e.preferredOptions||[]),this.model.set("hidePreferredOptions",!0===e.hidePreferredOptions),this.model.set("disabledOptions",new Set(e.disabledOptions||[])),this.model.set("disabledDescriptions",e.disabledDescriptions||{}),this.model.set("disableSelectedOptions",!0===e.disableSelectedOptions),this.model.set("selectedOptions",e.selectedOptions),"string"==typeof e.optionTemplate?this.customOptionTemplate=_.template(e.optionTemplate):this.customOptionTemplate=e.optionTemplate||null,this.customSelectedOptionTemplate=e.hasOwnProperty("customSelectedOptionTemplate")?e.customSelectedOptionTemplate:this.customOptionTemplate,this.queryTokenizer=e.queryTokenizer||this.queryTokenizer,this.datumTokenizer=e.datumTokenizer||this.datumTokenizer,this.disabled=e.disabled,this.enableSearch=_.isBoolean(e.enableSearch)?e.enableSearch:this.model.get("options").length>=10,this.menuAlignClass=e.alignMenuRight?"pull-right":"",this.placeholder="string"==typeof e.placeholder&&e.placeholder?e.placeholder:"Select One",this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.isActionMenu="boolean"==typeof e.isActionMenu&&e.isActionMenu,this.enableSearch&&this._initBloodhound(this.model.get("options")),this.isValid=_.isFunction(e.isValid)?e.isValid:this.model.isValid.bind(this.model),this.alwaysEnableDropdown=e.alwaysEnableDropdown||this.alwaysEnableDropdown,"function"==typeof e.conditionalOpen&&(this.conditionalOpen=e.conditionalOpen)),e&&e.size)switch(e.size){case"large":this.$el.prop("class","ld-dropdown ld-dropdown-large");break;case"xtra-small":this.$el.prop("class","ld-dropdown ld-dropdown-xtra-small");break;default:this.$el.prop("class","ld-dropdown ld-dropdown-small")}else this.$el.prop("class","ld-dropdown ld-dropdown-small");this.render(),this.listenTo(this.model,"change",this._handleModelChange)},_initBloodhound:function(e){this.bloodhound=new Bloodhound({local:e,queryTokenizer:this.queryTokenizer,datumTokenizer:this.datumTokenizer}),this.bloodhound.initialize().then(this._search.bind(this,this.$(".ld-dropdown-search-filter-input").val()))},events:{"click .ld-dropdown-search-filter-container":function(e){e.preventDefault(),e.stopPropagation()},"click .ld-dropdown-option-list-item":"selectOption","mouseup .ld-dropdown-search-filter-input":function(e){e.stopPropagation()},"keyup .ld-dropdown-search-filter-input":"_searchInputChanged","mouseup .ld-dropdown-toggle":function(e){if(!this.conditionalOpen||!this.conditionalOpen()){e.stopPropagation();var t=$(e.target).closest(".ld-dropdown");$(".ld-dropdown.open").not(t).toggleClass("open",!1),t.toggleClass("open").find(".ld-dropdown-toggle").focus(),this.enableSearch&&(this.$(".ld-dropdown-search-filter-input").focus(),(this.alwaysEnableDropdown||this.model.get("options").length<100)&&this.$(".ld-dropdown-option-list-item").show())}},"mouseup .ld-dropdown":function(e){e.stopPropagation()}},render:function(){var e=this.template(this);return this.$el.html(e),this._renderSelectList(),this._renderSelectedValue(),this.$el.toggleClass("disabled",!0===this.disabled),this.disabled&&this.$el.removeClass("input-invalid"),this.$(".ld-dropdown-search-filter-container").toggleClass("hidden",!1===this.enableSearch),this.width&&this.$el.find(".dropdown-menu").css("min-width",this.width+"px"),this},selectOption:function(e){"function"!=typeof $&&(window.$=jQuery.noConflict());var t=$(e.target);$(e.target).is(".ld-dropdown-option-list-item")||(t=$(e.target).closest(".ld-dropdown-option-list-item"));var i=t.find(".ld-dropdown-option").data("model-index"),a=this.model.get("options")[i];this.model.get("disabledOptions").has(a)||(this.isActionMenu?this.onChangeCallback(a,this):(this.model.set("value",a),this.$(".ld-dropdown-option-list-item.selected").toggleClass("selected",!1),t.toggleClass("selected",!0)))},val:function(){return this.model.get("value")},set:function(e){this.model.set("value",e),this._renderSelectList(),this._renderSelectedValue()},validate:function(){var e=this.isValid();return this.$el.toggleClass("input-invalid",!e),e},toggleDisabled:function(e){void 0===e?this.$el.toggleClass("disabled"):this.$el.toggleClass("disabled",e)},setOptionState:function(e,t){t?this.model.get("disabledOptions").add(e):this.model.get("disabledOptions").delete(e),this._renderSelectList()},updatePlaceholderText:function(e){this.$(".ld-dropdown-value").html(e)},_handleModelChange:function(){this._renderSelectedValue(),this.$el.trigger("LDDropdown:change",this),this.onChangeCallback(this.val(),this)},_getOptionItemMarkup:function(e,t){var i="";return"function"==typeof t?i=t(e):"object"==typeof e&&!1===_.isNull(e)?(console.warn("LDDropdown: option an item is an object, but no custom template was provided (optionTemplate)"),i=this.optionTemplate({option:JSON.stringify(e)})):i="boolean"==typeof e?this.optionTemplate({option:_.capitalize(e+"")}):this.optionTemplate({option:(_.isNull(e)||_.isUndefined(e)?"":e)+""}),i},_renderSelectedValue:function(){var e=this.model.get("value"),t=this.placeholder;(!_.isEmpty(e)||_.isBoolean(e)||_.isNumber(e))&&(t=this._getOptionItemMarkup(e,this.customSelectedOptionTemplate)),this.$(".ld-dropdown-value").html(t),this.$(".ld-dropdown-value").prop("title",$("<div>").html(t).text()),this.validate()},_renderSelectList:function(){"function"!=typeof $&&(window.$=jQuery.noConflict());var e="";this.$(".dropdown-menu .ld-dropdown-option-list-item").remove();var t={},i=this.model.get("preferredOptions"),a=this.model.get("hidePreferredOptions"),n=this.model.get("disabledOptions")||new Set;let o=this.model.get("disabledDescriptions")||{};var l=function(e,t,l){var s=i.includes(e);let r=!!e&&(n.has(e)||n.has(e.value));var d="";d+=e===this.model.get("value")?"selected ":"",d+=a&&s&&!l?"hidden ":"",d+=r?"disabled ":"";let c=e?o[e]||o[e.value]:null;return _.template('<li title="<%- disabledDescription %>" class="ld-dropdown-option-list-item <%- additionalClasses %>"><div class="ld-dropdown-option" data-model-index="<%-modelIndex%>"><%=renderedOptionTemplate%></div></li>')({renderedOptionTemplate:this._getOptionItemMarkup(e,this.customOptionTemplate),modelIndex:t,additionalClasses:d,disabledDescription:c})}.bind(this),s=0;_.each(this.model.get("options"),(a,n)=>{this.model.get("disableSelectedOptions")&&this.model.get("selectedOptions").includes(a)||(e+=l(a,n,!1),a==i[s]&&(t[s]=n,s++))});var r="";_.each(i,(e,i)=>{r+=l(e,t[i],!0)}),_.isEmpty(r)||(e=r+'<li class="separator preferred-section-separator" style="border-bottom: 1px solid #CCC;"></li>'+e),this.$(".dropdown-menu").append(e);var d=this.$(".preferred-section-separator").index();d>-1&&this.$(".dropdown-menu li").slice(0,d).each(function(){$(this).hasClass("ld-dropdown-option-list-item")&&$(this).toggleClass("is-preferred-option",!0)})},_searchInputChanged:_.debounce(function(e){var t=$(e.currentTarget).val();t?this._search(t):this.$(".ld-dropdown-option-list-item").show()},300),_search:function(e){this.bloodhound.search(e,this._filterByItems.bind(this))},_filterByItems:function(e){var t=this.model.get("options");e.length!==t.length?(this.$(".dropdown-menu .ld-dropdown-option-list-item").hide(),_.each(e,e=>{var i=t.indexOf(e);this.$(".dropdown-menu .ld-dropdown-option-list-item:not(.is-preferred-option)").eq(i).show()})):this.$(".dropdown-menu .ld-dropdown-option-list-item").show()}})}},function(e,t,i){e.exports=function(){var e=i(170),t=Magellan.Views.LDInput=Backbone.View.extend({inputEl:null,labelEl:null,errorEl:null,validate:null,className:"ld-input-container",tagName:"span",_isEditing:!1,events:{"change .ld-input":"update","blur .ld-input":function(){this.isValid()&&this.viewMode()},"click .ld-input-label":"editMode","keyup .ld-input":"_onTyping","LDInput:validate .ld-input":"isValid","LDInput:edit .ld-input":"editMode","LDInput:view .ld-input":"viewMode"},initialize:function(e){_.isUndefined(e)||(e.inputEl&&(this.inputEl=e.inputEl),e.validate&&(this.validate=e.validate),this.showError=!_.isBoolean(e.showError)||e.showError,this._isEditing="edit"===e.mode||!1,this.style=e.style),$("#paper").off(),$("#paper").on("click",function(){this.viewMode()}.bind(this)),this.render()},template:_.template(e),render:function(){return this.$el.html(this.template({editIconURL:resourceURL+"/images/Edit_Icon_Unselected_50x50.png",style:this.style})),null!==this.inputEl?(this.$(".ld-input").replaceWith(this.inputEl),this.inputEl.toggleClass("ld-input",!0)):this.inputEl=this.$(".ld-input"),this.labelEl=this.$(".ld-input-label"),this.labelEl.find(".label-text").text(this.inputEl.val()),this.errorEl=this.$(".ld-input-error"),this._isEditing?this.editMode():this.viewMode(),this.update(),this},editMode:function(){this._isEditing=!0,this.$el.toggleClass("ld-input-mode-edit",this._isEditing).toggleClass("ld-input-mode-view",!1),this.inputEl.focus()},viewMode:function(){this._isEditing=!1,this.$el.toggleClass("ld-input-mode-view",!0).toggleClass("ld-input-mode-edit",this._isEditing)},isValid:function(){var e=this.validate(this.inputEl.val());return _.isEmpty(e)?(this.inputEl.toggleClass("input-invalid",!1),this.errorEl.hide(),this.inputEl.trigger("LDInput:isValid",this.inputEl.val()),this.$el.prop("title",""),!0):(this.inputEl.toggleClass("input-invalid",!0),this.showError?(this.errorEl.show(),this.errorEl.html(e)):this.$el.prop("title",e),this.inputEl.trigger("LDInput:isInvalid"),!1)},update:function(){const e=this.labelEl.find(".label-text").text();return this.labelEl.find(".label-text").text(this.inputEl.val()),this.inputEl.trigger("LDInput:updated",{newValue:this.inputEl.val(),previousValue:e}),this.isValid()},_onTyping:function(e){13==e.keyCode&&(this.update()?this.viewMode():this.editMode()),_.isUndefined(this._debouncedIsValid)&&(this._debouncedIsValid=_.debounce(this.isValid.bind(this),50)),this._debouncedIsValid()}});$.fn.LDInput=function(e){if(e&&!_.isUndefined(e.defaultValue)&&$(this).val(e.defaultValue),"string"==typeof e)switch(e){case"validate":$(this).trigger("LDInput:validate");break;case"edit":$(this).trigger("LDInput:edit");break;case"view":$(this).trigger("LDInput:view")}else if($(this).hasClass("ld-input"))(e=e||{}).mode&&"edit"===e.mode?$(this).trigger("LDInput:edit"):$(this).trigger("LDInput:view"),$(this).trigger("change");else{(e=e||{}).inputEl=$(this);var i=$("<span></span>");$(this).replaceWith(i);var a=new t(e);i.replaceWith(a.$el)}return $(this)}}},function(e,t,i){e.exports=function(){var e=window.Magellan=window.Magellan||e||{};window.LD_MULTI_SELECT_DROPDOWN_MAP=window.LD_MULTI_SELECT_DROPDOWN_MAP||{},$(window).click(function(e){e.stopPropagation(),"function"!=typeof $&&(window.$=jQuery.noConflict());var t=$(e.target);if(0===t.parents(".multiselect-dropdown").length&&!t.hasClass("multiselect-dropdown")){var i=$(".multiselect-dropdown.open");if(i.toggleClass("open",!1),i.length>0){var a=i.parent(),n=window.LD_MULTI_SELECT_DROPDOWN_MAP[a[0].className];if(n){var o=n._getSelectedItems(!0);n.onCloseCallback(o.string,o.object)}}}}),$.fn.MultiSelectDropdown=function(t){"function"!=typeof $&&(window.$=jQuery.noConflict());var i=$(this)[0].className;if("MultiSelectDropdown"===t)return window.LD_MULTI_SELECT_DROPDOWN_MAP[i]||null;var a=new e.Views.MultiSelectDropdown(t);return $(this).html(a.$el),window.LD_MULTI_SELECT_DROPDOWN_MAP[i]=a,a};var t=Backbone.Model.extend({defaults:{options:[]}});e.Views.MultiSelectDropdown=Backbone.View.extend({tagName:"div",template:_.template(i(171)),optionTemplate:_.template(i(172)),initialize:function(e){e=e||{},this.model=new t({options:e.options||[]}),this.dropdownType=e.dropdownType||"items",this.placeholder=e.placeholder||"Select "+this.dropdownType,this.allSelectedPlaceholder="All "+this.dropdownType+" selected",this.selectAll=e.selectAll||!1,this.selected=e.selectedOptions||[],this.labelPropertyName=e.customLabelProperty||"label",this.valuePropertyName=e.customValueProperty||"value",this.generatePlaceholder="function"==typeof e.generatePlaceholder?e.generatePlaceholder:null,this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.onCloseCallback="function"==typeof e.onClose?e.onClose:_.noop,this.hasAdaptiveDropdownWidth=e.hasAdaptiveDropdownWidth,this.dropdownWidth=this.hasAdaptiveDropdownWidth?null:e.dropdownWidth,this.size=e.size&&"large"===e.size?"large":"small",this.checkboxClass="cb-container-"+this.size,this.$el.prop("class","multiselect-dropdown multiselect-dropdown-"+this.size),this.listenTo(this,"setToggleCheckboxState",this.setToggleCheckboxState),this.render()},events:{"mouseup .multiselect-dropdown-option-list-item":"selectOption","mouseup .multiselect-toggle-all-list-item":"toggleAllOptions",mouseup:"toggleDropdown"},toggleDropdown:function(e){e.stopPropagation();var t=$(e.target),i=t.closest(".multiselect-dropdown"),a=i.hasClass("open");if(0===t.parents(".multiselect-dropdown-menu").length&&!t.hasClass("multiselect-dropdown-menu")&&($(".multiselect-dropdown.open").not(i).toggleClass("open",!1),i.toggleClass("open").find(".multiselect-dropdown-toggle").focus(),a)){var n=this._getSelectedItems(!0);this.onCloseCallback(n.string,n.object),this.trigger("MultiSelectDropdown:close",n.string,n.object,this)}this.hasAdaptiveDropdownWidth&&this._setDropdownWidth.bind(this)()},toggleAllOptions:function(e){var t=$(e.currentTarget).find('input[type="checkbox"]'),i=this.$el.find('.multiselect-dropdown-option-list-item input[type="checkbox"]');t.prop("checked",!t.is(":checked")),i.prop("checked",t.is(":checked"));var a=this._getSelectedItems(!0),n=a.string.length,o=this.model.get("options").length;_.isNull(this.generatePlaceholder)?this.$el.find(".placeholder-text").text(t.is(":checked")?this.allSelectedPlaceholder:this.placeholder):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,a.string,a.object,o,this.dropdownType)),this.$el.find(".toggleText").text(t.is(":checked")?"Deselect All":"Select All"),this.onChangeCallback(null,a.string,a.object,o),this.trigger("MultiSelectDropdown:select",null,a.string,a.object,o,this),this.trigger("setToggleCheckboxState",n===o,n,o)},checkAllOptions:function(e){let t=$(e.currentTarget).find('input[type="checkbox"]'),i=this.$el.find('.multiselect-dropdown-option-list-item input[type="checkbox"]');t.prop("checked",!0),i.prop("checked",!0);let a=this._getSelectedItems(!0),n=a.string.length,o=this.model.get("options").length;_.isNull(this.generatePlaceholder)?this.$el.find(".placeholder-text").text(this.allSelectedPlaceholder):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,a.string,a.object,o,this.dropdownType)),this.$el.find(".toggleText").text("Select All"),this.onChangeCallback(null,a.string,a.object,o),this.trigger("MultiSelectDropdown:select",null,a.string,a.object,o,this),this.trigger("setToggleCheckboxState",n===o,n,o)},setToggleCheckboxState:function(e,t,i){this.$el.find('.multiselect-toggle-all-list-item input[type="checkbox"]').prop("checked",e),this.$el.find(".toggleText").text(e?"Deselect All":"Select All")},selectOption:function(e){"function"!=typeof $&&(window.$=jQuery.noConflict());var t=$(e.currentTarget).find('input[type="checkbox"]');t.prop("checked",!t.is(":checked"));var i=t.data("value"),a=this._getSelectedItems(!0),n=a.string.length,o=this.model.get("options").length;_.isNull(this.generatePlaceholder)?n===o?this.$el.find(".placeholder-text").text(this.allSelectedPlaceholder):n>0?this.$el.find(".placeholder-text").text(n+" of "+o+" "+this.dropdownType+" selected"):this.$el.find(".placeholder-text").text(this.placeholder):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,a.string,a.object,o,this.dropdownType)),this.onChangeCallback(i,a.string,a.object,o),this.trigger("MultiSelectDropdown:select",i,a.string,a.object,o,this),this.trigger("setToggleCheckboxState",n===o,n,o)},_getSelectedItems:function(e){var t=[],i=[],a=this.$el.find("."+this.checkboxClass+' input[type="checkbox"]:checked');return _.each(Array.prototype.slice.apply(a),e=>{var a=$(e).data();if(!_.isEmpty(a)){var n={};n[this.labelPropertyName]=a.label,n[this.valuePropertyName]=a.value,i.push(n),t.push(n[this.valuePropertyName])}}),e?{object:i,string:t}:t},_updateSelectList:function(e){this.model.set("options",e||[]),this._renderSelectList()},_renderSelectList:function(){var e=this.model.get("options"),t="";this.$el.find(".multiselect-dropdown-option-list-item").remove(),_.each(e,e=>{var i=this.optionTemplate({label:e[this.labelPropertyName],value:e[this.valuePropertyName],checkboxClass:this.checkboxClass});t+=i}),e.length>0?(this.$el.find(".multiselect-toggle-all-list-item").show(),this.$el.find(".multiselect-dropdown-menu").append(t),this.selectAll||_.isEmpty(this.selected)?this.$el.find(`.${this.checkboxClass} input[type="checkbox"]`).prop("checked",this.selectAll):this.selected.forEach(e=>{this.$el.find(`.${this.checkboxClass} input[type="checkbox"][data-value="${e}"]`).prop("checked",!0)}),this.$el.find(".toggleText").text(this.selectAll?"Deselect All":"Select All")):this.$el.find(".multiselect-toggle-all-list-item").hide();var i=this._getSelectedItems(!0),a=(i.string.length,this.model.get("options").length);_.isNull(this.generatePlaceholder)?e.length>0?this.$el.find(".placeholder-text").text(this.selectAll?this.allSelectedPlaceholder:this.placeholder):this.$el.find(".placeholder-text").text("No "+this.dropdownType+" to select"):this.$el.find(".placeholder-text").html(this.generatePlaceholder(null,i.string,i.object,a,this.dropdownType)),setTimeout(this._setDropdownWidth.bind(this))},_setDropdownWidth:function(){var e=this.$el.find(".multiselect-dropdown-menu"),t=this.$el.width(),i=e.width();this.hasAdaptiveDropdownWidth||i<t?e.css({width:t+32}):this.$el.css({width:this.dropdownWidth||i+2})},render:function(){var e=this.template({placeholder:this.placeholder,allSelectedPlaceholder:this.allSelectedPlaceholder,selectAll:this.selectAll,checkboxClass:this.checkboxClass});return this.$el.html(e),this._renderSelectList(),this}})}},function(e,t,i){e.exports=function(){const e=i(173),t=Backbone.View.extend({template:_.template(e),events:{"change input":"onSelect"},onSelect:function(e){e.currentTarget.checked&&this.onSelectCallback(this.value,e)},initialize:function(e){this.label=e.label,this.sublabel=e.sublabel,this.name=e.name,this.checked=e.checked,this.value=e.value,this.onSelectCallback=e.onSelectCallback,this.render()},render:function(){this.$el.html(this.template({label:this.label,sublabel:this.sublabel,name:this.name,checked:this.checked,value:this.value}))}});$.fn.LDRadioButton=function(e){const i=new t(e);return $(this).html(i.$el),i}}},function(e,t,i){e.exports=function(){var e=i(174);return Magellan.Views.LDSelectableList=Backbone.View.extend({tagName:"div",className:"ld-selectable-list-component",selected:null,template:_.template(e),listItemContentTemplate:_.template("<span><%-item%></span>"),_originalSelected:null,initialize:function(e){this.model=new(Backbone.Model.extend({validate:_.isFunction(e.validate)?e.validate:_.noop}))({data:e.data||[]}),this._originalSelected=e.selected||null,this.header=e.header||null,_.isFunction(e.itemTemplate)?this.listItemContentTemplate=e.itemTemplate:_.isString(e.itemTemplate)&&!_.isEmpty(e.itemTemplate)&&(this.listItemContentTemplate=_.template(e.itemTemplate)),_.isFunction(e.notFoundTemplate)?this.notFoundTemplate=e.notFoundTemplate:_.isString(e.notFoundTemplate)&&!_.isEmpty(e.notFoundTemplate)&&(this.notFoundTemplate=_.template(e.notFoundTemplate)),this.listenTo(this.model,"change:data",this.render),this.listenTo(this.model,"change:selected",this._handleModelSelectedChange)},events:{"click .ld-selectable-list-item":"_handleListItemClick"},render:function(){var e=this.template({model:this.model,header:this.header,itemContentTemplate:this.listItemContentTemplate});return this.$el.html(e),this.setSelected(this.model.get("selected")||this._originalSelected),this},setSelected:function(e){e=e||null,this.model.set("selected",e),this.validate()},validate:function(){var e="";this.model.isValid()||(e=this.model.validationError),this.$(".error-message").html(e)},_setActiveListItem:function(e){if(this.$(".ld-selectable-list-item.active").removeClass("active"),!(e<0)){this.$(".ld-selectable-list-item").eq(e).toggleClass("active",!0);var t=this.model.get("data")[e];this.setSelected(t)}},_handleModelSelectedChange:function(){var e=this.model.get("selected"),t=this.model.get("data").indexOf(e);this._setActiveListItem(t),_.isNull(e)||_.isUndefined(e)?this.$(".selected").html('<em class="text-muted">None</em>'):t<0?this.$(".selected").html(this.notFoundTemplate({notFound:this._originalSelected||""})):this.$(".selected").html(this.listItemContentTemplate(this.model.get("selected")))},_handleListItemClick:function(e){var t=this.$(".ld-selectable-list-item").index(e.currentTarget);this._setActiveListItem(t)}})}},function(e,t,i){e.exports=function(){Magellan.Views.LDTable=Backbone.View.extend({events:{"click .edit-button":"handleEditButtonClick","click .cancel-button":"handleCancelButtonClick","click .save-button":"handleSaveButtonClick","click .delete-button":"handleDeleteButtonClick"},handleDeleteButtonClick:function(e){var t=$(e.target).closest("tr"),i=this.table.row(t).data();this.table.row(t).remove().draw(),this.trigger("delete",i)},clear:function(){this.table.clear().draw()},handleCancelButtonClick:function(e){e.preventDefault();var t=$(e.target).closest("tr");this.$el.find(".edit-button").show(),$(".disable-while-row-edit").removeClass("disabled-by-edit"),t.removeClass("editing");var i=this.table.row(t);this.columns.map(function(e,t){return e.editor.getValue()});0!==this.currentRowData.filter(function(e){return""!==e&&!_.isNull(e)&&!_.isUndefined(e)}).length?i.data(this.currentRowData):(i.remove(),this.table.draw()),this.currentRowData=null,this.trigger("cancel")},handleSaveButtonClick:function(e){var t=$(e.target).closest("tr"),i=this.table.row(t),a={start:null,end:null},n=this.columns.map(function(e,t){var i=e.editor;return e.name.startsWith("Start Date")&&(a.start=e.editor),e.name.startsWith("End Date")&&(a.end=e.editor),i.getValue()}),o=this.columns.map(function(e,t){return e.editor.validate()}),l=!0;_.isEmpty(a.start)||_.isEmpty(a.end)||((l=+moment(a.start.getValue())<+moment(a.end.getValue()))||a.start.validate(!0));!o.includes(!1)&&l&&(this.$el.find(".edit-button").show(),$(".disable-while-row-edit").removeClass("disabled-by-edit"),t.removeClass("editing"),i.data(n.concat(this.editColHtml)),this.trigger("change",n))},handleEditButtonClick:function(e){var t=$(e.target).closest("tr");this.enterEditMode(t),this.trigger("edit",t.data())},enterEditMode:function(e){this.$el.find(".edit-button").hide(),$(".disable-while-row-edit").addClass("disabled-by-edit"),e.addClass("editing");var t=this.table.row(e).index();this.currentRowData=_.cloneDeep(this.table.row(e).data());for(var i=0;i<this.tableColCount;i++){var a=this.table.cell(t,i);if(i===this.tableColCount-1&&this.isInlineEditorEnabled){return void a.data('<button type="button" class="cancel-button lds-secondary-small-button">Cancel</button><button type="button" class="save-button lds-primary-small-button">Done</button>')}var n=this.currentRowData[i],o=this.columns[i].editor;!_.isUndefined(o)&&!_.isNull(o)?(a.data(""),o.setValue(n),o.setElement(a.node()),o.render()):a.data(n)}},addRow:function(){var e=Array(this.dataColCount).fill("");e.push(null);var t=this.table.row.add(e);this.table.draw();var i=$(t.node());this.enterEditMode(i)},reset:function(){this.table.clear().draw(),this.table.columns.adjust().draw(),this.trigger("reset")},revert:function(){this.table.clear(),this.table.rows.add(_.cloneDeep(this.originalData)),this.table.draw(),this.trigger("revert")},getData:function(){for(var e=this.table.rows().data(),t=[],i=0;i<e.length;i++){var a=_.clone(e[i]);this.isInlineEditorEnabled&&(a=a.slice(0,this.dataColCount)),t.push(a)}return t},getNamedData:function(){for(var e=this,t=this.table.rows().data(),i=[],a=0;a<t.length;a++){var n=_.clone(t[a]);this.isInlineEditorEnabled&&(n=n.slice(0,this.dataColCount));var o={};n.forEach(function(t,i){var a=e.columns[i].name;o[a]=t}),i.push(o)}return i},initialize:function(e){_anyNumberSort=function(e,t,i){return(e=null!==(e=parseInt(e.replace(/<[^>]+>/g,"")))?e:i)<(t=null!==(t=parseInt(t.replace(/<[^>]+>/g,"")))?t:i)?-1:e>t?1:0},$.extend($.fn.dataTableExt.oSort,{"any-number-asc":function(e,t){return _anyNumberSort(e,t,Number.POSITIVE_INFINITY)},"any-number-desc":function(e,t){return-1*_anyNumberSort(e,t,Number.NEGATIVE_INFINITY)}}),this.columns=e.columns,this.givenDatatableOptions=e.datatableOptions||{},this.isInlineEditorEnabled=e.isInlineEditorEnabled,this.dataColCount=e.columns.length,this.tableColCount=e.columns.length+(this.isInlineEditorEnabled?1:0),this.originalData=e.data,this.editColHtml='<button type="button" class="edit-button lds-secondary-small-button">Edit</button><button type="button" class="delete-button lds-secondary-small-button">Delete</button>'},template:_.template(i(175)),render:function(){var e=this.template({});return this.$el.html(e),function initializeHeaderRow(){var e=this.$el.find(".header-row");this.columns.forEach(function(t){e.append("<th>"+t.name+"</th>")}),this.isInlineEditorEnabled&&e.append("<th></th>")}.call(this),theview=this,this.table=function initializeDatatable(e){var t={columns:this.columns,columnDefs:[],data:e.data,paginate:!1,autoWidth:!0,scrollInfinite:!0,scrollCollapse:!1,scrollY:"450px",searchDelay:0,deferRender:!1,dom:"frtp",select:!0,rowId:"data-cid",language:{search:"",searchPlaceholder:"Search"},createdRow:function(t,i,a){e.givenDatatableOptions.disableRowHover||$(t).addClass("hover-row"),_.each(e.givenDatatableOptions.additionalRowDataAttributes,e=>{$(t).prop(e.prop,i[e.dataVal])})},drawCallback:function(e){}},i={columnDefs:[]};if(this.isInlineEditorEnabled){var a=this.tableColCount-1;i.columnDefs.push({orderable:!1,targets:a,defaultContent:this.editColHtml})}this.columns.forEach(function(e,t){var a=e.editor;a&&"getRenderFunction"in a&&i.columnDefs.push({targets:t,render:a.getRenderFunction()})});var n=_.defaultsDeep(e.givenDatatableOptions,t,i);return $(this.$el.find(".ld-table")).DataTable(n)}.call(this,{data:this.originalData,givenDatatableOptions:this.givenDatatableOptions}),this}});Magellan.Views.LDTableCellEditors=Magellan.Views.LDTableCellEditors||{},Magellan.Views.LDTableCellEditors.Input=Backbone.View.extend({initialize:function(){},setValue:function(e){},getValue:function(){},validate:function(){return!0},getDisplayText:function(){}}),Magellan.Views.LDTableCellEditors.Text=Magellan.Views.LDTableCellEditors.Input.extend({template:_.template('<input class="lds-field-large" placeholder="<%- placeholder %>" value="<%- value %>"></input>'),initialize:function(e){this.value="",this.placeholder=e.placeholder||""},render:function(){var e=this.template({value:this.value,placeholder:this.placeholder});this.$el.html(e)},setValue:function(e){this.value=e},getValue:function(){return this.value=this.$el.find("input").val(),this.value},validate:function(){return""===this.getValue()?(this.$el.find("input").css("border","1px solid #ff6e6e"),!1):(this.$el.find("input").css("border","1px solid var(--lt-grey-2)"),!0)}}),Magellan.Views.LDTableCellEditors.AsyncTypeahead=Magellan.Views.LDTableCellEditors.Input.extend({initialize:function(e){this.placeholder=e.placeholder||"Search",this.asyncServiceCall=e.asyncServiceCall||_.noop,this.onSelect=e.onSelect||_.noop,this.typeahead=null,this.value=null},render:function(){this.typeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:_.isEmpty(this.value)?[]:[this.value],size:"large",asyncServiceCall:this.asyncServiceCall,onSelect:this._onSelect.bind(this),placeholder:this.placeholder}),this.typeahead.validate(),this.$el.html(this.typeahead.$el)},_onSelect:function(e,t){this.value=_.isArray(t)?t[0]:null,this.onSelect(this.value)},getValue:function(){return _.isArray(this.typeahead.selection)?this.typeahead.selection[0]:null},setValue:function(e){this.typeahead&&!_.isUndefined(e)&&this.typeahead.setSelection([e])},getRenderFunction:function(){return _.bind(()=>_.isObject(this.value)?this.value.label:"")}}),Magellan.Views.LDTableCellEditors.ReadOnly=Magellan.Views.LDTableCellEditors.Text.extend({template:_.template("<%- value %>"),initialize:function(e){e=e||{},this.value=e.value||"",this.placeholder=e.placeholder||"",this.readOnly=!0},render:function(){var e=this.template({value:this.value});this.$el.html(e)},setValue:function(e){this.value=e||this.placeholder},getValue:function(){return this.value},validate:function(){return!0}}),Magellan.Views.LDTableCellEditors.DateTime=Magellan.Views.LDTableCellEditors.Text.extend({template:_.template('<input placeholder="<%- placeholder %>" class="datetime-cell-input lds-field-large" value="<%- value %>"></input>'),initialize:function(e){this.value="",this.placeholder=e.placeholder||"",this.timeFormat=e.timeFormat||"HH:mm:ss",this.isEndDate=e.isEndDate||!1},render:function(){var e=this.template({value:this.value,placeholder:this.placeholder});this.$el.html(e),$(this.$el.find("input")).datetimepicker({dateFormat:"yy-mm-dd",timeFormat:this.timeFormat,timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1,hour:this.isEndDate?23:0,minute:this.isEndDate?59:0,second:this.isEndDate?59:0})},setValue:function(e){this.value=e},getValue:function(){return this.value=this.$el.find("input").val(),this.value},validate:function(e){return""===this.getValue()||e?(this.$el.find("input").css("border","1px solid #ff6e6e"),!1):(this.$el.find("input").css("border","1px solid var(--lt-grey-2)"),!0)}}),Magellan.Views.LDTableCellEditors.TimeZone=Magellan.Views.LDTableCellEditors.Input.extend({template:_.template('<div class="ld-dropdown-small timezone-dropdown"></div>'),initialize:function(e){this.value=e.value||"",this.placeholder=e.placeholder||"Select one"},render:function(){var e=this.template({value:this.value,placeholder:this.placeholder});this.$el.html(e);var t=_LeanData.DateUtil.guessUserTimezone(),i=t?[t]:null;this.tzDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.value||void 0,options:Object.keys(_LeanData.DateUtil.getTimezonesMap()),placeholder:this.placeholder,optionTemplate:function(e){return _.template("<span><%- option %></span>")({option:_LeanData.DateUtil.getTimezonesNameMap()[e]})},onChange:function(e){this.value=e}.bind(this),preferredOptions:i,tokenizer:_LeanData.DateUtil.timezoneTokenizer.bind(_LeanData.Util)}),this.$el.find(".timezone-dropdown").html(this.tzDropdown.$el)},setValue:function(e){this.value=e},getValue:function(){return this.value},validate:function(){return this.tzDropdown.validate()}})}},function(e,t,i){e.exports=function(){Magellan.Models.MessageCreator=i(63)(),Magellan.Views.MessageCreator=i(64)()}},function(e,t,i){e.exports=function(){var e=i(180),t=i(179);const a=new Set(["REFERENCE","SOBJECT","Team"]);var n=function(e){return e&&a.has(e.type)},o=Magellan.Models.MultiNestedTypeaheadSelector=Magellan.Models.NestedTypeaheadSelector.extend({defaults:{}});Magellan.Views.MultiNestedTypeaheadSelector=Magellan.Views.NestedTypeaheadSelector.extend({multiSelectTemplate:_.template(t),events:{"click .tt-custom-input":"_onCustomInputSelect","click .multi-nestedtypeahead-checkbox":"_onSelectCheckBox","typeahead:autocomplete .typeahead":"_selectFirstItemOnMenu","typeahead:render .typeahead":"_onSuggestionsRendered","input .typeahead":"_onInputChange","blur .typeahead":function(e){this._setInputValueWithSelected(e,!0)},"focus .typeahead":function(e){this.$(".tt-custom-input").toggleClass("hidden",!0),this.$(e.target).typeahead("val",""),this._refreshSelectionBreadcrumbs()}},initialize:function(t){this.type=t.type||"PICKLIST",this.multiSelect=!0,Magellan.Views.MultiNestedTypeaheadSelector.__super__.initialize.apply(this,arguments),this.selection=[],this.selectionTemplate=_.template(e),this.render(),t.selection&&this.setSelection(t.selection)},processFetchedData:function(e,t){var i=JSON.parse(e);this.model=new o(i),this.bloodHound=void 0!=t.asyncServiceCall?this._getAsyncBloodHound(t.asyncServiceCall):this._getBloodHound(this.model.get(this.root)),this.searchEngine=this._getSearchEngine(this.bloodHound),this.render(),t.selection&&this.setSelection(t.selection)},getTypeaheadConfigurations:function(e,t){var i=this,a=i.requireSelectionFromData?i.notFoundTemplate:function(){return"<div></div>"};return{name:e||"multi-nested-typeahead-selector",limit:1e3,display:function(e){return n(e)?e.label.replace(" ID",""):i.multiSelect?e.label.replace(" ID",", "):e.label},source:t,templates:{header:_.template('<div class="mnts-selected-field-container"></div>'),suggestion:function(e){var t={suggestion:e,title:e.name};return e.isCategoryLabel?i.categoryLabelTemplate(t):i.multiSelectTemplate(t)},notFound:a}}},_onCustomInputSelect:function(e){"function"!=typeof $&&(window.$=jQuery.noConflict());var t=$(e.currentTarget).text(),i=_.find(this.model.get(this.root)||this.lastReceivedResult||[],e=>e.label===t);i||((i=_LeanData.Util.convertStringSelectionToArray(t)[0]).custom=!0);var a=this._indexInSelection(i),n=this.model.get(this.root)||this.lastReceivedResult||[];-1!==a?(this.selection.splice(a,1),n=this._removeCustomObjectFromData(n,i)):(this.selection.push(i),i.custom&&n.push(i)),this._resetBloodHoundData(n),this._refreshSelectionBreadcrumbs(),this.onSelectCallback(this,this.selection),this.$(".typeahead.tt-input").blur(),this.customInputSelect=!0},_removeCustomObjectFromData:function(e,t){if(t.custom)for(var i=e.length-1;i>=0;i--)if(t.label===e[i].label&&t.name===e[i].name){e.splice(i,1);break}return e},_onSelectCheckBox:function(e,t){"function"!=typeof $&&(window.$=jQuery.noConflict());var i=$(e.currentTarget),a=i.is(":checked"),n=i.data("label").toString(),o=_.find(this.model.get(this.root)||this.lastReceivedResult||[],e=>e.label===n),l=this._indexInSelection(o);if(a&&-1==l)this.selection.push(o);else if(this.selection.splice(l,1),o.custom){var s=this.model.get(this.root)||this.lastReceivedResult||[];s=this._removeCustomObjectFromData(s,o),this._resetBloodHoundData(s)}this._refreshSelectionBreadcrumbs(),_.isEmpty(this.bloodHound.remote)?this._refreshSelectionMenu(!1):this.$(".typeahead").focus(),this.onSelectCallback(this,this.selection)},_refreshSelectionBreadcrumbs:function(){var e=this.selectionTemplate({root:this.root,selection:this.selection,currentCustomValue:this.currentCustomValue,type:this.type});this.breadcrumbsEl&&this.breadcrumbsEl.remove(),"function"!=typeof $&&(window.$=jQuery.noConflict()),this.breadcrumbsEl=$(e),this.$(".tt-menu").prepend(this.breadcrumbsEl)},_indexInSelection:function(e){for(var t=0;t<this.selection.length;t++)if(e.label===this.selection[t].label&&e.name===this.selection[t].name)return t;return-1},setSelection:function(e){if(!e)return!1;if(e.length>0){this.selection=[];var t=this.model.get(this.root)||this.lastReceivedResult||[];if(e[0].name.constructor==Array)var i=e[0].name;else i="PICKLIST"===this.type?e[0].name.split(/,/):e[0].name.split(/;/);for(var a=0;a<i.length;a++){i[a]=i[a].trim();var n=_.find(this.model.get(this.root)||this.lastReceivedResult||[],e=>e.name===i[a]);n||(n=_LeanData.Util.convertStringSelectionToArray(i[a])[0])&&(n.custom=!0,t.unshift(n)),n&&-1==this._indexInSelection(n)&&this.selection.push(n)}this._resetBloodHoundData(),this.$(".typeahead.tt-input").blur()}},_setInputValueWithSelected:function(e,t=!1){var i="PICKLIST"===this.type?", ":"; ",a=this.selection.map(function(e){var t=n(e)?e.label.replace(" ID",""):e.label;return t=_.escape(t),", "===i&&t.includes(",")&&(t=JSON.stringify(t)),htmlDecode(t)});this.requireSelectionFromData?this.$(e.target).typeahead("val",a):""!==this.currentTextValue&&this.customInputSelect?(this.$(e.target).typeahead("val",this.currentTextValue),this.$el.trigger("multiNestedTypeaheadSelector:select",this)):null===a||""===a||this.emptyTextDesired?null!==a&&""!==a&&t?(this.$(e.target).typeahead("val",a),this.$el.trigger("multiNestedTypeaheadSelector:select",this)):(this.$(e.target).typeahead("val",this.currentTextValue),this.$el.trigger("multiNestedTypeaheadSelector:select",this)):(this.$(e.target).typeahead("val",a),this.$el.trigger("multiNestedTypeaheadSelector:select",this)),this.customInputSelect=!1,this.validate()}})}},function(e,t,i){e.exports=function(){var e=i(177),t=i(178);const a=new Set(["REFERENCE","SOBJECT","Team"]);var n=function(e){return e&&a.has(e.type)};Magellan=Magellan||{},Magellan.Models=Magellan.Models||{},Magellan.Views=Magellan.Views||{};var o=Magellan.Models.NestedTypeaheadSelector=Backbone.Model.extend({defaults:{}});Magellan.Views.NestedTypeaheadSelector=Backbone.View.extend({tagName:"span",selection:null,fieldSuggestionTemplate:_.template('<p title="<%-title%>"><%-suggestion.label%></p>'),categoryLabelTemplate:_.template('<p class="nts-category-label" title="<%-title%>"><%-suggestion.label%></p>'),objectSuggestionTemplate:_.template('<p title="<%-title%>"><span><%-suggestion.label.replace(" ID", "")%></span>&nbsp;&nbsp;<span class="expand-arrow">â–¸</span></p>'),disabledSuggestionTemplate:_.template('<p class="disabled" title="<%-title%>"><span><%-suggestion.label.replace(" ID", "")%></span>&nbsp;&nbsp;<span class="expand-arrow">â–¸</span>&nbsp;&nbsp;<span class="glyphicon glyphicon-warning-sign text-danger"></span></p>'),disableSelectedFieldSuggestionTemplate:_.template('<p title="<%-title%>" class="disabled selected-option"><%-suggestion.label%></p>'),notFoundTemplate:_.template('<div class="alert alert-danger" style="padding: 0 5px; margin: 0">No Suggestion Found.</div>'),notFoundMetaDataTemplate:_.template('<div style="display: flex; flex-direction: row; justify-content: space-between; align-items: center"><div class="alert alert-danger" style="padding: 0 5px; margin: 0">No Suggestion Found.</div><div class="refresh-icon" title="Refresh MetaData"></div></div>'),customValueTemplate:_.template('<div class="tt-dataset tt-dataset-nested-typeahead-selector"><div class="nts-selected-field-container"><p title="" class="tt-suggestion tt-custom-input tt-selectable hidden"></p></div></div>'),bloodHound:null,searchEngine:null,breadcrumbsEl:null,customValueEl:null,onSelectCallback:null,onSelectPostCallback:null,filterSuggestions:null,currentCustomValue:null,events:{"click .tt-custom-input":"_onCustomInputSelect","typeahead:select .typeahead":"_onSelect","typeahead:autocomplete .typeahead":"_selectFirstItemOnMenu","typeahead:render .typeahead":"_onSuggestionsRendered","input .typeahead":"_onInputChange","keydown .typeahead":"_onKeyPress","blur .typeahead":"_onBlurTypeahead","focus .typeahead":function(e){this.$(".tt-custom-input").toggleClass("hidden",!0),this.$(".typeahead-input").attr("autocomplete","chrome-off"),this.clearOnFocus&&this.$(e.target).typeahead("val",""),this._refreshSelectionBreadcrumbs(),this.customOnFocusTypeahead&&this.customOnFocusTypeahead(e),this.$(".tt-hint").toggleClass("hidden",!1)},"click .refresh-icon":"_refreshMetaData"},initialize:function(i){var a=this;if(this.getDynamicData=i.getDynamicData,this.getDynamicData&&!i.data&&(i.data=this.getDynamicData()),"object"==typeof i.data?this.model=new o(i.data):"function"==typeof i.data?(this.processDataCallback=i.data,this.model=new o(i.data())):i.model instanceof o?this.model=i.model:this.model=new o,this.includeNoValueOption="boolean"==typeof i.includeNoValueOption&&i.includeNoValueOption,this.includeNoValueOption&&this._insertNoValueOption(),this.selection=[],this.customRootLabel=i.customRootLabel,this.root=i.root,this.placeholder=i.placeholder||"Search",this.filterSuggestions="function"==typeof i.filter?i.filter:null,this.onSelectCallback="function"==typeof i.onSelect?i.onSelect:function(){},this.onSelectPostCallback="function"==typeof i.onSelectPost?i.onSelectPost:function(){},this.refreshMetaDataPostCallback="function"==typeof i.refreshMetaDataPostCallback?i.refreshMetaDataPostCallback:function(){},this.onInputChange=i.onInputChange,this.onEnter=i.onEnter,this.closeOnEnter=!0===i.closeOnEnter||!1,this.required=!0===i.required||!1,this.isOptionalTypeahead="boolean"==typeof i.isOptionalTypeahead&&i.isOptionalTypeahead,this.aliases=i.aliases||{},this.disableBreadcrumbs="boolean"==typeof i.disableBreadcrumbs&&i.disableBreadcrumbs,this.requireSelectionFromData="boolean"!=typeof i.requireSelectionFromData||i.requireSelectionFromData,this.emptyTextDesired=!1,this.clearOnFocus="boolean"!=typeof i.clearOnFocus||i.clearOnFocus,this.minLength=i.minLength||null,"function"==typeof i.data||"function"==typeof i.getDynamicData?this.selectedNotFoundTemplate=this.notFoundMetaDataTemplate:this.requireSelectionFromData?this.selectedNotFoundTemplate=this.notFoundTemplate:this.selectedNotFoundTemplate=function(){return"<div></div>"},this.disableEmptySearchString=i.disableEmptySearchString||!1,this.disableDownArrow=i.disableDownArrow||!1,this.datumTokenizer=i.datumTokenizer,this.queryTokenizer=i.queryTokenizer,this.currentTextValue=i.currentTextValue?i.currentTextValue:"",window._LeanData&&window._LeanData.AppState.fromOverlord)if(i.asyncServiceCall)i.asyncServiceCall=(e=>new Promise(t=>{t({label:e,name:e,value:e,parent:[],type:"STRING"})}));else{if(!this.currentTextValue&&!i.selection){let e={reason:"Typeahead will be blank even if a value is currently selected"};window.backboneGlobalEmitter&&window.backboneGlobalEmitter.emit(e)}this.currentTextValue=this.currentTextValue||(i.selection||[]).map(e=>e.name).join(".")}this.bloodHound=_.isFunction(i.asyncServiceCall)?this._getAsyncBloodHound(i.asyncServiceCall):this._getBloodHound(this.model.get(this.root)),this.currentCustomValue={label:"blah",name:"blah",isCustomValue:!0},this.customValidationFunction=_.isFunction(i.customValidationFunction)?i.customValidationFunction:null,this.cachedValidValues=[],this.customOnBlurTypeahead=i.customOnBlurTypeahead,this.customOnFocusTypeahead=i.customOnFocusTypeahead,this.asyncServiceCall=_.isFunction(i.asyncServiceCall)?i.asyncServiceCall:null,_.isFunction(i.fetchData)&&i.fetchData().then(function(e){a.processFetchedData(e,i)}).catch(function(e,t){a.render(),a.bloodHound&&a.bloodHound.clear(),a.$(".typeahead-input").toggleClass("input-invalid",!0)}),this.searchEngine=_.isUndefined(i.asyncServiceCall)?this._getSearchEngine(this.bloodHound):this.bloodHound,i.size?this.$el.prop("class","nested-typeahead-selector typeahead-"+i.size):this.$el.prop("class","nested-typeahead-selector typeahead-small"),i.classNames&&this.$el.addClass(i.classNames.join(" ")),this.template=_.template(e),this.selectionTemplate=_.template(t),i.customObjectSuggestionTemplate&&(this.customObjectSuggestionTemplate=i.customObjectSuggestionTemplate),this.render(),i.selection&&this.setSelection(this.includeNoValueOption&&0===i.selection.length?[{label:"< No Value >",name:""}]:i.selection),i.validateOnCreate&&this.validate()},render:function(){return this.$el.empty(""),this.$el.append(this.template(this)),this._initTypeahead(this.$(".typeahead"),this.searchEngine),this.currentTextValue&&this.$(".typeahead.tt-input").val(this.currentTextValue),this},processFetchedData:function(e,t){parsedData=JSON.parse(e),this.model=new o(parsedData),this.includeNoValueOption&&this._insertNoValueOption(),this.bloodHound=void 0!=t.asyncServiceCall?this._getAsyncBloodHound(t.asyncServiceCall):this._getBloodHound(this.model.get(this.root)),this.searchEngine=this._getSearchEngine(this.bloodHound),this.render()},getTypeaheadOptions:function(){return{hint:!0,highlight:!0,minLength:this.minLength?this.minLength:this.disableEmptySearchString?1:0}},getTypeaheadConfigurations:function(e,t){var i=this,a=i.selectedNotFoundTemplate;return{name:e||"nested-typeahead-selector",limit:1e3,display:function(e){return e.label},source:t,templates:{header:_.template('<div class="nts-selected-field-container"></div>'),suggestion:function(e){var t={suggestion:e,title:e.name};if(e.isCategoryLabel)return i.categoryLabelTemplate(t);if(e.disabled)return t.title=e.disabledReason,i.disabledSuggestionTemplate(t);if(n(e))return i.selection.length>=4?(t.title="Maximum number of objects selected reached.",i.disabledSuggestionTemplate(t)):i.objectSuggestionTemplate(t);if(i.customObjectSuggestionTemplate){return("function"==typeof i.customObjectSuggestionTemplate?_.template(i.customObjectSuggestionTemplate(t.suggestion)):_.template(i.customObjectSuggestionTemplate))(t)}return e.disableSelectedField?i.disableSelectedFieldSuggestionTemplate(t):i.fieldSuggestionTemplate(t)},notFound:a}}},setSelection:function(e){if(_.isEmpty(e))return this.currentTextValue&&this.$(".tt-input").val(this.currentTextValue),!1;this.selection=e,this._resetBloodHoundDataUsingCurrentSelection(),this.close()},fetchSelectionWithAsyncService(e,t){var i=$.Deferred();return e||t?(this.bloodHound.search(e,()=>{},function(e){this.setSelection(e),i.resolve(e)}.bind(this)),i):i.resolve()},refreshBloodhoundData:function(){this.searchEngine.initialize(!0)},validate:function(){if(this.customValidationFunction)return this.$(".typeahead-input").toggleClass("input-invalid",!this.customValidationFunction(this)),this.customValidationFunction(this);var e=this;window.$=jQuery.noConflict();var t=$.Deferred().always(function(t){e.$(".typeahead-input").toggleClass("input-invalid",!t)});return 0===this.selection.length?this.required?t.reject():t.resolve(!0):n(this.selection[this.selection.length-1])?t.reject():t.resolve(!0)},close(){this.$(".typeahead.tt-input").blur()},_insertNoValueOption:function(){let e=this.model.attributes;Object.keys(e).forEach(t=>{e[t].unshift({label:"< No Value >",name:""})}),this.model.set(e)},_getParentFields:function(e){var t=this,i=[],a=this.aliases,n={};let o=new Set(["id"]),l={};return _.each(e,function(s){var r=t.model.get(s);e.length>1&&i.push({label:s,isCategoryLabel:!0}),_.each(r,function(e){var t=s+"."+e.name;!e.isCategoryLabel&&o.has(e.name.toLowerCase())?(e.label=_LeanData.StringUtil.capitalizeString(e.name,!1),l[e.name.toLowerCase()]=e):a.hasOwnProperty(t)&&n.hasOwnProperty(a[t])||(i.push(e),n[t]=e)})}),[...Object.values(l),...i]},_resetBloodHoundData:function(e){null!=this.bloodHound&&this.bloodHound.clear(),e&&(this.bloodHound.local=e),null!=this.bloodHound&&this.bloodHound.initialize(!0)},_resetBloodHoundDataUsingCurrentSelection:function(){this.getDynamicData&&(this.data=this.getDynamicData(this.selection),this.model.clear({silent:!0}).set(this.data));for(var e=null,t=this.selection.length-1;t>=0;t--)if(n(this.selection[t])){e=this.selection[t];break}if(0===this.selection.length||null===e){var i=this.model.get(this.root);null!=i&&this._resetBloodHoundData(i)}else{const t=this._getParentFields(e.parent||(e.sObject?[e.sObject]:[]));null!=t&&this._resetBloodHoundData(t)}},_onSuggestionsRendered:function(e,t){this.emptyTextDesired=this.currentTextValue.length>0&&""==this.$(e.target).typeahead("val"),this.currentTextValue=this.$(e.target).typeahead("val"),this.$el.trigger("nestedTypeaheadSelector:onSuggestionsRendered",this),this.$(".tt-suggestion.disabled, .tt-suggestion.nts-category-label").on("click",function(e){return e.preventDefault(),!1})},_onInputChange:function(e){let t=$(e.currentTarget).val();"function"==typeof this.onInputChange&&this.onInputChange(t),!1===this.requireSelectionFromData&&(this.$(".tt-custom-input").text(t),this.$(".tt-custom-input")[0].title=t,""==t?this.$(".tt-custom-input").toggleClass("hidden",!0):this.$(".tt-custom-input").toggleClass("hidden",!1))},_onCustomInputSelect:function(e){"function"!=typeof $&&(window.$=jQuery.noConflict());var t=$(e.currentTarget).text();this._addToSelection(_LeanData.Util.convertStringSelectionToArray(t)[0]),this.$el.trigger("nestedTypeaheadSelector:select",this),this.onSelectCallback(this,this.selection),this.onSelectPostCallback(this,this.selection),this.close(),this.customInputSelect=!0},_onSelect:function(e,t,i){i?this.setSelection(t):this._addToSelection(t),this._refreshSelectionBreadcrumbs(),this._resetBloodHoundDataUsingCurrentSelection(),_.isEmpty(this.bloodHound.remote)&&this._refreshSelectionMenu(),this.$el.trigger("nestedTypeaheadSelector:select",this),this.onSelectCallback(this,this.selection),this.onSelectPostCallback(this,this.selection),n(t)||this.$(".typeahead-input").trigger("blur")},_selectFirstItemOnMenu:function(e){var t=$.Event("keydown");t.keyCode=t.which=40,this.$(e.target).triggerHandler(t)},_onBlurTypeahead:function(e){this._setInputValueWithSelected(e),this.customOnBlurTypeahead&&this.customOnBlurTypeahead(e),this.$(".tt-hint").toggleClass("hidden",!0)},_onKeyPress:function(e){if(13===e.keyCode)return"function"==typeof this.onEnter&&this.onEnter(),this.closeOnEnter&&this.close(),e.preventDefault(),!1},_setInputValueWithSelected:function(e){if(this.isOptionalTypeahead)return;let t=this.selection.map(e=>e.label).join(".");this.requireSelectionFromData?this.$(e.target).typeahead("val",t):""!==this.currentTextValue&&this.customInputSelect?(this.$(e.target).typeahead("val",this.currentTextValue),this._addToSelection(_LeanData.Util.convertStringSelectionToArray(this.currentTextValue)[0]),this.$el.trigger("nestedTypeaheadSelector:select",this)):null===t||""===t||this.emptyTextDesired?(this.$(e.target).typeahead("val",this.currentTextValue),this._addToSelection(_LeanData.Util.convertStringSelectionToArray(this.currentTextValue)[0]),this.$el.trigger("nestedTypeaheadSelector:select",this)):this.$(e.target).typeahead("val",t),this.customInputSelect=!1,this.validate()},_getAsyncBloodHound:function(e){var t=this,i="function"==typeof this.filterSuggestions?this.filterSuggestions:null,a=()=>{this.$el.find(".typeahead-input.tt-input").prop("placeholder","Loading...")},n=()=>{this.$el.find(".typeahead-input.tt-input").prop("placeholder",this.placeholder)},o=(e,i)=>{t.cachedLastResult[e]=i,setTimeout(()=>{t.cachedLastResult={}},5e3)};return t.cachedLastResult={},new Bloodhound({remote:{url:"%query%",wildcard:"%query%",transport:function(l,s,r){t.cachedLastResult[l.url]?s(t.cachedLastResult[l.url]):(a(),null===i?e(decodeURIComponent(l.url)).then(function(e){t.lastReceivedResult=e,s(e),o(l.url,e)},r).finally(n):e(decodeURIComponent(l.url)).then(function(e){let a=i(e);t.lastReceivedResult=a,s(a),o(l.url,e)},r).finally(n))},cache:!1},sufficient:100,queryTokenizer:t.queryTokenizer||function(e){return[e]},datumTokenizer:t.datumTokenizer||function(e){return e},identify:function(e){return e.Id}})},_getBloodHound:function(e){if(!e)throw"NestedTypeaheadSelector Error: Invalid data. Failed to create bloodhound.";return new Bloodhound({local:e,identify:function(e){return e.name+" / "+e.label},datumTokenizer:this.datumTokenizer||function(e){var t=Bloodhound.tokenizers.whitespace(e.name),i=Bloodhound.tokenizers.whitespace(e.label);return t.concat(i).concat(e.parent||e.sObject?[e.sObject]:[])},queryTokenizer:this.queryTokenizer||Bloodhound.tokenizers.whitespace})},_getSearchEngine:function(e){var t=this.filterSuggestions;return(i,a)=>{""===i?a("function"==typeof t?t(e.all()):e.all()):e.search(i,function(e){a("function"==typeof t?t(e):e)})}},_initTypeahead:function(e,t){e.typeahead("destroy");var i="nested-typeahead-selector-"+Date.now();e.typeahead(this.getTypeaheadOptions(),this.getTypeaheadConfigurations(i,t)),!1===this.requireSelectionFromData&&(this.customValueEl=this.customValueTemplate,this.$(".tt-menu").prepend(this.customValueEl)),this._refreshSelectionBreadcrumbs()},_addToSelection:function(e){if(!e)return this;var t=this.selection.length-1;t>-1&&!n(this.selection[t])?this.selection[t]=e:this.selection.push(e)},_refreshSelectionBreadcrumbs:function(){var e=this.selectionTemplate({root:"CampaignMember"===this.root?"Campaign Member":this.customRootLabel||_LeanData.Util.getSObjectLabel(this.root,!1)||this.root,selection:this.selection,currentCustomValue:this.currentCustomValue,hasChildren:n});this.breadcrumbsEl&&this.breadcrumbsEl.remove(),window.$=jQuery.noConflict(),this.breadcrumbsEl=$(e),this.breadcrumbsEl.find(".nts-selected-node.nts-parent-node").each(function(e,t){$(t).on("click",this._deselectTo.bind(this,e))}.bind(this)),this.disableBreadcrumbs||this.$(".tt-menu").prepend(this.breadcrumbsEl)},_refreshSelectionMenu:function(e=!0){this._initTypeahead(this.$(".typeahead"),this._getSearchEngine(this.bloodHound)),this.$(".typeahead").focus(),e&&this.$(".tt-dataset").hide(0,function(){$(this).slideDown()})},_deselectTo:function(e){this.selection.splice(e),this._resetBloodHoundDataUsingCurrentSelection(),this._refreshSelectionMenu(),this._refreshSelectionBreadcrumbs(),this.onSelectCallback(this,this.selection),this.onSelectPostCallback(this,this.selection)},_refreshMetaData:function(e){"function"!=typeof $&&(window.$=jQuery.noConflict()),$("#node-editor-sidebar").length?_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0):_LeanData.Notification.showLoadingOverlay("Refreshing MetaData");const t=_LeanData.AppState.getCurrentVariablesService()?_LeanData.AppState.getCurrentVariablesService().getVariableObjectTypes():[];_LeanData.MetaDataController.getFieldsMetaData(!0,t,!0).then(e=>{let t;"function"==typeof this.processDataCallback&&(t=this.processDataCallback(e,!0)),"function"==typeof this.getDynamicData&&(t=this.getDynamicData(this.selection,e,!0)),t&&(this.model.clear({silent:!0}).set(t),this.includeNoValueOption&&this._insertNoValueOption(),this._onSelect(null,this.selection||[],!0),$("#node-editor-sidebar").length?_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0):_LeanData.Notification.hideLoadingOverlay())}).finally(()=>{"function"==typeof this.refreshMetaDataPostCallback&&this.refreshMetaDataPostCallback(this)})},disableTypeahead(e){this.$el.toggleClass("disabled",e),this.$el.find("input.tt-input").prop("disabled",e)},updatePlaceholder(e){this.$el.find(".typeahead-input").prop("placeholder",e)}})}},function(e,t,i){e.exports=function(){var e=i(181);return Magellan.Views.PaginatedModal=Backbone.View.extend({header:"Confirmation Dialog",message:"Are you sure?",footer:"",container:"#magellan-modals",pageIndex:0,forwardButtonTextByPage:[],backButtonTextByPage:[],onSelect:{onForward:[],onBack:[]},selectorsByPage:[],viewsByPage:[],pageIndexToButtonLock:{},template:_.template(e),events:{"click .forward-button":"onForward","click .back-button":"onBack","click .cancel-button":"onCancel"},initialize:function(e){_.each(e.onForward,(e,t)=>{const i="function"==typeof e?e:()=>{};this.onSelect.onForward[t]=i}),_.each(e.onBack,(e,t)=>{const i="function"==typeof e?e:()=>{};this.onSelect.onBack[t]=i});const t="function"==typeof e.onCancel?e.onCancel:()=>{};this.cancel=(()=>{Promise.resolve(t()).then(()=>{this.close()}).catch(e=>{console.log("error in cancellation callback: ",e)})}),_.each(e.disableForward,(t,i)=>{t&&e.model&&(this.pageIndexToButtonLock[i]=t,this.listenTo(e.model,"change",this.toggleForwardButtonLock.bind(this)))}),"function"==typeof e.confirmActionHandler&&(this.confirmActionHandler=e.confirmActionHandler),"function"==typeof e.cancelActionHandler&&(this.cancelActionHandler=e.cancelActionHandler),Array.isArray(e.selectorsByPage)&&(this.selectorsByPage=e.selectorsByPage),Array.isArray(e.viewsByPage)&&(this.viewsByPage=e.viewsByPage),this.container=e.container||this.container,this.header=e.header||this.header,this.message=e.message||this.message,this.$contentElement=e.contentElement||null,this.footer=e.footer||this.footer,this.warningText=e.warningText||null,this.largeModal=e.largeModal,this.innerModal=e.innerModal,this.verticallyResizable=e.verticallyResizable,this.noContentPadding=e.noContentPadding,this.pageIndex=e.pageIndex||0,this.pageIndexMax=this.viewsByPage.length-1,this.forwardButtonTextByPage=e.forwardButtonTextByPage||[],this.forwardButtonText=e.forwardButtonTextByPage?e.forwardButtonTextByPage[0]:"Next",this.backButtonTextByPage=e.backButtonTextByPage||[],this.backButtonText=e.backButtonTextByPage?e.backButtonTextByPage[0]:"Back",this.cancelButtonText=e.cancelButtonText||"Cancel",this.hasExtraContent="boolean"==typeof e.hasExtraContent&&e.hasExtraContent,this.modalClasses=e.modalClasses||"",this.backdropClasses=e.backdropClasses||"",this.render()},onForward:function(e){e.preventDefault(),this.confirmActionHandler&&this.pageIndex>=this.pageIndexMax?this.confirmActionHandler(()=>this.handlePageTurn("onForward"),()=>!1):this.handlePageTurn("onForward")},onBack:function(e){e.preventDefault(),this.handlePageTurn("onBack")},onCancel:function(e){e.preventDefault(),this.cancelActionHandler?this.cancelActionHandler(()=>{this.cancel()},()=>!1):this.cancel()},handlePageTurn:function(e){const t=this.onSelect[e][this.pageIndex];if("function"==typeof t)return this.$el.find(".forward-button").LoadingOverlay("show"),Promise.resolve(t()).then(t=>{"onForward"===e?this.pageIndex++:this.pageIndex--,this.updateView()}).catch(e=>{console.error("error in page-turn callback: ",e)}).finally(()=>{this.$el.find(".forward-button").LoadingOverlay("hide",!0)});throw"PaginatedModal Error: page-turn callback must be a function."},updateView:function(){if(this.pageIndex<0||this.pageIndex>this.pageIndexMax)return this.close();this.forwardButtonText=this.forwardButtonTextByPage[this.pageIndex],this.backButtonText=this.backButtonTextByPage[this.pageIndex],this.$el.find(".forward-button").html(this.forwardButtonText),this.$el.find(".back-button").html(this.backButtonText),this.toggleBackButtonHidden(this.pageIndex<=0),this.toggleForwardButtonLock(),this.togglePageDisplay()},togglePageDisplay:function(){_.each(this.selectorsByPage,(e,t)=>{_.each(e,e=>{this.pageIndex===t?this.$el.find(e).removeClass("hidden"):this.$el.find(e).addClass("hidden")})}),_.each(this.viewsByPage,(e,t)=>{_.each(e,e=>{this.pageIndex===t&&e.render()})})},render:function(){return this.$el.html(this.template({header:this.header,message:this.message,footer:this.footer,warningText:this.warningText,forwardButtonText:this.forwardButtonText,backButtonText:this.backButtonText,cancelButtonText:this.cancelButtonText,hasExtraContent:this.hasExtraContent,largeModal:this.largeModal,innerModal:this.innerModal,verticallyResizable:this.verticallyResizable,noContentPadding:this.noContentPadding,modalClasses:this.modalClasses})),$(this.container).append(this.$el),this.pageIndex<=0?this.toggleBackButtonHidden(!0):this.toggleBackButtonHidden(!1),this.verticallyResizable&&this.$el.find(".modal-content-section").resizable({handles:{s:$(".bottom-handle")},containment:$(".confirmation-modal"),resize:(e,t)=>{var i=t.size.height-t.originalSize.height,a=t.originalSize.height+1.33*i;t.size.height=a}}),this},open:function(){this.$el.find(".modal").modal({backdrop:"static"}),this.$el.find(".modal").modal("show"),$(".modal-backdrop").addClass(this.backdropClasses),this.$contentElement&&this.$el.find(".modal-content-section").html(this.$contentElement)},close:function(){return this.$el.find(".modal").on("hidden.bs.modal",()=>{this.remove()}),this.$el.find(".modal").modal("hide"),this},toggleForwardButtonLock:function(){let e=!1;"function"==typeof this.pageIndexToButtonLock[this.pageIndex]&&(e=!this.pageIndexToButtonLock[this.pageIndex]()),this.toggleForwardButtonDisabled(e)},toggleForwardButtonDisabled:function(e){this.$el.find(".forward-button").attr("disabled",e)},toggleBackButtonHidden:function(e){this.$el.find(".back-button").toggleClass("hidden",e)}})}},function(e,t,i){e.exports=function(){Magellan=Magellan||{},Magellan.Views=Magellan.Views||{},Magellan.Models=Magellan.Models||{};var e=i(183),t=i(184),a=i(66)(),n=[];Magellan.Views.UpdateRow=Backbone.View.extend({initialize:function(e){this.editable="boolean"!=typeof e.editable||e.editable,this.renderParent=e.renderParent,this.onUpdatesChange=e.onUpdatesChange,this.model=e.model,this.update=e.update,this.nodeModel=e.nodeModel,this.expandTextArea=_LeanData.Util.expandTextArea(30,50),this.collapseTextArea=_LeanData.Util.collapseTextArea(17),this.typeaheadDropdowns=[],this.expandedText=e.update.get("value"),this.collapsedText=_LeanData.Util.truncateText(this.expandedText,30),this.SET_OF_VALID_FIELD_TYPE_MAPPING={};var t=Object.keys(_LeanData._function.SFDC_VALID_TYPE_MAPPING);_.each(t,e=>{let i=_.clone(_LeanData._function.SFDC_VALID_TYPE_MAPPING[e]);"TEXTAREA"!==e&&"STRING"!==e&&"URL"!==e||i.push(...t),this.SET_OF_VALID_FIELD_TYPE_MAPPING[e]=new Set(i)}),this.render()},template:_.template(t),events:{"focus .sofu-update-value.lds-textarea-small":"expandTextAreaTrigger","blur .sofu-update-value.lds-textarea-small":"collapseTextAreaTrigger"},render:function(){var e={};e[this.model.get("object")]=this.model.get("fields").toJSON(),this.$el.html(this.template({update:this.update,collapsedText:this.collapsedText,hideDeleteButton:!this.editable||1===this.model.get("updates").length}));var t=this._createFieldsDropdown(this.update,e);if(this.$el.find(".sofu-field-selector").html(t.$el),this.$el.find(".sofu-delete-column").on("click",this.deleteRow.bind(this,this.$el,this.update)),this.$el.find(".sofu-update-value").on("change",this._setUpdateValue.bind(this,this.update)),$(this.$el.find(".sofu-ld-dropdown")).LDDropdown({options:[!0,!1],value:this.update.get("value")}),this.$el.find(".sofu-ld-dropdown").on("LDDropdown:change",this._setUpdateValue.bind(this,this.update)),_.isEmpty(this.update.get("field"))){var i=this._createValueTypeahead(this.update,e);this.$el.find(".sofu-ld-typeahead").html(i.$el),i.$el.on("nestedTypeaheadSelector:select .sofu-ld-typeahead",this._setUpdateValue.bind(this,this.update))}this._refreshUpdateValueColumn(this.$el.find(".update-row"),this.update);var a=Magellan.Controllers.VariableCreator.createVariableInsertButton(this.nodeModel,t,e=>{var t=e;if("STRING"===this.update.get("type")||"TEXTAREA"===this.update.get("type")||"URL"===this.update.get("type")){var i=this.expandedText>this.collapsedText?this.expandedText.length:this.$el.find(".sofu-update-value")[0].selectionStart,a=this.expandedText||"";t=a.substring(0,i)+e+a.substring(i)}this.setUpdateValue(this.update,t,this.$el.find(".update-row"));var n=this.render();this.$el.replaceWith(n.$el),this.$el.find(".sofu-update-value").hasClass("hidden")||(this.expandedText=t);var o=i+e.length;n.$el.find(".sofu-update-value")[0].setSelectionRange(o,o),"DATE"!==this.update.get("type")&&"DATETIME"!==this.update.get("type")&&($(n.$el).find(".sofu-update-value").datepicker("destroy").removeClass("hasDatepicker"),n.$el.find(".sofu-update-value").focus())}),n=this.SET_OF_VALID_FIELD_TYPE_MAPPING;return a.fieldMetadataFilter=(e=>{var t=this.update.get("type");return t?_.filter(e,e=>{var i=n[t];return"REFERENCE"===e.type||"SOBJECT"===e.type||i.has(e.type)}):e}),this.$el.find(".merge-field-insert-button-container").html(a.$el),this},_createValueTypeahead:function(e){var t=_LeanData.MetaDataController.getCachedPicklistValues(this.model.get("object")+e.get("field"));null!=t&&(t=JSON.parse(t));var i={};return i[this.model.get("object")]=[],new Magellan.Views.NestedTypeaheadSelector({data:null==t?i:t,root:this.model.get("object"),disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!1,includeNoValueOption:!0,fetchData:null==t?_LeanData.MetaDataController.getPicklistFields.bind(null,this.model.get("object"),e.get("field")):null,currentTextValue:e.get("value"),selection:_LeanData.Util.convertStringSelectionToArray(e.get("value"))})},_createMultiValueTypeahead:function(e){var t=_LeanData.MetaDataController.getCachedPicklistValues(this.model.get("object")+e.get("field"));null!=t&&(t=JSON.parse(t));var i={};return i[this.model.get("object")]=[],new Magellan.Views.MultiNestedTypeaheadSelector({type:e.get("type"),data:null==t?i:t,root:this.model.get("object"),onSelect:this._setUpdateValue.bind(this,e),disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!1,fetchData:null==t?_LeanData.MetaDataController.getPicklistFields.bind(null,this.model.get("object"),e.get("field")):null,currentTextValue:e.get("value"),selection:_LeanData.Util.convertStringSelectionToArray(e.get("value"))})},_createFieldsDropdown:function(e,t){var i=_.find(t[this.model.get("object")],function(t){return t.name===e.get("field")}),a=_LeanData.MetaDataController.getCustomUserFieldsByObject(_LeanData.AppState.PrimarySObjectType),o=["ownerid"];_.each(a,function(e){e.name.endsWith("__r.id")?o.push(e.name.substring(0,e.name.length-6)+"__c"):e.name.endsWith(".id")&&o.push(e.name.substring(0,e.name.length-3))}),n=t[this.model.get("object")].filter(function(e){return!0===e.isNillable});var l=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:this.model.get("object"),currentTextValue:e.get("field"),data:(e,i)=>{e={};return t=i?{[this.model.get("object")]:_LeanData.MetaDataController.getFlattenedFieldsByObject(this.model.get("object"))}:t,e[this.model.get("object")]=t[this.model.get("object")].filter(function(e){return!0===e.isUpdateable&&!1===o.includes(e.name)}),e},selection:i?[i]:[],onSelect:this._updateFieldOnSelected.bind(this,e)});return l.validate(),this.typeaheadDropdowns.push(l),l},_triggerModelChangeEvent:function(){this.onUpdatesChange()},deleteRow:function(e,t){1!=this.model.get("updates").length&&(e.remove(),this.model.get("updates").remove(t),1===this.model.get("updates").length&&this.renderParent(),this._triggerModelChangeEvent())},_setUpdateValue:function(e,t,i){var a,n,o=e.get("type");if(i instanceof Magellan.Views.LDDropdown)a=i.$el.closest(".update-row"),n=this.setUpdateValue(e,i.val(),a);else if(i instanceof Magellan.Views.MultiNestedTypeaheadSelector)n=_.isEmpty(i.selection)?"":i.selection.reduce(function(e,t){return""!==e&&(e+="; "),"REFERENCE"===t.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(t.name):e+t.name},""),a=i.$el.closest(".update-row"),n=this.setUpdateValue(e,n,a);else if(i instanceof Magellan.Views.NestedTypeaheadSelector)n=_.isEmpty(i.selection)?"":i.selection[0].name,a=i.$el.closest(".update-row"),n=this.setUpdateValue(e,n,a);else{if(a=$(t.target).closest(".update-row"),n=$(t.target).val(),"DATETIME"===o){if(_.isEmpty(n))n=null;else{const e=moment(n);e.isValid()&&(n=e.format(_LeanData._datetime.DATETIME_FORMAT))}$(t.target).val(n)}n=this.setUpdateValue(e,n,a)}this.setUpdateValue(e,n,a)},setUpdateValue:function(e,t,i){return!this._isFieldNillable(e.get("field"))||""!==t&&null!==t&&void 0!==t||(t=null),e.set("value",t),this._validateRow(e,i),t},_updateFieldOnSelected:function(e,t,i){var a=null;i.length>0&&(a=i[i.length-1]),e.set({field:a?a.name:"",type:a?a.type:""}),this._refreshUpdateValueColumn(t.$el.closest(".update-row"),e)},_renderInputOrTextArea:function(e,t){"date"===e||"datetime"===e?(t.find(".sofu-update-value.sofu-input").hide(),t.find(".sofu-update-value.sofu-date").show()):(t.find(".sofu-update-value.sofu-input").show(),t.find(".sofu-update-value.sofu-date").hide())},_refreshUpdateValueColumn:function(e,t){$(e).find(".sofu-update-value").datepicker("destroy").removeClass("hasDatepicker");var i=!0,a=!0,n=(t.get("type")||"").toLowerCase();if(this._renderInputOrTextArea(n,e),"date"===n)$(e).find(".sofu-update-value.sofu-date").datepicker({dateFormat:"yy-mm-dd"});else if("datetime"===n)$(e).find(".sofu-update-value.sofu-date").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1});else if("boolean"===n)i=!1;else if("picklist"===n){a=!1;var o=this._createValueTypeahead(t);e.find(".sofu-ld-typeahead").html(o.$el),o.$el.on("nestedTypeaheadSelector:select .sofu-ld-typeahead",this._setUpdateValue.bind(this,t))}else if("multipicklist"===n){a=!1;o=this._createMultiValueTypeahead(t);e.find(".sofu-ld-typeahead").html(o.$el),o.$el.on("multiNestedTypeaheadSelector:select .sofu-ld-typeahead",this._setUpdateValue.bind(this,t))}e.find(".sofu-update-value").toggleClass("hidden",!i||!a),e.find(".sofu-ld-dropdown").toggleClass("hidden",i),e.find(".sofu-ld-typeahead").toggleClass("hidden",a),"boolean"===n?e.find(".sofu-ld-dropdown .ld-dropdown-value").html(`<span>${t.get("value")}</span>`):e.find(".sofu-update-value").val(_LeanData.Util.truncateText(t.get("value"),30)),this._validateRow(t,e)},_validateRow:function(e,t){const i=this.model.get("object"),a=e.get("value"),n=e.get("field"),o=e.get("type");let l=Magellan.Validation.isValidMergeFieldValueMessages(this.nodeModel.nodeInfo.name,a,o,n);const s="string"==typeof a&&a.match(/{!([^}]+)}/gi)||[];if(s.length>0)"String"!==_LeanData._function.SFDC_TYPE_TO_GROUPING[o]&&s[0]!==a&&(l=[`Field '${_LeanData.Util.getFieldLabel(i,n)}' must contain a valid value`]);else if(_.isEmpty(l)){const e=!this._isFieldNillable(n),t=""===a||null===a;let s=!e&&t;s||(s="PICKLIST"===o||Magellan.Validation.isValidValueOfType(o,a)),(e&&t||!s)&&(l=[`Field '${_LeanData.Util.getFieldLabel(i,n)}' must contain a valid value`])}let r="";!(l.length>0)||_.isEmpty(n)&&_.isEmpty(a)||(r=l.join("; ")),t.find(".sofu-ld-dropdown .ld-dropdown, .sofu-ld-typeahead").toggleClass("input-invalid",l.length>0),t.find(".sofu-update-value").toggleClass("lds-textarea-invalid",l.length>0),t.closest(".update-row-container").find(".sofu-error-feedback").text(r)},collapseTextAreaTrigger:function(e){this.expandedText=e.target.value,this.collapsedText=_LeanData.Util.truncateText(this.expandedText,30),this.collapseTextArea.call(e.target),e.target.value=this.collapsedText},expandTextAreaTrigger:function(e){this.expandedText!==this.collapsedText&&(e.target.value=this.expandedText),this.expandTextArea.call(e.target)},_isFieldNillable:function(e){return void 0!=_.find(n,function(t){return t.name===e})},remove:function(){this.typeaheadDropdowns.forEach(function(e){e.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}}),Magellan.Views.SOFieldUpdater=Backbone.View.extend({tagName:"div",className:"so-field-updater",initialize:function(e){this.editable="boolean"!=typeof e.editable||e.editable;let t=e.fields||[],i=_LeanData._blacklist.FIELD_BLACKLIST_SETS[`${e.object.toUpperCase()}_FIELDS`];i&&(t=_.filter(t,e=>!i.has(e.name))),this.nodeModel=e.nodeModel||null,this.model=new a({object:e.object,fields:t||[],updates:e.updates||[]}),this.model.get("updates").on("add",this._renderUpdates.bind(this)),this.model.get("updates").on("change",this._triggerModelChangeEvent.bind(this)),this.render()},template:_.template(e),events:{"click .add-rule-div":"addRow","click .sofu-boolean-dropdown-option":"_booleanDropdownHandler"},render:function(){return this.$el.html(this.template({model:this.model,editable:this.editable,objectLabelData:_LeanData.MetaDataController.getObjectMetaDataObject(this.model.get("object"),!0)})),this._renderUpdates(),ld_initializeToolTip(this.$el.find(".sofu-note-tooltip"),{title:"Insert Merged Fields & Relative Dates",body:"Select a compatible Field to insert a <b>Merged Field.</b><br>Select a Date/Time Field to insert a <b>Relative Date.</b>"}),this},addRow:function(){this.model.get("updates").add({field:null,value:null,type:null})},val:function(){return this.model.get("updates").toJSON()},_triggerModelChangeEvent:function(){this.$el.trigger("SOFieldUpdater:change",this)},_renderUpdates:function(){return this.$(".sofu-field-updates-list").empty(),this.model.get("updates").each(e=>{let t=new Magellan.Views.UpdateRow({editable:this.editable,model:this.model,update:e,nodeModel:this.nodeModel,renderParent:this.render.bind(this),onUpdatesChange:this._triggerModelChangeEvent.bind(this)});this.$(".sofu-field-updates-list").append(t.$el)}),this},_booleanDropdownHandler:function(e){e.preventDefault();var t=$(e.target).text(),i=$(e.target).data("value");$(e.target).closest(".sofu-boolean-dropdown").find(".sofu-boolean-dropdown-value-text").text(t),$(e.target).closest(".sofu-boolean-dropdown").find(".sofu-boolean-dropdown-value").val(i).trigger("change"),$(e.target).closest(".sofu-boolean-dropdown").toggleClass("input-invalid",!1)}})}},function(e,t,i){e.exports=function(){Magellan.Views.SingleTupleCondition=Backbone.View.extend({template:_.template(i(185)),initialize:function(e){this.idx=e.idx,this.selectedRoutingType=this.model.get("selectedRoutingType"),this.fieldObjectType=this.model.get("fieldObjectType"),this.operandObjectType=this.model.get("operandObjectType"),this.fieldData=this.model.get("fieldData"),this.operandData=this.model.get("operandData"),this.condition=e.condition,this.filterOutTextArea=this.model.get("filterOutTextArea"),this.allowFormulaField=this.model.get("allowFormulaField"),this.customPlaceholderText=this.model.get("customPlaceholderText"),this.operandFieldCache=null,this.operandValueCache=null,this.render(),this.validate()},validate:function(){let e=!0,t=!0,i="";const a=this.$el.find(".tt-input"),n=this.$el.find(".tuple-condition-operand-input"),o=this.$el.find(".error-message"),l=this.getFieldSelection();l&&l[0]&&l[0].type!=this.condition.type&&(this.condition.type=l[0].type),["is null","not null"].includes(this.condition.operator)||(e=(["number","boolean"].includes(typeof this.condition.operand)||!_.isEmpty(this.condition.operand))&&Magellan.Validation.isValidValueOfType(this.condition.type,this.condition.operand)),t=!_.isEmpty(this.condition.field)&&Magellan.Validation.metadataFieldExists(this.operandObjectType,this.condition.field),n.toggleClass("lds-field-invalid",!e),a.toggleClass("input-invalid",!t);const s=t&&e;return s||(i="Invalid field selected.  Please check the field is active and compatible with corresponding values."),o.html(i),s},events:{"click .tuple-condition-delete":"deleteCondition","change .tuple-fieldset-radiogroup input":"radioButtonHandler","keyup .tuple-condition-operand-input":"operandInputHandler","change .tuple-condition-operand-input":"operandInputHandler"},deleteCondition:function(e){var t=$(e.target).closest(".tuple-condition").data("ruleIndex");this.model.deleteCondition(t),this.handleConditionChange()},radioButtonHandler:function(e){this.condition["value/field"]=this.$el.find("fieldset input:checked").val();this.$el.find(".tuple-condition-operand-dropdown"),this.$el.find(".tuple-condition-operand-input");"field"===this.condition["value/field"]?this.condition.operand=this.operandFieldCache:this.condition.operand=this.operandValueCache,this.render()},operandInputHandler:function(e){var t=$(e.target).val();this.condition.operand=_.isEmpty(t)?null:t,this.operandValueCache=_.isEmpty(t)?null:t,this.handleConditionChange()},getFieldSelection(){let e=null;return 0===(e=this.model.get("flattenField")?_LeanData.Util.convertFieldSelectionStringToArray(this.condition.field,this.fieldObjectType,_LeanData.MetaDataController.getFlattenedFieldMetaDataMap()):_LeanData.Util.convertFieldSelectionStringToArray(this.condition.field,this.fieldObjectType,_LeanData.MetaDataController.getFieldMetaDataMap())).length||(e=_LeanData.Util.createFlattenedFields(e)),e},_createFieldNestedTypeahead:function(){const e=this.getFieldSelection();var t=_LeanData.Util.createBlacklistFilter();this.fieldNestedTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,data:(e=this.fieldData)=>(this.model.set("data",e),this.model.processData(),e),root:this.fieldObjectType,selection:e,currentTextValue:this.condition.field,filter:function(e){return e=function(e,t,i){return _.filter(e,function(e){return(!t||"TEXTAREA"!==e.type)&&(i||!1===e.isFormula)})}(e=t(e),this.filterOutTextArea,this.allowFormulaField)}.bind(this),onSelect:function(e,t){this.condition.field=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t),this.condition.type=t[t.length-1]?t[t.length-1].type:null,"REFERENCE"!==this.condition.type&&(this._createOperatorDropdown(),this._createOperandColumn()),this.handleConditionChange()}.bind(this)}),this.$el.find(".tuple-condition-field").html(this.fieldNestedTypeahead.$el)},_createOperatorDropdown:function(){var e,t,i=this.model.get("selectedRoutingType"),a=this.condition.type?_LeanData._function.SFDC_TYPE_TO_GROUPING[this.condition.type].toUpperCase():void 0;t=(e="Update"===i?_LeanData._function.UT_DATATYPE_TO_OPERATORS[a]:_LeanData._function.DATATYPE_TO_OPERATORS[a])&&-1!==e.indexOf(this.condition.operator)?this.condition.operator:this.condition.operator=null,this.model.get("isApiRouting")&&e&&(e=e.filter(e=>"has changed"!==e)),$(this.$el.find(".tuple-condition-operator")).LDDropdown({required:!0,options:e,value:t,optionTemplate:e=>`<span>${_LeanData.FlowBuilderUtil.datatypeToOperatorLabel(e,this.condition.type)}</span>`,enableSearch:this.model.get("enableSearch"),onChange:function(e){this.condition.operator=e,this.render(),this.handleConditionChange()}.bind(this)})},_createOperandColumn:function(){var e=this.$el.find(".tuple-condition-operand-dropdown"),t=this.$el.find(".tuple-condition-operand-input"),i=jQuery.noConflict();if(i(t).datepicker("destroy"),_LeanData._function.UNARY_OPERATORS.has(this.condition.operator))e.hide(),t.hide(),this.condition.operand="",this.handleConditionChange();else if("field"===this.condition["value/field"]){this.$el.find('fieldset input[value="field"]').prop("checked",!0),t.hide();var a=_LeanData._function.SFDC_TYPE_TO_GROUPING[this.condition.type],n=_LeanData.Util.convertFieldSelectionStringToArray(this.condition.operand,this.operandObjectType,_LeanData.MetaDataController.getFieldMetaDataMap());(0===n.length||n.length>0&&_LeanData._function.SFDC_TYPE_TO_GROUPING[n[n.length-1].type]!==a)&&(n=[],this.condition.operand=null),this.operandFieldCache=this.condition.operand;var o=_LeanData.Util.createFieldsFilter(_LeanData._function.SFDC_TYPE_TO_GROUPING[this.condition.type]),l=_LeanData.Util.createBlacklistFilter();this.operandNestedTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,data:this.operandData,root:this.operandObjectType,selection:n,filter:function(e){return e=o(e),e=l(e)},onSelect:function(e,t){this.condition.operand=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t),this.condition["operand type"]=t[t.length-1].type,this.operandFieldCache=this.condition.operand,this.handleConditionChange()}.bind(this)}),e.html(this.operandNestedTypeahead.$el)}else{switch(this.$el.find('fieldset input[value="value"]').prop("checked",!0),this.condition.type){case"BOOLEAN":t.hide(),i(e).LDDropdown({required:!0,options:[!0,!1],value:this.condition.operand,onChange:function(e){this.condition.operand=e,this.handleConditionChange()}.bind(this)}),e.show();break;case"COMBOBOX":case"MULTIPICKLIST":case"PICKLIST":if("equals"===this.condition.operator||"not equal to"===this.condition.operator){t.hide();var s=_LeanData.MetaDataController.getCachedPicklistValues(this.operandObjectType+this.condition.field);_.isEmpty(s)||(s=JSON.parse(s));var r={};r[this.operandObjectType]=[];var d=new Magellan.Views.MultiNestedTypeaheadSelector({required:!0,requireSelectionFromData:!1,disableBreadcrumbs:!0,data:_.isEmpty(s)?r:s,root:this.operandObjectType,selection:_.isEmpty(this.condition.operand)?_LeanData.Util.convertStringSelectionToArray(""):_LeanData.Util.convertStringSelectionToArray(this.condition.operand),fetchData:_.isEmpty(s)?_LeanData.MetaDataController.getPicklistFields.bind(null,this.operandObjectType,this.condition.field):null,onSelect:this.updateModelOnMultiNestedDropdownChange.bind(this)});e.html(d.$el),e.show()}break;case"DATE":case"DATETIME":e.hide(),Magellan.Validation.isValidValueOfType(this.condition.type,this.condition.operand)||t.toggleClass("lds-field-invalid",!0).val(this.condition.operand),"DATE"===this.condition.type?i(t).datepicker({dateFormat:"yy-mm-dd",constrainInput:!this.model.get("allowDateLiterals")}):i(t).datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1,constrainInput:!this.model.get("allowDateLiterals")}),t.show();break;default:e.hide(),t.show(),Magellan.Validation.isValidValueOfType(this.condition.type,this.condition.operand)||t.toggleClass("lds-field-invalid",!0).val(this.condition.operand),t.show()}t.val(this.condition.operand),this.operandValueCache=this.condition.operand,this.condition["operand type"]="STRING"}},handleConditionChange:function(){this.model.trigger("conditionChange",this.model.toJSON()),this.validate()},updateModelOnMultiNestedDropdownChange:function(e,t){var i=t[t.length-1];if(_.isUndefined(i)&&"REFERENCE"===i.type)return!1;var a=t.map(function(e){return"REFERENCE"===e.type?_LeanData.TypeaheadUtil.flattenReferenceAPIs(e.name):e.name});e.attributes&&e.attributes.isMatchedField?(this.condition.field=a,this.condition.type=i?i.type:"undefined",this.condition["picklist field"]=i?i.name:"undefined",this.condition["picklist object"]=i?i.objectType:"undefined"):(this.condition.operand=a,this.condition["operand type"]=i?i.type:"undefined"),this.handleConditionChange()},render:function(){var e=this.template({idx:this.idx,condition:this.condition,hideToggleColumn:this.model.get("hideToggleColumn"),showSeparatorPerRow:this.model.get("showSeparatorPerRow"),customPlaceholderText:this.customPlaceholderText});return this.$el.html(e),this._createFieldNestedTypeahead(),this._createOperatorDropdown(),this._createOperandColumn(),this}})}},function(e,t,i){e.exports=function(){i(67)(),Magellan.Views.TupleConditions=Backbone.View.extend({className:"tuple-conditions-wrapper",template:_.template(i(186)),initialize:function(e){this.model=new Magellan.Models.TupleConditions(e),this.listenTo(this.model,"addedCondition",this.render),this.listenTo(this.model,"deletedCondition",this.render),this.listenTo(this.model,"resetLogic",this.render),this.customRPNValidation=e.customRPNValidation&&"AsyncFunction"===e.customRPNValidation.constructor.name?e.customRPNValidation:null,this.render()},events:{"click .add-tuple-condition-btn":"addConditionButtonHandler","click .reset-tuple-rule-logic":"setDefaultLogic","keyup .tuple-rule-logic-input":"ruleLogicInputHandler"},returnModelValues:function(){return this.model.toJSON()},returnConditionValues:function(){return{conditions:this.model.get("conditions"),logic:this.model.get("logic"),rpnLogic:this.model.get("rpnLogic")}},validate:function(){return this.model.validate()},setDefaultLogic:function(){this.model.setDefaultLogic()},ruleLogicInputHandler:async function(e){var t=$(e.target),i=t.val();this.model.parseLogic(i);var a=this.model.isRpnLogicValid(this.model.getParsedLogicObject(i)),n="";this.customRPNValidation&&(n=await this.customRPNValidation(),a=a&&_.isEmpty(n));var o=this.$el.find(".rule-logic-error-row");if(a)t.toggleClass("lds-field-invalid",!1),o.html(""),o.hide();else{t.toggleClass("lds-field-invalid",!0);var l=[];_.isEmpty(this.model.get("rpnLogicErrorMessages")[0])||l.push(this.model.get("rpnLogicErrorMessages")[0]),_.isEmpty(n)||l.push(n),o.html(l.join("; ")),o.show()}this.model.trigger("conditionChange",this.model.toJSON())},addConditionButtonHandler:function(e){e.preventDefault(),this.addCondition(null)},addCondition:function(e){this.model.addCondition(e)},createRuleRows:function(){var e=this.$el.find(".tuple-conditions-row");e.empty();var t=this.model.get("conditions");0===t.length?this.addCondition(null):(_.each(t,(t,i)=>{var a=new Magellan.Views.SingleTupleCondition({idx:i,model:this.model,condition:t});e.append(a.$el)}),this.model.validate())},render:function(){var e=this.template({fieldObjectType:_LeanData.MetaDataController.getObjectMetaDataObject(this.model.get("fieldObjectType"),!0).label||this.model.get("fieldObjectType"),operandObjectType:this.model.get("operandObjectType"),logic:this.model.get("logic"),showRpnContent:this.model.get("conditions").length>1,rpnLogicIsValid:this.model.rpnLogicIsValid,operandHeader:this.model.get("operandHeader"),showSeparatorPerRow:this.model.get("showSeparatorPerRow")});return this.$el.html(e),this.model.trigger("conditionChange",this.model.toJSON()),this.createRuleRows(),this}})}},function(e,t,i){e.exports=function(){Magellan.Views.MergeFieldUsers=i(69)(),Magellan.Views.MergeFieldObject=i(68)()}},function(e,t,i){e.exports=function(){Magellan.Views.MergeFieldSelector=i(70)(),Magellan.Views.RelativeDateModal=i(71)(),Magellan.Views.VariableInsertButton=i(72)(),Magellan.Controllers.VariableCreator={createVariableInsertButton:function(e,t,i,a,n,o){if(!e)throw new Error("variable-insert-button.view: nodeModel is required.");return new Magellan.Views.VariableInsertButton({nodeModel:e,typeahead:t,onSelect:i,openDropdownLeft:a,name:n,hideAuditLogFullLink:o})}}}},function(e,t,i){e.exports=function(){var e=i(191);return Magellan.Views.WaitingScreen=Backbone.View.extend({tagName:"div",className:"ld-waiting-screen hidden",template:_.template(e),messageTemplate:_.template('<div class="waiting-message"><%-message%></div>'),initialize:function(e){this.pendingPromises=new Backbone.Collection,this.container=e.container||null,this.container&&$(this.container).html(this.$el),this.render()},render:function(){return this.$el.html(this.template()),this},show:function(e){e=e||"Loading...";var t=$(this.messageTemplate({message:e}));this.$(".waiting-message-wrapper").append(t);var i=$.Deferred(),a=this.pendingPromises.add({promise:i,messageEl:t});return i.always(this.hide.bind(this,a)),this.$el.toggleClass("hidden",!1),i},hide:function(e){e?(e.get("messageEl").remove(),this.pendingPromises.remove(e)):this.pendingPromises.reset(),0===this.pendingPromises.length&&(this.$el.toggleClass("hidden",!0),this.$(".waiting-message-wrapper").empty())}})}},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.AccountRouter={},Magellan.Controllers.AccountRouter.initialize=function(){Magellan.Views.AccountNodeForm=i(80)(),Magellan.Views.AccountInsertTriggerNode=i(78)(),Magellan.Views.AccountUpdateTriggerNode=i(87)(),Magellan.Views.AccountMatchNode=i(79)(),Magellan.Views.AccountDecisionNode=i(77)(),Magellan.Views.AccountTrueFalseNode=i(86)(),Magellan.Views.AccountBranchNode=i(74)(),Magellan.Views.AccountRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Views.AccountActivityRouting=i(73)(),Magellan.Views.AccountTeamRouting=i(85)(),Magellan.Views.AccountOpportunityRouting=i(81)(),Magellan.Views.AccountOwnerMappingRouting=i(82)(),Magellan.Views.AccountUserFieldRouting=i(88)(),Magellan.Views.AccountCreateOpportunity=i(75)(),Magellan.Views.AccountCreateTask=i(76)(),Magellan.Views.AccountRouteToTerritory=i(83)(),Magellan.Views.AccountZoominfoEnrichCompany=i(89)(),Magellan.Views.AccountSendNotification=i(84)()},Magellan.Controllers.AccountRouter.getNodeFormViewFromNodeModel=function(e){return e instanceof _LeanData.GraphModels.Trigger_New?Magellan.Views.AccountInsertTriggerNode:e instanceof _LeanData.GraphModels.Trigger_Updated?Magellan.Views.AccountUpdateTriggerNode:e instanceof _LeanData.GraphModels.Decision_TrueFalseNode?Magellan.Views.AccountTrueFalseNode:e instanceof _LeanData.GraphModels.Decision_BranchNode?Magellan.Views.AccountBranchNode:e instanceof _LeanData.GraphModels.MatchNode?Magellan.Views.AccountMatchNode:e instanceof _LeanData.GraphModels.Action_RouteToAccountTeam?Magellan.Views.AccountTeamRouting:e instanceof _LeanData.GraphModels.Action_RouteToMatchedOpportunity?Magellan.Views.AccountOpportunityRouting:e instanceof _LeanData.GraphModels.Action_RouteToOwnerMapping?Magellan.Views.AccountOwnerMappingRouting:e instanceof _LeanData.GraphModels.Action_RouteToUserField?Magellan.Views.AccountUserFieldRouting:e instanceof _LeanData.GraphModels.Action_CreateOpportunity?Magellan.Views.AccountCreateOpportunity:e instanceof _LeanData.GraphModels.Action_CreateTask?Magellan.Views.AccountCreateTask:e instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment?Magellan.Views.AccountRouteToTerritory:e instanceof _LeanData.GraphModels.Action_SendNotification?Magellan.Views.AccountSendNotification:e instanceof _LeanData.GraphModels.Action_CustomInterface?Magellan.Views.CustomInterface:e instanceof _LeanData.GraphModels.ReroutingNode?Magellan.Views.AccountRerouteNode:e instanceof _LeanData.GraphModels.Action_RouteToMatchedActivity?Magellan.Views.AccountActivityRouting:e instanceof _LeanData.GraphModels.Action_AssignAccountTeamMembers?Magellan.Views.AssignAccountTeamMembers:e instanceof _LeanData.GraphModels.Partner_ZoomInfo_EnrichCompany?Magellan.Views.AccountZoominfoEnrichCompany:null};var a={Account:"Account",A2O:"Opportunity",RA:"Activity"};Magellan.Controllers.AccountRouter.getObjectNameFromHatType=function(e){return a[e]||_LeanData.AppState.PrimarySObjectType},e.exports=Magellan.Controllers.AccountRouter},function(e,t,i){e.exports=function(e){var t=new(i(92)())(e);j$("#magellan-in-angela-container").html(t.render().$el)}},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.CaseRouter={},Magellan.Controllers.CaseRouter.initialize=function(){Magellan.Views.CaseNodeForm=i(98)(),Magellan.Views.CaseInsertTriggerNode=i(96)(),Magellan.Views.CaseUpdateTriggerNode=i(101)(),Magellan.Views.CaseMatchNode=i(97)(),Magellan.Views.CaseDecisionNode=i(95)(),Magellan.Views.CaseTrueFalseNode=i(100)(),Magellan.Views.CaseBranchNode=i(94)(),Magellan.Views.CaseRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Views.CaseActivityAssignment=i(93)(),Magellan.Views.CaseSendNotification=i(99)()};var a={RA:"Activity",Ca2A:"Account"};Magellan.Controllers.CaseRouter.getObjectNameFromHatType=function(e){return a[e]||_LeanData.AppState.PrimarySObjectType},Magellan.Controllers.CaseRouter.getNodeFormViewFromNodeModel=function(e){return e instanceof _LeanData.GraphModels.Trigger_New?Magellan.Views.CaseInsertTriggerNode:e instanceof _LeanData.GraphModels.Trigger_Updated?Magellan.Views.CaseUpdateTriggerNode:e instanceof _LeanData.GraphModels.Decision_TrueFalseNode?Magellan.Views.CaseTrueFalseNode:e instanceof _LeanData.GraphModels.Decision_BranchNode?Magellan.Views.CaseBranchNode:e instanceof _LeanData.GraphModels.MatchNode?Magellan.Views.CaseMatchNode:e instanceof _LeanData.GraphModels.Action_SendNotification?Magellan.Views.CaseSendNotification:e instanceof _LeanData.GraphModels.Action_RouteToMatchedActivity?Magellan.Views.CaseActivityAssignment:e instanceof _LeanData.GraphModels.Action_CustomInterface?Magellan.Views.CustomInterface:e instanceof _LeanData.GraphModels.ReroutingNode?Magellan.Views.CaseRerouteNode:e instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment?Magellan.Views.AccountRouteToTerritory:e instanceof _LeanData.GraphModels.Action_RouteToMatchedAccount?Magellan.Views.AccountBasedRouting:void 0},e.exports=Magellan.Controllers.CaseRouter},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.ContactRouter={},Magellan.Controllers.ContactRouter.initialize=function(){Magellan.Views.ContactNodeForm=i(109)(),Magellan.Views.InsertedContactTriggerNode=i(121)(),Magellan.Views.UpdateContactTriggerNode=i(122)(),Magellan.Views.ContactMatchNode=i(107)(),Magellan.Views.ContactDecisionNode=i(105)(),Magellan.Views.ContactTrueFalseNode=i(106)(),Magellan.Views.ContactBranchNode=i(104)(),Magellan.Views.ContactRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Views.ContactRouteToContact=i(114)(),Magellan.Views.ContactRouteToDuplicateContact=i(115)(),Magellan.Views.ContactRouteToAccount=i(111)(),Magellan.Views.ContactRouteToOpportunity=i(116)(),Magellan.Views.ContactRouteToActivity=i(112)(),Magellan.Views.ContactRouteToCampaignMember=i(113)(),Magellan.Views.ContactCreateOpportunity=i(102)(),Magellan.Views.ContactCreateTask=i(103)(),Magellan.Views.ContactOutreachAddToSequence=i(110)(),Magellan.Views.ContactSalesloftAddToCadence=i(118)(),Magellan.Views.ContactRouteToTerritory=i(117)(),Magellan.Views.ContactSendNotification=i(119)(),Magellan.Views.ContactMergeDupe=i(108)(),Magellan.Views.ContactZoominfoEnrichPerson=i(120)()},Magellan.Controllers.ContactRouter.getNodeFormViewFromNodeModel=function(e){return e instanceof _LeanData.GraphModels.Trigger_New?Magellan.Views.InsertedContactTriggerNode:e instanceof _LeanData.GraphModels.Trigger_Updated?Magellan.Views.UpdateContactTriggerNode:e instanceof _LeanData.GraphModels.Decision_TrueFalseNode?Magellan.Views.ContactTrueFalseNode:e instanceof _LeanData.GraphModels.Decision_BranchNode?Magellan.Views.ContactBranchNode:e instanceof _LeanData.GraphModels.MatchNode?Magellan.Views.ContactMatchNode:e instanceof _LeanData.GraphModels.ReroutingNode?Magellan.Views.ContactRerouteNode:e instanceof _LeanData.GraphModels.Action_RouteToAccount?Magellan.Views.ContactRouteToAccount:e instanceof _LeanData.GraphModels.Action_RouteToMatchedAccount?Magellan.Views.AccountBasedRouting:e instanceof _LeanData.GraphModels.Action_RouteToMatchedActivity?Magellan.Views.ContactRouteToActivity:e instanceof _LeanData.GraphModels.Action_RouteToMatchedCampaignMember?Magellan.Views.ContactRouteToCampaignMember:e instanceof _LeanData.GraphModels.Action_RouteToMatchedOpportunity?Magellan.Views.ContactRouteToOpportunity:e instanceof _LeanData.GraphModels.Action_RouteToMatchedContact?Magellan.Views.ContactRouteToContact:e instanceof _LeanData.GraphModels.Action_RouteToDuplicateContact?Magellan.Views.ContactRouteToDuplicateContact:e instanceof _LeanData.GraphModels.Action_CreateOpportunity?Magellan.Views.ContactCreateOpportunity:e instanceof _LeanData.GraphModels.Action_CreateTask?Magellan.Views.ContactCreateTask:e instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment?Magellan.Views.ContactRouteToTerritory:e instanceof _LeanData.GraphModels.Action_SendNotification?Magellan.Views.ContactSendNotification:e instanceof _LeanData.GraphModels.Action_MergeContactDuplicate?Magellan.Views.ContactMergeDupe:e instanceof _LeanData.GraphModels.Action_CustomInterface?Magellan.Views.CustomInterface:e instanceof _LeanData.GraphModels.Partner_Outreach_AddToSequence?Magellan.Views.ContactOutreachAddToSequence:e instanceof _LeanData.GraphModels.Partner_Salesloft_AddToCadence?Magellan.Views.ContactSalesloftAddToCadence:e instanceof _LeanData.GraphModels.Partner_ZoomInfo_EnrichPerson?Magellan.Views.ContactZoominfoEnrichPerson:null};var a={Contact:"Account",C2O:"Opportunity",C2C:"Contact",C2A:"Account",CDupe:"Contact",RA:"Activity",RCM:"CampaignMember"};Magellan.Controllers.ContactRouter.getObjectNameFromHatType=function(e){return a[e]||_LeanData.AppState.PrimarySObjectType},e.exports=Magellan.Controllers.ContactRouter},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.MeetingRouter={},Magellan.Controllers.MeetingRouter.initialize=function(){Magellan.Views.MeetingMatchNode=i(124)(),Magellan.Views.MeetingBranchNode=i(123)()},Magellan.Controllers.MeetingRouter.getNodeFormViewFromNodeModel=function(e){return e instanceof _LeanData.GraphModels.Trigger_UpdatedCampaignMember?Magellan.Views.UpdateCampaignMemberTriggerNode:e instanceof _LeanData.GraphModels.Decision_TrueFalseNode?Magellan.Views.TrueFalseNode:e instanceof _LeanData.GraphModels.Decision_BranchNode?Magellan.Views.MeetingBranchNode:e instanceof _LeanData.GraphModels.MatchNode?Magellan.Views.MeetingMatchNode:e instanceof _LeanData.GraphModels.Action_RouteToMatchedLead?Magellan.Views.LeadBasedRouting:e instanceof _LeanData.GraphModels.Action_RouteToMatchedAccount?Magellan.Views.AccountBasedRouting:e instanceof _LeanData.GraphModels.Action_RouteToMatchedOpportunity?Magellan.Views.OpportunityBasedRouting:e instanceof _LeanData.GraphModels.Action_RouteToDuplicateLead?Magellan.Views.RouteToDuplicateLead:e instanceof _LeanData.GraphModels.Action_RouteToDuplicateContact?Magellan.Views.RouteToDuplicateContact:e instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment?Magellan.Views.TerritoryRouting:void 0};var a={P2L:"Lead",P2A:"Account",P2O:"Opportunity",P2DupeL:"Lead",P2DupeC:"Contact",RA:"Activity"};Magellan.Controllers.MeetingRouter.getObjectNameFromHatType=function(e){return a[e]||_LeanData.AppState.PrimarySObjectType},e.exports=Magellan.Controllers.MeetingRouter},function(e,t,i){Magellan=window.Magellan=window.Magellan||{},Magellan.Controllers=Magellan.Controllers||{},Magellan.Controllers.OpportunityRouter={},Magellan.Controllers.OpportunityRouter.initialize=function(){Magellan.Views.OpportunityNodeForm=i(131)(),Magellan.Views.OpportunityInsertTriggerNode=i(129)(),Magellan.Views.OpportunityUpdateTriggerNode=i(139)(),Magellan.Views.OpportunityMatchNode=i(130)(),Magellan.Views.OpportunityDecisionNode=i(128)(),Magellan.Views.OpportunityTrueFalseNode=i(138)(),Magellan.Views.OpportunityBranchNode=i(125)(),Magellan.Views.OpportunityRerouteNode=Magellan.Views.Reroute.extend({}),Magellan.Views.OpportunityRouteToContact=i(134)(),Magellan.Views.OpportunityRouteToAccount=i(132)(),Magellan.Views.OpportunityRouteToActivity=i(133)(),Magellan.Views.OpportunityRouteToOpportunity=i(135)(),Magellan.Views.OpportunityCreateOpportunity=i(126)(),Magellan.Views.OpportunityCreateTask=i(127)(),Magellan.Views.OpportunityRouteToTerritory=i(136)(),Magellan.Views.OpportunitySendNotification=i(137)()},Magellan.Controllers.OpportunityRouter.getNodeFormViewFromNodeModel=function(e){return e instanceof _LeanData.GraphModels.Trigger_New?Magellan.Views.OpportunityInsertTriggerNode:e instanceof _LeanData.GraphModels.Trigger_Updated?Magellan.Views.OpportunityUpdateTriggerNode:e instanceof _LeanData.GraphModels.Decision_TrueFalseNode?Magellan.Views.OpportunityTrueFalseNode:e instanceof _LeanData.GraphModels.Decision_BranchNode?Magellan.Views.OpportunityBranchNode:e instanceof _LeanData.GraphModels.MatchNode?Magellan.Views.OpportunityMatchNode:e instanceof _LeanData.GraphModels.Action_RouteToMatchedContact?Magellan.Views.OpportunityRouteToContact:e instanceof _LeanData.GraphModels.Action_RouteToAccount?Magellan.Views.OpportunityRouteToAccount:e instanceof _LeanData.GraphModels.Action_RouteToMatchedActivity?Magellan.Views.OpportunityRouteToActivity:e instanceof _LeanData.GraphModels.Action_RouteToMatchedOpportunity?Magellan.Views.OpportunityRouteToOpportunity:e instanceof _LeanData.GraphModels.Action_CreateOpportunity?Magellan.Views.OpportunityCreateOpportunity:e instanceof _LeanData.GraphModels.Action_CreateTask?Magellan.Views.OpportunityCreateTask:e instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment?Magellan.Views.OpportunityRouteToTerritory:e instanceof _LeanData.GraphModels.Action_SendNotification?Magellan.Views.OpportunitySendNotification:e instanceof _LeanData.GraphModels.Action_CustomInterface?Magellan.Views.CustomInterface:e instanceof _LeanData.GraphModels.ReroutingNode?Magellan.Views.OpportunityRerouteNode:null};var a={Opportunity:"Opportunity",O2O:"Opportunity",O2C:"Contact",RA:"Activity"};Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType=function(e){return a[e]||_LeanData.AppState.PrimarySObjectType},e.exports=Magellan.Controllers.OpportunityRouter},function(e,t){e.exports=function initializePendingDetail(e){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),Magellan.Views.PendingDetail=Backbone.View.extend({parsedMetrics:e,removeAllChildViews:function(){_.each(this.childViews,function(e){try{e.remove()}catch(e){}}),this.childViews=[]},remove:function(){try{Backbone.View.prototype.remove.call(this,[])}catch(e){}this.removeAllChildViews()}})}},function(e,t,i){e.exports=function initializePendingDetailTable(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(275);Magellan.Views.PendingDetailTable=Magellan.Views.PendingDetail.extend({initialize:function(e){this.detailColumns=e.detailColumns,this.logs=e.logs,this.collection=e.collection,this.childViews=[],this.dataTable=null,this.columnLayout=Magellan.Models.PendingCCIO.getColumnLayout(_.capitalize(this.parsedMetrics.objectType),this.collection.statType)},template:_.template(e),events:{},createRow:function(e){var t=new Magellan.Views.PendingDetailTableRow({log:e,columnLayout:this.columnLayout});this.childViews.push(t),this.$el.find("#metrics-detail-body").append(t.$el),t.render()},render:function(){this.removeAllChildViews();var e=this.template({detailColumns:this.detailColumns,columnLayout:this.columnLayout,columnHeaderMapping:Magellan.Models.PendingCCIO.fieldToHeaderMapping[this.parsedMetrics.objectType]});this.$el.html(e);var t=this;return _.each(this.logs,function(e){t.createRow(e)}),_.defer(e=>{t.dataTable=$("#metrics-detail-table").DataTable({paging:!1,info:!1,ordering:!1,searching:!1}),$("#metrics-detail-table").show()}),this},showNewLogs:function(e){var t=this;$("#metrics-detail-body").empty(),_.each(e,function(e){t.createRow(e)})}})}},function(e,t,i){e.exports=function initializePendingDetailTableRow(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(276);Magellan.Views.PendingDetailTableRow=Magellan.Views.PendingDetail.extend({tagName:"tr",className:"pending-metric-detail-row",initialize:function(e){this.log=e.log,this.columnLayout=e.columnLayout},template:_.template(e),render:function(){var e=this.template({log:this.log.primary,columnLayout:this.columnLayout});return this.$el.html(e),this}})}},function(e,t,i){e.exports=function initializePendingDetailView(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(274);Magellan.Views.PendingDetailView=Magellan.Views.PendingDetail.extend({initialize:function(){this.userSettings={startDate:this.parsedMetrics.userStartDate,endDate:this.parsedMetrics.userEndDate,statusKey:this.parsedMetrics.statusKey,nextNodes:new Set(["Inactive User","Inactive Owner","Queue Owner","No Mapping Found","Invalid Group","Territory Not Assigned","Not Available For Routing"])},this.statType=this.parsedMetrics.statType,this.minDate=this.parsedMetrics.startDate,this.maxDate=this.parsedMetrics.endDate,this.childViews=[],this.expanded=!1,this.detailColumns=["id","name","email","title","status","preOwner","postOwner","createddate"];var e=this.template({statType:this.statType,nodeName:this.parsedMetrics.nodeName});this.$el.html(e),this.initializeDatePickers(),this.dataTable=null,this.collection=new Magellan.Collections.PendingCCIO(null,{deploymentId:this.parsedMetrics.deploymentId,userStartDate:this.userSettings.startDate,userEndDate:this.userSettings.endDate,nodeName:this.parsedMetrics.nodeName,statType:this.parsedMetrics.statType}),this.currentDisplayedRecords=[],this.initializeRemoteDataThenRender()},initializeRemoteDataThenRender:function(){var e=this;$(".dg_inner-wrapper").LoadingOverlay("show"),this.collection.initializeRemoteData().then(function(t){e.render(),$(".dg_inner-wrapper").LoadingOverlay("hide",!0)})},initializeDatePickers:function(){var e=this;_.defer(t=>{const i=$("#pending-datepick-start"),a=$("#pending-datepick-end");i&&i.datepicker("destroy").removeClass("hasDatepicker"),a&&a.datepicker("destroy").removeClass("hasDatepicker"),i.datepicker({dateFormat:"mm/dd/yy",minDate:new Date(e.minDate),maxDate:e.maxDate?new Date(e.maxDate):new Date}),e.userSettings.startDate&&i.datepicker("setDate",new Date(e.userSettings.startDate)),i.focus(function(){i.datepicker("show")}),i.on("change",this.changeDateRange.bind(this)),a.datepicker({dateFormat:"mm/dd/yy",minDate:new Date(e.minDate),maxDate:e.maxDate?new Date(e.maxDate):new Date}),e.userSettings.endDate&&a.datepicker("setDate",new Date(e.userSettings.endDate)),a.focus(function(){a.datepicker("show")}),a.on("change",this.changeDateRange.bind(this))})},template:_.template(e),events:{"click .pagination-item":"handleDifferentPageClick","click .abort-action":"handleAbortActionClick"},updateTableWithData:function(e){this.pendingDetailTable.showNewLogs(e)},updatePaginationButtons:function(){$(".pagination-item").removeClass("inactive"),this.collection.isOnFirstPage()&&$(".pagination-back").addClass("inactive"),this.collection.isOnLastPage()&&$(".pagination-next").addClass("inactive")},handleDifferentPageClick:function(e){var t=this,i=$(e.currentTarget).data("direction");this.collection.getDifferentPage(i).then(function(e){t.updateTableWithData(e),t.updatePaginationButtons()})},changeDateRange:function(e){var t=new Date($("#pending-datepick-start").val()),i=new Date($("#pending-datepick-end").val());this.userSettings.startDate=t,this.userSettings.endDate=i;var a=this;this.collection.filterRecordsByDate(t,i).paginatorPromise.then(function(){a.drawTable(a.collection.models),a.updatePaginationButtons()})},render:function(){return this.drawTable(this.collection.models),this.updatePaginationButtons(),this},showLoading:function(){this.$el.find()},drawTable:function(e){this.pendingDetailTable=new Magellan.Views.PendingDetailTable({detailColumns:this.detailColumns,logs:e,collection:this.collection}),this.removeAllChildViews(),this.childViews.push(this.pendingDetailTable),this.$el.find("#outcome-table-wrapper").html(this.pendingDetailTable.$el),this.pendingDetailTable.render()},handleAbortActionClick:function(e){e.preventDefault();let t="Abort Time-to-Action Tracking/Time-Based Hold",i="Would you like to abort the hold on the selected record?<br>This action cannot be undone.";"zoominfo"===this.statType&&(t="Abort Routing Post-Enrichment",i="Would you like to stop the record from being routed further? It still may be enriched.<br>This action cannot be undone."),_LeanData.Notification.showConfirmationDialog({header:t,message:i,confirmButtonText:"Yes",cancelButtonText:"No",onConfirm:()=>{var t=$(e.currentTarget).prop("id");this.collection.abortPendingCCIO(t).then(()=>{_LeanData.Navigation.navigateByUrl("",{skipLocationChange:!0}).then(()=>{_LeanData.Navigation.navigateByUrl(window.location.hash.replace("#",""),{skipLocationChange:!1})})})}})}})}},function(e,t){e.exports=function initializePendingDetailModels(e){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.PendingCCIO=Backbone.Model.extend({getPrimary:function(e){var t=e;return"Lead"===this.objectType&&(t.account=t.Lead__r.Reporting_Matched_Account__c),t},initialize:function(e){this.ns=e.LeanData__SObject_Type__c?"LeanData__":"",this.objectType=e[this.ns+"SObject_Type__c"],this.primary=this.getPrimary(e)}}),Magellan.Models.PendingCCIO.fieldToHeaderMapping={id:"Company",name:"Full Name",email:"Email",title:"Title",status:"Lead Status",preOwner:"Pre-Owner",postOwner:"Post-Owner",ownerid:"Owner",createddate:"Created Date"},Magellan.Models.PendingCCIO.getColumnLayout=((e,t)=>{let i="Other";return["Lead","Contact","Account","Opportunity","Case"].includes(e)||(i=e,e="Other"),{Lead:[["Company",function(e){return e.account?"/"+e.account:null},function(e){return e.Lead__r?e.Lead__r.Company:""}],["Name",function(e){return e.Lead__r?"/"+e.Lead__r.Id:""},function(e){return e.Lead__r?e.Lead__r.Name:e.Primary_Id__c}],["Email",function(e){return e.Lead__r?"mailto:"+e.Lead__r.Email:""},function(e){return e.Lead__r?e.Lead__r.Email:""}],["Lead Status",function(e){return null},function(e){return e.Lead__r?e.Lead__r.Status:""}],["Processed Date",function(e){return null},function(e){return moment(new Date(e.CreatedDate)).format("MM/DD/YYYY hh:mm:ss A")}],["hold-until"===t?"Expiration Time":"Evaluate On",function(e){return null},function(e){return e.Scheduled_Processing_Time__c?moment(new Date(e.Scheduled_Processing_Time__c)).format("MM/DD/YYYY hh:mm:ss A"):""}],["",function(e){return e.Id},function(e){return"Abort"}]],Contact:[["Account",function(e){return e.Contact__r.AccountId?"/"+e.Contact__r.AccountId:null},function(e){return e.Contact__r.AccountId?e.Contact__r.Account.Name:""}],["Name",function(e){return"/"+e.Contact__c},function(e){return e.Contact__r?e.Contact__r.Name:e.Primary_Id__c}],["Email",function(e){return"mailto:"+e.Contact__r.Email},function(e){return e.Contact__r?e.Contact__r.Email:""}],["Processed Date",function(e){return null},function(e){return moment(new Date(e.CreatedDate)).format("MM/DD/YYYY hh:mm:ss A")}],["hold-until"===t?"Expiration Time":"Evaluate On",function(e){return null},function(e){return e.Scheduled_Processing_Time__c?moment(new Date(e.Scheduled_Processing_Time__c)).format("MM/DD/YYYY hh:mm:ss A"):""}],["",function(e){return e.Id},function(e){return"Abort"}]],Account:[["Account Name",function(e){return"/"+e.Account__c},function(e){return e.Account__r?e.Account__r.Name:e.Primary_Id__c}],["Processed Date",function(e){return null},function(e){return moment(new Date(e.CreatedDate)).format("MM/DD/YYYY hh:mm:ss A")}],["hold-until"===t?"Expiration Time":"Evaluate On",function(e){return null},function(e){return e.Scheduled_Processing_Time__c?moment(new Date(e.Scheduled_Processing_Time__c)).format("MM/DD/YYYY hh:mm:ss A"):""}],["",function(e){return e.Id},function(e){return"Abort"}]],Opportunity:[["Opportunity",function(e){return null!=e.Opportunity__c?"/"+e.Opportunity__c:null},function(e){return e.Opportunity__r?e.Opportunity__r.Name:e.Primary_Id__c}],["Account",function(e){return e.Opportunity__r.Account?"/"+e.Opportunity__r.Account.Id:null},function(e){return e.Opportunity__r?e.Opportunity__r.Account.Name:""}],["Stage",function(e){return null},function(e){return e.Opportunity__r?e.Opportunity__r.StageName:""}],["Close Date",function(e){return null},function(e){return e.Opportunity__r?moment(new Date(e.Opportunity__r.CloseDate)).format("MM/DD/YYYY hh:mm:ss A"):""}],["Processed Date",function(e){return null},function(e){return moment(new Date(e.CreatedDate)).format("MM/DD/YYYY hh:mm:ss A")}],["hold-until"===t?"Expiration Time":"Evaluate On",function(e){return null},function(e){return e.Scheduled_Processing_Time__c?moment(new Date(e.Scheduled_Processing_Time__c)).format("MM/DD/YYYY hh:mm:ss A"):""}],["",function(e){return e.Id},function(e){return"Abort"}]],Case:[["Case ID",function(e){return"/"+e.Case__c},function(e){return e.Case__r?e.Case__r.CaseNumber:""}],["Account Name",function(e){return"/"+(e.Case__r.Account&&e.Case__r.Account.Id?e.Case__r.Account.Id:"")},function(e){return e.Case__r?e.Case__r.Account.Name:""}],["Processed Date",function(e){return null},function(e){return moment(new Date(e.CreatedDate)).format("MM/DD/YYYY hh:mm:ss A")}],["",function(e){return e.Id},function(e){return"Abort"}]],Other:[[i+" Object ID",function(e){return"/"+e.Primary_Id__c},function(e){return e.Primary_Id__c}],["Processed Date",function(e){return null},function(e){return moment(new Date(e.CreatedDate)).format("MM/DD/YYYY hh:mm:ss A")}],["hold-until"===t?"Expiration Time":"Evaluate On",function(e){return null},function(e){return e.Scheduled_Processing_Time__c?moment(new Date(e.Scheduled_Processing_Time__c)).format("MM/DD/YYYY hh:mm:ss A"):""}],["",function(e){return e.Id},function(e){return"Abort"}]]}[e]}),Magellan.Collections.PendingCCIO=Backbone.Collection.extend({initialize:function(e,t){this.deploymentId=t.deploymentId,this.statType=t.statType,this.dateRange=[];var i=new Date(t.userStartDate),a=new Date(t.userEndDate);this.dateRange[0]=t.userStartDate&&isFinite(i)?i:new Date(0),this.dateRange[1]=t.userEndDate&&isFinite(a)?this.addDays(a,1):new Date(1e13),this.nodeName=t.nodeName,this.filterPageNumber,this.currentPageResults={page:1,pageSize:0,records:[]},this.nextPageResults={page:2,pageSize:0,records:[]},this.previousPageResults,this.filter()},model:Magellan.Models.PendingCCIO,abortPendingCCIO:function(e){var t=[];t.push(e),_LeanData.RemotingRouter.abortCCIO(t);var i=$.Deferred(),a=this;return a.filter().then(function(){a.processAndUpdateCollection(a.currentPageResults["id to records"]),i.resolve()}),i},filterRecordsByDate:function(e,t){var i=this,a={paginatorPromise:$.Deferred()},n=60*(new Date).getTimezoneOffset()*1e3;this.dateRange=[];var o=new Date(e.valueOf()+n),l=new Date(t.valueOf()+n);return this.dateRange[0]=isFinite(e)?o:new Date(0),this.dateRange[1]=isFinite(t)?this.addDays(l,1):new Date(1e13),i.filter().then(function(){i.processAndUpdateCollection(i.currentPageResults["id to records"]),a.paginatorPromise.resolve()}),a},addDays:function(e,t){var i=new Date(e);return i.setDate(i.getDate()+t),i},processAndUpdateCollection:function(e){this.reset([]);var t=this;_.each(e,e=>{var i=new Magellan.Models.PendingCCIO(e);t.add(i)})},initializeRemoteData:function(){var e=$.Deferred(),t=this;return t.filter().then(function(){t.processAndUpdateCollection(t.currentPageResults["id to records"]),e.resolve()}),e},isOnFirstPage:function(){return 1==this.currentPageResults.page},isOnLastPage:function(){return 0==this.nextPageResults.pageSize},getDifferentPage:function(e){var t={previous:this.previousPage,next:this.nextPage}[e];if(t){var i=$.Deferred(),a=this;return t.apply(this).then(function(){a.processAndUpdateCollection(a.currentPageResults["id to records"]),i.resolve(a.models)}),i}console.warn("getDifferentPage must be called with either 'first', 'previous', 'next', or 'last'")},getPayloadJSON:function(){return{deploymentId:this.deploymentId,startDate:moment(this.dateRange[0]).format(_LeanData._datetime.DATETIME_FORMAT),endDate:moment(this.dateRange[1]).format(_LeanData._datetime.DATETIME_FORMAT),page:this.filterPageNumber,node:decodeURIComponent(this.nodeName)}},fetchLogs:function(){return this.isFetchingData=!0,_LeanData.RemotingRouter.getPaginatedCCIOs(JSON.stringify(this.getPayloadJSON()))},filter:function(){var e=$.Deferred();return this.filterPageNumber=1,this.fetchLogs().then(e=>(this.currentPageResults=e,this.filterPageNumber=2,this.fetchLogs())).then(t=>{this.nextPageResults=t,this.isFetchingData=!1,e.resolve()}),e},previousPage:function(){window.scrollTo({top:0});var e=$.Deferred();return this.nextPageResults=this.currentPageResults,this.currentPageResults=this.previousPageResults,this.filterPageNumber=this.currentPageResults.page-1,this.filterPageNumber<1?e.resolve():(this.fetchLogs().then(t=>{this.previousPageResults=t,this.isFetchingData=!1,e.resolve()}),e)},nextPage:function(){window.scrollTo({top:0});var e=$.Deferred();return this.previousPageResults=this.currentPageResults,this.currentPageResults=this.nextPageResults,this.filterPageNumber=this.currentPageResults.page+1,this.fetchLogs().then(t=>{this.nextPageResults=t,this.isFetchingData=!1,e.resolve()}),e}})}},function(e,t,i){e.exports=function(e){if(_.each(e.filteredUserList,function(e){"Queue"===e.Type&&(e.IsActive=!0,e.Type="Queue")}),!0===e.existing&&_.isUndefined(e.pool))_LeanData.Navigation.navigateByUrl("round_robin_pools");else{i(152)(),Magellan.Views.RoundRobinPoolsCreatorTabs={},Magellan.Views.RoundRobinPoolsCreatorTabs.Info=i(150)(),i(151)(),Magellan.Views.RoundRobinPoolsCreatorTabs.Distribution=i(149)(),i(147)(),i(154)(),Magellan.Views.RoundRobinPoolsCreator=i(153)();var t=new Magellan.Views.RoundRobinPoolsCreator(e);window.rrpoolview=t,j$("#magellan-in-angela-container").html(""),j$("#magellan-in-angela-container").html(t.render().$el)}}},function(e,t,i){e.exports=function(e){i(155)(),Magellan.Views.RoundRobinPools=i(156)(),Magellan.Views.AddUsersToPools=i(3)(),new Magellan.Views.RoundRobinPools(e).setElement(j$("#magellan-in-angela-container")).render()}},function(e,t,i){e.exports=function(e){i(157)(),i(158)();var t=new Magellan.Views.TerritorySegmentAssignments(e);j$("#magellan-in-angela-container").html(t.$el)}},function(e,t,i){e.exports=function(e){i(5)(),i(159)();var t=new Magellan.Views.TerritorySegmentEditor(e);j$("#magellan-in-angela-container").html(t.$el)}},function(e,t,i){e.exports=function(e){i(5)(),i(6)(),Magellan.Views.TerritorySegments=i(160)();var t=new Magellan.Views.TerritorySegments(e);j$("#magellan-in-angela-container").html(""),j$("#magellan-in-angela-container").html(t.$el)}},function(e,t,i){e.exports=function initializeNewViews(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});var e=i(259),t=i(244),a=i(227),n=i(249),o=i(236),l=i(243),s={};Magellan.Views.getAPIObjectNameFromObjectType=function(e){return"Lead"===_LeanData.AppState.PrimarySObjectType?Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP[e]||_LeanData.AppState.PrimarySObjectType:"Contact"===_LeanData.AppState.PrimarySObjectType?Magellan.Controllers.ContactRouter.getObjectNameFromHatType(e):"Account"===_LeanData.AppState.PrimarySObjectType?Magellan.Controllers.AccountRouter.getObjectNameFromHatType(e):"Opportunity"===_LeanData.AppState.PrimarySObjectType?Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType(e):"Case"===_LeanData.AppState.PrimarySObjectType?Magellan.Controllers.CaseRouter.getObjectNameFromHatType(e):"Meeting"===_LeanData.AppState.PrimarySObjectType?Magellan.Controllers.MeetingRouter.getObjectNameFromHatType(e):Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP[e]||_LeanData.AppState.PrimarySObjectType},Magellan.Views.getPluralAPIObjectNameFromObjectType=function(e){var t=Magellan.Views.getAPIObjectNameFromObjectType(e);return t?"Opportunity"===t?"Opportunities":"Activity"===t?"Activities":"CampaignMember"===t?"Campaign Members":t+"s":null},Magellan.Views.ButtonHandler=Backbone.View.extend({initialize:function(e){this.childViews=[]},removeAllChildViews:function(){_.each(this.childViews,function(e){try{e.remove()}catch(e){}}),this.childViews=[]},remove:function(){try{Backbone.View.prototype.remove.call(this,[])}catch(e){}this.removeAllChildViews()},originalEvents:{"click .collapsible-section-header":"toggleCollapsibleSection","click .change-parameter-dropdown.dropdown-choice":"changeParameter","click .change-parameter-input":"changeParameterInput","input .change-parameter-input":"changeParameterInput","change .control--radio input[type=radio]":"toggleRadio"},toggleRadio:function(e){if($(e.currentTarget).prop("checked")){const t=$(e.currentTarget).parent("label.control--radio"),i=t.parent(".control-wrapper");if(0===i.length){const e=t.siblings("label.control--radio"),i=t.siblings(".control-wrapper");e.length>0&&e.removeClass("checked"),i.length>0&&i.children("label.control--radio").removeClass("checked")}else i.siblings("label.control--radio").removeClass("checked");t.addClass("checked")}},additionalEvents:{},events:function(){return _.extend({},this.originalEvents,this.additionalEvents)},changeParameter:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.data("parameter");this.model[i]=t.data("value");var a=t.data("parameter2");a&&(this.model[a]=t.data("value2")),this.render()},changeParameterInput:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.data("parameter");this.model[i]=t.val()},toggleCollapsibleSection:function(e){var t=$(e.currentTarget).parent(".collapsible-outer-container");t.toggleClass("open"),this.onCollapse&&this.onCollapse(!t.hasClass("open")),e.stopPropagation()},loadVariableSetter:function(e){_.defer(()=>{const t=`ld-variable-setter-angular${e.selector?`#${e.selector}`:""}`,i=this.$el.find(t),a=e.context||this.model;if(i.length>0&&i[0].ngElementStrategy.componentRef){const n=i[0].ngElementStrategy,o=e.variableSetterRowDataList;n.setInputValue("variableSetterRowDataList",o),n.setInputValue("variablesService",_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService),n.setInputValue("context",a.nodeInfo),n.setInputValue("nodeNamesToNodesMap",this.nodeNameToNodeMap),n.setInputValue("inputMode","input"===e.variableType?"read":"write"),n.setInputValue("header",e.description?e.description.header:""),n.setInputValue("body",e.description?e.description.body:""),n.setInputValue("tooltipContent",e.description?e.description.tooltipContent:""),n.setInputValue("isDupeAction",e.isDupeAction),n.setInputValue("hideDescription",e.hideDescription),n.setInputValue("displayExistingObjectLabel",e.displayExistingObjectLabel||!1);const l=["onSelect"];["containerStyles"].forEach(t=>{e[t]&&n.setInputValue(t,e[t])}),l.forEach(t=>{e[t]&&n.getInputValue(t).subscribe(e[t])}),"variableSetterComponentRefs"in a.attributes||a.set("variableSetterComponentRefs",{}),a.get("variableSetterComponentRefs")[t]={elStrategy:n,conditionals:e.conditionals||{}},n.detectChanges()}})},loadEnablementAccordion:function(){const e={selector:"ld-enablement-accordion-angular",inputs:{modelString:this.model.get("type"),sObjectType:_LeanData.AppState.PrimarySObjectType}};_LeanDataUtil.Backbone.loadAngularComponent(this,e),_.defer(()=>{const e=this.$el.find("ld-enablement-accordion-angular");e.length>0&&e[0].ngElementStrategy.componentRef&&this.model.set("enablementAccordionRef",e.componentRef)})},renderMatchSelectorComponent:function(e,t){const i={selector:"ld-match-selector-angular",events:{onMatchChange:t=>{e()},onLeftInputChange:e=>{t()}}};_LeanDataUtil.Backbone.loadAngularComponent(this,i),_.defer(()=>{const e=this.$el.find("ld-match-selector-angular");e.length>0&&e[0].ngElementStrategy.componentRef&&this.model.set("matchSelectorRef",e[0].ngElementStrategy.componentRef)})},renderlockRepSuggestion:function(){const e={selector:"ld-lock-suggestion-angular#lockHost",inputs:{value:this.model.nodeInfo.lockHost,isHost:!0},events:{onChangeHandler:e=>{this.model.nodeInfo.lockHost=e}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e),_.defer(()=>{const e=this.$el.find("ld-lock-suggestion-angular#lockHost");if(e.length>0&&e[0].ngElementStrategy.componentRef){const t=e[0].ngElementStrategy;this.model.set("lockRepSuggestionReference",t.componentRef)}})}}),Magellan.Views.NewNodeForm=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.nodeNameToNodeMap=_LeanData.FlowBuilderGraph.getNodeNamesToNodesMap(),this.originalName=this.model.nodeInfo.name,this.currentName=this.originalName,this.listenTo(this.model,"renderForm",this.render),this.listenTo($("#node-properties-wrapper"),"dismiss",this.cancel),this.render(),this.setOriginalModelString()},setOriginalModelString:function(){this.originalModelString=JSON.stringify(_.cloneDeep(this.model.nodeInfo))},modelDirty:function(){return _LeanData.FlowBuilderGraph.nodeEditorCtrl.dataHasChanged(this.originalModelString)},template:_.template(i(239)),matchNodeTemplate:_.template(i(0)),createAccountTemplate:_.template(i(258)),mergeLeadTemplate:_.template(i(9)),decisionNodeTemplate:_.template(i(263)),changeNodeName:function(e){var t=new Set(_.keys(this.nodeNameToNodeMap));t.delete(this.originalName),this.currentName=$(e.currentTarget).val().trim(),_LeanData.FlowBuilderGraph.nodeEditorCtrl.editableNodeName=this.currentName,$("#node-name-char-count").text(this.currentName.length+"/200"),0==this.currentName.length?($(".node-panel-button.ok").attr("disabled",!0),$("#node-name-char-count").css("color","var(--med-grey-1)"),$("#node-name-error-message").text("Node name can't be empty!")):this.currentName.length>200?($(".node-panel-button.ok").attr("disabled",!0),$("#node-name-char-count").css("color","var(--ld-red)"),$("#node-name-error-message").text("Character limit exceeded.")):t.has(this.currentName)?($("#node-name-char-count").css("color","var(--med-grey-2)"),$(".node-panel-button.ok").attr("disabled",!0),$("#node-name-error-message").text("Node name already exists. Please try another.")):($("#node-name-char-count").css("color","var(--med-grey-2)"),$(".node-panel-button.ok").removeAttr("disabled"),$("#node-name-error-message").text(""))},changeDescription:function(e){this.model.nodeInfo.description=$(e.currentTarget).val()},cancel:function(e){if(e.preventDefault(),this.modelDirty()){var t=this;$("#dirty-button-2").off("click"),$("#dirty-button-2").click(function(){t.model.nodeInfo=JSON.parse(t.originalModelString),t.model.changeName(t.originalName),t.model.trigger("cancelNodeEvent")}),$("#dirty-modal").modal("show")}else this.model.trigger("cancelNodeEvent")},loadVariableSettersForNodeModel:function(){if(this.model instanceof _LeanData.GraphModels.Action_CreateAccount)this.loadVariableSetter({variableType:"output",conditionals:{convertLeadToContact:!1,doNotCreateOpportunity:!1},selector:"created-opportunity",containerStyles:{width:"98%","margin-bottom":"20px","margin-top":"20px","margin-left":"-15px","background-color":_LeanData._colors["lt-grey-1_5"]},variableSetterRowDataList:[{variableKey:"objectVariable",defaultVariable:"created opportunity",placeholder:"Enter or Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Opportunity"],doNotSave:!1}]}),this.loadVariableSetter({variableType:"output",conditionals:null,selector:"created-account",containerStyles:{"margin-bottom":"20px","margin-top":"20px","margin-left":"-15px"},variableSetterRowDataList:[{variableKey:"outputVariable",defaultVariable:"created account",placeholder:"Enter or Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1}]});else if(this.model instanceof _LeanData.GraphModels.Action_CreateOpportunity)"Lead"===_LeanData.AppState.PrimarySObjectType&&this.loadVariableSetter({variableType:"input",conditionals:null,selector:"account-variable",containerStyles:{"margin-bottom":"20px","margin-top":"20px","margin-left":"-15px"},variableSetterRowDataList:[{variableKey:"accountVariable",defaultVariable:"matched account",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1}]}),this.loadVariableSetter({variableType:"output",conditionals:null,selector:"created-opportunity",containerStyles:{"margin-bottom":"20px","margin-top":"20px","margin-left":"-15px"},variableSetterRowDataList:[{variableKey:"outputVariable",defaultVariable:"created opportunity",placeholder:"Enter or Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Opportunity"],doNotSave:!1}]});else if(this.model instanceof _LeanData.GraphModels.Action_CreateTask)this.loadVariableSetter({variableType:"output",conditionals:null,selector:"created-task",containerStyles:{"margin-bottom":"20px","margin-top":"20px","margin-left":"-15px"},variableSetterRowDataList:[{variableKey:"outputVariable",defaultVariable:"created task",placeholder:"Enter or Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Task"],doNotSave:!1}]});else if(this.model instanceof _LeanData.GraphModels.Action_MergeDuplicateLead)this.loadVariableSetter({variableType:"input",conditionals:null,selector:"lead-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"leadVariable",defaultVariable:"matched lead",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Lead"],doNotSave:!1}]});else if(this.model instanceof _LeanData.GraphModels.Action_MergeDuplicateContact)this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]});else if(this.model instanceof _LeanData.GraphModels.Action_MergeContactDuplicate)this.loadVariableSetter({variableType:"input",conditionals:null,selector:"lead-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]});else if(this.model instanceof _LeanData.GraphModels.MatchNode){"Dupe"===this.model.nodeInfo.objectType||"DupeC"===this.model.nodeInfo.objectType||"DupeA"===this.model.nodeInfo.objectType||this.model.nodeInfo.objectType;const e=this.model.nodeInfo.objectType,t=_LeanData.Util.getAPIObjectNameFromObjectType(e,_LeanData.AppState.PrimarySObjectType),i=[];"L2O"!==this.model.nodeInfo.objectType&&"P2O"!==this.model.nodeInfo.objectType||(this.model.nodeInfo["restrict l2o to chosen account"]?this.loadVariableSetter({variableType:"input",conditionals:{"restrict l2o to chosen account":!0},selector:"account-variable",containerStyles:{"margin-bottom":"15px","margin-left":"25px"},variableSetterRowDataList:[{variableKey:"accountVariable",defaultVariable:"matched account",placeholder:"Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1}]}):i.push({variableKey:"objectVariable",defaultVariable:"matched account",placeholder:"Enter or Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1})),i.push({variableKey:"outputVariable",defaultVariable:`matched ${t.toLowerCase()}`,placeholder:"Enter or Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:[t],doNotSave:!1}),this.loadVariableSetter({variableType:"output",conditionals:null,selector:"output-variable",variableSetterRowDataList:i})}},ok:function(e){if(e.preventDefault(),this.model.nodeInfo.name=this.originalName,this.model.changeName(this.currentName),_LeanData.Util.sanitizeSpecialCharacterInputs(this.model.nodeInfo),_LeanData.AppState.getCurrentVariablesService()&&_LeanData.AppState.getCurrentVariablesService().changeVariablesSource(this.originalName),this.model.get("variableSetterComponentRefs"))for(const e in this.model.get("variableSetterComponentRefs")){const t=this.model.get("variableSetterComponentRefs")[e],i=t.conditionals;let a=!0;for(const e in i)a=a&&this.model.nodeInfo[e]==i[e];if(a){const e=t.elStrategy.getInputValue("save");e&&e()}}const t=_LeanData.GraphModelTypeMap[this.model.nodeInfo._model];t.hasOwnProperty("handleWriteVariables")&&t.handleWriteVariables(this.model.nodeInfo,_LeanData.AppState.getCurrentVariablesService()),this.model.trigger("saveNodeEvent")},toggleDescription:function(e){$(e.currentTarget).toggleClass("collapsed")},additionalEvents:{"dismiss #node-properties-wrapper":"cancel","change #do-not-create-opportunity.create-new-node":"toggleCreateOpportunity","change [name='account-creation-choice']":"selectAccountCreationChoice","input #node-name-input":"changeNodeName","input #node-description-input":"changeDescription","click .node-panel-button.cancel":"cancel","click .node-panel-button.ok":"ok","click .description-label":"toggleDescription"},selectRecordType:function(e,t){this.model.nodeInfo.accRecordTypeId=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},toggleCreateOpportunity:function(e){this.openPanel=$("div.advanced-settings-view").hasClass("open"),this.model.nodeInfo.doNotCreateOpportunity=!$(e.currentTarget).is(":checked"),this.model.trigger("renderForm",this.model,{})},selectAccountCreationChoice:function(e){var t="convert lead to contact"===$(e.currentTarget).val();this.model.nodeInfo.convertLeadToContact=t;var i=_.find(this.model.nodeInfo.edges,e=>"Next Node"===e.name);i||this.model.nodeInfo.edges.push(i=_LeanData._flowbuilder.DEFAULT_EDGES.getDefaultEOFNextNodeEdge()),t?(this.__lastConvertedLeadStatus&&(this.model.nodeInfo["convert status"]=this.__lastConvertedLeadStatus),i.target=-1,this.model.trigger("renderForm",this.model,{}),$("#convert-status-typeahead-dropdown").find(".tt-input").focus()):(this.__lastConvertedLeadStatus=this.model.nodeInfo["convert status"]||"",delete this.model.nodeInfo["convert status"],this.model.trigger("renderForm",this.model,{}))},selectConvertedStatus:function(e,t){this.model.nodeInfo["convert status"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},getNodeFormHeaderText:function(){const e=_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType;return nodeFormHeaderText=`${this.model.getNodeTitlePrefix(_LeanData.AppState.PrimarySObjectType,_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph,!1)}${this.model.getFormTitle(_LeanData.AppState.PrimarySObjectType,e)}`},render:function(){const e=[_LeanData.GraphModels.Action_RoundRobin,_LeanData.GraphModels.Action_AssignOwner,_LeanData.GraphModels.Action_RouteToTerritorySegment,_LeanData.GraphModels.Action_SendNotification,_LeanData.GraphModels.Partner_Slack_SendNotification,_LeanData.GraphModels.Partner_Slack_NotifyPlus,_LeanData.GraphModels.Action_RouteToMatchedAccount];var t=this.template({nodeFormHeaderText:this.getNodeFormHeaderText(),currentNode:this.model,currentName:this.currentName,showNoOwnerWarning:!_LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType).hasOwnerField&&e.some(e=>this.model instanceof e),optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(t),(this.model instanceof _LeanData.GraphModels.DecisionNode||this.model instanceof _LeanData.GraphModels.MatchNode)&&!(this.model instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment)&&!this.model.nodeInfo.objectType){var i=new Magellan.Views.OptionView({model:this.model});return this.childViews.push(i),this.$el.html(i.render().$el),this}if(this.model instanceof _LeanData.GraphModels.Action_CreateAccount){var a=!!_LeanData.MetaDataController.getFieldMetaDataMap().Account&&_LeanData.MetaDataController.getFieldMetaDataMap().Account.hasOwnProperty("recordtypeid"),n=this.createAccountTemplate({chosenConvertStatus:actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["convert status"]],fieldMappingLink:"#routing/lead/account_creation",doNotCreateOpportunity:this.model.nodeInfo.doNotCreateOpportunity,convertLeadToContact:this.model.nodeInfo.convertLeadToContact,convertedLeadStatuses:actionNodeMetaData.convertedLeadStatuses,convertedLeadStatusApiNameToLabel:actionNodeMetaData.convertedLeadStatusApiNameToLabel,validateStatus:Magellan.Validation.validateConvertedLeadStatus.bind(this,this.model.nodeInfo["convert status"]),showRecordType:a,createOpportunityProvisioned:_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY"),convertLeadProvisioned:_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CONVERT")});this.$el.find("#node-partial-wrapper").html(n);var o=new Magellan.Views.CreateOpportunity({model:this.model,isInternalView:!0});this.$el.find(".create-opportunity-container").html(o.render().$el),this.childViews.push(o),_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY")||_.defer(this.renderOpportunityMessageBadges.bind(this)),_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CONVERT")||_.defer(this.renderConvertMessageBadge.bind(this)),actionNodeMetaData.convertedLeadStatuses;var l,s,r={Status:[]},d={RecordTypes:[]};null==this.model.nodeInfo.accRecordTypeId&&a&&(this.model.nodeInfo.accRecordTypeId=actionNodeMetaData.defaultAccountRecordTypeId),_.each(actionNodeMetaData.convertedLeadStatusApiNameToLabel,(e,t)=>{r.Status.push({label:e,name:t}),t===this.model.nodeInfo["convert status"]&&(l=[{label:e,name:t}])}),_.each(actionNodeMetaData.recordTypes,e=>{"Account"===e.SobjectType&&(d.RecordTypes.push({label:e.Id===actionNodeMetaData.defaultAccountRecordTypeId?"Default":e.Name,name:e.Id}),e.Id===this.model.nodeInfo.accRecordTypeId&&(s=[{label:e.Id===actionNodeMetaData.defaultAccountRecordTypeId?"Default":e.Name,name:e.Id}]))});var c=Magellan.Validation.validateConvertedLeadStatus(this.model.nodeInfo["convert status"]);c?this.$el.find(".lead-status-error-message").hide():null!=this.model.nodeInfo["convert status"]&&this.$el.find(".lead-status-error-message").text(`Previously selected status "${this.model.nodeInfo["convert status"]}" is no longer active or does not exist.`),this.picklistTypeahead&&this.picklistTypeahead.remove(),this.picklistTypeahead=new Magellan.Views.NestedTypeaheadSelector({data:r,root:"Status",disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,selection:null===this.model.nodeInfo["convert status"]?[]:l}),this.picklistTypeahead.$el.on("nestedTypeaheadSelector:select",this.selectConvertedStatus.bind(this)),this.childViews.push(this.picklistTypeahead),this.recordTypeahead&&this.recordTypeahead.remove(),this.recordTypeahead=new Magellan.Views.NestedTypeaheadSelector({data:d,root:"RecordTypes",disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,validateOnCreate:!0,selection:null==this.model.nodeInfo.accRecordTypeId?[]:s}),this.recordTypeahead.$el.on("nestedTypeaheadSelector:select",this.selectRecordType.bind(this)),this.childViews.push(this.recordTypeahead),_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade=!this.model.nodeInfo.doNotCreateOpportunity&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY")||this.model.nodeInfo.convertLeadToContact&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CONVERT")||!this.model.nodeInfo.doNotCreateOpportunity&&!this.model.nodeInfo.convertLeadToContact&&"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS"),this.model.nodeInfo.doNotCreateOpportunity?(this.$el.find("#ld-create-opp-subform").css({}),this.$el.find("#ld-create-opp-subform .horizontal-line-separator").css({})):(this.$el.find("#ld-create-opp-subform").css({background:"#f8f8f8",padding:"5px 0px 5px 10px","margin-right":"5px"}),this.$el.find("#ld-create-opp-subform .horizontal-line-separator").css({border:"1px solid #E6E6E6"})),c||null!=this.model.nodeInfo["convert status"]||this.picklistTypeahead.$el.find(".typeahead.typeahead-input.tt-input").addClass("input-invalid"),this.$el.find("#convert-status-typeahead-dropdown").html(this.picklistTypeahead.$el),this.$el.find("#record-type-typeahead-dropdown").html(this.recordTypeahead.$el),ld_initializeToolTip(this.$el.find(".record-type-tooltip"),{title:"Default Record Type for your Profile selected",body:"If Default is selected, LeanData will create Accounts with your Profile's Default Record Type regardless of record assignment.",width:"270px"});var h=new Magellan.Views.AdditionalCreateAccountFields({model:this.model});this.$el.find("#additional-account-fields-wrapper").html(h.render().$el),this.childViews.push(h);var p=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(p),this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(p.render().$el),this.model.nodeInfo.convertLeadToContact&&ld_initializeToolTip(this.$el.find(".create-account-tooltip"),{title:"Create Account and Convert Lead to Contact Under New Account and Create Opportunity",body:"This option utilizes the default Salesforce account field mappings, not LeanDataâ€™s and creates a Contact Role on the Opportunity using native Salesforce functionality."})}else if(this.model instanceof _LeanData.GraphModels.Action_CreateOpportunity){var u=new Magellan.Views.CreateOpportunity({model:this.model});this.$el.find("#node-partial-wrapper").html(u.render().$el),u.delegateEvents()}else if(this.model instanceof _LeanData.GraphModels.Action_CreateTask)u=new Magellan.Views.CreateTask({model:this.model}),this.$el.find("#node-partial-wrapper").html(u.render().$el),u.delegateEvents();else if(this.model instanceof _LeanData.GraphModels.Partner_Outreach_AddToSequence){const e=new Magellan.Views.OutreachAddToSequence({model:this.model});this.$el.find("#node-partial-wrapper").html(e.render().$el),e.delegateEvents()}else if(this.model instanceof _LeanData.GraphModels.Partner_Salesloft_AddToCadence){const e=new Magellan.Views.SalesloftAddToCadence({model:this.model});this.$el.find("#node-partial-wrapper").html(e.render().$el),e.delegateEvents()}else if(this.model instanceof _LeanData.GraphModels.Partner_Slack_SendNotification){const e=new Magellan.Views.SlackSendNotification({model:this.model});this.$el.find("#node-partial-wrapper").html(e.render().$el),e.delegateEvents()}else if(this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo_EnrichPerson){const e=new Magellan.Views.ZoominfoEnrichPerson({model:this.model});this.$el.find("#node-partial-wrapper").html(e.render().$el),e.delegateEvents()}else if(this.model instanceof _LeanData.GraphModels.Action_MergeDuplicateLead)n=this.mergeLeadTemplate(),this.$el.find("#node-partial-wrapper").html(n),p=new Magellan.Views.AdvancedSettings({model:this.model}),this.childViews.push(p),p.openPanel=this.openPanel,this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(p.render().$el);else if(this.model instanceof _LeanData.GraphModels.Action_MergeDuplicateContact)n=new Magellan.Views.MergeContact({model:this.model}),this.$el.find("#node-partial-wrapper").html(n.render().$el);else if(this.model instanceof _LeanData.GraphModels.MatchNode){var m="Dupe"===this.model.nodeInfo.objectType||"DupeC"===this.model.nodeInfo.objectType||"DupeA"===this.model.nodeInfo.objectType;n=this.matchNodeTemplate({isDupeNode:m,pluralObjects:Magellan.Views.getPluralAPIObjectNameFromObjectType(this.model.nodeInfo.objectType),singleObject:Magellan.Views.getAPIObjectNameFromObjectType(this.model.nodeInfo.objectType),elementOrderInNode:["RCM","RA"].includes(this.model.nodeInfo.objectType)?3:2}),this.$el.find("#node-partial-wrapper").html(n),p=new Magellan.Views.AdvancedSettings({model:this.model,openPanel:!_.isEmpty(this.model.nodeInfo.matchToParent)}),this.childViews.push(p),this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(p.render().$el);var g=new Magellan.Views.EdgeSelectionMenu({model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType,context:this.model,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275});this.childViews.push(g),this.$el.find("#criteria-list-partial").first().html(g.render().$el);var f=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275,parentView:this});if(this.childViews.push(f),this.$el.find(".filter-div").html(f.render().$el),"RA"===this.model.nodeInfo.objectType||"RCM"===this.model.nodeInfo.objectType){var b=new Magellan.Views.ObjectRadioOptions({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,parentView:this});this.childViews.push(b),this.$el.find(".object-radio-options").html(b.render().$el)}}else if(this.model instanceof _LeanData.GraphModels.TriggerNode){var v=new Magellan.Views.TriggerNode({model:this.model,objectType:_LeanData.AppState.PrimarySObjectType});this.childViews.push(v),this.$el.find("#node-partial-wrapper").html(v.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Decision_TrueFalseNode){var y=new Magellan.Views.TrueFalseNode({model:this.model});this.childViews.push(y),this.$el.find("#node-partial-wrapper").html(y.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Decision_BranchNode){const e=_LeanData._app.CLOAC_OBJECT_TYPES.includes(this.model.nodeInfo.objectType)||this.model instanceof _LeanData.GraphModels.Decision_Branch_Custom||this.model instanceof _LeanData.GraphModels.Decision_Branch_Prospect||"Primary"===this.model.nodeInfo.objectType;n=this.decisionNodeTemplate({showMatchSelector:!e,primaryObject:_LeanData.Util.getSObjectLabel(_LeanData.AppState.PrimarySObjectType)}),this.$el.find("#node-partial-wrapper").html(n),g=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.childViews.push(g),this.$el.find("#criteria-list-partial").html(g.render().$el),this.renderMatchSelectorComponent(()=>{g.toggledCriteria=null,g.render.call(g)},g.validateCriteriaList.bind(g))}else if(this.model instanceof _LeanData.GraphModels.Action_CustomInterface){var w=new Magellan.Views.CustomInterface({model:this.model});this.childViews.push(w),this.$el.find("#node-partial-wrapper").html(w.render().$el),p=new Magellan.Views.AdvancedSettings({model:this.model}),this.childViews.push(p),p.openPanel=this.openPanel,this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(p.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_CustomInterfaceSchedule)w=new Magellan.Views.CustomInterfaceSchedule({model:this.model}),this.childViews.push(w),this.$el.find("#node-partial-wrapper").html(w.render().$el),p=new Magellan.Views.AdvancedSettings({model:this.model}),this.childViews.push(p),p.openPanel=this.openPanel,this.$el.find("#node-partial-wrapper #advanced-settings-wrapper").html(p.render().$el);else if(this.model instanceof _LeanData.GraphModels.Action_RouteToDuplicateContact){var T=new Magellan.Views.RouteToDuplicateContact({model:this.model});this.$el.find("#node-partial-wrapper").html(T.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_RouteToDuplicateLead){var D=new Magellan.Views.RouteToDuplicateLead({model:this.model});this.$el.find("#node-partial-wrapper").html(D.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_RouteToMatchedAccount){var C=new Magellan.Views.AccountBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(C.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_RouteToMatchedLead){var S=new Magellan.Views.LeadBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(S.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_RouteToMatchedOpportunity){var M=new Magellan.Views.OpportunityBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(M.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment){var L=new Magellan.Views.TerritoryRouting({model:this.model,graphType:"lead"});this.$el.find("#node-partial-wrapper").html(L.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_RouteToMatchedCampaignMember){var I=new Magellan.Views.CampaignMemberBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(I.render().$el)}else if(this.model instanceof _LeanData.GraphModels.Action_ConvertLead){var O=new Magellan.Views.Convert({model:this.model});this.$el.find("#node-partial-wrapper").html(O.render().$el)}else this.model instanceof _LeanData.GraphModels.Action_SendNotification&&(p=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#advanced-settings-wrapper").html(p.render().$el));if(this.model instanceof _LeanData.GraphModels.ActionNode&&!(this.model instanceof _LeanData.GraphModels.Action_ConvertLead)){if(this.model instanceof _LeanData.GraphModels.Action_RouteToMatchedActivity){var x=new Magellan.Views.ActivityBasedRouting({model:this.model});this.$el.find("#node-partial-wrapper").html(x.render().$el)}var V=this.model instanceof _LeanData.GraphModels.Action_SendNotification?"#node-partial-wrapper":"#email-notification-wrapper",A=new Magellan.Views.SendNotification({model:this.model});this.$el.find(V).html(A.render().$el),this.childViews.push(A)}else if(this.model instanceof _LeanData.GraphModels.Rerouting_TimeBased){var F=new Magellan.Views.Reroute({model:this.model});this.$el.find("#node-partial-wrapper").html(F.render().$el),this.childViews.push(F)}if(this.model instanceof _LeanData.GraphModels.Action_SendNotification&&(p=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#advanced-settings-wrapper").html(p.render().$el),this.childViews.push(p)),this.$el.find("#node-name-char-count").text(this.currentName.length+"/200"),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.focusedNode){const e=this.$el.find(".advanced-settings-view.collapsible-outer-container");e&&e.toggleClass("open",!0)}return this.loadEnablementAccordion(),this.loadVariableSettersForNodeModel(),this},renderOpportunityMessageBadges:function(){const e={selector:"ldc-message-badge-angular.opportunity-badge",inputs:{data:{badgeText:"UPGRADE",header:"Create Opportunity",message:"Upgrade to create an Opportunity with details from the routed object, any matched object, and more.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360037775093-Routing-Create-Opportunity-Node-Guide","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},renderConvertMessageBadge:function(){const e={selector:"ldc-message-badge-angular.convert-badge",inputs:{data:{badgeText:"UPGRADE",header:"Convert Lead",message:"Upgrade to create an Account with details from the routed object, any matched object, and convert the Lead under the newly created Account.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360036070434-Router-Create-Account-Node-Guide","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}}),Magellan.Views.OptionView=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.selectedOption=null,_.isArray(e.hatOptions)?this.hatOptions=e.hatOptions:this.model instanceof _LeanData.GraphModels.MatchNode?this.hatOptions=[{name:"Lead2Account (L2A)",description:"Find matched accounts",value:"L2A"},{name:"Lead2Opportunity (L2O)",description:"Find matched opportunities",value:"L2O"},{name:"Lead2Lead (L2L)",description:"Find matched leads",value:"L2L"},{name:"Duplicate (Dupe)",description:"Find duplicate leads",value:"Dupe"},{name:"Duplicate Contact (DupeC)",description:"Find duplicate contacts",value:"DupeC"}]:this.model instanceof _LeanData.GraphModels.DecisionNode&&(this.hatOptions=[{name:"Lead",value:"Primary"},{name:"Lead2Account (L2A)",value:"L2A"},{name:"Lead2Opportunity (L2O)",value:"L2O"},{name:"Lead2Lead (L2L)",value:"L2L"},{name:"Duplicate (Dupe)",value:"Dupe"},{name:"Duplicate Contact (DupeC)",value:"DupeC"}])},template:_.template(i(240)),changeOption:function(e){this.selectedOption=$(e.currentTarget).data("value"),this.render()},setModelDefaultsByObjectType:function(){if(this.model instanceof _LeanData.GraphModels.MatchNode)switch(this.model.nodeInfo["exclude inactive owned"]=!0,this.model.nodeInfo.objectType){case"L2L":case"Dupe":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"PostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"City",type:"STRING",operator:"equals",operand:"City","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"State",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"Country",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}];break;case"L2A":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"BillingPostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"#children",direction:"max"},{type:"optima",field:"#opportunities",direction:"max"},{type:"optima",field:"#contacts",direction:"max"},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}];break;case"L2O":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"isclosed",type:"BOOLEAN",operator:"equals",operand:!1}],rpnLogic:[1]},{type:"conditions",logic:"1",conditions:[{"value/field":"value",field:"stagename",type:"PICKLIST",operator:"contains",operand:"open"}],rpnLogic:[1]},{type:"optima",field:"CreatedDate",direction:"min"}],this.model.nodeInfo["restrict l2o to chosen account"]=!0;break;case"DupeC":this.model.nodeInfo.tiebreakers=[{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"Account.BillingPostalCode",type:"STRING",operator:"equals",operand:"PostalCode","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2 AND 3",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"},{"value/field":"field",field:"Account.BillingCity",type:"STRING",operator:"equals",operand:"City","operand type":"STRING"}],rpnLogic:[1,2,"AND",3,"AND"]},{type:"conditions",logic:"1 AND 2",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"},{"value/field":"field",field:"Account.BillingState",type:"STRING",operator:"equals",operand:"State","operand type":"STRING"}],rpnLogic:[1,2,"AND"]},{type:"conditions",logic:"1",conditions:[{"value/field":"field",field:"Account.BillingCountry",type:"STRING",operator:"equals",operand:"Country","operand type":"STRING"}],rpnLogic:[1]},{type:"optima",field:"LastActivityDate",direction:"max"},{type:"optima",field:"CreatedDate",direction:"min"}]}},additionalEvents:{"click .control":"changeOption","click .cancel":"closePanel"},render:function(){var e=this.template({hatOptions:this.hatOptions,selectedOption:this.selectedOption,disableOk:!this.selectedOption,nodeType:this.model instanceof _LeanData.GraphModels.DecisionNode?"Decision":"Match"});return this.$el.html(e),this}}),Magellan.Views.TriggerNode=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.isUpdateTrigger=this.isUpdateTrigger||"UPDATE TRIGGER"==this.model.nodeInfo.type,this.objectType=this.objectType||e.objectType||this.model.objectType||_LeanData.AppState.PrimarySObjectType,this.loadPersistedEdgesFromModel(),this.initializeChildViews(),this.listenTo(this.model,"renderAdvancedSettings",this.renderAdvancedSettings),this.listenTo(this.model,"filterRuleChanged",this.render)},loadPersistedEdgesFromModel:function(){this._persistedEdges={all:[],none:_LeanData._flowbuilder.DEFAULT_EDGES.getDefaultInsertEdges(this.model.nodeInfo.name),inclusion:_LeanData._flowbuilder.DEFAULT_EDGES.getDefaultInclusionEdges()},this._persistedEdges[this.model["filter type"]]=_.cloneDeep(this.model.edges)},initializeChildViews:function(){this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model,graphType:this.objectType||_LeanData.AppState.PrimarySObjectType}),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,objectType:this.objectType,triggerNode:!0,node:this.model,customFieldFilter:e=>e.filter(e=>"actioncadenceid"!==e.name),isUpdateTrigger:this.isUpdateTrigger,parentView:this,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275})},template:_.template(i(271)),renderFormBody:function(){let e=_LeanData.AppState.PrimarySObjectType.toLowerCase(),t=_LeanData.MetaDataController.getObjectMetaDataObject(e,!0);var i=this.template({isUpdateTrigger:this.isUpdateTrigger,objectType:t.label||e,objectTypeAPI:e,pluralObjectType:t.pluralLabel,displayOutputVariable:"all"!==this.model.nodeInfo["filter type"]});return this.$el.html(i),"all"!==this.model.nodeInfo["filter type"]&&this.loadVariableSetter({variableType:"output",conditionals:null,selector:`routed-${e}`,variableSetterRowDataList:[{variableKey:"",defaultVariable:`routed ${e}`,placeholder:"Enter or Select a Variable",disabled:!0,sObjectTypes:[_LeanData.AppState.PrimarySObjectType],doNotSave:!0}]}),this},renderFilterRules:function(){return this.filterRulesView.setElement(this.$(".filter-div")).render(),this},renderAdvancedSettings:function(){return"all"!==this.model.nodeInfo["filter type"]&&"inclusion"!==this.model.nodeInfo["filter type"]?this.advancedSettingsView.setElement(this.$("#advanced-settings-wrapper")).render():this.$("#advanced-settings-wrapper").empty(),this},renderScheduledRoutingEdgeList:function(){return this.scheduledRoutingEdgeSelector&&this.scheduledRoutingEdgeSelector.remove(),this.scheduledRoutingEdgeSelector=new Magellan.Views.ScheduledRoutingEdgeSelector({model:this.model}),this.$el.find("#scheduled-routing-edge-list").html(this.scheduledRoutingEdgeSelector.render().$el),this},render:function(){return this.renderFormBody().renderFilterRules().renderAdvancedSettings().renderScheduledRoutingEdgeList(),this}}),Magellan.Views.CampaignMemberTriggerNode=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.isUpdateTrigger=this.isUpdateTrigger||"UPDATE CAMPAIGN MEMBER TRIGGER"==this.model.nodeInfo.type,this.objectType=this.objectType||e.objectType||this.model.objectType||_LeanData.AppState.PrimarySObjectType,this.loadPersistedEdgesFromModel(),this.initializeChildViews(),this.listenTo(this.model,"renderAdvancedSettings",this.renderAdvancedSettings),this.listenTo(this.model,"saveNodeEvent",()=>{this.model.nodeInfo.edges.forEach(e=>{_LeanData.Util.resetMultiConditionSecondaryEdge(e)})})},loadPersistedEdgesFromModel:function(){this._persistedEdges={none:_LeanData._flowbuilder.DEFAULT_EDGES.getDefaultInsertEdges(this.model.nodeInfo.name),inclusion:_LeanData._flowbuilder.DEFAULT_EDGES.getDefaultMultiConditionInclusionEdges()},this._persistedEdges[this.model["filter type"]]=_.cloneDeep(this.model.edges)},initializeChildViews:function(){this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model,graphType:this.objectType||"lead"}),this.isUpdateTrigger?this.filterRulesView=new Magellan.Views.EdgeSelectionMenu({model:this.model,context:this.model,isUpdateTrigger:this.isUpdateTrigger,triggerNode:!0,isCampaignMemberTrigger:!0,matchedFieldColumnWidth:200,operatorColumnWidth:180,valueFieldColumnWidth:200}):this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,objectType:this.objectType,triggerNode:!0,node:this.model,isUpdateTrigger:this.isUpdateTrigger,isCampaignMemberTrigger:!0,parentView:this,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275})},template:_.template(i(255)),renderFormBody:function(){var e=this.template({isUpdateTrigger:this.isUpdateTrigger,objectType:this.objectType,pluralObjectType:_LeanData.StringUtil.pluralizeString(this.objectType)});return this.$el.html(e),this},renderFilterRules:function(){return this.filterRulesView.setElement(this.$(".filter-div")).render(),this},renderAdvancedSettings:function(){return"all"!==this.model.nodeInfo["filter type"]&&"inclusion"!==this.model.nodeInfo["filter type"]?this.advancedSettingsView.setElement(this.$("#advanced-settings-wrapper")).render():this.$("#advanced-settings-wrapper").empty(),this},render:function(){return this.renderFormBody().renderFilterRules().renderAdvancedSettings(),this}}),Magellan.Views.ScheduledRoutingEdgeSelector=Magellan.Views.ButtonHandler.extend({className:"scheduled-routing-edge-selector collapsible-outer-container open",initialize:function(e){this.dropdownReferences=[],this.jobIdToJobMap={},this.applicableScheduledJobs=_.cloneDeep(_LeanData.AppState.scheduledJobs||[]).filter(e=>(this.jobIdToJobMap[e.Id]=e,e.nodeType===this.model.nodeInfo.type)),this.listenTo(this.model,"filterRuleChanged addRule",()=>{this.refreshDropdowns()}),this.listenTo(this.model,"deleteRule",e=>{this.refreshDropdowns()}),this.listenTo(this.model,"updateEdgeName",({previousValue:e,newValue:t})=>{(_LeanData.AppState.scheduledJobs||[]).forEach(i=>{i.edgeName===e&&(i.edgeName=t)}),this.refreshDropdowns()}),this.listenToOnce(this.model,"saveNodeEvent",()=>{(_LeanData.AppState.scheduledJobs||[]).forEach(e=>{e.edgeName=this.jobIdToJobMap[e.Id].edgeName})})},template:_.template(i(269)),refreshDropdowns:function(){this.dropdownReferences.forEach(e=>e.remove()),this.dropdownReferences=[];const e=this.model.nodeInfo.edges.map(e=>e.name),t=this;this.$el.find(".scheduled-job-row").each(function(){const i=$(this).data("id"),a=t.jobIdToJobMap[i].edgeName;$(this).find(".scheduled-job-edge-col").each(function(){const n=new Magellan.Views.LDDropdown({value:a,options:e,required:!0,placeholder:"None",onChange:e=>{t.jobIdToJobMap[i].edgeName=e}});$(this).html(n.$el),t.dropdownReferences.push(n)})})},render:function(){var e=this.template({applicableScheduledJobs:this.applicableScheduledJobs});return this.$el.html(e),this.refreshDropdowns(),this}}),Magellan.Views.Convert=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.model.nodeInfo.doNotCreateOpportunity=this.model.nodeInfo.doNotCreateOpportunity||!1,this.model.nodeInfo["explicit account conversion"]=this.model.nodeInfo["explicit account conversion"]||!1,this.model.nodeInfo["explicit account id"]=this.model.nodeInfo["explicit account id"]||null},template:_.template(i(257)),additionalEvents:{"change #explicit-account-conversion":"toggleExplicitAccountConversion","change #do-not-create-opportunity.convert-node":"toggleCreateOpportunity","change #explicit-account-id":"changeExplicitAccountId","click #view-lead-statuses":"viewLeadStatuses"},viewLeadStatuses:function(){let e=window.location.origin+"/",t="";t="undefined"!=typeof sforce?"lightning/setup/ObjectManager/Lead/FieldsAndRelationships/Status/view":"_ui/common/config/field/StandardFieldAttributes/d?id=Status&type=Lead&setupid=LeadFields",window.open(e+t,"_blank","noopener,noreferrer")},toggleCreateOpportunity:function(e){this.model.nodeInfo.doNotCreateOpportunity=!$(e.currentTarget).is(":checked"),_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade=!this.model.nodeInfo.doNotCreateOpportunity&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY"),this.model.nodeInfo.doNotCreateOpportunity?(this.$el.find(".additional-opp-type").hide(),_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY")||this.$el.find(".convert-lead-option").addClass("disabled")):this.$el.find(".additional-opp-type").show()},toggleExplicitAccountConversion:function(e){this.openPanel=$("div.advanced-settings-view").hasClass("open"),this.model.nodeInfo["explicit account conversion"]=$(e.currentTarget).is(":checked"),this.changeExplicitAccountId(),this.model.nodeInfo["explicit account conversion"]?delete this.model.nodeInfo.accountVariable:this.model.nodeInfo.accountVariable="{!matched account}",this.render()},changeExplicitAccountId:function(){if(this.$el.find(".selected-account-link, .selected-account-text, .account-finder-component").hide(),this.model.nodeInfo["explicit account conversion"]){this.$el.find(".account-finder-component").show();var e=null;_.isEmpty(this.accountFinderView.selection)||(e=this.accountFinderView.selection[0],this.model.nodeInfo["explicit account id"]=e.Id),e?this.$el.find(".selected-account-link").attr("href","/"+e.Id).show():this.$el.find(".selected-account-text").html(this.model.nodeInfo["explicit account id"]?"Invalid account:"+this.model.nodeInfo["explicit account id"]:"").show()}else delete this.model.nodeInfo["explicit account id"]},loadTypeahead:function(){var e={};e[_LeanData.AppState.PrimarySObjectType]=[],_.each(actionNodeMetaData.convertedLeadStatusApiNameToLabel,function(t,i){e[_LeanData.AppState.PrimarySObjectType].push({label:t,name:i})});var t=Magellan.Validation.validateConvertedLeadStatus(this.model.nodeInfo["convert status"]);t?this.$el.find(".lead-status-error-message").hide():null!=this.model.nodeInfo["convert status"]&&this.$el.find(".lead-status-error-message").text(`Previously selected status "${this.model.nodeInfo["convert status"]}" is no longer active or does not exist.`),this.picklistTypeahead&&this.picklistTypeahead.remove(),this.picklistTypeahead=new Magellan.Views.NestedTypeaheadSelector({data:e,root:_LeanData.AppState.PrimarySObjectType,disableBreadcrumbs:!0,required:!0,selection:t?_LeanData.Util.convertStringSelectionToArray(this.model.nodeInfo["convert status"]):[]}),t||null!=this.model.nodeInfo["convert status"]||this.picklistTypeahead.$el.addClass("input-invalid"),this.$el.find("#convert-status-dropdown-div").html(this.picklistTypeahead.$el),this.picklistTypeahead.$el.on("nestedTypeaheadSelector:select",this.updateConvertStatus.bind(this)),this.accountFinderView&&this.accountFinderView.remove(),this.accountFinderView=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,asyncServiceCall:_LeanData.FlowBuilderController.searchAccounts}),this.accountFinderView.fetchSelectionWithAsyncService(this.model.nodeInfo["explicit account id"]).then(function(){this.changeExplicitAccountId(),this.accountFinderView.validate()}.bind(this)),this.$el.find(".account-finder-component").html(this.accountFinderView.$el),this.accountFinderView.$el.on("nestedTypeaheadSelector:select",this.changeExplicitAccountId.bind(this)),this.model.nodeInfo.doNotCreateOpportunity&&this.$el.find(".additional-opp-type").hide()},updateConvertStatus:function(e,t){this.model.nodeInfo["convert status"]=t.selection[0].name},render:function(){var e=this.template({chosenConvertStatus:actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["convert status"]],doNotCreateOpportunity:this.model.nodeInfo.doNotCreateOpportunity,explicitAccountConversion:this.model.nodeInfo["explicit account conversion"],explicitAccountId:this.model.nodeInfo["explicit account id"],convertedLeadStatuses:actionNodeMetaData.convertedLeadStatuses,convertedLeadStatusApiNameToLabel:actionNodeMetaData.convertedLeadStatusApiNameToLabel,validateStatus:Magellan.Validation.validateConvertedLeadStatus.bind(this,this.model.nodeInfo["convert status"]),createOpportunityProvisioned:_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY")});this.$el.html(e),_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade=!this.model.nodeInfo.doNotCreateOpportunity&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY"),_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY")||_.defer(this.renderMessageBadge.bind(this)),ld_initializeToolTip(this.$el.find(".convert-lead-tooltip"),{title:"Default Record Type for your Profile selected",body:"If Default is selected, LeanData will create Opportunities with your Profile's Default Record Type regardless of record assignment."}),this.loadTypeahead(),this.loadVariableSetter({variableType:"input",conditionals:{"explicit account conversion":!1},selector:"account-variable",containerStyles:{"margin-bottom":"5px","margin-top":"20px","margin-left":"-15px"},variableSetterRowDataList:[{variableKey:"accountVariable",defaultVariable:"matched account",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1}]});var t=new Magellan.Views.AdvancedSettings({model:this.model});t.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el);var i=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(i.render().$el);var a=new Magellan.Views.AdditionalOpportunityFields({model:this.model,isConvertLead:!0});return this.$el.find("#additional-opp-fields-wrapper").html(a.render().$el),this},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Create Opportunity",message:"Upgrade to create an Opportunity with details from the Lead, the Matched Account, and more.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360037775093-Routing-Create-Opportunity-Node-Guide","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}}),Magellan.Views.AlternateFieldAssignment=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.assignmentField=this.model.nodeInfo["assignment field"],this.required=e.required,e.hasOwnProperty("explicitOwnerComponent")&&(this.explicitOwnerComponent=e.explicitOwnerComponent),this.listenTo(this.model,"refreshedMetaData",()=>{this.render()})},template:_.template(i(254)),updateAlternateField:function(e,t){this.model.nodeInfo["assignment field"]=t.selection[0].name},updateAlternateFieldAssignment:function(e){this.required||null==j$("#alternateFieldAssignment")||0!=j$("#alternateFieldAssignment").is(":checked")?("OwnerId"===this.assignmentField||void 0===this.assignmentField?this.model.nodeInfo["assignment field"]="":this.model.nodeInfo["assignment field"]=this.assignmentField,j$("#alternateFieldAssignmentLabel").css("color","var(--ld-green)"),j$("#alternate-field-assignment-div").css("display","flex")):(this.model.nodeInfo["assignment field"]="OwnerId",j$("#alternateFieldAssignmentLabel").css("color","#1f1f1f"),j$("#alternate-field-assignment-div").css("display","none"))},refreshCustomUserFields:function(){this.customUserFields=_LeanData.MetaDataController.getCustomUserFieldsByObject(_LeanData.AppState.PrimarySObjectType),this.customUserFieldNames=_.map(this.customUserFields,e=>e.name)},populateDropdowns:function(){var e=this,t={altFields:[]},i=null;_.each(this.customUserFields,function(a){"Created By.ID"!=a.label&&"Last Modified By.ID"!=a.label&&"owner.id"!==a.name&&(e.model.nodeInfo["assignment field"]==a.name&&(i=[a]),t.altFields.push(a))});var a=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"altFields",data:t,disableBreadcrumbs:!0,selection:i,filter:_LeanData.Util.createUserFieldsFilter()});a.validate(),this.$el.find("#alternate-field-assignment-typeahead").html(a.$el),a.$el.on("nestedTypeaheadSelector:select",this.updateAlternateField.bind(this)),this.rerenderDropdown()},rerenderDropdown:function(){var e=this.model.nodeInfo["assignment field"];_.isUndefined(e)||_.isNull(e)?(this.$el.find("#alternate-field-assignment-div .dropdown").css("outline",""),this.$el.find("#alternate-field-assignment-div .dropdown").addClass("dropdown-invalid")):(_.includes(this.customUserFieldNames,e)?(this.$el.find("#alternate-field-assignment-div .dropdown").css("outline","1px solid #9eb7cb"),this.$el.find("#alternate-field-assignment-div .dropdown").removeClass("dropdown-invalid")):(this.$el.find("#alternate-field-assignment-div .dropdown").css("outline",""),this.$el.find("#alternate-field-assignment-div .dropdown").addClass("dropdown-invalid")),"OwnerId"===this.model.nodeInfo["assignment field"]?this.$el.find("#alternate-field-assignment-div span.dropdown-selection").html(""):this.$el.find("#alternate-field-assignment-div span.dropdown-selection").html(this.model.nodeInfo["assignment field"]))},additionalEvents:{"change #alternateFieldAssignment":"updateAlternateFieldAssignment"},render:function(){var e=this.template({required:this.required,primaryObject:this.model.get("objectLabelData").label||_LeanData.AppState.PrimarySObjectType});return this.$el.html(e),this.refreshCustomUserFields(),this.populateDropdowns(),this.required||null!=this.model.nodeInfo["assignment field"]&&"OwnerId"!==this.model.nodeInfo["assignment field"]?(this.required&&this.updateAlternateFieldAssignment(),this.$el.find("#alternateFieldAssignment").prop("checked",!0),this.$el.find("#alternateFieldAssignmentLabel").css("color","var(--ld-green)"),this.$el.find("#alternate-field-assignment-div").css("display","flex")):(this.$el.find("#alternateFieldAssignment").prop("checked",!1),this.$el.find("#alternateFieldAssignmentLabel").css("color","#1f1f1f"),this.$el.find("#alternate-field-assignment-div").css("display","none")),this}}),Magellan.Views.RouteToDuplicateContact=Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,customUserFieldDropdownData:null,initialize:function(e){if(this.edgeOptions={"Out of User Schedule":{type:"fixed",condition:"Out of User Schedule",name:"Out of User Schedule",target:-1},"Inactive Owner":{type:"fixed",condition:"Inactive Owner",name:"Inactive Owner",target:-1},"No Mapping Found":{type:"fixed",condition:"No Mapping Found",name:"No Mapping Found",target:-1},"Next Node":{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}},_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){const e=["Next Node","Scheduling Configuration Error","Inactive Owner","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e)}},template:_.template(i(1)),updateDuplicateContactCustomField:function(e){var t=this.customUserFieldDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo["custom field"]=a},updateRoutingType:function(e){this.model.nodeInfo["routing type"]=this.$(e.currentTarget).data("routing-type")},populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createOwnerToOwnerMappingFilter();this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Contact",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},attributes:{id:"duplicate-record-custom-user-field"},filter:function(i){return i=e(i),i=t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Contact",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateDuplicateContactCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.customUserFieldDropdownView.validate()},additionalEvents:{"change #routing-type-radio-control input[type=radio]":"updateRoutingType"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,actionNodeMetaData:window.actionNodeMetaData,primaryObject:_LeanData.AppState.PrimarySObjectType,recordType:"Contact",isMatched:!1});if(this.$el.html(e),this.populateDropdowns(),this.model.nodeInfo["routing type"]){var t=this.$el.find("input[type=radio][data-routing-type='"+this.model.nodeInfo["routing type"]+"']");t.prop("checked",!0),t.parent("label").addClass("checked")}var i=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.childViews.push(i),this.$el.find(".alternate-field-assignment-container").html(i.render().$el);var a=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(a),this.$el.find("#advanced-settings-wrapper").html(a.render().$el);var n=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(n),this.$el.find("#respect-schedules-wrapper").html(n.render().$el);var o=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(o.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"dupe-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this}}),Magellan.Views.RouteToDuplicateLead=Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,customUserFieldDropdownData:null,initialize:function(e){if(this.edgeOptions={"Out of User Schedule":{type:"fixed",condition:"Out of User Schedule",name:"Out of User Schedule",target:-1},"Inactive Owner":{type:"fixed",condition:"Inactive Owner",name:"Inactive Owner",target:-1},"Queue Owner":{type:"fixed",condition:"Queue Owned Duplicate Lead",name:"Queue Owner",target:-1},"Next Node":{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}},_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){const e=["Next Node","Scheduling Configuration Error","Inactive Owner","Queue Owner","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,this.edgeOptions["Queue Owner"],e)}},template:_.template(i(1)),updateDuplicateLeadCustomField:function(e){var t=this.customUserFieldDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo["custom field"]=a},updateRoutingType:function(e){this.model.nodeInfo["routing type"]=this.$(e.currentTarget).data("routing-type")},populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createOwnerToOwnerMappingFilter();this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Lead",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},attributes:{id:"duplicate-record-custom-user-field"},filter:function(i){return i=e(i),i=t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Lead",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateDuplicateLeadCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.customUserFieldDropdownView.validate()},updateExcludeQueueOwned:function(e){var t=this.model.nodeInfo.edges;let i=e=>"Queue Owned Duplicate Lead"===e.condition,a=e=>"Out of User Schedule"===e.condition||"Inactive Owner"===e.condition;var n=!1;null!=this.$("#excludeQueueOwned")&&1==this.$("#excludeQueueOwned")[0].checked?void 0===t.find(i)&&(t.splice(_.findLastIndex(t,a)+1,0,this.edgeOptions["Queue Owner"]),n=!0):t=t.filter(e=>"Queue Owned Duplicate Lead"!==e.condition),this.model.nodeInfo.edges=t,this.model.trigger("renderNodeEdges",n)},additionalEvents:{"change #routing-type-radio-control input[type=radio]":"updateRoutingType","change #excludeQueueOwnedDiv input[type=checkbox]":"updateExcludeQueueOwned"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,actionNodeMetaData:window.actionNodeMetaData,primaryObject:_LeanData.AppState.PrimarySObjectType,recordType:"Lead",isMatched:!1});if(this.$el.html(e),this.populateDropdowns(),this.model.nodeInfo["routing type"]){var t=this.$el.find("input[type=radio][data-routing-type='"+this.model.nodeInfo["routing type"]+"']");t.prop("checked",!0),t.parent("label").addClass("checked")}var i=!1;void 0!==this.model.nodeInfo.edges.find(e=>"Queue Owned Duplicate Lead"===e.condition)&&(i=!0),this.$el.find("#excludeQueueOwned").prop("checked",i),("Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.AppState.isHandoffGraph)&&this.$el.find("#excludeQueueOwned").prop("disabled",!0);var a=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(a),this.$el.find("#advanced-settings-wrapper").html(a.render().$el);var n=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.childViews.push(n),this.$el.find(".alternate-field-assignment-container").html(n.render().$el);var o=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(o),this.$el.find("#respect-schedules-wrapper").html(o.render().$el);var l=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(l.render().$el),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),ld_initializeToolTip(this.$el.find(".prevent-schedule-queue-tooltip"),{title:"Why is routing to queues disabled?",body:"Meetings can only be scheduled with users in user fields or specific users, not queues."}),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"dupe-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"leadVariable",defaultVariable:"matched lead",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Lead"],doNotSave:!1}]}),this}}),Magellan.Views.CustomInterface=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.model.nodeInfo.nodeTypeToParametersmap=this.model.nodeInfo.nodeTypeToParametersmap?this.model.nodeInfo.nodeTypeToParametersmap:{},this.model.nodeInfo.variablesMap=this.model.nodeInfo.variablesMap?this.model.nodeInfo.variablesMap:{},this.model.nodeInfo.parameter=this.model.nodeInfo.parameter||"",this.model.nodeInfo.failureEdges=this.model.nodeInfo.failureEdges||[],this.customParameterChangedFlag=!1},template:_.template(i(261)),initializeOptionsAndEdges:function(){let e=this.model.nodeInfo.parameter,t=actionNodeMetaData.customInterfaceNodesAndEdges;if(e&&""!==e&&t[e]){let i=t[e],a={};this.model.nodeInfo.edges&&this.model.nodeInfo.edges.forEach(e=>{a[e.name]=e}),this.model.nodeInfo.edges=i.map(e=>e in a?a[e]:{type:"fixed",condition:e,name:e,target:-1})}const i=actionNodeMetaData.customInterfaceVariables;e&&""!==e&&i[e]&&(this.model.nodeInfo.variablesMap=i[e])},renderFieldUpdater:function(e){if(actionNodeMetaData.parametersMap[e]&&!this.model.nodeInfo.nodeTypeToParametersmap[e]){let t={};t[e]=actionNodeMetaData.parametersMap[e].map(e=>({field:e,value:"",type:"STRING"})),this.model.nodeInfo.nodeTypeToParametersmap=t}for(let t in this.model.nodeInfo.nodeTypeToParametersmap[e])this.model.nodeInfo.nodeTypeToParametersmap[e][t].type||(this.model.nodeInfo.nodeTypeToParametersmap[e][t].type="STRING");if(""!==e&&this.model.nodeInfo.nodeTypeToParametersmap[e]&&this.model.nodeInfo.nodeTypeToParametersmap[e].length>0){var t=new Magellan.Views.SOFieldUpdater({object:_LeanData.AppState.PrimarySObjectType,fields:this.updatableFields,updates:this.model.nodeInfo.nodeTypeToParametersmap[e],nodeModel:this.model,editable:!1,customerParameters:!0});this.$(".so-field-updater-container").html(t.render().$el),t.$el.on("SOFieldUpdater:change",this._setFieldUpdates.bind(this)),this.$(".typeahead.typeahead-input").prop("disabled",!0),this.$(".typeahead.typeahead-input").removeClass("input-invalid"),this.$(".merge-field-insert-button-container").hide()}},updateCustomParameter:function(e){this.model.nodeInfo.parameter=$(e.currentTarget).val(),this.customParameterChangedFlag=!0,this.render()},updateCustomParameterTypeAhead:function(e,t){this.model.nodeInfo.parameter=t.selection[0].name,this.customParameterChangedFlag=!0,this.render()},additionalEvents:{"input .custom-interface-parameter":"updateCustomParameter","nestedTypeaheadSelector:select #customInterfaceNodeDropdown":"updateCustomParameterTypeAhead"},_setFieldUpdates:function(e,t){let i=this.model.nodeInfo.parameter;this.model.nodeInfo.nodeTypeToParametersmap[i]=t.val()},renderVariablesComponent:function(e,t){const i=this.model.nodeInfo.parameter,a=window.actionNodeMetaData.customInterfaceVariables,n=[];if(i in a){for(let e in a[i].output){let t=a[i].output[e];const{label:o,name:l,type:s}=t,r=[];"SOBJECT"===s?r.push(t.sObject):r.push(t.type);const d=_LeanData.StringUtil.bracketize(l);n.push({placeholder:"Find and Select a Variable",disabled:!0,showObjectTypeByDefault:!0,sObjectTypes:r,defaultVariable:l,originalVariable:d,variable:d,variableLabel:o,selections:[{name:d,label:o}]})}this.loadVariableSetter({variableSetterRowDataList:n,variableType:"input",displayExistingObjectLabel:!0}),_.defer(()=>{const e=this.$el.find("ld-variable-setter-angular");e.length>0&&e[0].ngElementStrategy.componentRef&&this.model.set("variableSetterRef",e[0].ngElementStrategy.componentRef)})}},render:function(){this.removeAllChildViews();const e=window.actionNodeMetaData.customInterfaceVariables;var t=this.template({customInterfaceVariables:e,customParameter:this.model.nodeInfo.parameter,customInterfaceNodesAndEdges:actionNodeMetaData.customInterfaceNodesAndEdges,parametersMap:actionNodeMetaData.parametersMap});this.$el.html(t);var i=this.model.nodeInfo.parameter;this.renderFieldUpdater(i),this.initializeOptionsAndEdges();var a={nodeTypes:[]};_.each(actionNodeMetaData.customInterfaceNodesAndEdges,(e,t)=>{!0===this.customParameterChangedFlag&&-1!==t.indexOf("FailureEdges")&&t.substr(0,t.indexOf("FailureEdges"))===i&&_.each(actionNodeMetaData.customInterfaceNodesAndEdges[t],(e,t)=>{this.model.nodeInfo.failureEdges.push(e)}),-1===t.indexOf("FailureEdges")&&a.nodeTypes.push({label:t,name:t,value:t})}),this.customParameterChangedFlag&&(this.model.nodeInfo.variablesMap=e[i]||{}),this.customParameterChangedFlag=!1,this.renderVariablesComponent();var n=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:a,root:"nodeTypes",selection:null==this.model.nodeInfo.parameter?"":_LeanData.Util.convertStringSelectionToArray(this.model.nodeInfo.parameter)});this.$el.find("#customInterfaceNodeDropdown").html(n.$el),n.$el.on("nestedTypeaheadSelector:select",this.updateCustomParameterTypeAhead.bind(this));var o=new Magellan.Views.AdvancedSettings({model:this.model});return this.childViews.push(o),o.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(o.render().$el),this}}),Magellan.Views.CustomInterfaceSchedule=Magellan.Views.CustomInterface.extend({template:_.template(i(262)),render:function(){this.removeAllChildViews();const e=window.actionNodeMetaData.customInterfaceVariables;var t=this.template({customInterfaceVariables:e,customParameter:this.model.nodeInfo.parameter,customInterfaceNodesAndEdges:actionNodeMetaData.customInterfaceNodesAndEdges,parametersMap:actionNodeMetaData.parametersMap});this.$el.html(t);var i=this.model.nodeInfo.parameter;this.renderFieldUpdater(i),this.initializeOptionsAndEdges();var a={nodeTypes:[]};_.each(actionNodeMetaData.customInterfaceNodesAndEdges,(e,t)=>{!0===this.customParameterChangedFlag&&-1!==t.indexOf("FailureEdges")&&t.substr(0,t.indexOf("FailureEdges"))===i&&_.each(actionNodeMetaData.customInterfaceNodesAndEdges[t],(e,t)=>{this.model.nodeInfo.failureEdges.push(e)}),-1===t.indexOf("FailureEdges")&&a.nodeTypes.push({label:t,name:t,value:t})}),this.customParameterChangedFlag&&(this.model.nodeInfo.variablesMap=e[i]||{}),this.customParameterChangedFlag=!1,this.renderVariablesComponent();var n=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:a,root:"nodeTypes",selection:null==this.model.nodeInfo.parameter?"":_LeanData.Util.convertStringSelectionToArray(this.model.nodeInfo.parameter)});this.$el.find("#customInterfaceNodeDropdown").html(n.$el),n.$el.on("nestedTypeaheadSelector:select",this.updateCustomParameterTypeAhead.bind(this));var o=new Magellan.Views.Scheduling({model:this.model});this.$el.find("#scheduling-container").html(o.render().$el);var l=new Magellan.Views.AdvancedSettings({model:this.model});return this.childViews.push(l),l.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(l.render().$el),this}}),Magellan.Views.AccountBasedRouting=Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,customUserFieldDropdownData:null,initialize:function(e){if(this.edgeOptions={"Out of User Schedule":{type:"fixed",condition:"Out of User Schedule",name:"Out of User Schedule",target:-1},"Inactive User":{type:"fixed",condition:"Inactive User",name:"Inactive User",target:-1},"No Mapping Found":{type:"fixed",condition:"No Mapping Found",name:"No Mapping Found",target:-1},"Next Node":{type:"fixed",condition:"Next Node",name:"Next Node",target:-1},"No Account Found":{type:"fixed",condition:"No Account Found",name:"No Account Found",target:-1}},this.OWNER_OPTIONS_TO_EDGES_MAP={"account owner":[this.edgeOptions["No Account Found"]],"custom field":[this.edgeOptions["No Account Found"]],"account team":[],"owner mapping":[this.edgeOptions["No Mapping Found"]],"custom interface":[]},_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){let e=["Next Node","Scheduling Configuration Error","Inactive User","Out of User Schedule"];"Route to Account"!==this.model.nodeInfo.actionType&&e.push("Variable Not Found"),this.model.nodeInfo["abr type"]&&this.OWNER_OPTIONS_TO_EDGES_MAP[this.model.nodeInfo["abr type"]].forEach(t=>{e.push(t.name)}),this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e)}},template:_.template(i(252)),updateMatchedAccountCustomField:function(e){var t=this.customUserFieldDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t);this.model.nodeInfo["custom field"]=a},updateAbrType:function(e){let t=this.model.nodeInfo["abr type"],i=this.model.nodeInfo["abr type"]=$(e.currentTarget).data("abr-type");if(t===i)return;_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade="Meeting"!==_LeanData.AppState.PrimarySObjectType&&!_LeanData.AppState.isHandoffGraph&&"account team"===this.model.nodeInfo["abr type"]&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS"),this.populateDropdowns();let a=[];this.model.nodeInfo.edges.forEach(e=>{void 0===this.OWNER_OPTIONS_TO_EDGES_MAP[t].find(t=>e.condition===t.condition)&&a.push(e),"Inactive User"===e.condition&&this.OWNER_OPTIONS_TO_EDGES_MAP[i].forEach(e=>{"No Account Found"===e.name&&"Route to Account"!==this.model.nodeInfo.actionType||a.push(e)})}),this.model.nodeInfo.edges=a,this.model.trigger("renderNodeEdges",!0)},openAccountTeamLink:function(){var e=this.$el.find("#account-team-div .tt-highlight").html();const t=_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph?"meeting":_LeanData.AppState.PrimarySObjectType.toLowerCase();""!=e&&e?window.open("/apex/Dashboard#routing/"+t+"/specific_account_team/"+this.model.nodeInfo["account team rule"],"_blank","noopener,noreferrer"):window.open("/apex/Dashboard#routing/"+t+"/account_teams","_blank","noopener,noreferrer")},populateDropdowns:function(){switch(this.model.nodeInfo["abr type"]){case"owner mapping":this.ownerMapDropdownView&&this.ownerMapDropdownView.remove(),this.ownerMapDropdownView=new Magellan.Views.NestedTypeaheadSelector({disableBreadcrumbs:!0,required:!0,asyncServiceCall:_LeanData.FlowBuilderController.searchOwnerMappings,onSelect:e=>{this.model.nodeInfo["owner mapping"]=e.selection[0].name}}),this.model.nodeInfo["owner mapping"]?(this.$el.find("#owner-mapping-div").text("Loading Owner Mappings ..."),_LeanData.FlowBuilderController.queryOwnerMappings([this.model.nodeInfo["owner mapping"]]).then(e=>{this.ownerMapDropdownView.setSelection(e),this.$el.find("#owner-mapping-div").html(this.ownerMapDropdownView.$el),this.ownerMapDropdownView.validate()})):(this.$el.find("#owner-mapping-div").html(this.ownerMapDropdownView.$el),this.ownerMapDropdownView.validate());break;case"account team":this.accTeamDropdownView&&this.accTeamDropdownView.remove(),this.accTeamDropdownView=new Magellan.Views.NestedTypeaheadSelector({disableBreadcrumbs:!0,required:!0,asyncServiceCall:_LeanData.FlowBuilderController.searchAccountTeams,onSelect:e=>{this.model.nodeInfo["account team rule"]=e.selection[0].name}}),this.model.nodeInfo["account team rule"]?(this.$el.find("#account-team-div").text("Loading Account Teams..."),_LeanData.FlowBuilderController.queryAccountTeams([this.model.nodeInfo["account team rule"]]).then(e=>{this.accTeamDropdownView.setSelection(e),this.$el.find("#account-team-div").html(this.accTeamDropdownView.$el),this.accTeamDropdownView.validate()})):(this.$el.find("#account-team-div").html(this.accTeamDropdownView.$el),this.accTeamDropdownView.validate());break;case"custom field":this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Account",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},attributes:{id:"matched-account-custom-user-field"},filter:_LeanData.Util.createUserFieldsFilter(),selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Account",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateMatchedAccountCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.customUserFieldDropdownView.validate();break;default:return}},openMappingLink:function(){const e=_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph?"meeting":_LeanData.AppState.PrimarySObjectType.toLowerCase();window.open("/apex/Dashboard#routing/"+e+"/owner_mappings","_blank","noopener,noreferrer")},additionalEvents:{"click #view-mapping-link":"openMappingLink","change #abr-radio-control input[type=radio]":"updateAbrType","click #view-team-link":"openAccountTeamLink"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,primaryObject:this.model.get("objectLabelData").label||_LeanData.AppState.PrimarySObjectType,accountTeamsProvisioned:"Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.AppState.isHandoffGraph||_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS")});this.$el.html(e),this.populateDropdowns();var t=new Magellan.Views.AdvancedSettings({model:this.model});if(this.childViews.push(t),this.$el.find("#advanced-settings-wrapper").html(t.render().$el),"Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.AppState.isHandoffGraph||_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS")||_.defer(this.renderMessageBadge.bind(this)),this.model.nodeInfo["abr type"]){var i=this.$el.find("input[type=radio][data-abr-type='"+this.model.nodeInfo["abr type"]+"']");i.prop("checked",!0),i.parent("label").addClass("checked"),_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade="Meeting"!==_LeanData.AppState.PrimarySObjectType&&!_LeanData.AppState.isHandoffGraph&&"account team"===this.model.nodeInfo["abr type"]&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS")}var a=new Magellan.Views.AlternateFieldAssignment({model:this.model,required:!1===_LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType,!0).hasOwnerField});this.childViews.push(a),this.$el.find(".alternate-field-assignment-container").html(a.render().$el);var n=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(n),this.$el.find("#respect-schedules-wrapper").html(n.render().$el);var o=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(o.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,variableSetterRowDataList:[{variableKey:"accountVariable",defaultVariable:"matched account",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1}]}),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Account Teams",message:"Upgrade to route the Lead to an Account Team member on the Matched Account.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360021413094-Routing-Account-Teams-Guide","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}}),Magellan.Views.LeadBasedRouting=Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,customUserFieldDropdownData:null,initialize:function(e){if(this.edgeOptions={"Out of User Schedule":{type:"fixed",condition:"Out of User Schedule",name:"Out of User Schedule",target:-1},"Inactive Owner":{type:"fixed",condition:"Inactive Owner",name:"Inactive Owner",target:-1},"Queue Owner":{type:"fixed",condition:"Queue Owned Matched Lead",name:"Queue Owner",target:-1},"Next Node":{type:"fixed",condition:"Next Node",name:"Next Node",target:-1}},_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){const e=["Next Node","Scheduling Configuration Error","Inactive Owner","Queue Owner","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,this.edgeOptions["Queue Owner"],e)}},template:_.template(i(1)),updateMatchedLeadCustomField:function(e){var t=this.customUserFieldDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t);this.model.nodeInfo["custom field"]=a},updateRoutingType:function(e){this.model.nodeInfo["routing type"]=this.$(e.currentTarget).data("routing-type")},populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createOwnerToOwnerMappingFilter();this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Lead",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},attributes:{id:"matched-lead-custom-user-field"},filter:function(i){return i=e(i),i=t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Lead",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateMatchedLeadCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.customUserFieldDropdownView.validate()},updateExcludeQueueOwned:function(e){var t=this.model.nodeInfo.edges;let i=e=>"Queue Owned Matched Lead"===e.condition,a=e=>"Out of User Schedule"===e.condition||"Inactive Owner"===e.condition;var n=!1;null!=this.$("#excludeQueueOwned")&&1==this.$("#excludeQueueOwned")[0].checked?void 0===t.find(i)&&(t.splice(_.findLastIndex(t,a)+1,0,this.edgeOptions["Queue Owner"]),n=!0):t=t.filter(e=>"Queue Owned Matched Lead"!==e.condition),this.model.nodeInfo.edges=t,this.model.trigger("renderNodeEdges",n)},additionalEvents:{"change #routing-type-radio-control input[type=radio]":"updateRoutingType","change #excludeQueueOwnedDiv input[type=checkbox]":"updateExcludeQueueOwned"},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,actionNodeMetaData:window.actionNodeMetaData,primaryObject:_LeanData.AppState.PrimarySObjectType,recordType:"Lead",isMatched:!0});if(this.$el.html(e),this.populateDropdowns(),this.model.nodeInfo["routing type"]){var t=this.$el.find("input[type=radio][data-routing-type='"+this.model.nodeInfo["routing type"]+"']");t.prop("checked",!0),t.parent("label").addClass("checked")}var i=!1;void 0!==this.model.nodeInfo.edges.find(e=>"Queue Owned Matched Lead"===e.condition)&&(i=!0),this.$el.find("#excludeQueueOwned").prop("checked",i),("Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.AppState.isHandoffGraph)&&this.$el.find("#excludeQueueOwned").prop("disabled",!0);var a=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(a),this.$el.find("#advanced-settings-wrapper").html(a.render().$el);var n=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.childViews.push(n),this.$el.find(".alternate-field-assignment-container").html(n.render().$el);var o=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(o),this.$el.find("#respect-schedules-wrapper").html(o.render().$el);var l=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(l.render().$el),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),ld_initializeToolTip(this.$el.find(".prevent-schedule-queue-tooltip"),{title:"Why is routing to queues disabled?",body:"Meetings can only be scheduled with users in user fields or specific users, not queues."}),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"dupe-variable",variableSetterRowDataList:[{variableKey:"leadVariable",defaultVariable:"matched lead",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Lead"],doNotSave:!1}]}),this}}),Magellan.Views.ActivityBasedRouting=Magellan.Views.ButtonHandler.extend({initialize:function(e){if(_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){const e=["Next Node","Scheduling Configuration Error","Inactive User","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e)}},additionalEvents:{"change #rabr-radio-control input[type=radio]":"updateRabrType"},updateMatchedActivityCustomField:function(e){var t=this.matchedActivityDropdownView.selection,i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t);this.model.nodeInfo["custom field"]=a},updateRabrType:function(e){this.model.nodeInfo["rabr type"]=$(e.currentTarget).data("rabr-type"),("activity owner"===this.model.nodeInfo["rabr type"]||"custom field"===this.model.nodeInfo["rabr type"]&&!this.model.nodeInfo.hasOwnProperty("custom field"))&&(this.model.nodeInfo["custom field"]=null)},template:_.template(i(253)),populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createRelatedActivityUserFieldsFilter();this.matchedActivityDropdownView&&this.matchedActivityDropdownView.remove(),this.matchedActivityDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Activity",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},attributes:{id:"matched-activity-custom-user-field-selector"},filter:function(i){return i=e(i),i=t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Activity",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateMatchedActivityCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.matchedActivityDropdownView.$el),this.matchedActivityDropdownView.validate()},render:function(){this.removeAllChildViews();var e=this.template({model:this.model,primaryObject:_LeanData.AppState.PrimarySObjectType});this.$el.html(e),this.populateDropdowns();var t=new Magellan.Views.AdvancedSettings({model:this.model});if(this.childViews.push(t),this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.model.nodeInfo["rabr type"]){var i=this.$el.find("input[type=radio][data-rabr-type='"+this.model.nodeInfo["rabr type"]+"']");i.prop("checked",!0),i.parent("label").addClass("checked")}var a=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.childViews.push(a),this.$el.find(".alternate-field-assignment-container").html(a.render().$el);var n=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(n),this.$el.find("#respect-schedules-wrapper").html(n.render().$el);var o=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(o.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"activity-variable",variableSetterRowDataList:[{variableKey:"activityVariable",defaultVariable:"matched activity",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Activity"],doNotSave:!1}]}),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this}}),Magellan.Views.CampaignMemberBasedRouting=Magellan.Views.ButtonHandler.extend({initialize:function(e){},template:_.template(i(256)),additionalEvents:{"change #rcmbr-radio-control input[type=radio]":"updateRcmbrType"},updateRcmbrType:function(e){var t=$(e.currentTarget);this.model.nodeInfo["rcmbr type"]=t.data("rcmbr-type")},updateMatchedCampaignMemberCustomField:function(e,t){var i=t,a=i[i.length-1];if(_.isUndefined(a)||"REFERENCE"===a.type)return!1;var n=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(i);this.model.nodeInfo["custom field"]=n},populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createBlacklistFilter("CampaignMember");this.matchedCMDropdownView&&this.matchedCMDropdownView.remove(),this.matchedCMDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"CampaignMember",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},attributes:{id:"matched-campaignmember-custom-user-field-selector"},filter:function(i){return i=e(i),t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"CampaignMember",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateMatchedCampaignMemberCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.matchedCMDropdownView.$el),this.matchedCMDropdownView.validate()},render:function(){this.removeAllChildViews();var e=this.template({primaryObject:_LeanData.AppState.PrimarySObjectType,model:this.model});if(this.$el.html(e),this.populateDropdowns(),this.model.nodeInfo["rcmbr type"]){var t=this.$el.find("input[type=radio][data-rcmbr-type='"+this.model.nodeInfo["rcmbr type"]+"']");t.prop("checked",!0),t.parent("label").addClass("checked")}var i=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(i),this.$el.find("#advanced-settings-wrapper").html(i.render().$el);var a=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.childViews.push(a),this.$el.find(".alternate-field-assignment-container").html(a.render().$el);var n=new Magellan.Views.RespectUserSchedules({model:this.model});return this.childViews.push(n),this.$el.find("#respect-schedules-wrapper").html(n.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"campaignmember-variable",variableSetterRowDataList:[{variableKey:"campaignmemberVariable",defaultVariable:"matched campaignmember",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["CampaignMember"],doNotSave:!1}]}),this}}),Magellan.Views.OpportunityBasedRouting=Magellan.Views.ButtonHandler.extend({initialize:function(e){if(_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){const e=["Next Node","Scheduling Configuration Error","Inactive User","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e)}},template:_.template(i(265)),updateMatchedOpportunityCustomField:function(e,t){var i=t,a=i[i.length-1];if(_.isUndefined(a)||"REFERENCE"===a.type)return!1;var n=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(i);this.model.nodeInfo["custom field"]=n},updateObrType:function(e){this.model.nodeInfo["obr type"]=$(e.currentTarget).data("obr-type")},populateDropdowns:function(){var e=_LeanData.Util.createBlacklistFilter(),t=_LeanData.Util.createUserFieldsFilter(),i=_LeanData.Util.createOwnerToOwnerMappingFilter();this.matchedOppDropdownView&&this.matchedOppDropdownView.remove(),this.matchedOppDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Matched_Opportunity",required:!0,refreshMetaDataPostCallback:()=>{this.model.trigger("refreshedMetaData",this)},selection:null==this.model.nodeInfo["custom field"]?"":_LeanData.Util.convertStringSelectionToArray(this.model.nodeInfo["custom field"]),onSelect:this.updateMatchedOpportunityCustomField.bind(this),selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"]||"","Matched_Opportunity",_LeanData.MetaDataController.getFieldMetaDataMap()),filter:function(a){return a=e(a),a=t(a),a=i(a)}}),this.$el.find("#matched-opportunity-custom-user-field-div").html(this.matchedOppDropdownView.$el),this.matchedOppDropdownView.validate()},additionalEvents:{"change #obr-radio-control input[type=radio]":"updateObrType"},render:function(){this.removeAllChildViews();var e=this.template({primaryObject:_LeanData.AppState.PrimarySObjectType,model:this.model});this.$el.html(e),this.populateDropdowns();var t=new Magellan.Views.AdvancedSettings({model:this.model});if(this.childViews.push(t),this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.model.nodeInfo["obr type"]){var i=this.$el.find("input[type=radio][data-obr-type='"+this.model.nodeInfo["obr type"]+"']");i.prop("checked",!0),i.parent("label").addClass("checked")}var a=new Magellan.Views.AlternateFieldAssignment({model:this.model});this.childViews.push(a),this.$el.find(".alternate-field-assignment-container").html(a.render().$el);var n=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(n),this.$el.find("#respect-schedules-wrapper").html(n.render().$el);var o=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(o.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"opportunity-variable",variableSetterRowDataList:[{variableKey:"opportunityVariable",defaultVariable:"matched opportunity",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Opportunity"],doNotSave:!1}]}),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this}}),Magellan.Views.CreateOpportunity=Backbone.View.extend({initialize:function(e){this.isInternalView=e.isInternalView,this.model.nodeInfo.ownerAssignmentType=this.model.nodeInfo.ownerAssignmentType||"accountOwnerAssignment",this.model.nodeInfo.ownerAssignmentValue=this.model.nodeInfo.ownerAssignmentValue||null,this.model.nodeInfo.customUserField=this.model.nodeInfo.customUserField||null,this.model.nodeInfo.closeDate=this.model.nodeInfo.closeDate||"",this.model.nodeInfo.closeDays=this.model.nodeInfo.closeDays||(""==this.model.nodeInfo.closeDate.length?-1:14),this.model.nodeInfo.opportunityFields=this.model.nodeInfo.opportunityFields||[],0===this.model.nodeInfo.opportunityFields.length&&(this.model.nodeInfo.opportunityFields.push({type:"value",readFieldOrValue:"",writeField:"name"}),this.model.nodeInfo.opportunityFields.push({type:"value",readFieldOrValue:"",writeField:"stagename",isValid:!1})),this.assignmentValue_accountTeam,this.assignmentValue_explicitOwner,this.assignmentValue_customUser,"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&(this.assignmentValue_accountTeam=this.model.nodeInfo.ownerAssignmentValue),"explicitOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType&&(this.assignmentValue_explicitOwner=this.model.nodeInfo.ownerAssignmentValue),"customUserField"===this.model.nodeInfo.ownerAssignmentType&&(this.assignmentValue_customUser=this.model.nodeInfo.customUserField),this.expandedText=this.model.nodeInfo.opportunityFields[0].readFieldOrValue,this.truncatedText=_LeanData.Util.truncateText(this.expandedText,57),this.expandTextArea=_LeanData.Util.expandTextArea(66,50),this.collapseTextArea=_LeanData.Util.collapseTextArea(17),this.customUserFields=_.filter(_LeanData.MetaDataController.getCustomUserFieldsByObject(_LeanData.AppState.PrimarySObjectType),function(e){return"owner.id"!==e.name})},template:_.template(e),events:{"input #node-opp-name-input":"nameInputHandler",'change input[type=radio][name="oc-owner-radio-control"]':"updateOwnerAssignmentType","focus .ld-opp-name.lds-textarea-small":"expandTextAreaTrigger","blur .ld-opp-name.lds-textarea-small":"collapseTextAreaTrigger"},collapseTextAreaTrigger:function(e){this.expandedText=e.target.value,this.collapsedText=_LeanData.Util.truncateText(this.expandedText,57),this.collapseTextArea.call(e.target),e.target.value=this.collapsedText},expandTextAreaTrigger:function(e){this.expandedText!==this.collapsedText&&(e.target.value=this.expandedText),this.expandTextArea.call(e.target)},nameInputHandler:function(e){this.nameInputHelper(e.currentTarget.value)},nameInputHelper:function(e){var t=!1;if(e.length>0){var i=Magellan.Validation.isValidMergeFieldValueMessages(this.model.nodeInfo.name,e,"STRING","opportunity.name"),a="";_.isEmpty(i)||(a=i.join("; ")),this.$el.find(".opportunity-name-error").text(a),t=_.isEmpty(a)}this.$el.find("#node-opp-name-input").toggleClass("lds-textarea-invalid",!t),this.updateName(e)},updateName:function(e){this.model.nodeInfo.opportunityFields[0].readFieldOrValue=e},updateOwnerAssignmentType:function(e){this.model.nodeInfo.ownerAssignmentType=$(e.currentTarget).data("owner-type"),_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade="accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS"),"ownerAssignment"===this.model.nodeInfo.ownerAssignmentType||"accountOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType?(this.model.nodeInfo.ownerAssignmentValue=null,this.model.nodeInfo.customUserField=null):"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType?(this.model.nodeInfo.ownerAssignmentValue=this.assignmentValue_accountTeam,this.model.nodeInfo.customUserField=null):"explicitOwnerAssignment"===this.model.nodeInfo.ownerAssignmentType?(this.model.nodeInfo.ownerAssignmentValue=this.assignmentValue_explicitOwner,this.model.nodeInfo.customUserField=null):"customUserField"===this.model.nodeInfo.ownerAssignmentType&&(this.model.nodeInfo.ownerAssignmentValue=null,this.model.nodeInfo.customUserField=this.assignmentValue_customUser)},render:function(){var e=this,t=this.template({oppName:this.model.nodeInfo.opportunityFields[0].readFieldOrValue,objectType:_LeanData.AppState.PrimarySObjectType,isInternalView:this.isInternalView,accountTeamsProvisioned:_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS")});this.$el.html(t),"Contact"==_LeanData.AppState.PrimarySObjectType&&ld_initializeToolTip(this.$el.find(".create-opp-tooltip"),{title:"Create Opportunity - Contact Role",body:"Creating an Opportunity in Contact Routing creates a Contact Role on the Opportunity using native Salesforce functionality."});var i=this.model.nodeInfo.ownerAssignmentType?this.$el.find("input[type=radio][data-owner-type='"+this.model.nodeInfo.ownerAssignmentType+"']"):this.$el.find("input[type=radio][data-owner-type='accountOwnerAssignment']");i.prop("checked",!0),i.parent("label").addClass("checked");var a=this.$el.find("#invalidExplicitOwnerText");a.hide(),_LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade="accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS"),_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS")||_.defer(this.renderMessageBadge.bind(this));var n=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,asyncServiceCall:_LeanData.FlowBuilderController.searchAccountTeams,onSelect:function(t){e.model.nodeInfo.ownerAssignmentValue=t.selection[0].name,e.assignmentValue_accountTeam=t.selection[0].name}});"accountTeamAssignment"===this.model.nodeInfo.ownerAssignmentType&&n.fetchSelectionWithAsyncService(this.model.nodeInfo.ownerAssignmentValue),this.$el.find("#account-team-typeahead").html(n.$el);var o=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:_LeanData.FlowBuilderController.searchUsers,onSelect:function(e,t){this.model.nodeInfo.ownerAssignmentValue=t[0].Id,this.assignmentValue_explicitOwner=t[0].Id,a.hide()}.bind(this)});this.$el.find("#ownerListDropdown").html(o.$el),_.isEmpty(this.model.nodeInfo.ownerAssignmentValue)||o.fetchSelectionWithAsyncService(this.model.nodeInfo.ownerAssignmentValue).then(e=>{0===e.length&&(a.html('Error: User Id "'+this.model.nodeInfo.ownerAssignmentValue+'" is inactive or does not exist)'),a.show())});for(var l={userFields:[]},s=0;s<this.customUserFields.length;s++)l.userFields.push({label:this.customUserFields[s].label,name:this.customUserFields[s].name});var r=_.filter(l.userFields,e=>e.name===this.model.nodeInfo.customUserField),d=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"userFields",data:l,disableBreadcrumbs:!0,selection:r,onSelect:function(t){e.model.nodeInfo.customUserField=t.selection[0].name,e.assignmentValue_customUser=t.selection[0].name},filter:function(e){return _.filter(e,function(e){return!_LeanData._blacklist.FIELD_BLACKLIST_SETS.CUSTOM_USER_FIELDS.has(e.name)})}});d.validate(),this.$el.find("#custom-user-field-typeahead").html(d.$el);var c=new Magellan.Views.RequiredOpportunityFields({model:this.model});this.$el.find("#required-opp-fields-wrapper").html(c.render().$el);var h=new Magellan.Views.AdditionalOpportunityFields({model:this.model,isConvertLead:!1});this.$el.find("#additional-opp-fields-wrapper").html(h.render().$el);var p=new Magellan.Views.AdvancedSettings({model:this.model});p.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(p.render().$el);var u=Magellan.Controllers.VariableCreator.createVariableInsertButton(this.model,null,e=>{var t=this.$("#node-opp-name-input")[0].selectionStart,i=this.$("#node-opp-name-input").val();this.expandedText!==this.collapsedText?this.expandedText=this.expandedText+e:this.expandedText=i.substring(0,t)+e+i.substring(t);var a=t+e.length;this.$("#node-opp-name-input").val(this.expandedText)[0].setSelectionRange(a,a),this.nameInputHelper(this.expandedText)},null,"Opportunity Name",!0);return u.isDatetime=!0,this.$el.find("#opportunity-subject .merge-field-insert-button-container").html(u.$el),this.nameInputHelper(this.expandedText),this},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Account Teams",message:"Upgrade to route the Lead to an Account Team member on the Matched Account.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360021413094-Routing-Account-Teams-Guide","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}},events:{}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}}),Magellan.Views.RequiredOpportunityFields=Backbone.View.extend({initialize:function(e){this.model=e.model},template:_.template(t),events:{'change input[type=radio][name="oc-date-radio-control"]':"updateCloseDateType","input #oppDateDays":"updateCloseDays"},updateCloseDateType:function(e){"specificDate"===$(e.currentTarget).data("date-type")?(this.model.nodeInfo.closeDays=-1,this.model.nodeInfo.closeDate=$("#oppDatePicker").val()):(this.model.nodeInfo.closeDays=$("#oppDateDays").val(),this.model.nodeInfo.closeDate="")},updateCloseDays:function(e){Number(e.currentTarget.value)?(e.currentTarget.value=parseInt(e.currentTarget.value),$(e.target).addClass("input-invalid")):(e.currentTarget.value=e.currentTarget.value.replace(/[^0-9]/g,""),$(e.target).removeClass("input-invalid")),this.model.nodeInfo.closeDays=e.currentTarget.value,0===e.currentTarget.value.length?$(e.target).addClass("input-invalid"):$(e.target).removeClass("input-invalid")},updateCloseDate:function(e){this.model.nodeInfo.closeDate=e.currentTarget.value,0!==e.currentTarget.value.length&&this.isValidDate(e.currentTarget.value)?$(e.target).removeClass("input-invalid"):$(e.target).addClass("input-invalid")},isValidDate:function(e){return e==moment(e).format("MM/DD/YYYY")},render:function(){_.isEmpty(this.model.nodeInfo.closeDate)&&_.isEmpty(this.model.nodeInfo.closeDays)&&(this.model.nodeInfo.closeDays=14);var e=this.template({closeDays:this.model.nodeInfo.closeDays,closeDateInvalid:!this.isValidDate(this.model.nodeInfo.closeDate)});this.$el.html(e);var t=this.model.nodeInfo.closeDays>=0?this.$el.find("input[type=radio][data-date-type='closeDays']"):this.$el.find("input[type=radio][data-date-type='specificDate']");t.prop("checked",!0),t.parent("label").addClass("checked");var i=this;this.$el.find("#opportunityStageDropdown").html("Loading Opportunities List..."),_LeanData.FlowBuilderController.getOpportunityStages().then(e=>{var t=e.filter(e=>e.MasterLabel===i.model.nodeInfo.opportunityFields[1].readFieldOrValue),a=new Magellan.Views.LDDropdown({value:t.length>0?t[0].label:null,options:e.map(e=>e.label),required:!0,onChange:function(e){i.model.nodeInfo.opportunityFields[1].readFieldOrValue=e,i.model.nodeInfo.opportunityFields[1].isValid=!0}});a.validate(),i.$el.find("#opportunityStageDropdown").html(a.$el)});var a=$(this.$el).find("#oppDatePicker");return a&&a.datepicker("destroy").removeClass("hasDatepicker"),a.datepicker({dateFormat:"mm/dd/yy",minDate:new Date}),a.on("change",this.updateCloseDate.bind(this)),a.val(this.model.nodeInfo.closeDate||""),this}}),Magellan.Views.AdditionalOpportunityFields=Backbone.View.extend({initialize:function(e){this.isConvertLead=e.isConvertLead||!1,this.fieldMetaData=fieldMetaData,_.isUndefined(this.model.nodeInfo.recordTypeId)&&(this.model.nodeInfo.recordTypeId=null)},template:_.template(a),convertLeadTemplate:_.template(l),events:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule"},addRule:function(){this.model.nodeInfo.opportunityFields.push({type:"value",readFieldOrValue:"",writeField:null}),this.renderRows()},deleteRule:function(e){var t=Number($(e.currentTarget).data("rule-number").split(".")[1]);this.model.nodeInfo.opportunityFields.splice(t,1),this.renderRows()},renderRows:function(){var e=this.$el.find("#edit-opp-fields-wrapper");e.html(""),_.each(this.model.nodeInfo.opportunityFields,(t,i)=>{if("name"!==t.writeField&&"stagename"!==t.writeField){var a=new Magellan.Views.SingleMappingRow({nodeModel:this.model,field:t,ruleNum:"opp."+i,writeType:"Opportunity",readType:_LeanData._function.VARIABLES_FIELDNAME,readFieldHeader:"Variable",nestedFields:this.fieldMetaData,blacklist:["closedate","stagename","ownerid","name","accountid","recordtypeid"].concat(_LeanData._blacklist.FIELD_BLACKLIST_MAP.REPORTING_FIELDS)});e.append(a.render().$el)}})},validateRecordType:function(){_.isUndefined(this.model.nodeInfo.recordTypeId)?($("#recordTypeDropdown").addClass("input-invalid"),$("#recordTypeDropdownErrorText").html("Error: Invalid Record Type Selected. Select 'Default' to populate with default record type.")):($("#recordTypeDropdown").removeClass("input-invalid"),$("#recordTypeDropdownErrorText").html(""))},render:function(){var e=_LeanData.MetaDataController.getFieldMetaDataMap(),t=null!=e.Opportunity&&e.Opportunity.hasOwnProperty("recordtypeid");if(this.isConvertLead)i=this.convertLeadTemplate();else var i=this.template({showRecordType:t});this.$el.html(i);var a=this,n=new Magellan.Views.NestedTypeaheadSelector({disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],required:!0,validateOnCreate:!0,asyncServiceCall:_LeanData.FlowBuilderController.searchOpportunityRecordTypes,onSelect:function(e){a.model.nodeInfo.recordTypeId=e.selection[0].name,a.validateRecordType()}});return _.isUndefined(this.model.nodeInfo.recordTypeId)?(n.setSelection([]),this.validateRecordType()):null==a.model.nodeInfo.recordTypeId?n.setSelection([{label:"Default",name:null}]):_LeanData.FlowBuilderController.queryRecordTypes(this.model.nodeInfo.recordTypeId).then(function(e){0==e.length?n.setSelection([]):n.setSelection(e),a.validateRecordType()}),this.$el.find("#recordTypeDropdown").html(n.$el),this.renderRows(),this}}),Magellan.Views.SingleMappingRow=Backbone.View.extend({initialize:function(e){this.nodeModel=e.nodeModel,this.ruleNum=e.ruleNum,this.field=e.field,this.options=e,this.relativeDate=!1,this.readFieldInput="value"===this.field.type?this.field.readFieldOrValue:null,this.readFieldSelect="field"===this.field.type?this.field.readFieldOrValue:null,this.readType=e.readType,this.readFieldHeader=e.readFieldHeader,this.writeType=e.writeType,this.nestedFields=e.nestedFields,this.flattenedWriteFields={},this.flattenedWriteFields[this.writeType]=_.filter(_LeanData.MetaDataController.getFlattenedFieldsByObject(this.writeType),function(t){return!_.includes(e.blacklist,t.name)&&t.isUpdateable}),this.filter=e.filter||function(){return!0},this.writeFieldsFilter=e.writeFieldsFilter||function(e){return e},this.activityTypes=new Set(["Activity","Task","Event"]),this.taskOrEventFieldsSet=new Set(this.nestedFields.Activity?this.nestedFields.Activity.reduce((e,t)=>("Activity"!==t.objectType&&e.push(t.name),e),[]):[]),this.readFieldDropdown,this.writeFieldDropdown,this.ownerToOwnerMappingFilter=_LeanData.Util.createOwnerToOwnerMappingFilter(),this.expandedText=this.field.readFieldOrValue,this.collapsedText=_LeanData.Util.truncateText(this.expandedText,39),this.expandTextArea=_LeanData.Util.expandTextArea(30,50),this.collapseTextArea=_LeanData.Util.collapseTextArea(15)},template:_.template(n),events:{"change input[type=radio].match-type":"changeMatchType","change .change-condition-value":"changeInputText","blur .change-condition-value":"changeInputText","focus .width-fill.change-condition-value.lds-textarea-small":"expandTextAreaTrigger","blur .width-fill.change-condition-value.lds-textarea-small":"collapseTextAreaTrigger"},collapseTextAreaTrigger:function(e){this.expandedText=e.target.value,this.collapsedText=_LeanData.Util.truncateText(this.expandedText,39),this.collapseTextArea.call(e.target),e.target.value=this.collapsedText},expandTextAreaTrigger:function(e){this.expandedText!==this.collapsedText&&(e.target.value=this.expandedText),this.expandTextArea.call(e.target)},changeMatchType:function(e){this.field.type=$(e.currentTarget).val(),"field"===this.field.type?this.field.readFieldOrValue=this.readFieldSelect:this.field.readFieldOrValue=this.readFieldInput,this.render()},changeInputText:function(e){this.field.readFieldOrValue=e.currentTarget.value,this.readFieldInput=e.currentTarget.value,0===e.currentTarget.value.length?$(e.target).addClass("input-invalid"):$(e.target).removeClass("input-invalid"),this.validateRow()},changePickListValue:function(e,t){var i=t.selection[0].name;this.field.readFieldOrValue=i,this.readFieldInput=i,this.validateRow()},changeBooleanDropdownValue:function(e,t){var i=t.val().toString();this.field.readFieldOrValue=i,this.readFieldInput=i,this.validateRow()},validateRow:function(){var e="",t=!1;return t=!!this.restrictionType&&("field"==this.field.type?(t=_.includes(_LeanData._function.SFDC_VALID_TYPE_MAPPING[this.readFieldType],this.restrictionType))&&Magellan.Validation.validateVariable(this.nodeModel.nodeInfo.name,this.field.readFieldOrValue):(t=Magellan.Validation.isValidValueOfType(this.restrictionType,this.readFieldInput))&&Magellan.Validation.isValidMergeFieldValue(this.nodeModel.nodeInfo.name,this.readFieldInput,this.field.dataType,this.field.writeField)),this.relativeDate&&!t&&(t=_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(this.expandedText,"DATETIME","Additional "+this.writeType+" Field")),t||(e="Invalid condition: check for valid fields and compatible data types."),this.$(".error-message").html(e),this.$(".change-condition-value").toggleClass("input-invalid",!t),this.$(".matched-field-column .boolean-dropdown .ld-dropdown").toggleClass("input-invalid",!t),t},updateRestrictionType:function(e){this.restrictionType=e.toUpperCase(),this.readFieldSelect=null,this.readFieldType=null,this.readFieldDropdown.setSelection([]),this.readFieldDropdown.render(),this.readFieldDropdown.validate(),this.render()},filterFields:function(e){if(!this.restrictionType)return;let t=["REFERENCE","SOBJECT"];_.each(_LeanData._function.SFDC_VALID_TYPE_MAPPING,(e,i)=>{_.includes(e,this.restrictionType)&&t.push(i)});let i=_.filter(e,e=>this.filter(e)&&_.includes(t,e.type));return i=this.ownerToOwnerMappingFilter(i),(i=_.filter(i,e=>{const t=e.objectType||e.sObject||"";let i=_LeanData._blacklist.FIELD_BLACKLIST_SETS[t.toUpperCase()+"_FIELDS"];return!i||!i.has(e.name)})).length&&this.activityTypes.has(i[0].objectType||i[0].sObject)&&(i=_.filter(i,e=>!this.taskOrEventFieldsSet.has(e.name))),i},setReadInputSelector:function(e,t){switch(this.relativeDate=!1,e){case"BOOLEAN":const r=$(this.$(".matched-field-column .boolean-dropdown"));r.LDDropdown({options:[!0,!1],value:this.field.readFieldOrValue}),r.on("LDDropdown:change",this.changeBooleanDropdownValue.bind(this));break;case"MULTIPICKLIST":{const e=t[0].objectType;let i=_LeanData.MetaDataController.getCachedPicklistValues(e+t[0].name),a={};a[e]=[],null!=i?i=JSON.parse(i):"Event"===this.writeType&&"reminder"===t[0].name&&(i=_LeanData.MetaDataController.getCachedPicklistValues(this.writeType+t[0].name),i=JSON.parse(i));let n=new Magellan.Views.MultiNestedTypeaheadSelector({data:null==i?a:i,root:e,disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,fetchData:null==i?_LeanData.MetaDataController.getPicklistFields.bind(null,e,t[0].name):null,selection:null==this.field?_LeanData.Util.convertStringSelectionToArray(""):_LeanData.Util.convertStringSelectionToArray(this.field.readFieldOrValue),onSelect:(e,t)=>{let i=[];for(let e of t)i.push(e.name);this.field.readFieldOrValue=i,this.readFieldInput=i,this.validateRow()}});this.$(".matched-field-column .boolean-dropdown").html(n.$el);break}case"PICKLIST":var i=t[0].objectType,a=_LeanData.MetaDataController.getCachedPicklistValues(i+t[0].name),n={};n[i]=[],null!=a?a=JSON.parse(a):"Event"===this.writeType&&"reminder"===t[0].name&&(a=_LeanData.MetaDataController.getCachedPicklistValues(this.writeType+t[0].name),a=JSON.parse(a));var o=new Magellan.Views.NestedTypeaheadSelector({data:null==a?n:a,root:i,disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,fetchData:null==a?_LeanData.MetaDataController.getPicklistFields.bind(null,i,t[0].name):null,selection:null==this.field?_LeanData.Util.convertStringSelectionToArray(""):_LeanData.Util.convertStringSelectionToArray(this.field.readFieldOrValue)});this.$(".matched-field-column .boolean-dropdown").html(o.$el),o.$el.on("nestedTypeaheadSelector:select",this.changePickListValue.bind(this));break;case"DATE":case"DATETIME":if("value"===this.field.type&&("Opportunity"===this.writeType||"Task"===this.writeType||"Event"===this.writeType)){this.relativeDate=!0;var l=Magellan.Controllers.VariableCreator.createVariableInsertButton(this.nodeModel,this.writeFieldDropdown,e=>{var t=this.$(".change-condition-value")[0].selectionStart,i=this.$(".change-condition-value").val();this.expandedText!==this.collapsedText?this.expandedText=i+e:this.expandedText=i.substring(0,t)+e+i.substring(t);var a=t+e.length;this.$(".change-condition-value").val(this.expandedText)[0].setSelectionRange(a,a),this.$(".change-condition-value").focus()},null,"Additional Fields");this.$el.find(".merge-field-insert-button-container").html(l.$el)}var s=$(this.$el).find(".matched-field-column input.change-condition-value");moment.utc(this.field.readFieldOrValue).isValid()?"DATE"===e?s.val(moment(this.field.readFieldOrValue).format(_LeanData._datetime.DATE_FORMAT)):s.val(moment(this.field.readFieldOrValue).format(_LeanData._datetime.DATETIME_FORMAT)):s.val(this.field.readFieldOrValue),s&&s.datepicker("destroy").removeClass("hasDatepicker"),"DATE"===e?s.datepicker({dateFormat:"yy-mm-dd"}):s.datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1}),s.on("change",this.changeInputText.bind(this))}},render:function(){const e={isFormula:!1,isNillable:!1,isUnique:!1,isUpdateable:!0,label:"Reminder",name:"reminder",objectType:"Event",type:"PICKLIST",parent:[]};"Event"===this.writeType&&this.flattenedWriteFields[this.writeType].push(e);var t=this.field.writeField?this.flattenedWriteFields[this.writeType].filter(e=>e.name===this.field.writeField.toLowerCase()):[];this.restrictionType=t.length>0?t[0].type:null;var i=this.template({ruleNum:this.ruleNum,fieldType:this.field.type,dataType:this.restrictionType?this.restrictionType.toUpperCase():null,fieldValue:this.field.readFieldOrValue,writeType:this.writeType,readFieldHeader:this.readFieldHeader});this.$el.html(i),this.writeFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:this.writeType,data:(t,i=!1)=>{const a=this;return this.flattenedWriteFields={},this.flattenedWriteFields[this.writeType]=_.filter(_LeanData.MetaDataController.getFlattenedFieldsByObject(this.writeType),function(e){return!_.includes(a.options.blacklist,e.name)&&e.isUpdateable}),"Event"===this.writeType&&this.flattenedWriteFields[this.writeType].push(e),this.flattenedWriteFields},selection:t.length>0?[t[0]]:[],onSelect:function(e){e.selection[0]&&(a.field.writeField=e.selection[0].name,a.field.dataType=e.selection[0].type,a.updateRestrictionType(e.selection[0].type))},filter:this.writeFieldsFilter}),this.$el.find(".write-field-dropdown").html(this.writeFieldDropdown.$el),this.writeFieldDropdown.validate();var a=this;let n=_LeanData.Util.convertFieldSelectionStringToArray(this.field.readFieldOrValue,this.readType,this.nestedFields,_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap());return this.readFieldType=n.length>0?n[n.length-1].type:null,this.readFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:this.readType,getDynamicData:_LeanData.Util.getDynamicFieldMetaData(this.readType,_LeanData.AppState.PrimarySObjectType,this.nestedFields,null),selection:n,onSelect:function(e){_.isEmpty(e.selection)||(a.field.readFieldOrValue=_LeanData.Util.createMergeField(e.selection.slice(0)),a.readFieldSelect=a.field.readFieldOrValue,a.readFieldType=e.selection[e.selection.length-1].type,a.validateRow())},filter:this.filterFields.bind(this),customValidationFunction:this.validateRow.bind(this)}),this.readFieldDropdown.validate(),this.$el.find(".read-field-dropdown").html(this.readFieldDropdown.$el),this.setReadInputSelector(this.restrictionType,t),this.validateRow(),this}}),Magellan.Views.AccountTeamsSingleMappingRow=Backbone.View.extend({initialize:function(e){this.nodeModel=e.nodeModel,this.ruleNum=e.ruleNum,this.field=e.field,this.options=e,this.cachedLastRoles=[],this.readFieldDropdown,this.writeFieldDropdown},template:_.template(i(224)),updateOwner:function(e,t){this.field.writeField="value"==this.field.type?t.selection[0]:_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(t.selection)},updateSelectedRole:function(e,t){this.field.readField=t.selection[0]},createReadFieldDropdown:function(){this.readFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({customValidationFunction:e=>{if(!_LeanData._getOrganizationData().statuses.accountTeamsEnabled)return!0;const t=this.field.readField?this.field.readField.value:null;return t&&this.cachedLastRoles.some(e=>e.value===t)},required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:{roles:this.cachedLastRoles},root:"roles",placeholder:"Select Role",onSelect:()=>{this.$el.find(".invalid-role").html("").css("padding-top","0px"),this.readFieldDropdown.validate()},selection:this.field.readField?[this.field.readField]:[]}),this.$el.find(".read-field-dropdown").html(this.readFieldDropdown.$el),_LeanData._getOrganizationData().statuses.accountTeamsEnabled&&this.field.readField&&!this.cachedLastRoles.some(e=>e.value===this.field.readField.value)&&this.$el.find(".invalid-role").html("This role is no longer available. Please select a new role.").css("padding-top","5px"),this.readFieldDropdown.$el.on("nestedTypeaheadSelector:select",this.updateSelectedRole.bind(this)),this.readFieldDropdown.validate()},render:function(){const e=this.template({ruleNum:this.ruleNum,fieldType:this.field.type,readFieldHeader:this.readFieldHeader});this.$el.html(e);const t=this.field.writeField?[this.field.writeField]:null;if("value"==this.field.type){if(this.writeFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({customValidationFunction:()=>{const e=this.field.writeField?[this.field.writeField]:null;if(!e)return!1;const t=this.options.users.find(t=>t.Id===e[0].Id);return t&&t.IsActive&&this.nodeModel.nodeInfo["atm fields"].every((e,i)=>null===e.writeField||this.ruleNum===i||"string"==typeof e.writeField||t.Id!==e.writeField.Id||(this.$el.find(".invalid-user").html("This user is already assigned. Please select a new user.").css("padding-top","5px"),!1))},required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:t||[],filter:e=>e.filter(e=>this.nodeModel.nodeInfo["atm fields"].every((t,i)=>null===t.writeField||this.ruleNum===i||"string"==typeof t.writeField||t.writeField.Id!==e.Id)),fetchData:!0,onSelect:(e,t)=>{this.options.users.push(t[0]),this.$el.find(".invalid-user").html("").css("padding-top","0px"),this.writeFieldDropdown.validate()},placeholder:"Select Specific User",asyncServiceCall:_LeanData.FlowBuilderController.searchUsers}),t&&t[0]){const e=this.options.users.find(e=>e.Id===t[0].Id);e&&!e.IsActive&&this.$el.find(".invalid-user").html("This user is inactive. Please select an active user.").css("padding-top","5px")}this.$el.find(".write-field-dropdown").html(this.writeFieldDropdown.$el),this.writeFieldDropdown.$el.on("nestedTypeaheadSelector:select",this.updateOwner.bind(this))}else if("field"==this.field.type){const e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createBlacklistFilter(),i=_LeanData.Util.createOwnerToOwnerMappingFilter();this.writeFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"Account",placeholder:"Select User Field on Routed Account",data:function(e=fieldMetaData,t=!1){return e},customValidationFunction:()=>{const e=this.field.writeField?[this.field.writeField]:null;return!!e&&(this.nodeModel.nodeInfo["atm fields"].every((t,i)=>this.ruleNum===i||e[0]!==t.writeField)?!!Magellan.Validation.isValidUserFieldValues(e[0],"Account",_LeanData.MetaDataController.getFieldMetaDataMap()):(this.$el.find(".invalid-user").html("This field is already assigned. Please select another field.").css("padding-top","5px"),!1))},filter:a=>(a=t(a),a=e(a),a=i(a)),onSelect:()=>{this.$el.find(".invalid-user").html("").css("padding-top","0px"),this.writeFieldDropdown.validate()},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.field.writeField,"Account",_LeanData.MetaDataController.getFieldMetaDataMap())}),this.$el.find(".write-field-dropdown").html(this.writeFieldDropdown.$el),this.writeFieldDropdown.$el.on("nestedTypeaheadSelector:select",this.updateOwner.bind(this))}return this.writeFieldDropdown.validate(),_.isEmpty(this.cachedLastRoles)&&_LeanData._getOrganizationData().statuses.accountTeamsEnabled?_LeanData.FlowBuilderController.searchAccountTeamRoles().then(e=>{this.cachedLastRoles=e.AccountTeamRoles,this.createReadFieldDropdown()}):this.createReadFieldDropdown(),this}}),Magellan.Views.TerritoryRouting=Magellan.Views.ButtonHandler.extend({initialize:function(e){if(this.namespace=actionNodeMetaData.namespace,this.graphType=_LeanData.AppState.PrimarySObjectType.toLowerCase(),this.serviceCall=_LeanData.FlowBuilderController.createSearchTerritorySegments("case"===this.graphType||"lead"===this.graphType,_LeanData.AppState.businessUnitId||null),this.objectType=_LeanData.AppState.PrimarySObjectType,this.childViews=[],this.territorySegments=[],this.segmentName="Default",this.segmentId="123",this.populateTerritoryField="",this.isPopulateTerritoryFieldChecked=!!e.model.nodeInfo["populate territory field"],this.unprovisionedTerritories=null,_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType){const e=["Next Node","Scheduling Configuration Error","Inactive User","Out of User Schedule","Territory Not Assigned","Invalid Round Robin Group","Not Available For Routing","Variable Not Found"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e),this.isPopulateTerritoryFieldChecked=this.model.nodeInfo.fieldMapping&&this.model.nodeInfo.fieldMapping[1]&&"{!LeanDataTerritory}"==this.model.nodeInfo.fieldMapping[1]["value field"]}this.nodeNameToNodeMap=_LeanData.FlowBuilderGraph.getNodeNamesToNodesMap()},template:_.template(i(270)),updateModelOnNestedDropdownChange:function(e,t){var i=e.el.parentNode.dataset.field,a=t[t.length-1];if(_.isUndefined(a)||"REFERENCE"===a.type)return!1;var n=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo.fields=this.model.nodeInfo.fields||{},this.model.nodeInfo.fields[i]=_LeanData.StringUtil.bracketize(n),this.model.type=a.type},handleSelectPopulateTerritoryField:function(e,t){e.el.parentNode.dataset.field;var i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(t.name):e+t.name},"");this.model.nodeInfo["populate territory field"]=a,this.model.type=i.type},populateTerritoryFields:function(){that=this,null!==that.populateTerritoryField&&void 0!==that.populateTerritoryField&&(that.populateTerritoryField=this.model.nodeInfo["populate territory field"]),null!=this.model.nodeInfo["populate territory field"]?(this.$el.find("#populateTerritoryField").prop("checked",!0),this.$el.find("#populateTerritoryFieldDiv").css("display","flex")):(this.$el.find("#populateTerritoryField").prop("checked",!1),this.$el.find("#populateTerritoryFieldDiv").css("display","none"))},additionalEvents:{"change #populateTerritoryField":"handlePopulateTerritoryFieldCheckboxChange","change #onlyTagTerritory":"handleOnlyTagTerritoryCheckboxChange","click #territory-view-group-link":"viewTerritory","change .availability-checkbox":"toggleAvailabilityCheckbox"},viewTerritory:function(e){let t=`/apex/${_LeanData._getOrganizationData().nameSpace}Dashboard#`;("Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph)&&(t+="calendaring/"),null!=this.model.nodeInfo.segmentName?(url=t+"territory_segments/assignments/"+encodeURIComponent(this.model.nodeInfo.segmentId).replace(/\(/g,"%28").replace(/\)/g,"%29"),window.open(url,"_blank","noopener,noreferrer")):window.open(t+"territory_segments","_blank","noopener,noreferrer")},handleOnlyTagTerritoryCheckboxChange:function(e){that.model.nodeInfo["only tag territory"]=e.target.checked},handlePopulateTerritoryFieldCheckboxChange:function(e){"Meeting"===_LeanData.AppState.PrimarySObjectType?e.target.checked?this.model.nodeInfo.fieldMapping.splice(1,0,{"form field":"","value field":"{!LeanDataTerritory}"}):this.model.nodeInfo.fieldMapping.splice(1,1):this.showOrHideTerritoryField(e.target.checked)},showOrHideTerritoryField:function(e){this.isPopulateTerritoryFieldChecked=e,e||(this.model.nodeInfo["only tag territory"]=!1,$("#onlyTagTerritory").prop("checked",!1),this.model.nodeInfo["populate territory field"]=null),this.$el.find("#populateTerritoryDropdown").toggle(e),this.$el.find("#onlyTagTerritoryDropdown").toggle(e);let t=actionNodeMetaData.hasLookupTMTaggingEnabled?["ID"]:null;var i=new Magellan.Views.NestedTypeaheadSelector({data:function(e,i=!1){return _LeanData.MetaDataController.getFlattenedWriteFields(!!e,_LeanData.AppState.PrimarySObjectType,t)},root:_LeanData.AppState.PrimarySObjectType,onSelect:that.handleSelectPopulateTerritoryField.bind(that),disableBreadcrumbs:!0,required:!0,selection:_LeanData.Util.convertFieldSelectionStringToArray(that.model.nodeInfo["populate territory field"],_LeanData.AppState.PrimarySObjectType,_LeanData.MetaDataController.getFlattenedWriteFields(!0,_LeanData.AppState.PrimarySObjectType,t))});this.$("#populateTerritoryFieldDropdown").html(i.$el),i.validate()},handleSelectSegment:function(e,t){this.model.nodeInfo.segmentName=t.selection[0].label,this.model.nodeInfo.segmentId=t.selection[0].name,this.segmentName=t.selection[0].label,this.segmentId=t.selection[0].name,this.model.trigger("renderForm",this.model,{}),null==this.model.nodeInfo.segmentName?this.$el.find("#territory-view-group-link").text("View Territory Segments"):this.$el.find("#territory-view-group-link").text("View Territory Segment"),this.populateRoutingMappingForm(t.selection[0].Fields_Used__c),this.validateSelection(t.selection[0])},populateRoutingMappingForm:function(e){var t=this,i=e.split(",");i.includes("CustomField")?this.model.nodeInfo.customFieldRequired=!0:this.model.nodeInfo.customFieldRequired=!1;var a=fieldMetaData;this.model[_LeanData.AppState.PrimarySObjectType]=a;var n="";i.forEach(function(e){n+='<div style="margin-bottom:10px;"><span style="font-weight:600;text-align:right;margin-right:10px;width:70px;display:inline-block;">'+e+'</span><span style="width:250px;display:inline-block;" data-field="'+e+'" class="nested-dropdown-container-'+e+'"></span></div>'}),this.$(".territory-routing-field-mapping").html(n);var o=[],l={Lead:{CustomField:"",PostalCode:"{!routed lead.postalcode}",City:"{!routed lead.city}",State:"{!routed lead.state}",Country:"{!routed lead.country}"},Contact:{CustomField:"",PostalCode:"{!routed contact.mailingpostalcode}",City:"{!routed contact.mailingcity}",State:"{!routed contact.mailingstate}",Country:"{!routed contact.mailingcountry}"},Account:{CustomField:"",PostalCode:"{!routed account.billingpostalcode}",City:"{!routed account.billingcity}",State:"{!routed account.billingstate}",Country:"{!routed account.billingcountry}"},Opportunity:{CustomField:"",PostalCode:"{!routed opportunity.account.billingpostalcode}",City:"{!routed opportunity.account.billingcity}",State:"{!routed opportunity.account.billingstate}",Country:"{!routed opportunity.account.billingcountry}"},Case:{CustomField:"",PostalCode:"",City:"",State:"",Country:""},Meeting:{CustomField:"",PostalCode:"{!postalCode}",City:"{!city}",State:"{!stateOrProvince}",Country:"{!country}"}};(o=i.map(function(e){var i=null!=t.model.nodeInfo.fields&&null!=t.model.nodeInfo.fields[e]&&""!=t.model.nodeInfo.fields[e]?t.model.nodeInfo.fields[e]:l[_LeanData.AppState.PrimarySObjectType]?l[_LeanData.AppState.PrimarySObjectType][e]:"";return t.model.nodeInfo.fields[e]=i,new Magellan.Views.NestedTypeaheadSelector({getDynamicData:_LeanData.Util.getDynamicFieldMetaData(_LeanData._function.VARIABLES_FIELDNAME,_LeanData.AppState.PrimarySObjectType,_.cloneDeep(window.fieldMetaData),null),root:_LeanData._function.VARIABLES_FIELDNAME,customRootLabel:"Variable",onSelect:t.updateModelOnNestedDropdownChange.bind(t),customValidationFunction:e=>{const i=_LeanData.StringUtil.bracketize(_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e.selection));return!_.isEmpty(i)&&"{!}"!==i&&Magellan.Validation.isValidMergeFieldValue(t.model.nodeInfo.name,i,"STRING","Form Field Value")},required:!0,placeholder:"Select a Field from a Variable",validateOnCreate:!0,selection:_LeanData.Util.convertFieldSelectionStringToArray(t.model.nodeInfo.fields[e],_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap())})})).forEach(function(e,a){t.$(".nested-dropdown-container-"+i[a]).html(e.$el)}),o.length>0&&t.$("#territory-routing-field-mapping-title").show()},createTerritorySegmentDropdown:function(){this.territorySegmentDropdown&&this.territorySegmentDropdown.remove(),this.territorySegmentDropdown=new Magellan.Views.NestedTypeaheadSelector({disableBreadcrumbs:!0,required:!0,asyncServiceCall:this.serviceCall,placeholder:"Find and Select Territory Segment",customObjectSuggestionTemplate:e=>this.unprovisionedTerritories&&this.unprovisionedTerritories[e.name]?'<div title="<%- suggestion.label %>" class="pools-suggestion disabled"><p class="med-grey-1"><%- suggestion.label %> (UPGRADE) </p></div>':'<div title="<%- suggestion.value %>"> <%- suggestion.label %> </div>',customValidationFunction:e=>{const t=e.selection[0];if(!t)return!1;const i=this.unprovisionedTerritories&&this.unprovisionedTerritories[t.name];return _LeanData.FlowBuilderGraph.nodeEditorCtrl.nodeNeedsUpgrade=i,!i}}),this.territorySegmentDropdown.$el.on("nestedTypeaheadSelector:select",this.handleSelectSegment.bind(this));const e=[_LeanData.FlowBuilderController.getTerritorySegmentsWithUnprovisionedPools()];this.model.nodeInfo.segmentName&&(this.$el.find("#territory-segment-typeahead-dropdown").text("Loading Territory Segments"),e.push(_LeanData.FlowBuilderController.queryTerritorySegments(this.model.nodeInfo.segmentId))),Promise.all(e).then(([e,t])=>{if(this.unprovisionedTerritories||(this.unprovisionedTerritories=e),t){let e=null;t.length>0?(this.populateRoutingMappingForm(t[0].Fields_Used__c),this.territorySegmentDropdown.setSelection([{label:t[0].Name__c,name:t[0].Id}]),e=t[0]):this.territorySegmentDropdown.setSelection([{label:this.model.nodeInfo.segmentName,name:this.model.nodeInfo.segmentId}]),this.validateSelection(e)}this.$("#territory-segment-typeahead-dropdown").html(this.territorySegmentDropdown.$el)}),this.territorySegmentDropdown.validate(),this.serviceCall("").then(e=>{e.length>0&&this.$("#territory-view-group-link").removeClass("disabled")})},validateSelection:function(e){null==e?($("#territory-segment-error-text").html(`<p style="color:var(--ld-red);margin-left: ${"Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph?"115px":"170px"};margin-top: 10px;">Please Select a Valid Territory Segment.</p>`),$("#territory-segment-error-text").show()):$("#territory-segment-error-text").hide(),$("#territory-segment-typeahead-dropdown").toggleClass("input-invalid",null==e)},render:function(){const e=_LeanData._getOrganizationData().bookItFieldMapping;this.populateTerritoryFields(),this.removeAllChildViews();var t=this.template({model:this.model,graphType:this.graphType,objectType:_LeanData.MetaDataController.getObjectMetaDataObject(this.objectType,!0).label||this.objectType,segmentId:this.segmentId,segmentName:this.segmentName,populateTerritoryField:this.populateTerritoryField,fieldMappingStatus:e});this.$el.html(t),this.model.nodeInfo.fields=this.model.nodeInfo.fields||{},this.createTerritorySegmentDropdown(),"contact"!=this.graphType&&"opportunity"!=this.graphType||(this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el));var i=new Magellan.Views.AdvancedSettings({model:this.model,graphType:this.graphType||"lead"});this.childViews.push(i),this.$el.find("#advanced-settings-wrapper").html(i.render().$el);var a=new Magellan.Views.AlternateFieldAssignment({model:this.model,graphType:_LeanData.AppState.PrimarySObjectType,required:!1===_LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType,!0).hasOwnerField});this.childViews.push(a),this.$el.find(".alternate-field-assignment-container").html(a.render().$el),this.model.nodeInfo["populate territory field checked"];var n=this.model.nodeInfo["only tag territory"];this.$el.find("#populateTerritoryField").prop("checked",this.isPopulateTerritoryFieldChecked),this.$el.find("#onlyTagTerritory").prop("checked",n),this.showOrHideTerritoryField(this.isPopulateTerritoryFieldChecked),this.$el.find("#segment-dropdown .ld-caret").on("mouseup",function(e){j$("#segment-dropdown").hasClass("open")||_.defer(function(e){j$("#segment-dropdown .dropdown-selection").click()})}),ld_initializeToolTip(this.$el.find(".territory-bu-graph-tooltip"),{title:"Select a Segment",body:"Segments belonging to this Graph's Business Unit are available for selection."});var o=new Magellan.Views.RespectUserSchedules({model:this.model});this.childViews.push(o),this.$el.find("#respect-schedules-wrapper").html(o.render().$el);const l=new Magellan.Views.Scheduling({model:this.model});return this.$el.find("#scheduling-container").html(l.render().$el),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),"logIdAndAdditional"===e&&"Meeting"===_LeanData.AppState.PrimarySObjectType&&ld_initializeToolTip(this.$el.find(".tag-territory-tooltip"),{title:"What is Territory Field Tagging?",body:"This option allows you to tag the name of the Territory that was selected for the record onto the associated lead or contact record (in most cases, created by Marketing Automation after BookIt routing). Please map the value to a hidden field"}),ld_initializeToolTip(this.$el.find(".availability-tooltip"),{title:"Display All Pool Members' Availability",body:"If multiple pool members are available at the selected time, the meeting will be scheduled with the pool member with the lowest meeting count."}),this},toggleAvailabilityCheckbox:function(e){this.model.nodeInfo.displayAllPoolAvailability=!!$(e.target).prop("checked")}}),Magellan.Views.TrueFalseNode=Magellan.Views.ButtonHandler.extend({template:_.template(i(272)),currentType:function(){return this.model.nodeInfo.edges[0].type},initialize:function(e){this.childViews=[],this.objectType=this.model.nodeInfo.objectType||_LeanData.AppState.PrimarySObjectType,this.isPrimaryDecisionNode=_LeanData._app.CLOAC_OBJECT_TYPES.includes(this.objectType)||this.model instanceof _LeanData.GraphModels.Decision_TF_Custom||this.model instanceof _LeanData.GraphModels.Decision_TF_Prospect||"Primary"===this.model.nodeInfo.objectType,null==this.model.nodeInfo.edges[0].soqlCondition&&(this.model.nodeInfo.edges[0].soqlCondition=""),"RA"===this.objectType&&(this.model.nodeInfo.edges[0].type="conditions"),this.listenToOnce(this.model,"saveNodeEvent",()=>{"soql"===this.currentType()&&(delete this.model.nodeInfo.edges[0].conditions,delete this.model.nodeInfo.rightInputVariable)})},changeRuleType:function(e){var t=$(e.currentTarget).data("rule-type");this.model.nodeInfo.edges[0].type=t,this.render()},additionalEvents:{"change .rule-type-radio":"changeRuleType"},render:function(){this.removeAllChildViews();var e=this.currentType(),t=this.template({ruleType:e,objectType:this.objectType,showMatchSelector:!this.isPrimaryDecisionNode,primaryObject:_LeanData.AppState.PrimarySObjectType});if(this.$el.html(t),this.$el.find("#conditions-header-section").hide(),"RA"===this.objectType||"Meeting"===this.objectType){const e=this.$el.find('.control--radio input[data-rule-type="soql"]').parent();e.find(".rule-type-radio").attr("disabled","disabled"),e.find(".has-object-label").addClass("disabled-label")}if("soql"===e){var i=new Magellan.Views.SoqlRule({model:this.model.nodeInfo.edges[0],objectType:this.objectType});this.childViews.push(i),this.$el.find("#soql-rule-wrapper").html(i.render().$el)}else if("conditions"===e){this.model.nodeInfo.edges[0].conditions||(this.model.nodeInfo.edges[0].conditions=[{field:null,operand:null,operator:"equals","value/field":"value"}]);var a=new Magellan.Views.ConditionsList({model:this.model.nodeInfo.edges[0],context:this.model,objectType:this.objectType,isTrueFalseNode:!0,enforceSoqlLogic:!0,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275});this.childViews.push(a),this.renderMatchSelectorComponent(this.render.bind(this)),this.$el.find("#condition-set-wrapper").html(a.render().$el),this.$el.find("#conditions-header-section").show()}var n=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.objectType});return this.childViews.push(n),n.hideDragColumn=!0,this.$el.find("#criteria-list-partial").html(n.render().$el),ld_initializeToolTip(this.$el.find(".true_false_RA-tooltip"),{title:"SOQL Rules Unavailable for Related Activity",body:"Related Activities are not eligible for SOQL Rules due to their dual object composition.",width:"240px"}),this}}),Magellan.Views.MergeContact=Magellan.Views.ButtonHandler.extend({template:_.template(i(264)),initialize:function(e){this.childViews=[]},additionalEvents:{"click #view-lead-statuses":"viewStatuses"},viewStatuses:function(){let e=window.location.origin+"/",t="";t="undefined"!=typeof sforce?"lightning/setup/ObjectManager/Lead/FieldsAndRelationships/Status/view":"_ui/common/config/field/StandardFieldAttributes/d?id=Status&type=Lead&setupid=LeadFields",window.open(e+t,"_blank","noopener,noreferrer")},populatePicklist:function(){var e={Status:[]};for(var t in actionNodeMetaData.convertedLeadStatusApiNameToLabel)e.Status.push({label:actionNodeMetaData.convertedLeadStatusApiNameToLabel[t],name:t});var i="";null!=this.model.nodeInfo["merge status"]&&(i=null==(i=actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["merge status"]])?this.model.nodeInfo["merge status"]:i);var a=[],n=!1;Magellan.Validation.validateConvertedLeadStatus(this.model.nodeInfo["merge status"])?(a=_LeanData.Util.convertStringSelectionToArray(i),this.$el.find(".merge-contact-error-message").hide()):null!=this.model.nodeInfo["merge status"]?this.$el.find(".merge-contact-error-message").text(`Previously selected status "${this.model.nodeInfo["merge status"]}" is no longer active or does not exist.`):n=!0;var o=new Magellan.Views.NestedTypeaheadSelector({data:e,root:"Status",disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!0,fetchData:null,selection:a});this.$el.find("#merge-status-typeahead-dropdown").html(o.$el),this.$el.find("#merge-status-typeahead-dropdown").find(".typeahead.typeahead-input.tt-input").toggleClass("input-invalid",n),o.$el.on("nestedTypeaheadSelector:select",this.selectMergeStatus.bind(this))},selectMergeStatus:function(e,t){this.model.openPanel=$("div.advanced-settings-view").hasClass("open"),this.model.nodeInfo["merge status"]=t.selection[0].name,this.model.trigger("renderForm",this.model,{})},render:function(){this.removeAllChildViews();var e=this.template({validateStatus:Magellan.Validation.validateConvertedLeadStatus.bind(this,this.model.nodeInfo["merge status"]),mergeStatus:actionNodeMetaData.convertedLeadStatusApiNameToLabel[this.model.nodeInfo["merge status"]]});this.$el.html(e),this.populatePicklist();var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.childViews.push(t),t.openPanel=this.model.openPanel,this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),this}}),Magellan.Views.RespectUserSchedules=Backbone.View.extend({template:_.template(i(245)),events:{"click .respect-schedules-cb":"_toggleForm","click .schedule-type-cb":"_updateScheduleTypes"},initialize:function(e){this.model=e.model||new Backbone.Model,this.respectSchedules=["W","V","H","P"],this.listenToOnce(this.model,"saveNodeEvent",this._removeFallbackEdge)},_toggleForm:function(e){var t=$(e.target).prop("checked");this.$el.find(".schedule-types-container").prop("hidden",!t),t?(this.model.nodeInfo.respectSchedules=this.respectSchedules,this._addFallbackEdge()):(delete this.model.nodeInfo.respectSchedules,this._removeFallbackEdge())},_updateScheduleTypes:function(e){var t=$(e.target),i=t.data("type");t.prop("checked")?this.respectSchedules.push(i):_.pull(this.respectSchedules,i),_.isEmpty(this.respectSchedules)&&this._resetRespectUserSchedulesView()},_resetRespectUserSchedulesView:function(){this.$el.find(".respect-schedules-cb").prop("checked",!1),this.$el.find(".schedule-types-container").prop("hidden",!0),this.respectSchedules=["W","V","H","P"],this.respectSchedules.forEach(e=>{this.$el.find('input[type=checkbox][data-type="'+e+'"]').prop("checked",!0)}),delete this.model.nodeInfo.respectSchedules,this._removeFallbackEdge()},_removeFallbackEdge:function(){var e=!1;this.model.nodeInfo.hasOwnProperty("respectSchedules")||(this.model.nodeInfo.edges=this.model.nodeInfo.edges.filter(t=>{let i="Out of User Schedule"===t.condition&&(-1===t.target||null===t.target);return e=i||e,!i}),e&&(this.model.trigger("renderNodeEdges",!1),_LeanData.FlowBuilderGraph.nodeEditorCtrl.configChangeEmitter.emit({currentEdges:this.model.nodeInfo.edges})))},_addFallbackEdge:function(){if(_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)return;let e=e=>"Inactive User"===e.condition||"Inactive Owner"===e.condition,t={type:"fixed",condition:"Out of User Schedule",name:"Out of User Schedule",target:null};this.model.nodeInfo.edges.find(e=>"Out of User Schedule"===e.condition)||(this.model.nodeInfo.edges.splice(_.findLastIndex(this.model.nodeInfo.edges,e)+1,0,t),this.model.trigger("renderNodeEdges",!0),_LeanData.FlowBuilderGraph.nodeEditorCtrl.configChangeEmitter.emit({currentEdges:this.model.nodeInfo.edges}))},render:function(){var e=this.template();return this.$el.html(e),this.model.nodeInfo.respectSchedules&&(this.respectSchedules=this.model.nodeInfo.respectSchedules,this.$el.find('input[type=checkbox][data-type="respect-schedules-on"]').prop("checked",!0),this.$el.find(".schedule-types-container").prop("hidden",!1),this._addFallbackEdge()),this.respectSchedules.forEach(e=>{this.$el.find('input[type=checkbox][data-type="'+e+'"]').prop("checked",!0)}),ld_initializeToolTip(this.$el.find(".respect-schedules-tooltip"),{title:"Routing Schedule",body:'<p>Specify whether LeanData should only route to Users who are available. If the user is not available, the record will follow the â€œOut of User Scheduleâ€ edge.</p><p>Set up User Schedules under the <a target="_blank" href="/apex/Dashboard#people/users">People</a> section of LeanData. Each User can have one set of Working Hours and Holidays and multiple Vacations scheduled.</p>',clickableContent:!0}),this}}),Magellan.Views.SendNotification=Backbone.View.extend({template:_.template(i(247)),events:{"click .send-notif-form-cb":"_toggleForm","change .email-radio input[type=radio]":"_toggleEmailType"},initialize:function(e){this.model=e.model,this.showFailureNotificationForm=!(this.model instanceof _LeanData.GraphModels.Action_SendNotification),_.isEmpty(this.model.nodeInfo.notificationSettings)&&(this.model.nodeInfo.notificationSettings={}),this.formDataCache=_.cloneDeep(this.model.nodeInfo.notificationSettings),_.isEmpty(this.model.nodeInfo.notificationSettings.success)&&(this.formDataCache.success=_LeanData.Util.getDefaultNotificationSettings(),this.formDataCache.success.message="",this.formDataCache.success.subject=""),_.isEmpty(this.model.nodeInfo.notificationSettings.failure)&&(this.formDataCache.failure=_LeanData.Util.getDefaultNotificationSettings(!0),this.formDataCache.failure.message="",this.formDataCache.failure.subject=""),_.isEmpty(this.model.nodeInfo.notificationSettings.chatter)&&(this.formDataCache.chatter=_LeanData.Util.getDefaultChatterNotificationSettings(),this.formDataCache.chatter.message=""),this.hasData={success:_LeanData.Util.hasNotificationData(this.model.nodeInfo.notificationSettings.success),failure:_LeanData.Util.hasNotificationData(this.model.nodeInfo.notificationSettings.failure),chatter:_LeanData.Util.hasChatterOrSlackNotificationData(this.model.nodeInfo.notificationSettings.chatter)};var t=Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name,!1);this.matchedObjectTypes=t.matched,this.createdObjectTypes=t.created,this.triggeredObjectTypes=t.triggered,this.emailTemplateSelector={},this.emailMessageCreator={},this.emailRecipientSelector={},this.useEmailComposer={},_.each(["success","failure"],e=>{this.model.nodeInfo.notificationSettings[e]&&("Meeting"===_LeanData.AppState.PrimarySObjectType&&(this.model.nodeInfo.notificationSettings[e].useEmailComposer=!0),this.useEmailComposer[e]=this.model.nodeInfo.notificationSettings[e].useEmailComposer)}),this.listenTo(this.model,"significantEdgeSelection",()=>{this.render()}),this.listenToOnce(this.model,"saveNodeEvent",()=>{var e=Object.keys(_LeanData.Util.getDefaultNotificationSettings().recipients);_.each(["success","failure"],t=>{this.emailRecipientSelector[t]&&this.model.nodeInfo.notificationSettings&&this.model.nodeInfo.notificationSettings[t]&&(this.emailRecipientSelector[t]._setAdditionalObjectUserFieldsInModel(),this.emailRecipientSelector[t].validate(!0).then(()=>{var i=this.emailRecipientSelector[t].model.toJSON(),a={};_.each(e,function(e){a[e]=i[e]}),this.model.nodeInfo.notificationSettings[t].recipients=a})),this.chatterRecipientSelector&&this.model.nodeInfo.notificationSettings&&this.model.nodeInfo.notificationSettings.chatter&&(this.chatterRecipientSelector._setDataInModel(),this.chatterRecipientSelector.validate(!0).then(()=>{var e=this.chatterRecipientSelector._getSaveableData();this.model.nodeInfo.notificationSettings.chatter.recipients=e}))})})},initializeAdditionalOptions(e,t){let i=actionNodeMetaData.customNotifications||{},a={};return Object.keys(i).forEach(e=>{a[e]||(a[e]=!1)}),Object.keys(e).forEach(t=>{let i=e[t].recipients.additionalOptions;e[t].recipients.additionalOptions=Object.assign(_.cloneDeep(a),i)}),Object.assign({},a,e[t].recipients?e[t].recipients.additionalOptions:null)},_createNotificationViews:function(e){let t={primaryObjectType:_LeanData.AppState.PrimarySObjectType,hasOwnerField:_LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType).hasOwnerField,matchedObjectTypes:this.matchedObjectTypes,createdObjectTypes:this.createdObjectTypes,triggeredObjectTypes:this.triggeredObjectTypes,fieldMetaData,showNewPreviousOwnerOptions:!0,showNewPreviousOwnerMergeFields:!0,nodeInfo:this.model.nodeInfo,additionalNotificationOptions:this.initializeAdditionalOptions(this.formDataCache,e)};if("Meeting"===_LeanData.AppState.PrimarySObjectType&&(t.notifyOwners=!1,this.formDataCache.chatter.recipients.notifyPostOwner=!1),"chatter"===e)t.messageType="chatter",t.showNewPreviousOwnerMergeFields=!1,this.chatterMessageCreator=new Magellan.Views.MessageCreator(_.assign({message:this.formDataCache.chatter.message},this.formDataCache.success.message,t)),this.listenTo(this.chatterMessageCreator,"createMessage",this._updateChatterMessage.bind(this)),this.$el.find(".chatter-notification-message-selector").html(this.chatterMessageCreator.$el),this.createdObjectTypes.length>0&&(t.showNewObjectOption=!0),this.chatterRecipientSelector=new Magellan.Views.ChatterRecipientSelector(_.assign({},this.formDataCache.chatter.recipients,t)),this.listenTo(this.chatterRecipientSelector,"savedRecipients",this._updateRecipients.bind(this,e)),this.$el.find(".chatter-notification-recipient-selector").html(this.chatterRecipientSelector.$el);else{t.messageType="email",this.emailTemplateSelector[e]=new Magellan.Views.EmailTemplateSelector({templateId:this.formDataCache[e].template,options:t}),this.listenTo(this.emailTemplateSelector[e],"selectedTemplate",this._updateTemplate.bind(this,e));var i="success"===e?".success-notification-template-selector":".failure-notification-template-selector";this.$el.find(i).html(this.emailTemplateSelector[e].$el),(Object.keys(Magellan.Validation.CREATED_ACTION_TYPE_MAP).includes(this.model.nodeInfo.actionType)||this.model.nodeInfo.actionType=="Update "+_LeanData.AppState.PrimarySObjectType)&&(t.showNewPreviousOwnerMergeFields=!1),this.emailMessageCreator[e]=new Magellan.Views.MessageCreator(_.assign({message:this.formDataCache[e].message,subject:this.formDataCache[e].subject},this.formDataCache[e].message,t)),this.listenTo(this.emailMessageCreator[e],"createMessage",this._updateEmailMessage.bind(this,e));var a="success"===e?".success-email-notification-message-selector":".failure-email-notification-message-selector";this.$el.find(a).html(this.emailMessageCreator[e].$el),"failure"===e&&(t.notifyOwners=!1,t.notifyAdditionalObjectUsers=!1)}Object.keys(Magellan.Validation.CREATED_ACTION_TYPE_MAP).includes(this.model.nodeInfo.actionType)&&(t.showNewObjectOption=!0,t.showNewPreviousOwnerOptions=!1),this.emailRecipientSelector[e]=new Magellan.Views.EmailRecipientSelector(_.assign({},this.formDataCache[e].recipients,t)),this.listenTo(this.emailRecipientSelector[e],"savedRecipients",this._updateRecipients.bind(this,e));var n="success"===e?".success-notification-recipient-selector":".failure-notification-recipient-selector";this.$el.find(n).html(this.emailRecipientSelector[e].$el)},_toggleForm:function(e){var t,i=$(e.target),a=i.data("type"),n=i.prop("checked");t="failure"===a?".failure-notification-content":"chatter"===a?".chatter-notification-content":".success-notification-content",this.$el.find(t).toggleClass("hidden",!n),this.model.nodeInfo.notificationSettings[a]=n?this.formDataCache[a]:null},_toggleEmailType:function(e){var t=$(e.currentTarget).attr("name");this.useEmailComposer[t]=this.model.nodeInfo.notificationSettings[t].useEmailComposer="template"!==$(e.currentTarget).val(),this.$el.find("."+t+"-email-template-wrapper").toggleClass("hidden",this.useEmailComposer[t]),this.$el.find("."+t+"-email-message-wrapper").toggleClass("hidden",!this.useEmailComposer[t])},_updateTemplate:function(e,t){this.model.nodeInfo.notificationSettings[e].template=this.formDataCache[e].template=t},_updateRecipients:function(e,t){this.model.nodeInfo.notificationSettings[e].recipients=this.formDataCache[e].recipients=t},_updateChatterMessage:function(e){_.isEmpty(this.model.nodeInfo.notificationSettings.chatter)||(this.model.nodeInfo.notificationSettings.chatter.message=this.formDataCache.chatter.message=e.message)},_updateEmailMessage:function(e,t){_.isEmpty(this.model.nodeInfo.notificationSettings[e])||(this.model.nodeInfo.notificationSettings[e].message=this.formDataCache[e].message=t.message,this.model.nodeInfo.notificationSettings[e].subject=this.formDataCache[e].subject=t.subject)},render:function(){this.notSendingNotifications=!1;for(let e of this.model.nodeInfo.edges)this.notSendingNotifications=this.notSendingNotifications||("Existing Ownership"===e.name||"Record Already Assigned to Active Pool Member"===e.name)&&e.target!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED;var e=this.template({showFailureNotificationForm:this.showFailureNotificationForm,notSendingNotifications:this.notSendingNotifications,showSuccessContent:this.hasData.success,showFailureContent:this.hasData.failure,showChatterContent:this.hasData.chatter,useEmailComposer:this.useEmailComposer,hideEmailTemplates:"Meeting"===_LeanData.AppState.PrimarySObjectType});if(this.$el.html(e),this._createNotificationViews("success"),this.showFailureNotificationForm?this._createNotificationViews("failure"):this._createNotificationViews("chatter"),this.$el.attr("class",["send-notification"].join(" ")),this.model instanceof _LeanData.GraphModels.Action_SendNotification){var t=new Magellan.Views.AdvancedSettings({model:this.model});this.$el.find("#advanced-settings-wrapper").html(t.render().$el),ld_initializeToolTip(this.$el.find(".chatter-message-tooltip"),{title:"Chatter Message: Fields & Mentions",body:"Please use the picklists to insert fields and mention users.  To notify mentioned users, LeanData will post on their Chatter Feeds.  Modifying the auto-inserted values between the special characters (< >, { }) may result in notifications not being sent or other issues."})}else this.model instanceof _LeanData.GraphModels.Action_SetVariable?ld_initializeToolTip(this.$el.find(".email-notifications-tooltip"),{title:"Email Notifications",body:'<p style="margin-bottom: 5px;">Send email notifications for <b>Success</b> or <b>Failures</b>.</p>Common reasons for <b>Failures</b> include:</br><ul style="margin: 0; padding:2px 0 0 25px;"><li>Invalid values that are selected</li><li>Incorrect data types used for storing the identified value</li></ul>',width:"400px"}):ld_initializeToolTip(this.$el.find(".email-notifications-tooltip"),{title:"Email Notifications",body:'<p style="margin-bottom: 5px;">Send email notifications for <b>Success</b> or <b>Failures</b>.</p><b>Common reasons for Failure Notifications</b></br><ul style="margin: 0; padding:2px 0 0 25px;"><li>Salesforce Validation Rules blocking the action</li><li>Invalid values selected (such as an invalid Lead converted status)</li><li>No user designated in user field referenced</li><li>A reason designated in this nodeâ€™s default Edges (such as inactive/invalid user)</li></ul><br><b>Sender Email Address</b><p style="margin-bottom: 0px">The Integration User is the default Sender of the email notification. You can change the Sender email address to a Salesforce organization-wide email address in Admin > Settings > Notifications.</p>',width:"400px"});return this}}),Magellan.Views.UpdatePrimaryAccountOwner=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=this.objectType||e.objectType||this.model.objectType||_LeanData.AppState.PrimarySObjectType.toLowerCase(),this.childViews=[],this.updateAccountOwner=e.model.nodeInfo.updateAccountOwner||!1},template:_.template(i(251)),events:{"click #updatePrimaryAccountOwner":"updateAccountOwnerChange"},render:function(){this.removeAllChildViews();var e=this.template({checked:this.updateAccountOwner,objectType:_.capitalize(this.objectType)});return this.$el.html(e),this},updateAccountOwnerChange:function(e){this.model.nodeInfo.updateAccountOwner=!this.model.nodeInfo.updateAccountOwner}}),Magellan.Views.AssignAccountTeamMembers=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=this.objectType,this.childViews=[],this.model.nodeInfo["atm fields"]=this.model.nodeInfo["atm fields"]||[],this.fieldMetaData=_LeanData.MetaDataController.getFlattenedFieldsByObject(_LeanData.AppState.PrimarySObjectType),this.model.nodeInfo["replace atm"]=!!this.model.nodeInfo["replace atm"]&&this.model.nodeInfo["replace atm"],this.accountTeamsEnabled=_LeanData._getOrganizationData().statuses.accountTeamsEnabled,this.addMemberDropdownOptions={value:null,options:["Specific User","User Field on Routed Account"],alignMenuRight:!1,placeholder:"Add Team Member",onChange:e=>{"Specific User"===e?this.addRuleSpecificUser():this.addRuleUserField(),this.renderDropdown()}}},template:_.template(i(223)),events:{"click .replace-atm":"toggleReplaceAccountTeamMembers","click #specific-user":"addRuleSpecificUser","click #user-field-on-account":"addRuleUserField","click .delete-column":"deleteRule"},toggleReplaceAccountTeamMembers:function(e){this.model.nodeInfo["replace atm"]=!!$(e.target).prop("checked")},addRuleUserField:function(){this.model.nodeInfo["atm fields"].push({type:"field",readFieldOrUserValue:[],writeField:null,readField:null,isValid:!0}),this.renderRows()},addRuleSpecificUser:function(){this.model.nodeInfo["atm fields"].push({type:"value",readFieldOrUserValue:[],writeField:null,readField:null,isValid:!0}),this.renderRows()},deleteRule:function(e){var t=$(e.currentTarget).data("rule-number");this.model.nodeInfo["atm fields"].splice(t,1),this.renderRows()},renderRows:function(){const e=[],t=this.$el.find("#edit-atm-fields-wrapper");t.html("");const i=this.model.nodeInfo["atm fields"];_.each(i,(t,i)=>{var a=new Magellan.Views.AccountTeamsSingleMappingRow({nodeModel:this.model,fieldMetaData:this.fieldMetaData,field:t,ruleNum:i,users:this.users});e.push(a.render().$el)}),0===i.length?t.append('<div class="empty-message ld-body-large">Click \'Add Team Member\' to begin assigning Account Team Members</div><hr class="horizontal-line-separator">'):t.append(e)},renderDropdown:function(){this.dropdownView=new Magellan.Views.LDDropdown(this.addMemberDropdownOptions),this.$el.find(".variable-insert-button").html(this.dropdownView.$el)},render:function(){this.removeAllChildViews();var e=this.template({model:this.model});this.$el.html(e);var t=new Magellan.Views.AdvancedSettings({model:this.model});this.childViews.push(t),this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.renderDropdown();const i=this.model.nodeInfo["atm fields"].filter(e=>"string"!=typeof e.writeField).filter(e=>e.writeField).map(e=>e.writeField.Id);return _LeanData.FlowBuilderController.queryUsers(i).then(e=>{this.users=e,this.renderRows()}),this.$el.find("#account-teams-setup-link").attr("href",_LeanData.Util.checkLightningExperience()?"/lightning/setup/AccountTeamSelling/home":"/opp/teamsellingsetup.jsp?type=Account&retURL=%2Fui%2Fsetup%2FSetup%3Fsetupid%3DAccount&setupid=AccountTeamSelling"),this.$el.find(".account-teams-not-enabled").toggleClass("hidden",_LeanData._getOrganizationData().statuses.accountTeamsEnabled),this.accountTeamsEnabled||this.$el.find("#action-node-atm-partial").addClass("read-only-graph"),ld_initializeToolTip(this.$el.find(".atm-tooltip"),{renderOnLeft:!0,body:"Selecting â€œReplace Existing Account Team Members in Selected Rolesâ€ will add the selected user(s) to the team and remove all existing team members with the same role(s)."}),this}}),Magellan.Views.Scheduling=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.cacheData={},this.meetingInfo={},this.meetingTypeId=this.model.nodeInfo["meeting type id"],"hidden"!==_LeanData._getOrganizationData().bookItFieldMapping&&_.isEmpty(this.model.nodeInfo.fieldMapping)&&(this.model.nodeInfo.fieldMapping=[{"value field":"{!LogId}","form field":""}]);const t=_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph;("Meeting"===_LeanData.AppState.PrimarySObjectType||t)&&(_LeanData.FlowBuilderController.heroku_getMeetingInfo().then(e=>{this.cacheData.Meeting=[],e.forEach(e=>{e.product_access=e.product_access||[];const i="custom"===e.dateRangeType&&new Date(e.customRange.endTime)<new Date,a=t&&e.product_access.includes("BookIt Handoff"),n=!t&&e.product_access.includes("BookIt for Forms"),o=!e.user_id,l=e.is_active;if(!i&&(a||n)&&o&&l){this.cacheData.Meeting.push({name:e.id,label:e.meeting_name});let t={dateRangeType:e.dateRangeType,minBookingNotice:e.minBookingNotice,customRange:e.customRange};this.meetingInfo[e.id]={name:e.meeting_name,meetingConfig:t}}}),this.renderDropdown()}),this.nodeToDefaultAddFallbackEdge=!("Round Robin"===this.model.nodeInfo.actionType),this.listenToOnce(this.model,"saveNodeEvent",this._removeVacationFallbackEdge))},additionalEvents:{"change .create-event-checkbox":"toggleCreateEvent","click .respect-vacation-schedules-cb":"_toggleVacationEdge","click #additional-hosts-modal-link":"openAdditionalHostsModal"},template:_.template(i(246)),renderDropdown:function(){let e;if(this.meetingTypeDropdownView&&this.meetingTypeDropdownView.remove(),this.cacheData.Meeting)if(this.meetingTypeId){const t=this.meetingInfo[this.meetingTypeId]?this.meetingInfo[this.meetingTypeId].name:this.model.nodeInfo["meeting type name"]||"";e=t?[{name:this.meetingTypeId,label:t}]:[]}else e=[];else e=this.meetingTypeId?_LeanData.Util.convertStringSelectionToArray("Loading..."):[];const t={selector:"ld-typeahead-angular#meeting-type-typeahead",inputs:{data:this.cacheData.Meeting?this.cacheData:{Meeting:[]},nestingRoot:"Meeting",required:"Meeting"===_LeanData.AppState.PrimarySObjectType,selections:e,placeholder:"Select Meeting Type",validationFunction:e=>{if(this.$el.find(".deleted-meeting-type-message").hide(),this.$el.find(".expired-meeting-type-message").hide(),!this.cacheData.Meeting)return!0;let t=e.length>0?e[0]:null;return _.isNil(t)?!!_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph||(this.$el.find(".deleted-meeting-type-message").show(),!1):new Set(this.cacheData.Meeting.map(e=>e.name)).has(t.name)?!!Magellan.Validation.isValidMeetingTypeDateRange(this.meetingInfo[t.name].meetingConfig)||(this.$el.find(".expired-meeting-type-message").show(),!1):(this.$el.find(".deleted-meeting-type-message").show(),!1)},showClearIcon:_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph,disabled:!_LeanData.AppState.isLockedForEditing},events:{onSelect:e=>{const t=e[e.length-1].name;if(!t)return!1;this.model.nodeInfo["meeting type id"]=t,this.model.nodeInfo["meeting type name"]=e[e.length-1].label},onClearSelection:()=>{delete this.model.nodeInfo["meeting type id"],delete this.model.nodeInfo["meeting type name"]}}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)},render:function(){this.createEventOn=!!this.model.nodeInfo.eventCreation;const e=_LeanData._getOrganizationData().bookItVersion>=3,t=_LeanData._getOrganizationData().bookItFieldMapping,i="Meeting"===_LeanData.AppState.PrimarySObjectType&&"Round Robin"===this.model.nodeInfo.actionType;this.showAdditionalAttendeeLock=this.model.nodeInfo.additionalAttendeeList&&this.model.nodeInfo.additionalAttendeeList.length>0;const a=this.template({model:this.model,createEventOn:this.createEventOn,showGroupBooking:e,showAdditionalAttendeeLock:this.showAdditionalAttendeeLock,showAdditionalHostsModalLink:i,fieldMappingStatus:t});this.requiredAdditionalAttendeesCount=0,this.$el.html(a),this.renderDropdown(),ld_initializeToolTip(this.$el.find(".meeting-type-tooltip"),{title:"What are Meeting Types?",body:"Meeting Types determine the length, available hours, reminders, page styles, booking flow details (e.g., Thank You page URL), and more."}),ld_initializeToolTip(this.$el.find(".event-creation-tooltip"),{title:"Create Event for Suggested Host(s)",body:"If a meeting is booked with non-suggested host(s), a Salesforce event will be created using the default settings configured in the BookIt Handoff Settings page."}),ld_initializeToolTip(this.$el.find(".respect-vacation-schedules-tooltip"),{title:"Respect User Vacations",body:"<p>Specify whether BookIt should only route to Users who are available and not on Vacation. "+(this.nodeToDefaultAddFallbackEdge?'If the User is not available, the record will follow the "Out of User Schedule" edge.</p>':'If all of the Round Robin Members are not available, the record will follow the "No Round Robin Member Available" edge.</p>')+'<p>Set up User Vacations under the <a class="lds-link" href="#people/users" target="_blank">People</a> section of LeanData.</p>',clickableContent:!0}),ld_initializeToolTip(this.$el.find(".additional-host-schedules-tooltip"),{title:"What does being an additional host mean? ",body:"Additional hosts can be either required or optional attendees. If optional, their availability is not considered during booking. Additional hosts do not receive a meeting count for the meeting."});const n=_LeanData.AppState.getCurrentVariablesService().getVariablesForTypeahead(!1),o=_.cloneDeep(this.model.nodeInfo.additionalAttendeeList||[]).map(e=>("User Field on Variable"===e.type&&(e.keyField=_LeanData.Util.convertFieldSelectionStringToArray(e.keyField,_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),n,_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap())),e.isOptional||this.requiredAdditionalAttendeesCount++,e)),l=_LeanData.Util.createBlacklistFilter(),s=_LeanData.Util.createUserFieldsFilter(),r=_LeanData.Util.createOwnerToOwnerMappingFilter(),d={variables:_LeanData.Util.createSObjectVariableFilter()(n)},c=_LeanData.Util.getDynamicFieldMetaData(_LeanData._function.VARIABLES_FIELDNAME,null,_.cloneDeep(window.fieldMetaData),d);let h,p,u=[];return _LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ldc-user-variable-list-angular",inputs:{readOnly:_LeanData.FlowBuilderGraph.nodeEditorCtrl.isReadOnly,attendeeList:o,specificUserTypeaheadOptions:{data:[],placeholder:"Select Specific User",required:!0,searchFunction:_LeanData.FlowBuilderController.searchUsers,asyncValidationFunction:(e,t)=>{const i=[];return h?i.push(Promise.resolve(h)):i.push(_LeanData.FlowBuilderController.bookit_getBookitUserStatusMap()),p?i.push(Promise.resolve(p)):i.push(_LeanData.FlowBuilderController.bookit_getBookItMembersAccess()),t?i.push(Promise.resolve(t)):i.push(_LeanData.FlowBuilderController.queryUsers(e[0].Id)),Promise.all(i).then(([i,a,n])=>((t,i,a)=>!(!t[e[0].Id]||"valid"!==t[e[0].Id].status)&&!(!i[e[0].Id]||!i[e[0].Id].includes(_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph?"BookIt Handoff":"BookIt for Forms"))&&a.some(t=>t.Id===e[0].Id||u.some(t=>t===e[0].Id)))(h=h||i,p=p||a,n||t))},filter:e=>e.filter(e=>!u.some(t=>t===e.Id))},userVariableTypeaheadOptions:{placeholder:"Select User Field From Variable",required:!0,nestingRoot:_LeanData._function.VARIABLES_FIELDNAME,validationFunction:e=>{if(e.length<2)return!1;if(!Magellan.Validation.validateVariable(this.model.nodeInfo.name,e[0].name))return!1;const t=e[e.length-1].name;return t.endsWith("__c")||t.endsWith("id")},getDynamicData:e=>{const t=c(e);return _.cloneDeep(t)},filter:e=>(e=l(e),e=s(e),e=r(e))}},events:{attendeeListChange:e=>{if(this.model.nodeInfo.additionalAttendeeList=e||[],u=[],this.requiredAdditionalAttendeesCount=0,this.model.nodeInfo.additionalAttendeeList.forEach(e=>{"Specific User"===e.type&&0!==e.keyField.length&&u.push(e.keyField[0].Id),e.isOptional||this.requiredAdditionalAttendeesCount++}),!this.nodeToDefaultAddFallbackEdge&&this.model.nodeInfo.respectSchedules&&(this._removeVacationFallbackEdge(),this.requiredAdditionalAttendeesCount>0&&this._addVacationFallbackEdge()),!_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph)return;const t=this.model.nodeInfo.additionalAttendeeList.length>0;this.showAdditionalAttendeeLock!==t&&(this.showAdditionalAttendeeLock=t,this.showAdditionalAttendeeLock||delete this.model.nodeInfo.lockAdditionalAttendees,this.render())}}}),_.defer(()=>{const e=this.$el.find("ld-form-field-mapping-angular");if(e.length>0&&e[0].ngElementStrategy.componentRef){const i=e[0].ngElementStrategy;i.setInputValue("nodeEditorCtrl",_LeanData.FlowBuilderGraph.nodeEditorCtrl),i.setInputValue("isReadOnly",!_LeanData.AppState.isLockedForEditing),i.setInputValue("hideAddFieldMappingButton","logIdAndAdditional"!==t),i.setInputValue("formFieldData",this.model.nodeInfo.fieldMapping),i.setInputValue("isRowMandatory",(e,t)=>0===t||"{!LeanDataTerritory}"==e["value field"]&&1===t),i.getInputValue("onChangeHandler").subscribe(e=>{this.model.nodeInfo.fieldMapping=e.allRows}),i.detectChanges()}var i=Magellan.Validation.getNodesToCurrentNode(this.model.nodeInfo.name,!1);this.model.set("matchedObjectTypes",i.matched),this.model.set("createdObjectTypes",i.created),this.model.set("triggeredObjectTypes",i.triggered),this.createEventOn&&this.renderCreateEvent(),$(".node-panel-button.ok").unbind(),$(".node-panel-button.ok").click(()=>{this.createEventOn||delete this.model.nodeInfo.eventCreation,this.model.nodeInfo.additionalAttendeeList&&this.model.nodeInfo.additionalAttendeeList.forEach(e=>{if("User Field on Variable"===e.type){if("string"==typeof e.keyField)return;e.keyField=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e.keyField)}})})}),this.renderlockRepSuggestion(),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this.model.nodeInfo.respectSchedules&&(this.respectSchedules=this.model.nodeInfo.respectSchedules,this.$el.find('input[type=checkbox][data-type="respect-vacations-on"]').prop("checked",!0),this._addVacationFallbackEdge()),this},toggleCreateEvent:function(e){this.createEventOn=$(e.target).is(":checked"),this.$el.find("#create-event-section-wrapper").toggleClass("hidden",!this.createEventOn),this.createEventOn?(this.model.nodeInfo.eventCreation=this.previousEventCreationInfo||{assignedToType:"assignedToMeetingOwner",assignedToValue:null,relatedToValue:"{!routed meeting}",additionalFields:[],subject:null},this.renderCreateEvent()):(this.previousEventCreationInfo=this.model.nodeInfo.eventCreation,delete this.model.nodeInfo.eventCreation)},renderCreateEvent:function(){let e=new Magellan.Views.CreateObjectRadioOptions({model:this.model,objectDataKey:"eventCreation"});this.$el.find("#create-event-radio-options-wrapper").html(e.render().$el),_LeanData.FlowBuilderController.getEventFieldValues().then(e=>{this.model.nodeInfo.eventCreation.additionalFields||(this.model.nodeInfo.eventCreation.additionalFields=[]);var t=new Magellan.Views.OtherCreateObjectFields({model:this.model,objectFieldValues:e,objectDataKey:"eventCreation"});this.$el.find("#other-event-fields-wrapper").html(t.render().$el);var i=new Magellan.Views.AdditionalCreateObjectFields({model:this.model,objectDataKey:"eventCreation"});this.$el.find("#additional-event-fields-wrapper").html(i.render().$el)})},renderlockRepSuggestion:function(){_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ld-lock-suggestion-angular#lockAdditionalAttendees",inputs:{value:this.model.nodeInfo.lockAdditionalAttendees,isHost:!1},events:{onChangeHandler:e=>{this.model.nodeInfo.lockAdditionalAttendees=e}}}),_.defer(()=>{const e=this.$el.find("ld-lock-suggestion-angular#lockAdditionalAttendees");if(e.length>0&&e[0].ngElementStrategy.componentRef){const t=e[0].ngElementStrategy;this.model.set("lockRepSuggestionReference",t.componentRef)}})},_toggleVacationEdge:function(e){$(e.target).prop("checked")?(this.model.nodeInfo.respectSchedules=["V"],this._checkToToggleOutOfUserScheduleFallbackEdge()&&this._addVacationFallbackEdge()):(delete this.model.nodeInfo.respectSchedules,this._checkToToggleOutOfUserScheduleFallbackEdge()&&this._removeVacationFallbackEdge())},_removeVacationFallbackEdge:function(){var e=!1;this.nodeToDefaultAddFallbackEdge&&this.model.nodeInfo.hasOwnProperty("respectSchedules")||!this.nodeToDefaultAddFallbackEdge&&this.model.nodeInfo.hasOwnProperty("respectSchedules")&&this.requiredAdditionalAttendeesCount>0||(this.model.nodeInfo.edges=this.model.nodeInfo.edges.filter(t=>{let i="Out of User Schedule"===t.condition;return e=i||e,!i}),e&&(this.model.trigger("renderNodeEdges",!1),_LeanData.FlowBuilderGraph.nodeEditorCtrl.configChangeEmitter.emit({currentEdges:this.model.nodeInfo.edges})))},_addVacationFallbackEdge:function(){if(!this._checkToToggleOutOfUserScheduleFallbackEdge())return;let e=e=>"Inactive User"===e.condition||"Inactive Owner"===e.condition||"Invalid Round Robin Group"===e.condition,t={type:"fixed",condition:"Out of User Schedule",name:"Out of User Schedule",target:null};this.model.nodeInfo.edges.find(e=>"Out of User Schedule"===e.condition)||(this.model.nodeInfo.edges.splice(_.findLastIndex(this.model.nodeInfo.edges,e)+1,0,t),this.model.trigger("renderNodeEdges",!0),_LeanData.FlowBuilderGraph.nodeEditorCtrl.configChangeEmitter.emit({currentEdges:this.model.nodeInfo.edges}))},_checkToToggleOutOfUserScheduleFallbackEdge:function(){return!!this.nodeToDefaultAddFallbackEdge||this.requiredAdditionalAttendeesCount>0},openAdditionalHostsModal:function(){_LeanData.AppState.showConfirmationDialogBackdrop=!0,_LeanData.Notification.showConfirmationDialog({header:"Adding Additional Hosts",message:'\n          <div class="semi-bold">How does selecting a Round Robin Pool as the main host and adding additional hosts work?</div>\n          <br />\n          <div class="semi-bold">Order-Based Pools</div>\n          <ul><li>Display calendar slots where the <span class="semi-bold">next up rep in the pool</span> and <span class="semi-bold">all required additional host(s)</span> are available.</li></ul>\n          <br />\n          <div class="semi-bold">Count-Based Pools</div>\n          <ul><li>Display calendar slots where <span class="semi-bold">at least one of the reps in the pool</span> is available and <span class="semi-bold">all required additional host(s)</span> are available.</ul></li>\n        ',confirmButtonText:"Close",showRejectButton:!1,onConfirm:()=>{_LeanData.AppState.showConfirmationDialogBackdrop=!1}})}}),Magellan.Views.AdvancedSettings=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.hideCriteriaEdges=e.hideCriteriaEdges||!1,this.objectType=this.objectType||e.objectType||this.model.objectType||_LeanData.AppState.PrimarySObjectType.toLowerCase()||"L2A",this.openPanel=!!_.isBoolean(e.openPanel)&&e.openPanel,this.childViews=[],this.onCollapse=e.onCollapse,this.listenTo(this.model,"renderNodeEdges",this.renderNodeEdges),this.originalSel={}},additionalEvents:{"change .l2a-match-parent-toggle":"l2aMatchParentToggleHandler","change .l2a-match-parent-choice":"l2aMatchParentSelectionHandler","click .advanced-settings-view .collapsible-section-header":"toggleOpenPanel"},l2aMatchParentToggleHandler:function(e){$(e.target).is(":checked")?this.model.nodeInfo.matchToParent="parent":delete this.model.nodeInfo.matchToParent,this.$el.find(".l2a-match-parent-choices").toggleClass("hidden",!$(e.target).is(":checked")),this.$el.find('.l2a-match-parent-choice[value="'+this.model.nodeInfo.matchToParent+'"]').prop("checked",!0),this.renderEdgeSelectionMenu()},l2aMatchParentSelectionHandler:function(e){this.model.nodeInfo.matchToParent=$(e.target).val(),this.renderEdgeSelectionMenu()},renderEdgeSelectionMenu:function(){"L2A"===this.model.nodeInfo.objectType&&(this.model.nodeInfo.edges=_LeanData.Migration.migrateL2AMatchNodeEdges(this.model.nodeInfo.edges,this.model.nodeInfo.matchToParent)),_.each(this.childViews,(e,t)=>{if(e instanceof Magellan.Views.EdgeSelectionMenu)return this.childViews.splice(t,1),!1});const e=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.objectType,triggerNode:this.model instanceof _LeanData.GraphModels.TriggerNode,hideCriteriaEdges:this.hideCriteriaEdges});e.hideDragColumn=!0,this.childViews.push(e),this.$el.find("#criteria-list-partial.advanced-settings-criteria-list").html(e.render().$el)},renderNodeEdges:function(e){this.openPanel=this.openPanel||e,this.render()},toggleOpenPanel:function(){this.openPanel=!this.openPanel},template:_.template(i(229)),render:function(){this.removeAllChildViews();let e=!1;const t=!!this.model.nodeInfo.actionType,i=_LeanData._flowbuilder.NO_OBJECT_VARIABLE_ACTION_TYPES.has(this.model.nodeInfo.actionType);if(t&&i){const t=new Set(Object.keys(_LeanData._localstorage.NEW_OWNER_IN_POOL_EDGE_FOR_EDGE_SELECTION_MAP));e=_.some(this.model.nodeInfo.edges,e=>t.has(e.name)&&_LeanData.Util.getLocalStorageCounter(_LeanData._localstorage.NEW_OWNER_IN_POOL_EDGE_FOR_EDGE_SELECTION_MAP[e.name],5)<5)}var a=this.template({model:this.model,openPanel:this.openPanel,newSetting:e});if(this.$el.html(a),"L2A"===this.model.nodeInfo.objectType){var n=_.template(o)({model:this.model});this.$el.find(".l2a-match-parent-settings-container").html(n)}return this.renderEdgeSelectionMenu(),this}}),Magellan.Views.ObjectRadioOptions=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.node=e.node||null,this.objectType=e.objectType||this.model.objectType,this.parentView=e.parentView||null,this.primaryData={},this.referenceTypes=[],this.allowedObjectTypes="RCM"===this.objectType?["Lead","Contact"]:[],this.mostRecentVariableSelection="variable"===this.model.relatedToType?this.model.relatedToValue:null,"RA"===this.objectType&&["Contact","Opportunity","Case"].includes(_LeanData.AppState.PrimarySObjectType)&&["Contact","Opportunity","Case"].includes(_LeanData.AppState.PrimarySObjectType)&&this.referenceTypes.push("Account"),this.loadingData="RA"===this.objectType,"RA"===this.objectType?_LeanData.MetaDataController.activityRelatedToObjects().then(e=>{this.loadingData=!1,this.allowedObjectTypes=e,this.settingValidOptions(),this.render()}):this.settingValidOptions(),this.primaryData={value:"Object",label:_LeanData.AppState.PrimarySObjectType}},template:_.template(i(242)),events:{"change .primary-matched-radio":"changeOption"},settingValidOptions:function(){var e=_.cloneDeep(_LeanData.AppState.getCurrentVariablesService().getVariablesForTypeahead(!1));e=(e=e.filter(e=>this.allowedObjectTypes.includes(e.sObject))).filter(e=>e.name!==`routed ${_LeanData.AppState.PrimarySObjectType.toLowerCase()}`),this.hasValidVariables=e.length>0,1===e.length&&(this.mostRecentVariableSelection=e[0].name)},changeOption:function(e){let t=$(e.target).data("type"),i=$(e.target).data("value"),a=$(e.target).data("value");"variable"===t&&(a=this.mostRecentVariableSelection,i=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService.getRootVariableSObjectType(a));const n="variable"===this.model.relatedToType||"variable"===t;this.toggleDataTypeForOption(this.model.relatedToType,this.model.relatedToValue,!1),this.model.relatedToType=t,this.model.relatedToValue=a,n?this.render():this.toggleDataTypeForOption(this.model.relatedToType,this.model.relatedToValue,!0),this.node.trigger("changeRightOperandField",{readObjectType:i})},_renderVariableSelection:function(){this.loadVariableSetter({variableType:"input",conditionals:{relatedToType:"variable"},selector:"variable-selection",context:this.node,hideDescription:!0,onSelect:function(e){this.mostRecentVariableSelection=_LeanData.StringUtil.bracketize(e.at(-1).name),this.node.trigger("changeRightOperandField",{readObjectType:e.at(-1).sObject})}.bind(this),variableSetterRowDataList:[{variableKey:"relatedToValue",defaultVariable:"",placeholder:"Select Variable",customSetterFilter:function(e){return e=e.filter(e=>e.name!==`routed ${_LeanData.AppState.PrimarySObjectType.toLowerCase()}`)},disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:this.allowedObjectTypes,doNotSave:!1}]})},toggleDataTypeForOption:function(e,t,i){if("variable"===e)return;let a="";"primary"===e?a="#object-type-primary":"reference"===e&&(a=`#object-type-${t}`);const n=this.$el.find(a);i?n.css("display","inline"):n.css("display","none")},selectOption:function(e,t){let i='input[type=radio][data-type="'+e+'"]';"variable"!==e&&(i+='[data-value="'+t+'"]');const a=this.$el.find(i);a.prop("checked",!0),a.parent("label").addClass("checked"),this.toggleDataTypeForOption(e,t,!0)},render:function(){let e=Magellan.Views.getAPIObjectNameFromObjectType(this.objectType);"CampaignMember"===e&&(e="Campaign Member");const t=this.template({matchType:this.objectType,primaryData:this.primaryData,referenceTypes:this.referenceTypes,hasValidVariables:this.hasValidVariables,objectTypeLabel:e,pluralize:Magellan.Views.getPluralAPIObjectNameFromObjectType,toggledVariableOption:"variable"===this.model.relatedToType});return this.$el.html(t),this.loadingData?$(this.$el.find("#radio-container")).LoadingOverlay("show"):($(this.$el.find("#radio-container")).LoadingOverlay("hide",!0),this._renderVariableSelection()),this.selectOption(this.model.relatedToType,this.model.relatedToValue),this}}),Magellan.Views.FilterRules=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.node=e.node||null,this.isUpdateTrigger=e.isUpdateTrigger||!1,this.triggerNode=e.triggerNode||!1,this.hideNumber=e.hideNumber,this.objectType=e.objectType||this.model.objectType||this.node&&this.node.nodeInfo.objectType||"L2A",this.filterTypes={inclusion:_LeanData.FlowBuilderUtil.createEmptyLogicRule(),exclusion:_LeanData.FlowBuilderUtil.createEmptyLogicRule(),custom:_LeanData.FlowBuilderUtil.createEmptyCustomRule()},this.customFieldFilter="function"==typeof e.customFieldFilter?e.customFieldFilter:null,this.filterTypes[this.model["filter type"]]=this.model.filter,this.parentView=e.parentView,this.listenTo(this.node,"changeRightOperandField",this.changeRightOperandField.bind(this)),this.matchedFieldColumnWidth=e.matchedFieldColumnWidth,this.operatorColumnWidth=e.operatorColumnWidth,this.valueFieldColumnWidth=e.valueFieldColumnWidth},template:_.template(i(234)),additionalEvents:{"click #filter-radio-custom-control, #filter-radio-none-control, #filter-radio-exclude-control, #filter-radio-include-control":"changeFilterType","change .filter-type-radio":"adjustRadio","change #restrict-l2o-to-chosen-account":"changeRestrictL2OToChosenAccount","change #exclude-inactive-owned":"changeExcludeInactiveOwned"},adjustRadio:function(e){let t=$(e.currentTarget).data("text-type");"exclusion"===this.model["filter type"]&&"exclusion"!==t?$("#filter-radio-exclude.filter-type-radio").prop("checked",!0):"none"===this.model["filter type"]&&"none"!==t?$("#filter-radio-none.filter-type-radio").prop("checked",!0):"inclusion"===this.model["filter type"]&&"inclusion"!==t?$("#filter-radio-include.filter-type-radio").prop("checked",!0):"custom"===this.model["filter type"]&&"custom"!==t&&$("#filter-radio-custom.filter-type-radio").prop("checked",!0)},changeFilterType:function(e){this.filterTypes[this.model["filter type"]]=this.model.filter;var t=$(e.currentTarget).data("filter-type");this.triggerNode?this.parentView._persistedEdges[this.model["filter type"]]=_.cloneDeep(this.model.edges):this.model.filter=this.filterTypes[t],"all"===this.model["filter type"]&&"all"!==t?_.isEmpty(this.model.edges[0])||(this.model.edges[0].target=null):"none"===t?this.model.filter=null:"all"===t&&(this.model.edges[0].target=-1,this.model.filter=null),this.triggerNode&&(this.model.edges=_.cloneDeep(this.parentView._persistedEdges[t])),this.model["filter type"]=t,this.model.filter&&(this.model.filter["filter type"]=t),this.renderFilter(this.node),this.node.trigger("filterRuleChanged")},changeRestrictL2OToChosenAccount:function(e){this.model["restrict l2o to chosen account"]=$(e.currentTarget).is(":checked"),this.parentView.render(),this.render()},changeExcludeInactiveOwned:function(e){this.model["exclude inactive owned"]=$(e.currentTarget).is(":checked")},changeRightOperandField:function(e){const t=e.readObjectType||_LeanData.AppState.PrimarySObjectType;this.node.set("primary-object",t),this.node.set("primary-object-label",t),this.render()},renderFilter:function(e){e&&this.node.trigger("renderAdvancedSettings",this.node,{}),this.render()},render:function(){this.removeAllChildViews();var e="Dupe"===this.objectType||"DupeC"===this.objectType||"DupeA"===this.objectType,t=this.template({isDupeNode:e,isUpdateTrigger:this.isUpdateTrigger,triggerNode:this.triggerNode,filterType:this.model["filter type"],node:this.node,elementOrderInNode:["RCM","RA"].includes(this.objectType)?2:1,pluralObjects:_LeanData.MetaDataController.getObjectMetaDataObject(this.objectType,!0).pluralLabel||Magellan.Views.getPluralAPIObjectNameFromObjectType(this.objectType),hideNumber:this.hideNumber,showInactiveOwnerCheckbox:"MATCH"===this.model.type&&"RCM"!==this.model.objectType,excludeInactiveOwned:this.model["exclude inactive owned"],primaryObject:_LeanData.AppState.PrimarySObjectType,restrictL2OToChosenAccount:this.model["restrict l2o to chosen account"]});if(this.$el.html(t),"L2O"!==this.model.objectType&&"P2O"!==this.model.objectType||!this.model["restrict l2o to chosen account"]||this.loadVariableSetter({variableType:"input",conditionals:{"restrict l2o to chosen account":!0},selector:"account-variable",context:this.parentView.model,containerStyles:{"margin-bottom":"5px"},variableSetterRowDataList:[{variableKey:"accountVariable",defaultVariable:"matched account",placeholder:"Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Account"],doNotSave:!1}]}),"inclusion"===this.model["filter type"]&&this.triggerNode){var i=new Magellan.Views.EdgeSelectionMenu({model:this.node,context:this.node,isUpdateTrigger:this.isUpdateTrigger,triggerNode:this.triggerNode,customFieldFilter:this.customFieldFilter,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth});this.childViews.push(i),i.showDescription=!1,this.$el.find("#criteria-list-partial").html(i.render().$el)}else if("inclusion"===this.model["filter type"])i=new Magellan.Views.ConditionsList({model:this.model.filter,context:this.node,objectType:this.objectType,hideFieldValueColumn:this.triggerNode,isDupeNode:e,isUpdateTrigger:this.isUpdateTrigger,customFieldFilter:this.customFieldFilter,enforceSoqlLogic:!0,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth}),this.childViews.push(i),i.showDescription=!1,this.$el.find("#inclusion-filter-rules").html(i.render().$el).hide().slideDown();else if("exclusion"===this.model["filter type"]){var a=new Magellan.Views.ConditionsList({model:this.model.filter,context:this.node,objectType:this.objectType,hideFieldValueColumn:this.triggerNode,isDupeNode:e,customFieldFilter:this.customFieldFilter,enforceSoqlLogic:!0,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth});this.childViews.push(a),a.showDescription=!1,this.$el.find("#exclusion-filter-rules").html(a.render().$el).hide().slideDown()}else if("custom"===this.model["filter type"]){var n=new Magellan.Views.CustomRule({model:this.model.filter,objectType:this.objectType});this.childViews.push(n),this.$el.find("#custom-filter-rules").html(n.render().$el).hide().slideDown(),this.$el.find("#inclusion-filter-rules, #exclusion-filter-rules").empty()}else this.$el.find("#inclusion-filter-rules, #exclusion-filter-rules").empty();let o={Lead:"If the condition is set to score greater than 100, routing will only begin if the Lead's score is originally less than 100 and is updated to greater than 100.",contact:"If the condition is set to score greater than 100, routing will only begin if the Contact's score is originally less than 100 and is updated to greater than 100.",Account:"If the condition is set to Annual Revenue greater than 100,000, routing will only begin if the Account's Annual Revenue is originally less than 100,000 and changes to greater than 100,000.",Opportunity:"If the condition is set to Stage equals Qualified, routing will only begin if the Opportunity's stage is originally a stage other than Qualified and changes to Qualified.",Case:"If the condition is set to Status equals Open, routing will only begin if the status is originally a status other than Open and changes to Open."},l=_LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType,!0).label||this.objectType;return this.isUpdateTrigger?ld_initializeToolTip(this.$el.find(".trigger-tooltip"),{title:"Updated "+l+" Included",body:`Routing will begin when criteria goes from being not met to met.${o[this.objectType]?"<br><br><i> Example: "+o[this.objectType]+"</i>":""} <br><br>Conditions can only be created for ${l} fields. Formula fields cannot be used in trigger conditions.`}):ld_initializeToolTip(this.$el.find(".trigger-tooltip"),{title:"New "+l+" Included",body:"Criteria will be evaluated at new "+l+" creation."}),this}}),Magellan.Views.EdgeSelectionMenu=Magellan.Views.ButtonHandler.extend({invalidChildren:null,nextNodeNames:null,initialize:function(e){this.nextNodeDropdowns=[],this.childViews=[],this.edgesWithAssociatedWarnings=new Set,this.context=this.model instanceof _LeanData.GraphModels.Node?this.model:e.context||new Backbone.Model,this.objectType=e.objectType,this.overrideLeftObjectType=e.overrideLeftObjectType||null,this.overrideRightObjectType=e.overrideRightObjectType||null,this.nextNodeNames=this._getNextNodeNames(),this.isTrigger=e.triggerNode||!1,this.isCampaignMemberTrigger=e.isCampaignMemberTrigger||!1,this.isAdditionalObjectTrigger=e.isAdditionalObjectTrigger||!1,this.isUpdateTrigger=e.isUpdateTrigger||!1,this.hideAddRuleRow=e.hideAddRuleRow||!1,this.alwaysShowDeleteIcon=e.alwaysShowDeleteIcon||!1,this.isMultipleObjectMenu=e.isMultipleObjectMenu||!1,this.isEnrichmentHUNode=e.isEnrichmentHUNode||!1,this.numDefaultEdges=e.numDefaultEdges||0,this.hideOptimaFields=e.hideOptimaFields||!1,this.customEdgeHiddenFilter="function"==typeof e.customEdgeHiddenFilter?e.customEdgeHiddenFilter:e=>!1,this.customFieldFilter="function"==typeof e.customFieldFilter?e.customFieldFilter:null,this.customUpdateConditionsOnEdgeEdit="function"==typeof e.customUpdateConditionsOnEdgeEdit?e.customUpdateConditionsOnEdgeEdit:null,this.$el.on("LD_SoqlRule:changed",function(e,t){t.$el.closest(".criteria-list-item").find(".decision-criteria-column .warning-sign").toggleClass("hidden",t.model.isValid)}),this.criteriaEdgesOnly=e.criteriaEdgesOnly||!1,this.hideCriteriaEdges=e.hideCriteriaEdges||!1,this.matchedFieldColumnWidth=e.matchedFieldColumnWidth,this.operatorColumnWidth=e.operatorColumnWidth,this.valueFieldColumnWidth=e.valueFieldColumnWidth,this.listenTo(this.context,"refreshEdges",(e,t)=>{this.context.nodeInfo.edges[t].target=e,this.render()})},_getNextNodeNames:function(){if(!(this.model instanceof _LeanData.GraphModels.Node))return[];var e=_LeanData.FBUtil.getNodeNamesToNodesMap(),t=_LeanData.FBUtil.getTriggerNodeNames(e),i=_.sortBy(Object.keys(e)),a=_.filter(i,i=>{var a=i!==this.model.nodeInfo.name,n=!_.includes(t,i);return a&&n&&!(e[i]instanceof _LeanData.GraphModels.CollapsedNode)});return this.model instanceof _LeanData.GraphModels.Rerouting_TimeBased&&a.push(_LeanData._flowbuilder.EDGE_TARGET.REROUTE),this.model instanceof _LeanData.GraphModels.Trigger_NewProspect||this.model instanceof _LeanData.GraphModels.Trigger_NewChatProspect||(a.push(_LeanData._flowbuilder.EDGE_TARGET.EOF),a.unshift(_LeanData._flowbuilder.EDGE_TARGET.NONE)),a},deleteRule:function(e){var t=$(e.currentTarget).data("criteria-number");if(this.model instanceof _LeanData.GraphModels.Node){var i=!this.model.nodeInfo.edges[t].target||this.model.nodeInfo.edges[t].target===_LeanData._flowbuilder.EDGE_TARGET.EOF,a=this.model.nodeInfo.edges[t];this.model.nodeInfo.edges.splice(t,1),this.render(),i?_LeanData.FlowBuilderGraph.paper.findViewByModel(this.model).render():this.model.nodeInfo.hasOwnProperty("_model")?this.model.linkHandler.changeEdgeTarget(a.name):this.model.linkHandler.removeLinkForEdge(a)}else this.model.splice(t,1),this.render();this.context.trigger("deleteRule",a),this.context.trigger("validateChange"),"function"==typeof this.model.toggleLooseEdgesIcon&&this.model.toggleLooseEdgesIcon()},showRuleTypeSelection:function(){$(".rule-type-selection").css("display","inline-flex")},hideRuleTypeSelection:function(){$(".rule-type-selection").css("display","none")},addRule:function(e,t,i){if(t=t||$(e.currentTarget).data("rule-type"),this.model instanceof _LeanData.GraphModels.Node){t="logic"===t?"conditions":t;var a=new Set,n=0;_.each(this.model.nodeInfo.edges,function(e,t){"system"!==e.type&&"default"!==e.type&&"fixed"!==e.type&&(n=t+1,a.add(e.name))});for(var o=1,l="Edge "+o;a.has(l);)l="Edge "+ ++o;const e=_LeanData.FlowBuilderUtil.emptyEdge(this.model,t,l,i,this.model instanceof _LeanData.GraphModels.TriggerNode,this.model instanceof _LeanData.GraphModels.Trigger_CampaignMember||this.model instanceof _LeanData.GraphModels.Trigger_Activity);this.model.nodeInfo.edges.splice(n,0,e),this.render(),_LeanData.FlowBuilderGraph.paper.findViewByModel(this.model).render()}else{var s=null;"logic"===t?s=_LeanData.FlowBuilderUtil.createEmptyLogicRule():"soql"===t?s=_LeanData.FlowBuilderUtil.createEmptySoqlCondition():"optima"===t&&(s=_LeanData.FlowBuilderUtil.createEmptyMinMaxRule()),null!==s&&(s.isNew=!0,this.model.push(s),this.render(),delete s.isNew)}this.context.trigger("addRule"),this.context.trigger("validateChange"),"function"==typeof this.model.toggleLooseEdgesIcon&&this.model.toggleLooseEdgesIcon()},editRule:function(e){if(this.model instanceof _LeanData.GraphModels.Decision_TrueFalseNode)return;if(this.disabled)return;var t=$(e.currentTarget);if("default"===t.data("criteria-type"))return;var i=t.data("criteria-number");$(".conditions-edit-partial-wrapper").empty();var a=this.model instanceof _LeanData.GraphModels.Node?this.model.nodeInfo.edges[i]:this.model[i];if(this.toggledCriteria===i)return this.toggledCriteria=null,this.customUpdateConditionsOnEdgeEdit&&this.customUpdateConditionsOnEdgeEdit(!1,a),void this.render();this.render(),this.toggledCriteria=i;var n=this.$el.find(`.criteria-list-item .conditions-edit-partial-wrapper[data-criteria-number=${i}]`),o=this.isTrigger||this.model instanceof _LeanData.GraphModels.ReroutingNode||this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo;const l=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService,s=_LeanData.StringUtil.debracketize(this.context.nodeInfo.leftInputVariable),r=_LeanData.StringUtil.debracketize(this.context.nodeInfo.rightInputVariable);if("General"===this.context.nodeInfo.objectType||s&&l.getVariableByName(s)){const e="General"!==this.context.nodeInfo.objectType||s?"":_LeanData._function.VARIABLES_FIELDNAME;this.overrideLeftObjectType=l.getVariableByName(s)?l.getVariableByName(s).sObject:e}if(r&&l.getVariableByName(r)&&(this.overrideRightObjectType=l.getVariableByName(r).sObject),"conditions"===a.type&&a.referenceFilters){let e=this.model instanceof _LeanData.GraphModels.Trigger_CampaignMember?"CampaignMember":"Activity";this.customUpdateConditionsOnEdgeEdit&&this.customUpdateConditionsOnEdgeEdit(!0,a);var d=new Magellan.Views.MultiConditionsList({model:a,context:this.context,primaryObjectType:this.objectType,secondaryObjectType:e,hideFieldValueColumn:o,isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,isCampaignMemberTrigger:this.isCampaignMemberTrigger,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger});this.listenTo(d,"validated",this.handleConditionListValidationEvent.bind(this,d)),this.childViews.push(d),n.html(d.render().$el)}else if("conditions"===a.type)d=new Magellan.Views.ConditionsList({model:a,showDescription:!(this.model instanceof _LeanData.GraphModels.Decision_Branch_SixSenseIntent),context:this.context,objectType:this.objectType,overrideLeftObjectType:this.overrideLeftObjectType,overrideRightObjectType:this.overrideRightObjectType,hideFieldValueColumn:o,customFieldFilter:this.customFieldFilter,isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,enforceSoqlLogic:!0,conditionObjectType:a.objectType,doFlattenFields:this.model instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this.model instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment||this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth}),this.listenTo(d,"validated",this.handleConditionListValidationEvent.bind(this,d)),this.childViews.push(d),n.html(d.render().$el);else if("optima"===a.type){var c=new Magellan.Views.OptimaView({model:a,objectType:this.objectType,overrideObjectType:this.overrideLeftObjectType,hideOptimaFields:this.hideOptimaFields});this.childViews.push(c),n.html(c.render().$el),c.$el.on("parameter:update",()=>{this.$el.trigger("parameter:update")})}else if("soql"===a.type){var h=new Magellan.Views.SoqlRule({model:a,objectType:this.objectType,overrideLeftObjectType:this.overrideLeftObjectType});this.childViews.push(h),n.html(h.render().$el),h.callValidateSOQL()}else{if("custom"!==a.type)return;var p=new Magellan.Views.CustomRule({model:a,objectType:this.objectType});this.childViews.push(p),n.html(p.render().$el)}"function"==typeof this.model.toggleLooseEdgesIcon&&this.model.toggleLooseEdgesIcon()},validateSOQLEdge:function(e){if("soql"!==e.type||"General"!==this.objectType)return;const t=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService,i=_LeanData.StringUtil.debracketize(this.context.nodeInfo.leftInputVariable),a=t.getVariableByName(i)?t.getVariableByName(i).sObject:_LeanData._function.VARIABLES_FIELDNAME;var n=new Magellan.Views.SoqlRule({model:e,objectType:this.objectType,overrideLeftObjectType:a});n.$el.on("LD_SoqlRule:changed",()=>{this.render()}),n.callValidateSOQL()},validateCriteriaList:function(){for(const e of this.criteriaList)"soql"===e.type&&this.validateSOQLEdge(e)},updateEdgeName:function(e,t){var i=$(e.currentTarget),a=i.data("criteria-number");this.criteriaList[a].name=t.newValue,i.prop("title",""),$(this.$(".edge-label-column .edge-name-input").not(i)).LDInput("validate"),this.model.nodeInfo.hasOwnProperty("_model")?this.model.linkHandler.refreshLinks():(this.model.refreshLinks||_.noop).apply(this.model),t.previousValue!==t.newValue&&this.model.trigger("updateEdgeName",t)},validateTarget:function(e,t){return t&&t.model.isValid()},validateEdgeName:function(e,t){if(_.isEmpty(t)||(t=t.trim()),_.isEmpty(t))return"Required";var i=_.some(this.criteriaList,i=>e!==i&&"string"==typeof i.name&&i.name.trim().toLowerCase()===t.toLowerCase());return e.name=t,i?"Duplicate Name":""},validateEdge:function(e){if(e.isNew)return!0;var t=!0;if("conditions"===e.type&&e.referenceFilters){let a=this.model instanceof _LeanData.GraphModels.Trigger_CampaignMember?"CampaignMember":"Activity";t=(i=new Magellan.Views.MultiConditionsList({model:e,context:this.context,primaryObjectType:this.objectType,secondaryObjectType:a,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,isTrigger:this.isTrigger,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth})).validate(),i.remove()}else if("conditions"===e.type){var i;t=(i=new Magellan.Views.ConditionsList({model:e,context:this.context,objectType:this.objectType,overrideLeftObjectType:this.overrideLeftObjectType,overrideRightObjectType:this.overrideRightObjectType,enforceSoqlLogic:!0,conditionObjectType:e.objectType,hideFieldValueColumn:this.hideFieldValueColumn,doFlattenFields:this.model instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this.model instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment||this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth})).validate(),i.remove()}else if("soql"===e.type)t=e.isValid;else if("optima"===e.type){var a=this.overrideLeftObjectType||Magellan.Views.getAPIObjectNameFromObjectType(this.objectType);t=Magellan.Validation.metadataFieldExists(a,e.field)}return t},handleConditionListValidationEvent:function(e,t){e.$el.closest(".criteria-list-item").find(".decision-criteria-column .warning-sign").toggleClass("hidden",t),this.context.trigger("validateChange")},additionalEvents:{"click .delete-rule-icon":"deleteRule","click .edit-icon-div":"editRule","click .rule-type":"addRule","click .edge-connect-icon":"selectEdgeConnect","click .end-of-flow-icon":"selectEndOfFlow","mouseenter .new-rule-container .add-rule-div":"showRuleTypeSelection","mouseenter .new-rule-container .empty-row-space":"hideRuleTypeSelection","mouseleave .new-rule-container":"hideRuleTypeSelection"},changeNextNode:function(e,t,i){if(e.target!==t){var a=e.target;t===_LeanData._flowbuilder.EDGE_TARGET.NONE||t===_LeanData._flowbuilder.EDGE_TARGET.EOF||t===_LeanData._flowbuilder.EDGE_TARGET.REROUTE||t===_LeanData._flowbuilder.EDGE_TARGET.DISABLED?this.model.nodeInfo.hasOwnProperty("_model")?this.model.linkHandler.changeEdgeTarget(e.name,t?t.toString():t):this.model.linkHandler.removeLinkForEdge(e):this.model.nodeInfo.hasOwnProperty("_model")?this.model.linkHandler.changeEdgeTarget(e.name,t):this.model.linkHandler.changeEdgeTargetFromMenu(e,t,a),this.model instanceof _LeanData.GraphModels.MatchNode&&"Multiple Matches"===e.name&&a===_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&e.isNew&&(_LeanData.AppState.showConfirmationDialogBackdrop=!0,_LeanData.Notification.showConfirmationDialog({header:"Multiple Matches and Tiebreakers",message:"In order to identify multiple matches and utilize this edge, please remove all MIN/MAX tiebreakers in this node (these tiebreakers that would definitively identify one match).",confirmButtonText:"OK",showRejectButton:!1,onConfirm:()=>{_LeanData.AppState.showConfirmationDialogBackdrop=!1}})),e.target=t,"Existing Ownership"!==e.name&&"Record Already Assigned to Active Pool Member"!==e.name||a!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&t!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED||(a===_LeanData._flowbuilder.EDGE_TARGET.DISABLED?this.edgesWithAssociatedWarnings.add(e):this.edgesWithAssociatedWarnings.delete(e),this.model.trigger("significantEdgeSelection")),this.render(),i.validate()}},bindSorting:function(e){$(this.$el.find("#criteria-sortable, .criteria-sortable")).sortable({handle:".drag-column > img",cursor:"grabbing, -moz-grabbing, -webkit-grabbing",items:"li:not(.criteria-list-default)"});var t=this;$(this.$el.find("#criteria-sortable, .criteria-sortable")).on("sortstop",function(i){oldCriteria=JSON.parse(JSON.stringify(e)),e.length=0,$(this).children().each(function(t,i){e.push(oldCriteria[$(this).data("criteriaNumber")])}),t.render()})},getEdgeSelectionIconClass:function(e){return e!=_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&_LeanData.AppState.isLockedForEditing?e==_LeanData._flowbuilder.EDGE_TARGET.NONE?"node-chosen-none":e==_LeanData._flowbuilder.EDGE_TARGET.EOF?"node-chosen-end":e==_LeanData._flowbuilder.EDGE_TARGET.REROUTE?"node-chosen-reschedule":"node-chosen":"node-chosen-disabled"},selectEdgeConnect:function(e){var t=$(e.currentTarget).data("index"),i=this.model.nodeInfo.edges[t];if(_LeanData.AppState.isLockedForEditing){_LeanData.FlowBuilderGraph.updateGraphToolsPanelState(null,!0);const a={index:t,edge:i,originalEdge:_.cloneDeep(i),selectedNode:this.model,initialX:e.clientX,initialY:e.clientY};_LeanData.FlowBuilderGraph.startDraggingNewLink(e.originalEvent,i,a)}},selectEndOfFlow:function(e){var t=$(e.currentTarget).data("index"),i=this.nextNodeDropdowns[t];_LeanData.AppState.isLockedForEditing&&i.set(_LeanData._flowbuilder.EDGE_TARGET.EOF)},formattedConditionTextTemplate:_.template(i(235)),template:_.template(i(233)),render:function(){this.removeAllChildViews(),this.nextNodeDropdowns=[];var e=this;this.model instanceof _LeanData.GraphModels.Action_RoundRobin||this.model instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment||(this.model,_LeanData.GraphModels.MatchNode);var t=this.criteriaList=this.model instanceof _LeanData.GraphModels.Node?this.model.getEdgesForSelection():this.model;t.forEach(e=>{"Existing Ownership"!==e.name&&"Record Already Assigned to Active Pool Member"!==e.name||e.target===_LeanData._flowbuilder.EDGE_TARGET.DISABLED||this.edgesWithAssociatedWarnings.add(e)});const i=new Set(Object.keys(_LeanData._localstorage.NEW_OWNER_IN_POOL_EDGE_FOR_EDGE_SELECTION_MAP));var a=_.reduce(t,function(e,t){if(t.hasOwnProperty("name"))return e[t.name]=e[t.name]?e[t.name]+1:1,i.has(t.name)&&(t.isNew=_LeanData.Util.getLocalStorageCounter(_LeanData._localstorage.NEW_OWNER_IN_POOL_EDGE_FOR_EDGE_SELECTION_MAP[t.name],5)<5),e},{});const n=!(this.model instanceof _LeanData.GraphModels.DecisionNode||this.model instanceof _LeanData.GraphModels.ReroutingNode||"Account"===_LeanData.AppState.PrimarySObjectType&&this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo_EnrichCompany),o=this.model instanceof _LeanData.GraphModels.Decision_Branch_General,l=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService;var r=_LeanData.MetaDataController.getObjectMetaDataObject(this.objectType,!0).caseSensitiveName||Magellan.Views.getAPIObjectNameFromObjectType(this.objectType);if(o){const e=_LeanData.StringUtil.debracketize(this.model.nodeInfo.leftInputVariable),t=_LeanData.StringUtil.debracketize(this.model.nodeInfo.rightInputVariable),i=!this.model.nodeInfo.isLeftSideNull&&(!e||l.getVariableByName(e)),a=this.model.nodeInfo.isValueComparison||t&&l.getVariableByName(t);i&&(r=e?l.getVariableByName(e).sObject:_LeanData._function.VARIABLES_FIELDNAME,this.overrideLeftObjectType=r),this.disabled=!i||!a,this.disabledMessage=this.disabled?"You must have items selected for comparison before you edit conditions.":null}var d=_LeanData.MetaDataController.getObjectMetaDataObject(this.objectType,!0).caseSensitiveName||_LeanData.AppState.PrimarySObjectType,c=this.isTrigger||this.model instanceof Backbone.Model&&this.model.get("reversed-condition-operands");let h,p;if(this.isAdditionalObjectTrigger&&(h=_LeanData.FlowBuilderGraph.nodeEditorCtrl.getTriggerObjectTypeFromNodeType()),this.isTrigger)for(let e of t)void 0!==e.priority?5!==e.priority&&(p=!0):0!==e.priority&&(e.priority=5);const u=this.model instanceof _LeanData.GraphModels.Node,m=this.model instanceof _LeanData.GraphModels.MatchNode,g=this.model instanceof _LeanData.GraphModels.DecisionNode,f=this.model instanceof _LeanData.GraphModels.Decision_TrueFalseNode,b=this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo||this.model instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this.model instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment||this.model instanceof _LeanData.GraphModels.Partner_SixSense_EnrichCompany;d="Meeting"===d?_LeanData._function.VARIABLES_FIELDNAME:d,r="Meeting"===r?_LeanData._function.VARIABLES_FIELDNAME:r,r=this.overrideLeftObjectType?this.overrideLeftObjectType:r;const v=this.template({edgesWithAssociatedWarnings:this.edgesWithAssociatedWarnings,criteriaEdgesOnly:this.criteriaEdgesOnly,hideCriteriaEdges:this.hideCriteriaEdges,isCriteriaEdge:e=>"soql"===e.type||"conditions"===e.type||"optima"===e.type||"default"===e.type,edges:t,mapNameCounts:a,formattedConditionTextTemplate:this.formattedConditionTextTemplate,hideDragColumn:u&&this.hideDragColumn,isAccountSettingsPage:!u,hideLabel:!u||m,allowOptimaNode:n,trueFalseNode:f,decisionNode:g,useLabelAsCondition:b,ccioPrioEnabled:_LeanData._getOrganizationData().ccioPrioritizationEnabled,isDeploymentLive:_LeanData.AppState.isDeploymentLive,isRoutingInsightsView:_LeanData.AppState.isRoutingInsightsView,showRoutingPriorityColumn:_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:ROUTING_PRIORITY")&&(_LeanData.AppState.isRoutingInsightsView?_LeanData.AppState.showRoutingPriorityColumn&&p:_LeanData.AppState.showRoutingPriorityColumn||p),businessUnit:_LeanData.AppState._BUIdToName?_LeanData.AppState._BUIdToName[_LeanData.AppState._businessUnitId]:"",getFieldLabel:_LeanData.Util.getFieldLabel.bind(this,c?d:r),getOperandFieldLabel:_LeanData.Util.getFieldLabel.bind(this,c?r:d),getAdditionalObjectFieldLabel:this.isAdditionalObjectTrigger?_LeanData.Util.getFieldLabel.bind(this,h):null,getAdditionalObjectOperandFieldLabel:this.isAdditionalObjectTrigger?_LeanData.Util.getFieldLabel.bind(this,h):null,getObjectFieldLabel:this.isCampaignMemberTrigger?_LeanData.Util.getFieldLabel.bind(this,"Object"):null,getObjectOperandFieldLabel:this.isCampaignMemberTrigger?_LeanData.Util.getFieldLabel.bind(this,"Object"):null,getOperandValueLabel:_LeanData.Util.getOperandValueLabel.bind(this),validateEdge:this.validateEdge.bind(this),isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,isPartnerTriggerNode:!!(this.context instanceof _LeanData.GraphModels.TriggerNode&&window._LeanData.FlowBuilderGraph.nodeEditorCtrl)&&!!window._LeanData.FlowBuilderGraph.nodeEditorCtrl.getPartnerNameFromNodeType(),isMultipleObjectMenu:this.isMultipleObjectMenu,isEnrichmentHUNode:this.isEnrichmentHUNode,numDefaultEdges:this.numDefaultEdges,objectType:r,nodeObjectType:this.objectType,hideAddRuleRow:this.hideAddRuleRow,alwaysShowDeleteIcon:this.alwaysShowDeleteIcon,customEdgeHiddenFilter:this.customEdgeHiddenFilter,getEdgeSelectionIconClass:this.getEdgeSelectionIconClass,disabled:this.disabled,disabledMessage:this.disabledMessage});if(this.$el.html(v),t&&t.length>0)for(let e of t){if("Configuration Error"===e.name&&!_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph)continue;const t=e.source||e.name,i=_LeanData._tooltip.criteriaNameToTooltipMap[_LeanData.FlowBuilderUtil.getFormattedEdgeName(t)]||_LeanData._tooltip.criteriaNameToTooltipMap[t];t&&i&&ld_initializeToolTip(this.$el.find("."+i.selector),{title:i.tooltipTitle,body:i.tooltipBody})}this.bindSorting(t);let y=this.model instanceof _LeanData.GraphModels.MatchNode||this.model instanceof _LeanData.GraphModels.TriggerNode||this.model instanceof _LeanData.GraphModels.ReroutingNode||this.model instanceof _LeanData.GraphModels.Decision_BranchNode||this.model instanceof _LeanData.GraphModels.Partner_ZoomInfo||_.isArray(this.model);const w=_.range(_LeanData.AppState.superPriorityExposed||_LeanData.AppState.isRoutingInsightsView?0:1,10);let T={0:"0 - Super",1:"1 - High",2:"2 - High",3:"3 - High",4:"4 - Med",5:"5 - Med",6:"6 - Med",7:"7 - Low",8:"8 - Low",9:"9 - Low"},D=this.model instanceof _LeanData.GraphModels.Decision_BranchNode;return this.$(".criteria-list-item").each(function(){var i=$(this).hasClass("criteria-list-default"),a=$(this).data("criteria-number"),n=t[a];y=y&&(!i||D);var o=$(this).find(".edge-label-column .edge-name-input");if(y)$(o).LDInput({validate:e.validateEdgeName.bind(e,n),style:"flex-direction: column;"}).on("LDInput:updated",e.updateEdgeName.bind(e));else{var l=_LeanData.FlowBuilderUtil.getFormattedEdgeName(o.val());o.replaceWith("<span>"+_.escape(l)+"</span>")}const r=_LeanData.FlowBuilderGraph.getNodeNamesToNodesMap();var d=_.cloneDeep(e.nextNodeNames);const c=d.filter(e=>r[e]&&r[e].get("isCollapsed")),h={};c.forEach(e=>h[e]="Unable to select a Target node in a collapsed group"),"Record Already Assigned to Active Pool Member"!=n.name&&"Existing Ownership"!=n.name&&"Multiple Matches"!=n.name||d.unshift(-2),$(this).find(".next-node-column-dropdown").each(function(){var t=new Magellan.Views.LDDropdown({value:n.target,options:d,required:!0,alignMenuRight:!0,placeholder:"None",disabledDescriptions:h,disabledOptions:c,optionTemplate:function(e){if(s[e])return s[e];if(-1===e)var t=_.template('<div class="dropdown-choice node-choice-end">END OF FLOW</div>');else t=null===e?_.template('<span class="text-muted">None</span>'):0===e?_.template('<div class="dropdown-choice node-choice-end">RESCHEDULE</div>'):-2==e?_.template("<i>&lt;Disabled&gt;</i>"):_.template("<span><%-option%></span>");return s[e]=t({option:e})},onChange:e.changeNextNode.bind(e,n)});t._filterByItems=function(e){e.push(-1),e.push(null),Magellan.Views.LDDropdown.prototype._filterByItems.call(this,e)},t.isValid=e.validateTarget.bind(e,n,t),$(this).html(t.$el),t.validate(),e.nextNodeDropdowns.push(t)}),$(this).find(".edge-priority-column").each(function(){var e=new Magellan.Views.LDDropdown({value:n.priority,options:w,required:!0,enableSearch:!1,alignMenuRight:!0,placeholder:"None",optionTemplate:function(e){return"<span>"+T[e]+"</span>"},onChange:function(e,t){n.priority=e}});$(this).html(e.$el)})}),ld_initializeToolTip(this.$el.find(".edge-priority-tooltip"),{title:"Routing Priorities",body:'View and compare <a href="#admin/settings/routing_priority" target="_blank" class="hoverLink" style="font-weight:400;">Routing Prioritization</a> for all FlowBuilder objects.\n\nIf prioritization is enabled, LeanData will process newly qualified records with your defined priorities.\n\n<i style="font-weight:400;line-height:1;">Example: If your organization always prioritizes â€˜Demo Requestsâ€™ over other records, the priority for this edge should be set higher than the other edges.</i>',clickableContent:!0,renderOnLeft:!0,width:"375px"}),_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:".delete-rule-icon",inputs:{iconName:"trashcan",iconSize:"large",iconVariation:"circle",hoverMode:"icon"}}),this}}),Magellan.Views.MultiConditionsList=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.context=e.context||new Backbone.Model,this.hideFieldValueColumn=e.hideFieldValueColumn||!1,this.isTrigger=e.isTrigger||!1,this.isCampaignMemberTrigger=e.isCampaignMemberTrigger||!1,this.isAdditionalObjectTrigger=e.isAdditionalObjectTrigger||!1,this.primaryObjectType=e.primaryObjectType||_LeanData.AppState.PrimarySObjectType,this.secondaryObjectType=e.secondaryObjectType,this.model.referenceFilters||(this.model.referenceFilters={type:"conditions",conditions:[],logic:"",rpnLogic:[],description:""}),this.model.referenceFilters.conditions||(this.model.referenceFilters.conditions=[],this.model.referenceFilters.rpnLogic=[],this.model.referenceFilters.logic=""),this.model.conditions&&0!==this.model.conditions.length||(this.model.conditions=[_LeanData.FlowBuilderUtil.createEmptyCondition()],this.model.rpnLogic=[1],this.model.logic="1"),this.isUpdateTrigger=e.isUpdateTrigger||!1,this.isValid=!0,this.matchedFieldColumnWidth=e.matchedFieldColumnWidth,this.operatorColumnWidth=e.operatorColumnWidth,this.valueFieldColumnWidth=e.valueFieldColumnWidth},template:_.template(i(238)),validate:function(){var e=!0;if(this.childViews&&0!==this.childViews.length)this.childViews.forEach(function(t){t instanceof Magellan.Views.ConditionsList&&(e=e&&t.isValid)});else{const t=this.isUpdateTrigger?_LeanData._blacklist.UPDATE_TRIGGER_BLACKLIST:null,i=this.model.referenceFilters;e=Magellan.Validation.validateIndividualEdgeConditions(this.secondaryObjectType,this.model.conditions,t),i.conditions.length>0&&(e=e&&Magellan.Validation.validateIndividualEdgeConditions("CampaignMember"===this.secondaryObjectType?"Object":this.primaryObjectType,i.conditions,t))}return this.isValid=e,this.trigger("validated",e),e},render:function(){this.removeAllChildViews();var e=this.template({primaryObjectType:this.primaryObjectType,secondaryObjectType:this.secondaryObjectType,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,filterType:this.filterType});this.$el.html(e);var t={};this.isCampaignMemberTrigger&&(t.status=_LeanData.FlowBuilderController.getCampaignMemberStatusByCampaignId);var i=this.$el.find("#reference-filters-div"),a=this.$el.find("#conditions-div"),n=new Magellan.Views.AdditionalTriggerObjectFiltersList({model:this.model.referenceFilters,context:this.context,objectType:this.primaryObjectType,hideFieldValueColumn:this.hideFieldValueColumn,isTrigger:this.isTrigger,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,enforceSoqlLogic:!0,conditionsOptional:!0,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth});this.listenTo(n,"validated",this.validate.bind(this,n)),this.childViews.push(n),i.html(n.render().$el);var o=new Magellan.Views.ConditionsList({model:this.model,context:this.context,objectType:this.secondaryObjectType,hideFieldValueColumn:this.hideFieldValueColumn,isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,enforceSoqlLogic:!0,fieldToAsyncServiceCallByMap:t,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth,showDescription:!1});return this.listenTo(o,"validated",this.validate.bind(this,o)),this.childViews.push(o),a.html(o.render().$el),this}}),Magellan.Views.ConditionsList=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.childViews=[],this.context=e.context||new Backbone.Model,this.hideFieldValueColumn=e.hideFieldValueColumn||!1,this.hideExtraRowHeaders=e.hideExtraRowHeaders||!1,this.isTrigger=e.isTrigger||!1,this.isTrueFalseNode=e.isTrueFalseNode||!1,this.isCampaignMemberTrigger=e.isCampaignMemberTrigger||!1,this.isAdditionalObjectTrigger=e.isAdditionalObjectTrigger||!1,this.objectType=e.objectType,this.overrideLeftObjectType=e.overrideLeftObjectType,this.overrideRightObjectType=e.overrideRightObjectType,this.showDescription="boolean"!=typeof e.showDescription||e.showDescription,this.conditionsOptional=e.conditionsOptional||!1,this.model||(this.model={}),this.model.conditions&&0!==this.model.conditions.length||this.isTrueFalseNode||(this.model.conditions=[_LeanData.FlowBuilderUtil.createEmptyCondition()],this.model.rpnLogic=[1],this.model.logic="1"),this.model.logic=this.model.logic.replace(/[^\w\s\(\)]/gi,""),this.isUpdateTrigger=e.isUpdateTrigger||!1,this.isValid=!0,this.doFlattenFields=e.isTrigger||e.doFlattenFields||this.node&&this.node.doFlattenFields||!1,this.rpnLogicIsValid=!0,this.enforceSoqlLogic=e.enforceSoqlLogic,this.fieldToAsyncServiceCallByMap=e.fieldToAsyncServiceCallByMap||{},this.customFieldFilter="function"==typeof e.customFieldFilter?e.customFieldFilter:null,this.autoScrollOnRender=e.autoScrollOnRender||null,this.conditionObjectType=e.conditionObjectType||null,this.onSuggestionsRendered=(e=>{if(this.autoScrollOnRender){let t=this.$el.find("#edit-rules-div"),i=e.$el.find(".tt-open .tt-dataset");i&&i.length>0&&t.scrollTop(t.scrollTop()+Math.abs(i.offset().top-i.height()))}}),this.matchedFieldColumnWidth=e.matchedFieldColumnWidth,this.operatorColumnWidth=e.operatorColumnWidth,this.valueFieldColumnWidth=e.valueFieldColumnWidth},template:_.template(i(230)),defaultLogic:function(){return _.range(1,this.model.conditions.length+1).join(" AND ")},addRule:function(e){e.preventDefault();var t=this.defaultLogic()===this.model.logic;this.model.conditions.push(_LeanData.FlowBuilderUtil.createEmptyCondition()),t||this.isUpdateTrigger?this.resetDefaultLogic():this.model.logic=this.model.logic+" AND "+this.model.conditions.length,this.render(),this.$el.trigger("LD_ConditionsList:changed",this)},deleteRule:function(e){if(this.conditionsOptional||this.model.conditions.length>1){var t=this.defaultLogic()===this.model.logic,i=$(e.currentTarget).data("rule-number");this.model.conditions.splice(i,1),this.render(),t||this.isUpdateTrigger?this.resetDefaultLogic():this.updateAndParseLogic()}this.$el.trigger("LD_ConditionsList:changed",this)},updateLogic:function(){this.model.logic=this.$(".rule-logic-input").val().replace(/[^\w\s\(\)]/gi,"")},parseLogic:function(){if(0===this.model.conditions.length)return this.model.logic="",this.model.rpnLogic=[],void(this.rpnLogicIsValid=!0);if(1===this.model.conditions.length)return this.model.logic="1",this.model.rpnLogic=[1],void(this.rpnLogicIsValid=!0);var e=_LeanData.FunctionUtil.parseTokenLogic(this.model.conditions.length,this.model.logic,this.enforceSoqlLogic);this.model.rpnLogic=e.RPNTokens,this.rpnLogicIsValid=0===e.feedbackMessage.length,e.feedbackMessage.length>0?(this.$(".rule-logic-input").css("box-shadow","0px 0px 2px 1px #d91e18"),this.$(".rule-logic-feedback").css("margin-top","4px"),this.$(".rule-logic-feedback").text(e.feedbackMessage[0])):(this.$(".rule-logic-input").css("box-shadow","none"),this.$(".rule-logic-feedback").css("margin-top","0px"),this.$(".rule-logic-feedback").text("")),this.model.logic!==this.defaultLogic()&&this.$(".reset-default-logic").removeClass("disabled")},resetDefaultLogic:function(){this.model.logic=this.defaultLogic(),this.$(".rule-logic-input").val(this.model.logic),this.$(".reset-default-logic").addClass("disabled"),this.updateAndParseLogic()},updateAndParseLogic:function(){this.updateLogic(),this.parseLogic(),this.$el.trigger("LD_ConditionsList:changed",this)},additionalEvents:{"click .add-rule-div, .add-trigger-rule-div":"addRule","click .delete-column":"deleteRule","change .rule-logic-input":"updateAndParseLogic","click .reset-default-logic":"resetDefaultLogic"},validate:function(){var e=!0;return this.childViews&&0!==this.childViews.length||this.render(),this.childViews.forEach(function(t){t instanceof Magellan.Views.SingleCondition&&(e=e&&t.isValid)}),this.parseLogic(),e=e&&this.rpnLogicIsValid,this.isValid=e,this.trigger("validated",e),e},render:function(){this.removeAllChildViews();const e=this.context instanceof _LeanData.GraphModels.TriggerNode&&window._LeanData.FlowBuilderGraph.nodeEditorCtrl?window._LeanData.FlowBuilderGraph.nodeEditorCtrl.getPartnerNameFromNodeType():null,t=_LeanData.AppState.PrimarySObjectType,i=_LeanData.StringUtil.pluralizeString(t);let a,n,o=e?`Select the <i>${e} Trigger</i> conditions you want to trigger <i>${t} Routing.</i>`:"";this.context instanceof _LeanData.GraphModels.Trigger_ClearbitEnrichment?(a="Clearbit Trigger Conditions",n="Use the suggested Clearbit fields to set up trigger conditions to orchestrate records based on Clearbit enrichment. New or updated enriched records can be surfaced to the right revenue team member for action."):this.context instanceof _LeanData.GraphModels.Trigger_CognismEnrichment?(a="Cognism Trigger Conditions",n="Use the suggested Cognism fields to set up trigger conditions to orchestrate records based on Cognism enrichment. Updated enriched records can be surfaced to the right revenue team member for action."):this.context instanceof _LeanData.GraphModels.Trigger_SixSenseIntent?(a="6sense Trigger Conditions",n=`Use the suggested 6sense ${t} fields to set up trigger conditions to orchestrate ${i} based on 6sense intent. New or updated ${i} showing intent can be surfaced to the right revenue team member for action.`):this.context instanceof _LeanData.GraphModels.Trigger_UserGemsTracking?(a="UserGems Trigger Conditions",n="Use the pre-selected or suggested UserGems fields to set up trigger conditions to orchestrate records based on UserGems tracking. New or updated records can be surfaced to the right revenue team member for action."):this.context instanceof _LeanData.GraphModels.Trigger_OtherEnrichment&&(a="Enrichment Trigger Conditions",n="Use specific Enrichment Vendor Fields to set up trigger conditions to orchestrate records based on enriched data. New or updated enriched records can be surfaced to the right revenue team member for action.",o=`Add specific conditions to Enrichment Vendor Fields to route Enriched ${t} matching the following Trigger Conditions`);var l=this.template({showLogic:(!this.isUpdateTrigger||this.isAdditionalObjectTrigger)&&this.model.conditions.length>1,isUpdateTrigger:this.isUpdateTrigger,logic:this.model.logic,disableDefaultButton:this.defaultLogic()===this.model.logic,description:this.model.description,showDescription:this.showDescription,partnerTriggerName:e,triggerConditionDescription:o,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger});this.$el.html(l);var s=this.$el.find("#edit-rules-div");return _.each(this.model.conditions,(e,t)=>{var i=new Magellan.Views.SingleCondition({context:this.context,model:e,ruleNum:t,objectType:this.objectType,overrideLeftObjectType:this.overrideLeftObjectType,overrideRightObjectType:this.overrideRightObjectType,conditionObjectType:this.conditionObjectType,hideExtraRowHeaders:this.hideExtraRowHeaders,isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,isLastCondition:t===this.model.conditions.length-1,isFirstCondition:0===t,isOnlyCondition:1==this.model.conditions.length,conditionsOptional:this.conditionsOptional,renderParent:this.render.bind(this),fieldToAsyncServiceCallByMap:this.fieldToAsyncServiceCallByMap,doFlattenFields:this.isTrigger||this.doFlattenFields||this.node&&this.node.doFlattenFields||!1,customFieldFilter:this.customFieldFilter,onSuggestionsRendered:this.onSuggestionsRendered,hideFieldValueColumn:this.hideFieldValueColumn,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth});this.listenTo(i,"validated",this.validate.bind(this)),i.$el.on("LD_SingleCondition:changed",()=>{this.$el.trigger("LD_ConditionsList:changed",this),this.checkDomainRelatedFieldsExist()}),this.childViews.push(i),s.append(i.render().$el),this.isAdditionalObjectTrigger&&t!==this.model.conditions.length-1&&s.append('<hr class="horizontal-line-separator-lt-grey-1">')}),ld_initializeToolTip(this.$el.find(".partner-trigger-tooltip"),{title:a,body:n}),this.checkDomainRelatedFieldsExist(),this},checkDomainRelatedFieldsExist:function(){if(!this.isUpdateTrigger&&!this.isCampaignMemberTrigger&&!this.hideExtraRowHeaders)return;let e=!1;this.model.conditions.forEach(t=>{["EMAIL","URL"].includes(t.type)&&(e=!0)});const t=this.context.get("secondary-object")||Magellan.Views.getAPIObjectNameFromObjectType(_LeanData.AppState.PrimarySObjectType),i=_LeanData._app.DOMAIN_MATCH_OBJECT_TYPES.includes(t);e&&i?this.$el.find(".wew-tooltip.ld-tooltip-hint").show():this.$el.find(".wew-tooltip.ld-tooltip-hint").hide()}}),Magellan.Views.AdditionalTriggerObjectFiltersList=Magellan.Views.ConditionsList.extend({initialize:function(e){if(this.childViews=[],this.context=e.context||new Backbone.Model,this.hideFieldValueColumn=e.hideFieldValueColumn||!1,this.hideExtraRowHeaders=e.hideExtraRowHeaders||!1,this.isTrigger=e.isTrigger||!1,this.isCampaignMemberTrigger=e.isCampaignMemberTrigger||!1,this.isAdditionalObjectTrigger=e.isAdditionalObjectTrigger||!1,this.objectType=e.objectType,this.showDescription="boolean"!=typeof e.showDescription||e.showDescription,this.conditionsOptional=e.conditionsOptional||!1,this.isUpdateTrigger=e.isUpdateTrigger||!1,this.isValid=!0,this.doFlattenFields=e.isTrigger||e.doFlattenFields||this.node&&this.node.doFlattenFields||!1,this.rpnLogicIsValid=!0,this.enforceSoqlLogic=e.enforceSoqlLogic,this.onSuggestionsRendered=(e=>{if(this.autoScrollOnRender){let t=this.$el.find("#edit-rules-div"),i=e.$el.find(".tt-open .tt-dataset");i&&i.length>0&&t.scrollTop(t.scrollTop()+Math.abs(i.offset().top-i.height()))}}),this.filterType=this.model&&this.model.conditions.length>0?"inclusion":"none",this.campaignFilterType="none",this.startRoutingObjectFilterIndex=0,this.model&&this.isCampaignMemberTrigger&&this.model.conditions.length>0){const e=this.model.conditions.findLastIndex(e=>"Campaign"===e["picklist object"]);-1!==e&&(this.campaignFilterType="inclusion"),this.startRoutingObjectFilterIndex=e+1,this.startRoutingObjectFilterIndex===this.model.conditions.length&&(this.filterType="none")}this.matchedFieldColumnWidth=e.matchedFieldColumnWidth,this.operatorColumnWidth=e.operatorColumnWidth,this.valueFieldColumnWidth=e.valueFieldColumnWidth,this._persistedReferenceFilters={conditions:[],rpnLogic:[],logic:""},this._presistedCampaignFilters=[]},template:_.template(i(228)),changeFilterType:function(e){const t=$(e.currentTarget).data("filter-type");this.filterType!==t&&(this.isCampaignMemberTrigger?"none"===t?this._persistedReferenceFilters.conditions=this.model.conditions.splice(this.startRoutingObjectFilterIndex,this.model.conditions.length-this.startRoutingObjectFilterIndex):this.model.conditions.splice(this.startRoutingObjectFilterIndex,0,...this._persistedReferenceFilters.conditions):"none"===t?(this._persistedReferenceFilters.conditions=this.model.conditions,this._persistedReferenceFilters.rpnLogic=this.model.rpnLogic,this._persistedReferenceFilters.logic=this.model.logic,this.model.conditions=[],this.model.rpnLogic=[],this.model.logic=""):(this.model.conditions=this._persistedReferenceFilters.conditions,this.model.rpnLogic=this._persistedReferenceFilters.rpnLogic,this.model.logic=this._persistedReferenceFilters.logic),"inclusion"===t&&0===this._persistedReferenceFilters.conditions.length&&(this.model.conditions.push({field:"",operand:"",operator:"equals"}),this.model.conditions.length>1&&(this.model.logic=this.model.logic+" AND "+this.model.conditions.length)),"inclusion"===t&&(this._persistedReferenceFilters.conditions=[],this._persistedReferenceFilters.rpnLogic=[],this._persistedReferenceFilters.logic=""),this.filterType=t,this.render(),this.$el.trigger("LD_ConditionsList:changed",this))},changeCampaignFilterType:function(e){const t=$(e.currentTarget).data("filter-type");this.campaignFilterType!==t&&("none"===t?(this._presistedCampaignFilters=this.model.conditions.splice(0,this.startRoutingObjectFilterIndex),this.startRoutingObjectFilterIndex=0):(this.model.conditions.splice(0,0,...this._presistedCampaignFilters),this.startRoutingObjectFilterIndex=this._presistedCampaignFilters.length,this._presistedCampaignFilters=[]),"inclusion"===t&&0===this.startRoutingObjectFilterIndex&&(this.model.conditions.splice(0,0,{field:"",operand:"",operator:"equals","picklist object":"Campaign"}),this.updateCampaignLogic(),1===this.model.conditions.length?this.model.logic="1":this.model.logic="1 AND "+this.model.logic,this.startRoutingObjectFilterIndex=1),this.campaignFilterType=t,this.render(),this.$el.trigger("LD_ConditionsList:changed",this))},addRule:function(e){const t=this.defaultLogic()===this.model.logic;let i;"campaign"===$(e.currentTarget).data("add-type")?(this.model.conditions.splice(this.startRoutingObjectFilterIndex,0,{field:"",operand:"",operator:"equals","picklist object":"Campaign"}),this.updateCampaignLogic(),this.startRoutingObjectFilterIndex++,i=this.startRoutingObjectFilterIndex):(this.model.conditions.push(_LeanData.FlowBuilderUtil.createEmptyCondition()),i=this.model.conditions.length),t||this.isUpdateTrigger?this.resetDefaultLogic():this.model.logic=this.model.logic+" AND "+i,this.render(),this.$el.trigger("LD_ConditionsList:changed",this)},deleteRule:function(e){if(this.conditionsOptional||this.model.conditions.length>1){var t=this.defaultLogic()===this.model.logic,i=$(e.currentTarget).data("rule-number");i<this.startRoutingObjectFilterIndex&&this.startRoutingObjectFilterIndex--,this.model.conditions.splice(i,1),0===this.startRoutingObjectFilterIndex&&(this.campaignFilterType="none"),this.startRoutingObjectFilterIndex===this.model.conditions.length&&(this.filterType="none"),this.render(),t||this.isUpdateTrigger?this.resetDefaultLogic():this.updateAndParseLogic()}this.$el.trigger("LD_ConditionsList:changed",this)},updateCampaignLogic:function(){let e="",t=0;[...this.model.logic.matchAll(/\d+/g)].forEach(i=>{let a=i[0],n=parseInt(a);n>this.startRoutingObjectFilterIndex&&n++,e+=this.model.logic.substring(t,i.index)+n,t=i.index+a.length}),this.model.logic=e+this.model.logic.substring(t)},additionalEvents:{"click #filter-radio-none-control, #filter-radio-include-control":"changeFilterType","click #campaign-filter-radio-none-control, #campaign-filter-radio-include-control":"changeCampaignFilterType","click .add-trigger-rule-div":"addRule","click .delete-column":"deleteRule","change .rule-logic-input":"updateAndParseLogic","click .reset-default-logic":"resetDefaultLogic"},validate:function(){var e=!0;return this.childViews&&0!==this.childViews.length||this.render(),this.childViews.forEach(function(t){t instanceof Magellan.Views.SingleCondition&&(e=e&&t.isValid)}),this.parseLogic(),e=e&&this.rpnLogicIsValid,this.isValid=e,this.trigger("validated",e),e},render:function(){this.removeAllChildViews();var e=this.template({showLogic:this.model.conditions.length>1,showAddCondition:"inclusion"==this.filterType,showCampaignAddCondition:"inclusion"==this.campaignFilterType,logic:this.model.logic,disableDefaultButton:this.defaultLogic()===this.model.logic,description:this.model.description,isCampaignMemberTrigger:this.isCampaignMemberTrigger,objectType:this.objectType,filterType:this.filterType,campaignFilterType:this.campaignFilterType});this.$el.html(e);var t=this.$el.find("#edit-rules-div");const i=this.$el.find("#edit-campaign-rules-div");return _.each(this.model.conditions,(e,a)=>{const n=a===this.startRoutingObjectFilterIndex-1||a===this.model.conditions.length-1;var o=new Magellan.Views.SingleCondition({context:this.context,model:e,ruleNum:a,objectType:this.isCampaignMemberTrigger&&a<this.startRoutingObjectFilterIndex?"Campaign":this.objectType,conditionObjectType:this.conditionObjectType,hideFieldValueColumn:this.hideFieldValueColumn,hideExtraRowHeaders:this.hideExtraRowHeaders,isTrigger:this.isTrigger,isUpdateTrigger:this.isUpdateTrigger,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,isLastCondition:n,isFirstCondition:0===a||a===this.startRoutingObjectFilterIndex,isOnlyCondition:1==this.model.conditions.length,conditionsOptional:this.conditionsOptional,renderParent:this.render.bind(this),doFlattenFields:this.isTrigger||this.doFlattenFields||this.node&&this.node.doFlattenFields||!1,onSuggestionsRendered:this.onSuggestionsRendered,matchedFieldColumnWidth:this.matchedFieldColumnWidth,operatorColumnWidth:this.operatorColumnWidth,valueFieldColumnWidth:this.valueFieldColumnWidth});this.listenTo(o,"validated",this.validate.bind(this)),o.$el.on("LD_SingleCondition:changed",()=>{this.$el.trigger("LD_ConditionsList:changed",this),this.checkDomainRelatedFieldsExist()}),this.childViews.push(o),this.isCampaignMemberTrigger&&a<this.startRoutingObjectFilterIndex?(i.append(o.render().$el),n||i.append('<hr class="horizontal-line-separator-lt-grey-1">')):(t.append(o.render().$el),n||t.append('<hr class="horizontal-line-separator-lt-grey-1">'))}),this.checkDomainRelatedFieldsExist(),this}}),Magellan.Views.SingleCondition=Magellan.Views.ButtonHandler.extend({isValid:!0,initialize:function(e){this.objectType=e.objectType,this.overrideLeftObjectType=e.overrideLeftObjectType||null,this.overrideRightObjectType=e.overrideRightObjectType||null,this.model=e.model,this.node=e.node||null,this.context=e.context||new Backbone.Model,this.isCampaignMemberTrigger=e.isCampaignMemberTrigger||!1,this.isAdditionalObjectTrigger=e.isAdditionalObjectTrigger||!1,this.isUpdateTrigger=e.isUpdateTrigger||!1,this.isTriggerNode=this.context instanceof _LeanData.GraphModels.TriggerNode,this.isReroutingNode=this.context instanceof _LeanData.GraphModels.ReroutingNode,this.ruleNum=e.ruleNum,this.fieldValueMap={field:null,value:null,operator:null,"picklist field":null,"picklist object":null},this.isLastCondition=e.isLastCondition||!1,this.isFirstCondition=e.isFirstCondition||!1,this.isOnlyCondition=e.isOnlyCondition||!1,this.conditionsOptional=e.conditionsOptional||!1,this.renderParent="function"==typeof e.renderParent?e.renderParent:()=>{},this.doFlattenFields=e.isTrigger||e.doFlattenFields||this.node&&this.node.doFlattenFields||!1,this.hideFieldValueColumn=e.hideFieldValueColumn||_LeanData.MetaDataController.getObjectMetaDataObject(this.objectType)||"Primary"===this.objectType||!1,this.hideExtraRowHeaders="boolean"==typeof e.hideExtraRowHeaders&&e.hideExtraRowHeaders,this.fieldToAsyncServiceCallByMap=e.fieldToAsyncServiceCallByMap||{},this.matchedObjectType=this.context.get("secondary-object");const t=this.context.get("nodeInfo");this.isPrimaryDecisionNode=t.objectType===_LeanData.AppState.PrimarySObjectType;const i=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService,a=_LeanData.StringUtil.debracketize(t.leftInputVariable);t.leftInputVariable&&i.getVariableByName(a)&&(this.matchedObjectType=i.getVariableByName(a).sObject||this.matchedObjectType),this.matchedObjectType=this.matchedObjectType||Magellan.Views.getAPIObjectNameFromObjectType(this.objectType),this.matchedObjectType=this.matchedObjectType||"",this.conditionObjectType=e.conditionObjectType||"",this.populateConditionObjects(),this.model["value/field"]&&!this.hideFieldValueColumn||(this.model["value/field"]="value"),this.isValid=!0,this.expandTextArea=_LeanData.Util.expandTextArea(30,50),this.collapseTextArea=_LeanData.Util.collapseTextArea(17),this.collapsedText=_LeanData.Util.truncateText(this.model.operand,25),this.expandedText=this.model.operand||"",this.SET_OF_VALID_FIELD_TYPE_MAPPING=_.cloneDeep(_LeanData._function.SFDC_VALID_TYPE_MAPPING),this.customFieldFilter="function"==typeof e.customFieldFilter?e.customFieldFilter:null,this.listenTo(this.context,"changeRightOperandField",this.changeRightOperandField.bind(this)),this.onSuggestionsRendered=e.onSuggestionsRendered,this.matchedFieldColumnWidth=e.matchedFieldColumnWidth,this.operatorColumnWidth=e.operatorColumnWidth,this.valueFieldColumnWidth=e.valueFieldColumnWidth},populateConditionObjects:function(){let e,t;this.conditionObjects={leftOperand:{objectName:null,label:null},operator:{label:"Operator"},rightOperand:{objectName:null,label:null}};const i=this.context.get("nodeInfo");let a,n;i&&i.relatedToType&&("primary"===i.relatedToType?(e=_LeanData.AppState.PrimarySObjectType,t=_LeanData.AppState.PrimarySObjectType):(e="variable"===i.relatedToType?_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService.getRootVariableSObjectType(i.relatedToValue):i.relatedToValue,t="variable"===i.relatedToType?e:"Matched "+e)),this.isTriggerNode&&("CampaignMember"===this.objectType?(a=this.objectType,n="Campaign Member"):"Campaign"===this.objectType?n=a=this.objectType:"Activity"===this.objectType&&(a=this.objectType,n="Activity"));let o=_LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType);var l=this.context.get("primary-object")||e||a||_LeanData.AppState.PrimarySObjectType,s=this.context.get("primary-object-label")||t||n||(o?o.label:_LeanData.AppState.PrimarySObjectType);this.isPrimaryDecisionNode&&(s="Meeting"===this.objectType?"Prospect Variable":_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService.getVariableByName(`routed ${_LeanData.AppState.PrimarySObjectType}`).label);var r=_LeanData.MetaDataController.getObjectMetaDataObject(this.matchedObjectType)?_LeanData.MetaDataController.getObjectMetaDataObject(this.matchedObjectType).label:this.matchedObjectType;this.context.get("secondary-object-label")?r=this.context.get("secondary-object-label"):this.doFlattenFields||!i||!i.type||"REROUTING"===i.type||"DECISION"==i.type&&_LeanData.MetaDataController.getObjectMetaDataObject(i.objectType)||(r="Matched "+r),this.hasVariables="Meeting"===l,l=this.hasVariables?_LeanData._function.VARIABLES_FIELDNAME:l;const d="Meeting"===this.matchedObjectType?_LeanData._function.VARIABLES_FIELDNAME:this.matchedObjectType;if(this.overrideLeftObjectType)if(i.leftInputVariable||i.rightInputVariable||"DECISION"===i.type&&"General"===i.objectType){const e=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService;let t,a=e.getVariableByName(_LeanData.StringUtil.debracketize(i.leftInputVariable||""));this.conditionObjects.leftOperand.objectName=a?a.sObject:"General"===i.objectType?_LeanData._function.VARIABLES_FIELDNAME:d,this.conditionObjects.leftOperand.excludeField="General"===i.objectType&&!a,this.conditionObjects.leftOperand.label=a?a.label:"General"===i.objectType?"Primitive Variable":r,i.isValueComparison?this.hideFieldValueColumn=!0:t=e.getVariableByName(_LeanData.StringUtil.debracketize(i.rightInputVariable||"")),this.conditionObjects.rightOperand.objectName=t?t.sObject:l,this.conditionObjects.rightOperand.label=t?t.label:s}else this.conditionObjects.leftOperand.objectName=this.overrideLeftObjectType,this.conditionObjects.leftOperand.label=_LeanData.MetaDataController.getObjectMetaDataObject(this.overrideLeftObjectType).label,this.conditionObjects.rightOperand.objectName=this.overrideRightObjectType,this.conditionObjects.rightOperand.label=_LeanData.MetaDataController.getObjectMetaDataObject(this.overrideRightObjectType).label,this.hideFieldValueColumn=!1;else if(i&&"HOLDUNTIL"===i.type)this.conditionObjectType=this.conditionObjectType||_LeanData.AppState.PrimarySObjectType,this.conditionObjects.leftOperand.objectName=this.conditionObjectType,this.conditionObjects.leftOperand.label=(!0===i.isEnrichmentNode?"Enriched ":"")+this.conditionObjectType,this.conditionObjects.rightOperand.objectName=this.conditionObjectType,this.conditionObjects.rightOperand.label=this.conditionObjectType;else if(this.context.get("reversed-condition-operands")||this.doFlattenFields||!this.matchedObjectType)this.conditionObjects.leftOperand.objectName=l,this.conditionObjects.leftOperand.label=s,this.conditionObjects.rightOperand.objectName=d,this.conditionObjects.rightOperand.label=r;else if(i&&(i.leftInputVariable||i.rightInputVariable||"DECISION"===i.type&&"General"===i.objectType)){const e=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService,t=_LeanData.StringUtil.debracketize(i.leftInputVariable),a=t&&e.getVariableByName(t);this.conditionObjects.leftOperand.objectName=a?a.sObject:d,this.conditionObjects.leftOperand.label=a?a.label:r,"General"!==i.objectType||t||(this.conditionObjects.leftOperand.excludeField=!0,this.conditionObjects.leftOperand.objectName="variables",this.conditionObjects.leftOperand.label="Primitive Variable");let n=i.rightInputVariable;i.isValueComparison?this.hideFieldValueColumn=!0:n=_LeanData.StringUtil.debracketize(n),this.conditionObjects.rightOperand.objectName=n&&e.getVariableByName(n)?e.getVariableByName(n).sObject:l,this.conditionObjects.rightOperand.label=n&&e.getVariableByName(n)?e.getVariableByName(n).label:s}else this.conditionObjects.leftOperand.objectName=d,this.conditionObjects.leftOperand.label=r,this.conditionObjects.rightOperand.objectName=l,this.conditionObjects.rightOperand.label=s},validateDropdownSelection:function(){let e,t=!0,i="",a=!1,n=this.overrideLeftObjectType||_LeanData.MetaDataController.getObjectMetaDataObject(this.conditionObjects.leftOperand.objectName,!0).caseSensitiveName||this.conditionObjects.leftOperand.objectName;if("value"===this.model["value/field"]){const e=this.isUpdateTrigger||this.context instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this.context instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment?_LeanData._blacklist.UPDATE_TRIGGER_BLACKLIST:null;t=null!==this.model.field&&Magellan.Validation.validateSingleCondition(this.model,n,this.conditionObjects.rightOperand.objectName,e,this.context),(Magellan.Validation.invalidCountryStateCodeField(this.model["picklist field"])||this.isTriggerNode&&"Lead"===n&&Magellan.Validation.invalidCountryStateField(this.model["picklist field"]))&&(t=!1,a=!0),this.$(".change-condition-value").toggleClass("input-invalid",!t)}else t=t&&Magellan.Validation.validateFieldTypeCondition(this.model,n,this.conditionObjects.rightOperand.objectName,this.context),Magellan.Validation.invalidCountryStateCodeField(this.model.operand)&&(t=!1,a=!0);if(["website & email","email domains"].includes(this.model.field)){const i=this.isReroutingNode&&!["Task","Event"].includes(this.conditionObjectType);_LeanData.Validation.getConditionOperators(this.model,this.matchedObjectType,{isTriggerNode:this.isTriggerNode,isUpdateTrigger:this.isUpdateTrigger,isReroutingNode:i}).includes(this.model.operator)||(e=_LeanData.StringUtil.capitalizeString(this.model.field,!0),"Account"===this.matchedObjectType&&"website & email"===this.model.field&&(e+=" Domains")),t=t&&!e}return t||(i=a?_LeanData._getOrganizationData().countryStateCodeEnabled?"Invalid Condition: State/Country fields cannot be used when State/Country picklists/codes are enabled. Use State/Country codes instead.":"Invalid Condition: State/Country codes cannot be used when they are disabled. Use State/Country fields instead.":e?`The "${e}" field is not compatible with the selected operator. Please select another field or operator.`:null!==this.model.field&&"has changed"===this.model.operator&&this.model.field.indexOf(".")>-1?'Invalid condition: The "has changed" operator is not supported for lookup object fields.':"Invalid condition: check for valid fields and compatible data types."),this.$(".error-message").html(i),t},changeMatchType:function(e){this.fieldValueMap[this.model["value/field"]]=this.model.operand,this.fieldValueMap.operator=this.model.operator,this.model["value/field"]=$(e.currentTarget).data("value"),this.model.operand=this.fieldValueMap[this.model["value/field"]],this.model.operator=this.fieldValueMap.operator,this.render(),this.$el.trigger("LD_SingleCondition:changed",this)},changeValue:function(e,t){var i=$(e.currentTarget).val();if(t instanceof Magellan.Views.NestedTypeaheadSelector)i=_.isEmpty(t.selection)?"":t.selection[0].label;else if(t instanceof Magellan.Views.LDDropdown)i=t.val();else if(i&&this.compareByValue&&("DATETIME"===this.model.type||"DATE"===this.model.type)&&!_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(this.expandedText,this.model.type,"Matched "+this.matchedObjectType+" Field")){var a=moment(i).utc();i=a.isValid()&&"DATETIME"===this.model.type?moment(i).format(_LeanData._datetime.DATETIME_FORMAT):i,i=a.isValid()&&"DATE"===this.model.type?moment(i).format(_LeanData._datetime.DATE_FORMAT):i}this.model.operand=i,this.validate(),this.$el.trigger("LD_SingleCondition:changed",this)},updateModelOnNestedDropdownChange:function(e,t){var i=t[t.length-1];if(_.isUndefined(i)||"REFERENCE"===i.type)return!1;var a=!1,n=t.reduce(function(e,i,n){return""!==e&&(e+="."),a=a||"ownerid"===i.name&&i.parent.length>1&&n<t.length-1,"REFERENCE"===i.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(i.name):e+i.name},"");this.doFlattenFields||(n=n.replace(/__r\.id$/,"__c").replace(/\.id$/,"id")),e.attributes&&e.attributes.isMatchedField?(this.model.type!==i.type&&(this.model.operand=""),this.conditionObjects.leftOperand.objectName===_LeanData._function.VARIABLES_FIELDNAME&&(n=_LeanData.StringUtil.bracketize(n)),this.model.field=n,this.model.type=i.type,this.model["picklist field"]=i.name,this.model["picklist object"]=i.objectType,a?this.model["left polymorphic"]=!0:delete this.model["left polymorphic"]):(this.doFlattenFields||this.conditionObjects.rightOperand.objectName===_LeanData._function.VARIABLES_FIELDNAME||(n=n.replace(/__r\.id$/,"__c").replace(/\.id$/,"id")),this.conditionObjects.rightOperand.objectName===_LeanData._function.VARIABLES_FIELDNAME&&(n=_LeanData.StringUtil.bracketize(n)),this.model.operand=n,this.model["operand type"]=i.type,a?this.model["right polymorphic"]=!0:delete this.model["right polymorphic"]);const o=t.reduce((e,t)=>(["Task","Event"].includes(t.objectType)&&(e=t.objectType),e),null);o?this.model.fieldObjectType=o:delete this.model.fieldObjectType,this.render(),this.$el.trigger("LD_SingleCondition:changed",this)},updateModelOnMultiNestedDropdownChange:function(e,t){var i=t[t.length-1];if(!_.isUndefined(i)&&"REFERENCE"===i.type)return!1;this.model.type;var a=t.map(function(e){return"REFERENCE"===e.type?_LeanData.TypeaheadUtil.flattenReferenceAPIs(e.name):e.name});e.attributes&&e.attributes.isMatchedField?(this.model.field=a,this.model.type=i?i.type:"undefined",this.model["picklist field"]=i.name,this.model["picklist object"]=i.objectType):(this.model.operand=a,this.model["operand type"]=i?i.type:"undefined"),this.validate(),this.$el.trigger("LD_SingleCondition:changed",this)},initializePicklistDropdown(){const e=this.conditionObjects.leftOperand.objectName;var t=_.isEmpty(this.model["picklist object"])?e:this.model["picklist object"],i=_.isEmpty(this.model["picklist field"])?this.model.field:this.model["picklist field"],a=_LeanData.MetaDataController.getCachedPicklistValues(t+i);null!=a&&(a=JSON.parse(a));var n={};n[t]=[];var o={type:this.model.type,root:t,onSelect:this.updateModelOnMultiNestedDropdownChange.bind(this),disableBreadcrumbs:!0,requireSelectionFromData:!1,required:!0,customValidationFunction:e=>{if(0===e.selection.length)return!1;if(!this.context.get("nodeInfo"))return!0;let t=!0;return e.selection.forEach(e=>{t=t&&Magellan.Validation.isValidMergeFieldValue(this.context.get("nodeInfo").name,e.name,"STRING",i)}),t},selection:null==this.model.operand?_LeanData.Util.convertStringSelectionToArray(""):_LeanData.Util.convertStringSelectionToArray(this.model.operand)};this.fieldToAsyncServiceCallByMap[i]?o.asyncServiceCall=this.fieldToAsyncServiceCallByMap[i]:(o.data=null==a?n:a,o.fetchData=null==a?_LeanData.MetaDataController.getPicklistFields.bind(null,t,i):null),this.rightOperandDropdown=new Magellan.Views.MultiNestedTypeaheadSelector(o)},updateOperator:function(e,t){var i=t.val();if(_LeanData._function.UNARY_OPERATORS.has(i)?(this.oldOperand=this.model.operand,delete this.model.operand):_LeanData._function.UNARY_OPERATORS.has(this.model.operator)&&!_.isEmpty(this.oldOperand)&&(this.model.operand=this.oldOperand),"PICKLIST"==this.model.type){let e=new Set(["equals","not equal to"]);e.has(i)!==e.has(this.model.operator)&&(this.model.operand=null)}this.model.operator=i,this.render(),this.$el.trigger("LD_SingleCondition:changed",this)},populateSelectableMetaData:function(e,t,i){if(this.doFlattenFields?(selectableMetaData={},selectableMetaDataMap={},selectableMetaData[i]=_LeanData.MetaDataController.getFlattenedFieldsByObject(i),selectableMetaDataMap[i]=_LeanData.MetaDataController.getFlattenedFieldsMapByObject(i)):(selectableMetaData=e,selectableMetaDataMap=_LeanData.MetaDataController.getFieldMetaDataMap()),this.context instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment&&(selectableMetaData[i]=_LeanData.MetaDataController.orderEnrichmentFieldsMetadata(i,selectableMetaData[i])),this.isUpdateTrigger||this.context instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this.context instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment||this.context instanceof _LeanData.GraphModels.Partner_ZoomInfo){const e=function(e){return _.filter(e,function(e){return!e.isFormula&&!_LeanData._blacklist.UPDATE_TRIGGER_BLACKLIST.has(e.name)})};selectableMetaData[i]=e(selectableMetaData[i]),selectableMetaDataMap[i]=e(selectableMetaDataMap[i])}return t&&this.renderParent(),[selectableMetaData,selectableMetaDataMap]},additionalEvents:{"change input[type=radio].match-type":"changeMatchType","click span.value-field-selector":"changeMatchType","change .change-condition-value":"changeValue","focus .change-condition-value.lds-textarea-small":"expandTextAreaTrigger","blur .change-condition-value.lds-textarea-small":"collapseTextAreaTrigger"},expandTextAreaTrigger:function(e){this.expandedText!==this.collapsedText&&(e.target.value=this.expandedText),this.expandTextArea.call(e.target)},collapseTextAreaTrigger:function(e){this.expandedText=e.target.value,this.collapsedText=_LeanData.Util.truncateText(this.expandedText,28),this.collapseTextArea.call(e.target),e.target.value=this.collapsedText},changeRightOperandField:function(e){this.populateConditionObjects(),this.render()},validate:function(){var e=this.validateDropdownSelection();return this.matchedFieldDropdown&&this.matchedFieldDropdown.validate(),this.operatorDropdown&&this.operatorDropdown.validate(),this.rightOperandDropdown&&this.rightOperandDropdown.validate(),this.isValid=e,this.trigger("validated",e),e},template:_.template(i(248)),calculateColumnWidths:function(e,t,i,a){return t=t?`width:${t}px;`:e?"width:175px;":"width:150px;",i=i?`width:${i+10}px;flex:unset;max-width:${i+10}px;`:"width:190px;",a&&(a=`width:${a}px;`),{matchedFieldColumnWidth:t,operatorColumnWidth:i,valueFieldColumnWidth:a}},render:function(){this.matchedFieldDropdown&&this.matchedFieldDropdown.remove(),this.operatorDropdown&&this.operatorDropdown.remove(),this.rightOperandDropdown&&this.rightOperandDropdown.remove(),this.context instanceof _LeanData.GraphModels.Partner_ZoomInfo&&(this.model.operator="has changed",this.conditionObjects.operator.label=" "),this.compareByValue="value"===this.model["value/field"];var{matchedFieldColumnWidth:e,operatorColumnWidth:t,valueFieldColumnWidth:i}=this.calculateColumnWidths(this.hideFieldValueColumn,this.matchedFieldColumnWidth,this.operatorColumnWidth,this.valueFieldColumnWidth),a=this.template({condition:this.model,ruleNum:this.ruleNum,dropdownValid:this.validateDropdownSelection(),matchedObjectType:this.matchedObjectType,hideFieldValueColumn:this.hideFieldValueColumn,hideExtraRowHeaders:this.hideExtraRowHeaders,useBooleanDropdown:this.compareByValue&&"BOOLEAN"===this.model.type,isCampaignMemberTrigger:this.isCampaignMemberTrigger,isUpdateTrigger:this.isUpdateTrigger,isAdditionalObjectTrigger:this.isAdditionalObjectTrigger,isLastCondition:this.isLastCondition,isFirstCondition:this.isFirstCondition,isOnlyCondition:this.isOnlyCondition,conditionsOptional:this.conditionsOptional,conditionObjects:this.conditionObjects,isNewTrigger:!!(this.context&&this.context.nodeInfo&&this.context.nodeInfo.type&&this.context.nodeInfo.type.includes("TRIGGER")),isTimebasedNode:!(!this.context||!this.context.nodeInfo||"REROUTING"!==this.context.nodeInfo.type),usePicklistDropdown:this.compareByValue&&"PICKLIST"===this.model.type&&("equals"===this.model.operator||"not equal to"===this.model.operator),useMultiPicklistDropdown:this.compareByValue&&"MULTIPICKLIST"===this.model.type&&["equals","not equal to","includes","excludes"].includes(this.model.operator),hasVariables:this.hasVariables,objectType:this.objectType,unaryOperators:_LeanData._function.UNARY_OPERATORS,matchedFieldColumnWidth:e,operatorColumnWidth:t,valueFieldColumnWidth:i});this.$el.html(a);const n=!!this.model.field&&this.model.field.split(".").length>1,o=_LeanData._app.DOMAIN_MATCH_OBJECT_TYPES.includes(this.matchedObjectType);(["EMAIL","URL"].includes(this.model.type)||_LeanData._function.DOMAIN_MATCH_SUPPORTING_PRESET_VARIABLES.has(this.model.field))&&o&&!n?(ld_initializeToolTip(this.$el.find(".wew-tooltip.ld-tooltip-hint"),{title:"Fuzzy Match Operator",body:'The "Fuzzy Matches" operator appears whenever Website and/or Email Domain fields are selected. This operator will use domain relationships to broaden the scope of potential matches.',width:"250px"}),this.$el.find(".hint-message").show(),this.$el.find(".hint-message").html("Public domains are not considered with exact/fuzzy match operators. Use <i>equals</i> to directly compare public domains.")):(this.$el.find(".wew-tooltip.ld-tooltip-hint").hide(),this.$el.find(".hint-message").hide());const l=this.context.get("nodeInfo"),s=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService;let r;const d=_LeanData.StringUtil.debracketize(l.leftInputVariable);var c=[r=d&&s.getVariableByName(d)?s.getVariableByName(d).sObject:_LeanData.MetaDataController.getObjectMetaDataObject(this.conditionObjects.leftOperand.objectName,!0).caseSensitiveName||this.conditionObjects.leftOperand.objectName],[h,p]=this.populateSelectableMetaData(fieldMetaData,!1,r),u=_LeanData.Util.createBlacklistFilter(),m=_LeanData.Util.createOwnerToOwnerMappingFilter();const g=_LeanData.Util.createBlacklistFilter("TRIGGER_TASK");let f=_LeanData.Util.getDynamicFieldMetaData(r,null,_.cloneDeep(h),null);const b=_LeanData.StringUtil.debracketize(l.rightInputVariable);l.rightInputVariable&&s.getVariableByName(b)&&(sObjectType=s.getVariableByName(b).sObject);const v=_LeanData.Util.createPrimitiveVariableFilter(),y=r===_LeanData._function.VARIABLES_FIELDNAME;var w=this.matchedFieldDropdown=new Magellan.Views.NestedTypeaheadSelector({root:r,getDynamicData:(e,t,i)=>{if(t&&i){const e=this.populateSelectableMetaData(t,i,this.conditionObjects.leftOperand.objectName)[0];f=_LeanData.Util.getDynamicFieldMetaData(r,null,_.cloneDeep(e),null)}const a=f(e),n=_.cloneDeep(a);return!(e&&e.length>0&&_LeanData.Util.isReference(e[0]))&&this.matchedObjectType in n&&n[this.matchedObjectType].push(..._LeanData._function.getDomainFieldMetadata(this.matchedObjectType)),n},onSelect:this.updateModelOnNestedDropdownChange.bind(this),required:!0,aliases:{"User.id":"Group/User.id","Group.id":"Group/User.id","Task.id":"Task/Event.id","Event.id":"Task/Event.id"},attributes:{isMatchedField:!0},currentTextValue:this.model.field,selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.field,r,p,_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),this.model["picklist object"]),filter:e=>(e=e.filter(e=>!e.contextType||c.includes(e.label)),e=u(e),e=m(e),(this.isTriggerNode||this.isReroutingNode)&&(e=g(e)),this.customFieldFilter&&(e=this.customFieldFilter(e)),y&&(e=v(e)),e)});this.matchedFieldDropdown.$el.on("nestedTypeaheadSelector:onSuggestionsRendered",e=>{this.onSuggestionsRendered&&this.onSuggestionsRendered(this.matchedFieldDropdown)}),this.$(".matched-field-column .nested-dropdown-container").html(w.$el);const T=this.isReroutingNode&&!["Task","Event"].includes(this.conditionObjectType),D=this.context instanceof _LeanData.GraphModels.DecisionNode?_LeanData.AppState.PrimarySObjectType:this.matchedObjectType,C=_LeanData.Validation.getConditionOperators(this.model,D,{isTriggerNode:this.isTriggerNode,isUpdateTrigger:this.isUpdateTrigger,isReroutingNode:T}),S=$(this.$(".operator-column .operator-dropdown"));if(this.context instanceof _LeanData.GraphModels.Partner_ZoomInfo?S.html(`<div style="display: flex;height: 100%;align-items: center;">${this.model.operator}</div>`):(S.LDDropdown({options:C,optionTemplate:e=>`<span>${_LeanData.FlowBuilderUtil.datatypeToOperatorLabel(e,this.model.type)}</span>`,value:this.model.operator,required:!0}),S.on("LDDropdown:change",this.updateOperator.bind(this))),this.compareByValue)switch(this.model.type){case"BOOLEAN":const e=$(this.$(".value-field-column .right-operand-dropdown"));e.LDDropdown({options:[!0,!1],value:this.model.operand,required:!0}),e.on("LDDropdown:change",this.changeValue.bind(this)),this.operatorDropdown=e.LDDropdown("LDDropdown");break;case"MULTIPICKLIST":case"PICKLIST":if(["equals","not equal to","includes","excludes"].includes(this.model.operator))this.initializePicklistDropdown(),this.$el.find("#right-operand-dropdown").html(this.rightOperandDropdown.$el);else if("is null"!==this.model.operator&&"not null"!==this.model.operator)var M="Input the API Name of the Value(s)";this.$(".change-condition-value").attr("placeholder",M);break;case"DATE":case"DATETIME":_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(this.expandedText,this.model.type,"Matched "+this.matchedObjectType+" Field")||moment.utc(this.model.operand).isValid()||this.$(".value-field-container input.change-condition-value").toggleClass("input-invalid",!0).val(this.model.operand);const t=$(this.$el).find(".value-field-container input.change-condition-value");t&&t.datepicker("destroy").removeClass("hasDatepicker"),"DATE"===this.model.type?t.datepicker({dateFormat:"yy-mm-dd"}):t.datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",timeInput:!0,showHour:!1,showMinute:!1,showSecond:!1}),t.on("change",this.changeValue.bind(this))}else if("field"===this.model["value/field"]){this.model.field&&this.model.field.toLowerCase();var L="Meeting"===this.conditionObjects.rightOperand.objectName?_LeanData._function.VARIABLES_FIELDNAME:this.conditionObjects.rightOperand.objectName,I=_LeanData.Validation.isWewEnabledForCondition(this.model,this.matchedObjectType)&&_LeanData._function.DOMAIN_MATCH_OPERATORS.includes(this.model.operator)?"wew":_LeanData._function.SFDC_TYPE_TO_GROUPING[this.model.type],O=(u=_LeanData.Util.createBlacklistFilter(),_LeanData.Util.createFieldsFilter(I));m=_LeanData.Util.createOwnerToOwnerMappingFilter();const e=_LeanData.Util.createPrimitiveVariableFilter(),t="Meeting"===_LeanData.AppState.PrimarySObjectType&&L===_LeanData._function.VARIABLES_FIELDNAME;this.rightOperandDropdown&&this.rightOperandDropdown.remove();const i=_LeanData.FlowBuilderGraph.nodeEditorCtrl.variablesService,a=this.context.get("nodeInfo"),n=_LeanData.StringUtil.debracketize(a.rightInputVariable);a.rightInputVariable&&i.getVariableByName(n)&&(L=i.getVariableByName(n).sObject);const o=_LeanData.Util.getDynamicFieldMetaData(L,null,_.cloneDeep(h),null);var x=this.rightOperandDropdown=new Magellan.Views.NestedTypeaheadSelector({root:L,getDynamicData:e=>{const t=o(e),i=_.cloneDeep(t),a=this.conditionObjects.rightOperand.objectName;return"wew"===I&&a in i&&i[a].push(..._LeanData._function.getDomainFieldMetadata(a)),i},onSelect:this.updateModelOnNestedDropdownChange.bind(this),required:!0,aliases:{"User.id":"Group/User.id","Group.id":"Group/User.id","Task.id":"Task/Event.id","Event.id":"Task/Event.id"},attributes:{isMatchedField:!1},filter:function(i){return i=u(i),i=O(i),i=m(i),t&&(i=e(i)),i},currentTextValue:this.model.operand,selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.operand,L,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap(),this.model["picklist object"])});this.$(".value-field-column .right-operand-dropdown").html(x.$el),x.$el.on("nestedTypeaheadSelector:select",this.changeValue.bind(this))}if(null!=this.context.nodeInfo&&!this.isReroutingNode){const e=this.context instanceof _LeanData.GraphModels.DecisionNode||this.context instanceof _LeanData.GraphModels.MatchNode;this.context.isComparison=!0;var V=Magellan.Controllers.VariableCreator.createVariableInsertButton(this.context,w,e=>{if("PICKLIST"!==this.model.type||"equals"!==this.model.operator&&"not equal to"!==this.model.operator){var t=this.$el.find(".value-field-column .change-condition-value")[0].selectionStart,i=this.$el.find(".value-field-column .change-condition-value").val(),a=i.substring(0,t)+e+i.substring(t);this.$el.find(".value-field-column .change-condition-value").val(a).trigger("change")}else Array.isArray(this.model.operand)||(this.model.operand=[]),this.model.operand.push(e),this.initializePicklistDropdown(),this.$el.find("#right-operand-dropdown").html(this.rightOperandDropdown.$el),this.rightOperandDropdown.validate();this.validate()},!0,null,e);this.$el.find(".merge-field-insert-button-container").html(V.$el)}return this.validate(),this}}),Magellan.Views.SoqlRule=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType,this.primaryObjectType=_LeanData.AppState.PrimarySObjectType||null,this.overrideLeftObjectType=e.overrideLeftObjectType||null,this.errorMessage=""},additionalEvents:{"blur .change-parameter-input":"callValidateSOQL"},callValidateSOQL:function(){var e=this;if(_.isEmpty(this.model.soqlCondition))return e.model.isValid=!1,e.errorMessage="",void e.$el.find(".soqlFeedback").text(e.errorMessage);const t=JSON.stringify({"match type":this.objectType,"query condition":this.model.soqlCondition,primarySObjectType:this.primaryObjectType,overrideLeftObjectType:this.overrideLeftObjectType});_LeanData.FlowBuilderController.validateSOQL(t).then(function(t){if(t.success)e.model.isValid=!0,e.render(),e.$el.find(".soqlFeedback").text(""),e.errorMessage="",e.$el.trigger("LD_SoqlRule:changed",e);else{const i=t.errorMessage||"";e.model.isValid=!1,e.render(),e.$el.find(".soqlFeedback").text(i),e.errorMessage=i,e.$el.trigger("LD_SoqlRule:changed",e)}})},template:_.template(i(250)),render:function(){var e=this.template({soqlCondition:this.model.soqlCondition,description:this.model.description,isValid:this.model.isValid});return this.$el.html(e),this}}),Magellan.Views.OptimaView=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType,this.overrideObjectType=e.overrideObjectType,this.hideOptimaFields=e.hideOptimaFields||!1},template:_.template(i(237)),update:function(e,t){var i=t.reduce(function(e,t){return""!==e&&(e+="."),"REFERENCE"===t.type?e+_LeanData.TypeaheadUtil.flattenReferenceAPIs(t.name):e+t.name},"");this.model.field=i;const a=t.reduce((e,t)=>(["Task","Event"].includes(t.objectType)&&(e=t.objectType),e),null);a?this.model.fieldObjectType=a:delete this.model.fieldObjectType},render:function(){var e=this.overrideObjectType||Magellan.Views.getAPIObjectNameFromObjectType(this.objectType),t=_LeanData.MetaDataController.getOptimaFieldMetaData();this.hideOptimaFields&&(t=_.mapValues(t,e=>e.filter(e=>!("name"in e&&e.name.startsWith("#")))));var i=_LeanData.Util.convertFieldSelectionStringToArray(this.model.field,e,_LeanData.MetaDataController.getOptimaFieldMetaDataMap()),a=this.template({condition:this.model,optimaFields:t});this.$el.html(a);var n=new Magellan.Views.NestedTypeaheadSelector({data:t,root:e,onSelect:this.update.bind(this),required:!0,currentTextValue:this.model.field,selection:i});return this.$(".nested-dropdown-container").html(n.$el),this.$el.trigger("parameter:update"),this}}),Magellan.Views.CustomRule=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.objectType=e.objectType},template:_.template(i(232)),render:function(){var e=this.template({customParameter:null!=this.model?this.model.parameter:""});return this.$el.html(e),this}}),Magellan.Views.CreateTask=Backbone.View.extend({initialize:function(e){},template:_.template(i(260)),render:function(){var e=this.template({});this.$el.html(e);var t=new Magellan.Views.CreateObjectRadioOptions({model:this.model});this.$el.find("#create-task-radio-options-wrapper").html(t.render().$el).append('<hr class="horizontal-line-separator">'),_LeanData.FlowBuilderController.getTaskFieldValues().then(e=>{var t=new Magellan.Views.OtherCreateObjectFields({model:this.model,objectFieldValues:e});this.$el.find("#other-task-fields-wrapper").html(t.render().$el).append('<hr class="horizontal-line-separator">')});var i=new Magellan.Views.AdditionalCreateObjectFields({model:this.model});this.$el.find("#additional-task-fields-wrapper").html(i.render().$el);var a=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(a.render().$el),this}}),Magellan.Views.OutreachAddToSequence=Backbone.View.extend({initialize:function(e){},toggleOwnership:function(e){this.model.nodeInfo.updateOwnership=$(e.currentTarget).is(":checked"),this.model.nodeInfo.updateOwnership?this.$el.find(".update-owner-type").show():this.$el.find(".update-owner-type").hide()},events:{"click #refresh-sequences-typeahead":"refreshSequencesData","click #refresh-users-typeahead":"refreshUsersData","change #update-ownership":"toggleOwnership"},template:_.template(i(266)),initializeSequencesTypeahead:function(){const e={selector:"ld-typeahead-angular#outreach-sequences-typeahead",inputs:{required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchOutreachSequences,placeholder:"Find and Select a Sequence",selections:this.model.nodeInfo.sequenceSelection},events:{onSelect:e=>{this.model.nodeInfo.sequenceSelection=e}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},checkSequenceRenaming:function(){const e=this.model.nodeInfo.sequenceSelection[0]&&this.model.nodeInfo.sequenceSelection[0].id||"";return _LeanData.FlowBuilderController.queryOutreachSequences(e).then(e=>{if(e.length>0&&this.model.nodeInfo.sequenceSelection.length>0){const t=e[e.length-1];this.model.nodeInfo.sequenceSelection[0].id===t.id&&(this.model.nodeInfo.sequenceSelection[0].label=this.model.nodeInfo.sequenceSelection[0].name=t.name)}})},checkUserRenaming:function(){const e=this.model.nodeInfo.userSelection[0]&&this.model.nodeInfo.userSelection[0].id||"";return _LeanData.FlowBuilderController.queryOutreachUsers(e).then(e=>{if(e.length>0&&this.model.nodeInfo.userSelection.length>0){const t=e[e.length-1];this.model.nodeInfo.userSelection[0].id===t.id&&(this.model.nodeInfo.userSelection[0].label=this.model.nodeInfo.userSelection[0].name=t.name)}})},initializeUsersTypeahead:function(){const e={selector:"ld-typeahead-angular#outreach-users-typeahead",inputs:{required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchOutreachUsers,placeholder:"Find and Select a User",selections:this.model.nodeInfo.userSelection||[]},events:{onSelect:e=>{this.model.nodeInfo.userSelection=e}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},initializeCustomUserFieldTypeahead:function(e){const t={selector:"ld-typeahead-angular#custom-user-field-typeahead",inputs:{required:!0,data:fieldMetaData,nestingRoot:e,placeholder:"Find and Select a User Field",selections:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserField,e,_LeanData.MetaDataController.getFieldMetaDataMap()),filter:t=>(t=_LeanData.Util.createBlacklistFilter(e)(t),t=_LeanData.Util.createUserFieldsFilter()(t))},events:{onSelect:e=>{this.model.nodeInfo.customUserField=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e)}}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)},initializeOwnersTypeahead:function(){const e={selector:"ld-typeahead-angular#outreach-owners-typeahead",inputs:{required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchOutreachUsers,placeholder:"Find and Select a User",selections:this.model.nodeInfo.ownerSelection||[]},events:{onSelect:e=>{this.model.nodeInfo.ownerSelection=e}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},initializeCustomUserOwnerFieldTypeahead:function(e){const t={selector:"ld-typeahead-angular#custom-owner-field-typeahead",inputs:{required:!0,data:fieldMetaData,nestingRoot:e,placeholder:"Find and Select a User Field",selections:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserOwnerField,e,_LeanData.MetaDataController.getFieldMetaDataMap()),filter:t=>(t=_LeanData.Util.createBlacklistFilter(e)(t),t=_LeanData.Util.createUserFieldsFilter()(t))},events:{onSelect:e=>{this.model.nodeInfo.customUserOwnerField=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e)}}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)},render:function(){_LeanData.RemotingRouter.outreach_validateProspectsScope().then(e=>{e||(this.$el.find(".reauth-warning").show(),this.$el.find(".ownership-checkbox-label").addClass("med-grey-1"),this.$el.find(".ownership-checkbox").prop("disabled",!0),this.$el.find(".ownership-checkbox").prop("checked",!1),this.$el.find(".update-owner-type").hide(),this.model.nodeInfo.updateOwnership=!1)});const e=this.template({authorized:_LeanData.MetaDataController.getPartnerAuthorization("outreach"),showOwnership:this.model.nodeInfo.updateOwnership});this.$el.html(e),this.model.nodeInfo.updateOwnership||this.$el.find(".update-owner-type").hide(),this.$el.find(".reauth-warning").hide();var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkSequenceRenaming().then(()=>{this.initializeSequencesTypeahead()}),this.checkUserRenaming().then(()=>{this.initializeUsersTypeahead(),this.initializeOwnersTypeahead()}),"specific"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-user-field-typeahead-container").hide(),this.initializeCustomUserFieldTypeahead("Lead"),this.initializeCustomUserOwnerFieldTypeahead("Lead"),$(this.$el.find("#radio-record-owner")).LDRadioButton({label:"Lead Owner",checked:"owner"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").hide(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-specific-user")).LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").show(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-custom-user-field")).LDRadioButton({label:"User Field on Lead",checked:"customField"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-user-field-typeahead-container").show(),this.$el.find("#outreach-users-typeahead-container").hide()}}),"specific"!==this.model.nodeInfo.ownershipSelection&&this.$el.find("#outreach-owners-typeahead-container").hide(),"customField"!==this.model.nodeInfo.ownershipSelection&&this.$el.find("#outreach-owner-field-typeahead-container").hide(),$(this.$el.find("#radio-record-ownership")).LDRadioButton({label:"Lead Owner",checked:"owner"===this.model.nodeInfo.ownershipSelection,name:"ownership-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.ownershipSelection=e,this.$el.find("#outreach-owners-typeahead-container").hide(),this.$el.find("#outreach-owner-field-typeahead-container").hide()}}),$(this.$el.find("#radio-specific-owner")).LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.ownershipSelection,name:"ownership-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.ownershipSelection=e,this.$el.find("#outreach-owners-typeahead-container").show(),this.$el.find("#outreach-owner-field-typeahead-container").hide()}}),$(this.$el.find("#radio-custom-owner-field")).LDRadioButton({label:"User Field on Lead",checked:"customField"===this.model.nodeInfo.ownershipSelection,name:"ownership-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.ownershipSelection=e,this.$el.find("#outreach-owner-field-typeahead-container").show(),this.$el.find("#outreach-owners-typeahead-container").hide()}}),ld_initializeToolTip(this.$el.find(".mailbox-user-tooltip.ld-tooltip-hint"),{title:"Select Corresponding User",body:'Select the user who will communicate with the prospect and whose mailbox will send automated emails (if applicable). If the selected user does not exist in Outreach or does not have a default mailbox with sending enabled, the Add to Sequence action will fail.<br><br><i style="font-weight: inherit;">Note that queue ownership is not supported at this time.</i>'}),ld_initializeToolTip(this.$el.find(".owner-user-tooltip.ld-tooltip-hint"),{title:"Outreach Ownership Assignment",body:'The Outreach prospect`s owner will be updated to the corresponding user.<br><i style="font-weight: inherit;">Note this is not required to Add Prospect to a Sequence.</i>'}),this},refreshSequencesData:function(){_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0),_LeanData.MetaDataController.getPartnerAuthorization("outreach")&&"OFF"!==_LeanData.MetaDataController.getPartnerNodeAuthorization("outreachAddToSequence").state?_LeanData.FlowBuilderController.outreach_refreshSequencesData().then(()=>{this.initializeSequencesTypeahead(),_LeanData.MetaDataController.resetPartnerMetaDataCache("outreach_sequences")}).finally(()=>{_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)}):_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)},refreshUsersData:function(){_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0),_LeanData.MetaDataController.getPartnerAuthorization("outreach")&&"OFF"!==_LeanData.MetaDataController.getPartnerNodeAuthorization("outreachAddToSequence").state?_LeanData.FlowBuilderController.outreach_refreshUsersData(!0).then(()=>{this.usersTypeahead.refreshBloodhoundData()}).finally(()=>_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)):_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)}}),Magellan.Views.SalesloftAddToCadence=Backbone.View.extend({initialize:function(e){_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0)},events:{"click #refresh-cadences-typeahead":"refreshCadencesData","click #refresh-users-typeahead":"refreshUsersData"},template:_.template(i(268)),initializeCadencesTypeahead:function(){const e={selector:"ld-typeahead-angular#salesloft-cadences-typeahead",inputs:{required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchSalesloftCadences,placeholder:"Find and Select a Cadence",selections:this.model.nodeInfo.cadenceSelection},events:{onSelect:e=>{this.model.nodeInfo.cadenceSelection=e,this.checkCadenceRenaming()}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},initializeUsersTypeahead:function(){const e={selector:"ld-typeahead-angular#salesloft-users-typeahead",inputs:{required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchSalesloftUsers,placeholder:"Find and Select a User",selections:this.model.nodeInfo.userSelection||[]},events:{onSelect:e=>{this.model.nodeInfo.userSelection=e}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},initializeCustomUserFieldTypeahead:function(e){const t={selector:"ld-typeahead-angular#custom-user-field-typeahead",inputs:{required:!0,data:fieldMetaData,nestingRoot:e,placeholder:"Find and Select a User Field",selections:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo.customUserField,e,_LeanData.MetaDataController.getFieldMetaDataMap()),filter:t=>(t=_LeanData.Util.createBlacklistFilter(e)(t),t=_LeanData.Util.createUserFieldsFilter()(t))},events:{onSelect:e=>{this.model.nodeInfo.customUserField=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e)}}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)},render:function(){const e=this.template({authorized:_LeanData.MetaDataController.getPartnerAuthorization("salesloft")});this.$el.html(e);var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkCadenceRenaming().then(()=>{this.initializeCadencesTypeahead()}),this.initializeUsersTypeahead(),"specific"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-user-field-typeahead-container").hide(),this.initializeCustomUserFieldTypeahead("Lead"),$(this.$el.find("#radio-record-owner")).LDRadioButton({label:"Lead Owner",checked:"owner"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").hide(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-specific-user")).LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").show(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-custom-user-field")).LDRadioButton({label:"User Field on Lead",checked:"customField"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-user-field-typeahead-container").show(),this.$el.find("#salesloft-users-typeahead-container").hide()}}),ld_initializeToolTip(this.$el.find(".assignee-user-tooltip.ld-tooltip-hint"),{title:"Select User as the Assignee and Owner",body:'The Assignee is the rep accountable for running the email, call, or other steps associated to those people in the cadence. In other words, whatever cadence step is due gets assigned to that rep and automated emails will come from the assignee selected.<br><br><i style="font-weight: inherit;">Note: The Assignee will also become the Owner of the cadence.</i>',width:"400px"}),_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0),this},checkCadenceRenaming:function(){const e=this.model.nodeInfo.cadenceSelection[0]&&this.model.nodeInfo.cadenceSelection[0].id||"";return _LeanData.FlowBuilderController.querySalesloftCadences(e).then(e=>{if(!_.isEmpty(e)&&this.model.nodeInfo.cadenceSelection.length>0)this.model.nodeInfo.cadenceSelection[0].id===e.id&&(this.model.nodeInfo.cadenceSelection[0].label=this.model.nodeInfo.cadenceSelection[0].name=e.name),this.$el.find(".cadence-error-message").hide();else if(this.model.nodeInfo.cadenceSelection.length>0){const e=this.model.nodeInfo.cadenceSelection[0].name;this.$el.find(".cadence-error-message").text(`Previously selected cadence "${e}" no longer exists.`),this.model.nodeInfo.cadenceSelection=[]}})},refreshCadencesData:function(){_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0),_LeanData.MetaDataController.getPartnerAuthorization("salesloft")&&"OFF"!==_LeanData.MetaDataController.getPartnerNodeAuthorization("salesloftAddToCadence").state?_LeanData.FlowBuilderController.salesloft_refreshCadencesData().then(()=>{this.initializeCadencesTypeahead(),_LeanData.MetaDataController.resetPartnerMetaDataCache("salesloft_cadences")}).finally(()=>{_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)}):_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)},refreshUsersData:function(){_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0),_LeanData.MetaDataController.getPartnerAuthorization("salesloft")&&"OFF"!==_LeanData.MetaDataController.getPartnerNodeAuthorization("salesloftAddToCadence").state?_LeanData.FlowBuilderController.salesloft_refreshUsersData().then(()=>{this.initializeUsersTypeahead(),_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)}).finally(()=>{_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)}):_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0)}}),Magellan.Views.ZoominfoEnrich=Backbone.View.extend({template:_.template(i(273)),events:{"click .add-field_cancel":"hideFieldTypeahead","click .add-field_save":"addSelectedField","click .delete-row-icon":"deleteRow"},initialize:function(e){_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!0),this.isAdvancedPanelCollapsed=!1,Promise.all([_LeanData.FlowBuilderController.zoominfo_appInstalled()]).then(([e])=>{this.appInstalled=e,this.render()})},render:function(){const e=this.template({appInstalled:this.appInstalled,authorized:_LeanData.MetaDataController.getPartnerAuthorization("zoominfo")});this.$el.html(e);const t=new Magellan.Views.AdvancedSettings({model:this.model,openPanel:!this.isAdvancedPanelCollapsed,onCollapse:e=>this.isAdvancedPanelCollapsed=e});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0),this}}),Magellan.Views.ZoominfoEnrichPerson=Magellan.Views.ZoominfoEnrich.extend({initialize:function(){this.objectType="Lead",Magellan.Views.ZoominfoEnrich.prototype.initialize.apply(this)}}),Magellan.Views.CreateObjectRadioOptions=Backbone.View.extend({initialize:function(e){this.objectData=e.objectDataKey?this.model.nodeInfo[e.objectDataKey]:this.model.nodeInfo,this.assignedToValue_variableField=null,this.assignedToValue_explicitOwner=null,"assignedToVariable"===this.objectData.assignedToType&&(this.assignedToValue_variableField=this.objectData.assignedToValue),"assignedToExplicitOwner"===this.objectData.assignedToType&&(this.assignedToValue_explicitOwner=this.objectData.assignedToValue),_LeanData.MetaDataController.activityRelatedToObjects().then(e=>{this.validRelatedToObjectTypes=new Set(e)})},template:_.template(i(231)),events:{"change input[type=radio]":"updateTypeAndValue"},updateTypeAndValue:function(e){var t=$(e.target),i=t.data("category"),a=t.data("type");"assignedTo"===i&&(this.objectData.assignedToType=a,this.objectData.assignedToValue=null,"assignedToVariable"===a?this.objectData.assignedToValue=this.assignedToValue_variableField:"assignedToExplicitOwner"===a&&(this.objectData.assignedToValue=this.assignedToValue_explicitOwner))},_renderRelatedToSelection:function(){const e=_LeanData.Util.createFlattenedFields(_LeanData.AppState.getCurrentVariablesService().getVariablesForTypeahead(!1)),t=_LeanData.StringUtil.debracketize(this.objectData.relatedToValue);var i=_LeanData.Util.createFlattenedFields(_LeanData.Util.convertFieldSelectionStringToArray(t,_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap()));if("Meeting"===_LeanData.AppState.PrimarySObjectType){const t={name:"routed meeting",label:"Routed Prospect (Lead/Contact)"};"routed meeting"==_LeanData.StringUtil.debracketize(this.objectData.relatedToValue)&&(i=[t]),e.unshift(t)}const a={selector:"ld-typeahead-angular#relatedTo",inputs:{selections:i,nestingRoot:"Variables",data:{Variables:e},required:!0,placeholder:"Search",disabled:!_LeanData.AppState.isLockedForEditing,filter:e=>e.filter(e=>this.validRelatedToObjectTypes.has(e.sObject)||"routed meeting"===e.name),asyncValidationFunction:e=>"routed meeting"===e[0].name||_LeanData.MetaDataController.activityRelatedToObjects().then(t=>{const i=new Set(t),a=_LeanData.Validation.validateVariableSelection(this.model.nodeInfo.name,_LeanData.AppState.getCurrentVariablesService(),e,e[0]?e[0].name:"",e[0]?e[0].label:"","read",!1,"",i,_LeanData.AppState.PrimarySObjectType);return this.$el.find("#invalidRelatedTo").text(a).show(),""===a})},events:{onSelect:e=>{const t=e.length>0?_LeanData.StringUtil.bracketize(e[0].name):null;this.objectData.relatedToValue=t}}};_LeanDataUtil.Backbone.loadAngularComponent(this,a)},_renderAssignedToSelection:function(){let e=_LeanData.Util.convertFieldSelectionStringToArray(_LeanData.StringUtil.debracketize(this.objectData.assignedToValue),_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap());var t=_LeanData.Util.createUserFieldsFilter(),i=_LeanData.Util.createOwnerToOwnerMappingFilter(),a=_LeanData.Util.createBlacklistFilter();const n={selector:"ld-typeahead-angular#assignedToVariable",inputs:{getDynamicData:_LeanData.Util.getDynamicFieldMetaData(_LeanData._function.VARIABLES_FIELDNAME,_LeanData.AppState.PrimarySObjectType,_.cloneDeep(window.fieldMetaData),null),nestingRoot:_LeanData._function.VARIABLES_FIELDNAME,customNestingRootLabel:"Variables",required:!0,selections:e,placeholder:"Search",disabled:!_LeanData.AppState.isLockedForEditing,validationFunction:e=>{if(e.length<2)return!1;const t=e[e.length-1].name;return(t.endsWith("__c")||t.endsWith("id"))&&Magellan.Validation.validateVariable(this.model.nodeInfo.name,e[0].name)},filter:function(e){return e=a(e),this.selections&&(_.isEmpty(this.selections)?e=e.filter(e=>"SOBJECT"===e.type):(e=t(e),e=i(e))),e}},events:{onSelect:e=>{const t=_LeanData.StringUtil.bracketize(_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e));this.objectData.assignedToValue=t,this.assignedToValue_variableField=t}}};_LeanDataUtil.Backbone.loadAngularComponent(this,n);var o=this.objectData.assignedToType?this.$el.find("input[type=radio][data-type='"+this.objectData.assignedToType+"']"):this.$el.find("input[type=radio][data-type='assignedToVariable']");o.prop("checked",!0),o.parent("label").addClass("checked")},_renderExplicitOwnerTypeahead:function(){const e={selector:"ld-typeahead-angular#assignedToExplicit",inputs:{searchFunction:_LeanData.FlowBuilderController.searchUsers,required:!0,disableBreadcrumbs:!0,placeholder:"Search",disabled:!_LeanData.AppState.isLockedForEditing,isValid:!1},events:{onSelect:e=>{this.objectData.assignedToValue=e[0].Id,this.assignedToValue_explicitOwner=e[0].Id,this.$el.find("#invalidExplicitOwner").hide()}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e),"assignedToExplicitOwner"===this.objectData.assignedToType&&_LeanData.FlowBuilderController.queryUsers([this.objectData.assignedToValue]).then(function(t){var i=this.objectData.assignedToValue?t:[];i[0]&&!i[0].IsActive||!_.isEmpty(this.objectData.assignedToValue)&&0===i.length?this.$el.find("#invalidExplicitOwner").text('User Id "'+this.objectData.assignedToValue+'" is inactive or does not exist').show():(e.inputs.selections=i,_LeanDataUtil.Backbone.loadAngularComponent(this,e))}.bind(this)).catch(function(e){console.error("_renderExplicitOwnerTypeahead error",e)})},render:function(){var e=this.template({eventNode:!(this.model instanceof _LeanData.GraphModels.Action_CreateTask)});return this.$el.html(e),this._renderRelatedToSelection(),this._renderAssignedToSelection(),this._renderExplicitOwnerTypeahead(),this}}),Magellan.Views.OtherCreateObjectFields=Backbone.View.extend({NO_DUE_DATE:-1,INVALID_RELATIVE_DATE:-2,SPECIFIC_DATE:-3,initialize:function(e){this.objectDataKey=e.objectDataKey;var t=e.objectFieldValues;this.objectStatuses=t.statuses,this.objectSubjects=t.subjects,this.objectPriorities=t.priorities,_.each(this.objectStatuses,e=>{e.name=e.value}),_.each(this.objectSubjects,e=>{e.name=e.value}),_.each(this.objectPriorities,e=>{e.name=e.value})},template:_.template(i(241)),events:{'change input[type=radio][name="oc-date-radio-control"]':"updateDueDateType","input #dueDateDays":"updateTaskDays","change #task-subject-input":"updateOtherTaskFieldSelection"},updateDueDateType:function(e){var t=$(e.currentTarget).data("dateType");if("specificDate"===t)this.model.nodeInfo.taskDays=this.SPECIFIC_DATE,this.model.nodeInfo.dueDate=this.isValidDate($("#dueDatePicker").val())?$("#dueDatePicker").val():"";else if("taskDays"===t){let e=$("#dueDateDays").val().replace(/[^0-9]/g,"");this.model.nodeInfo.taskDays=_.isEmpty(e)?this.INVALID_RELATIVE_DATE:$("#dueDateDays").val(),this.model.nodeInfo.dueDate=""}else this.model.nodeInfo.taskDays=this.NO_DUE_DATE,this.model.nodeInfo.dueDate=""},updateTaskDays:function(e){e.currentTarget.value=e.currentTarget.value.replace(/[^0-9]/g,""),_.isEmpty(e.currentTarget.value)?($(e.target).toggleClass("lds-field-invalid",!0),this.model.nodeInfo.taskDays=this.INVALID_RELATIVE_DATE):($(e.target).toggleClass("lds-field-invalid",!1),this.model.nodeInfo.taskDays=e.currentTarget.value)},updateDueDate:function(e){0!==e.currentTarget.value.length&&this.isValidDate(e.currentTarget.value)?($(e.target).toggleClass("input-invalid",!1),this.model.nodeInfo.dueDate=e.currentTarget.value):($(e.target).toggleClass("input-invalid",!0),this.model.nodeInfo.dueDate="")},isValidDate:function(e){return e==moment(e).format("MM/DD/YYYY")},updateOtherTaskFieldSelection:function(e,t){if(this.$(e.currentTarget).is("#task-subject-input")&&(this.objectDataKey?this.model.nodeInfo[this.objectDataKey].subject=this.$(e.currentTarget).val():this.model.nodeInfo.taskSubject=this.$(e.currentTarget).val(),this.validateSubjectMergeFieldValues()),t){var i=_.isEmpty(t.selection)?null:t.selection[0].name;"status"===t.root&&(this.model.nodeInfo.taskStatus=i),"priority"===t.root&&(this.model.nodeInfo.taskPriority=i)}this.validateTaskSubject()},validateSubjectMergeFieldValues:function(){var e=Magellan.Validation.isValidMergeFieldValueMessages(this.model.nodeInfo.name,this.objectDataKey?this.model.nodeInfo[this.objectDataKey].subject:this.model.nodeInfo.taskSubject,"STRING",this.model.nodeInfo.eventCreation?"event.subject":"task.subject"),t="";_.isEmpty(e)||(t=e.join("; ")),this.$el.find(".task-subject-error").text(t)},validateTaskSubject:function(){const e=this.$el.find("#task-subject-input");null==e.val()||0===e.val().trim().length||this.$el.find(".task-subject-error").text().length>0?e.toggleClass("lds-field-invalid",!0):e.toggleClass("lds-field-invalid",!1)},render:function(){var e=this.template({eventNode:!(this.model instanceof _LeanData.GraphModels.Action_CreateTask),taskDays:this.model.nodeInfo.taskDays,dueDateInvalid:!this.isValidDate(this.model.nodeInfo.dueDate)});if(this.$el.html(e),this.objectStatuses){var t,i=!1,a=_.filter(this.objectStatuses,e=>(e.defaultValue&&e.active&&(t=e),e.active||e.value!==this.model.nodeInfo.taskStatus||(i=!0),e.active&&e.value===this.model.nodeInfo.taskStatus))[0];!_.isEmpty(this.model.nodeInfo.taskStatus)&&i?this.$el.find("#invalidTaskStatus").text('Previously selected task status option "'+this.model.nodeInfo.taskStatus+'" is inactive').show():!_.isEmpty(this.model.nodeInfo.taskStatus)&&_.isEmpty(a)&&this.$el.find("#invalidTaskStatus").text('Previously selected task status option "'+this.model.nodeInfo.taskStatus+'" does not exist').show(),this.model.nodeInfo.taskStatus=a?a.value:t?t.value:null;const e={selector:"ld-typeahead-angular#taskStatusDropdown",inputs:{required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:{status:this.objectStatuses},nestingRoot:"status",selections:_.isEmpty(a)?[]:[a],readOnly:!_LeanData.AppState.isLockedForEditing},events:{onSelect:e=>{const t=_.isEmpty(e)?null:e[0].name;this.model.nodeInfo.taskStatus=t}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}const n=$(this.$el.find("#task-subject-input"));n.val((this.objectDataKey?this.model.nodeInfo[this.objectDataKey].subject:this.model.nodeInfo.taskSubject)||"").trigger("change"),n.typeahead({hint:!0,highlight:!0,minLength:0},{name:"task-subject-typeahead",limit:1e3,source:new Bloodhound({local:_.map(this.objectSubjects,e=>e.value),datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace})}),this.validateSubjectMergeFieldValues(),this.validateTaskSubject();var o=Magellan.Controllers.VariableCreator.createVariableInsertButton(this.model,null,e=>{var t=this.$("#task-subject-input")[0].selectionStart,i=this.$("#task-subject-input").val(),a=i.substring(0,t)+e+i.substring(t);this.$("#task-subject-input").val(a).trigger("change"),n.typeahead("val",a)},null,`${this.objectDataKey?"Event":"Task"} Subject`,!0);if(o.isDatetime=!0,this.$el.find("#task-subject .merge-field-insert-button-container").html(o.$el),"eventCreation"===this.objectDataKey&&this.$el.find("#task-subject .merge-field-insert-button-container .ld-dropdown").removeClass("ld-dropdown-small").addClass("ld-dropdown-xtra-small"),this.objectPriorities){var l,s=!1,r=_.filter(this.objectPriorities,e=>(e.defaultValue&&e.active&&(l=e),e.active||e.value!==this.model.nodeInfo.taskPriority||(s=!0),e.active&&e.value===this.model.nodeInfo.taskPriority))[0];!_.isEmpty(this.model.nodeInfo.taskPriority)&&s?this.$el.find("#invalidTaskPriority").text('Previously selected task priority option "'+this.model.nodeInfo.taskPriority+'" is inactive').show():!_.isEmpty(this.model.nodeInfo.taskPriority)&&_.isEmpty(r)&&this.$el.find("#invalidTaskPriority").text('Previously selected task priority option "'+this.model.nodeInfo.taskPriority+'" does not exist').show(),this.model.nodeInfo.taskPriority=r?r.value:l?l.value:null;const e={selector:"ld-typeahead-angular#taskPriorityDropdown",inputs:{required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,data:{priority:this.objectPriorities},nestingRoot:"priority",selections:_.isEmpty(r)?[]:[r],readOnly:!_LeanData.AppState.isLockedForEditing},events:{onSelect:e=>{const t=_.isEmpty(e)?null:e[0].name;this.model.nodeInfo.taskPriority=t}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}const d=$(this.$el).find("#dueDatePicker");return d&&d.datepicker("destroy").removeClass("hasDatepicker"),d.datepicker({dateFormat:"mm/dd/yy",minDate:new Date}),d.on("change",this.updateDueDate.bind(this)),this.model.nodeInfo.taskDays>=0||this.model.nodeInfo.taskDays===this.INVALID_RELATIVE_DATE?dateRadioOption=this.$el.find("input[type=radio][data-date-type='taskDays']"):_.isEmpty(this.model.nodeInfo.dueDate)&&this.model.nodeInfo.taskDays!==this.SPECIFIC_DATE?dateRadioOption=this.$el.find("input[type=radio][data-date-type='noDueDate']"):(dateRadioOption=this.$el.find("input[type=radio][data-date-type='specificDate']"),this.$el.find("#dueDatePicker").val(this.model.nodeInfo.dueDate)),dateRadioOption.prop("checked",!0),dateRadioOption.parent("label").addClass("checked"),this}}),Magellan.Views.AdditionalCreateAccountFields=Backbone.View.extend({initialize:function(e){null==this.model.nodeInfo.accFields&&(this.model.nodeInfo.accFields=[]),this.fieldMetaData=fieldMetaData,this.ownerMappingFilter=_LeanData.Util.createOwnerToOwnerMappingFilter()},template:_.template(i(225)),events:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule"},addRule:function(){this.model.nodeInfo.accFields.push({type:"value",readFieldOrValue:"",writeField:null,isValid:!0,dataType:""}),this.renderRows()},deleteRule:function(e){var t=Number($(e.currentTarget).data("rule-number").split(".")[1]);this.model.nodeInfo.accFields.splice(t,1),this.renderRows()},renderRows:function(){var e=this.$el.find("#edit-account-fields-wrapper");e.html(""),_.each(this.model.nodeInfo.accFields,(t,i)=>{if("name"!==t.writeField){var a=new Magellan.Views.SingleMappingRow({nodeModel:this.model,field:t,ruleNum:"acc."+i,writeType:"Account",readType:_LeanData._function.VARIABLES_FIELDNAME,readFieldHeader:"Variable",nestedFields:this.fieldMetaData,blacklist:["name"].concat(_LeanData._blacklist.FIELD_BLACKLIST_MAP.ACCOUNT_FIELDS)});e.append(a.render().$el)}})},render:function(){var e=this.template({});return this.$el.html(e),this.renderRows(),this}}),Magellan.Views.AdditionalCreateObjectFields=Backbone.View.extend({initialize:function(e){this.objectDataKey=e.objectDataKey,this.fieldMetaData=fieldMetaData,this.ownerMappingFilter=_LeanData.Util.createOwnerToOwnerMappingFilter(),"eventCreation"===this.objectDataKey?this.writeFieldsFilter=(e=>{const t=this.model.nodeInfo[this.objectDataKey].additionalFields.map(({writeField:e})=>e);return e.filter(e=>!["enddatetime","startdatetime","recurrencestartdatetime","recurrenceenddatetime","durationinminutes","activitydatetime","activitydate","isreminderset","reminderdatetime","isprivate"].includes(e.name)&&!t.includes(e.name))}):this.writeFieldsFilter=(e=>e)},template:_.template(i(226)),events:{"click .add-rule-div":"addRule","click .delete-column":"deleteRule"},addRule:function(){var e={type:"value",readFieldOrValue:"",writeField:null,isValid:!0,dataType:""};this.objectDataKey?this.model.nodeInfo[this.objectDataKey].additionalFields.push(e):this.model.nodeInfo.taskFields.push(e),this.renderRows()},deleteRule:function(e){var t=$(e.currentTarget).data("rule-number");this.objectDataKey?this.model.nodeInfo[this.objectDataKey].additionalFields.splice(t,1):this.model.nodeInfo.taskFields.splice(t,1),this.renderRows()},renderRows:function(){var e=this.$el.find("#edit-task-fields-wrapper");e.html(""),_.each(this.objectDataKey?this.model.nodeInfo[this.objectDataKey].additionalFields:this.model.nodeInfo.taskFields,(t,i)=>{if("name"!==t.writeField){var a=new Magellan.Views.SingleMappingRow({nodeModel:this.model,field:t,ruleNum:i,writeType:"eventCreation"===this.objectDataKey?"Event":"Task",readType:_LeanData._function.VARIABLES_FIELDNAME,readFieldHeader:"Variable",nestedFields:this.fieldMetaData,blacklist:_LeanData._blacklist.FIELD_BLACKLIST_MAP.CREATE_TASK_FIELDS,writeFieldsFilter:this.writeFieldsFilter});e.append(a.render().$el)}})},render:function(){var e=this.template({eventNode:!(this.model instanceof _LeanData.GraphModels.Action_CreateTask)});return this.$el.html(e),this.renderRows(),this}}),Magellan.Views.Reroute=Magellan.Views.ButtonHandler.extend({initialize:function(e){this.listenTo(this.model,"change:days",this.updateNodeInfo),this.listenTo(this.model,"change:hours",this.updateNodeInfo),this.listenTo(this.model,"change:minutes",this.updateNodeInfo),this.listenTo(this.model,"change:respectSchedules",this.updateNodeInfo),this.listenTo(this.model,"change:workingHoursId",this.updateNodeInfo),this.listenTo(this.model,"change:holidaysId",this.updateNodeInfo),this.model.set("days",this.model.nodeInfo.days?this.model.nodeInfo.days:0),this.model.set("minutes",this.model.nodeInfo.minutes?this.model.nodeInfo.minutes:0),this.model.set("hours",this.model.nodeInfo.hours?this.model.nodeInfo.hours:0),this.model.set("workingHoursId",this.model.nodeInfo.workingHoursId?this.model.nodeInfo.workingHoursId:null),this.model.set("holidaysId",this.model.nodeInfo.holidaysId?this.model.nodeInfo.holidaysId:null),this.model.set("respectSchedules",!0===this.model.nodeInfo.respectSchedules),this.model.set("timeFrameChoice",this.model.get("workingHoursId")?"working hours":"defined time"),this.model.set("userTimeZone",_LeanData._getOrganizationData().userTimeZone),this.getWorkingHoursTimeZone(),this.renderHolidayScheduleTimeZone(),this.listenToOnce(this.model,"saveNodeEvent",()=>{"working hours"===this.model.get("timeFrameChoice")?(delete this.model.nodeInfo.days,delete this.model.nodeInfo.minutes,delete this.model.nodeInfo.hours):(delete this.model.nodeInfo.workingHoursId,delete this.model.nodeInfo.holidaysId)})},events:{"click #respect-schedules-toggle":"toggleRespectSchedule","click #alternateFieldAssignment":"toggleRespectSchedule","click .checkmark":"toggleRespectSchedule","input .time-hours-input":"updateHours","input .time-minutes-input":"updateMinutes","change [name='reroute-time-choice']":"changeRerouteTimeFrameChoice","click .clear-holidays":"clearHolidays"},updateNodeInfo:function(e){let t=!1;_.each(e.changed,function(i,a){e.nodeInfo[a]=i,"respectSchedules"===a&&(t=!0)}),this.daysDropdown&&this.daysDropdown.validate(),this.hoursDropdown&&this.hoursDropdown.validate(),this.minutesDropdown&&this.minutesDropdown.validate(),this.workingHoursDropdown&&this.workingHoursDropdown.validate(),this.holidaysDropdown&&this.holidaysDropdown.validate(),e.nodeInfo.holidaysId||delete e.nodeInfo.holidaysId,t&&this.render()},getWorkingHoursTimeZone:function(){this.model.get("workingHoursId")&&_LeanData.FlowBuilderController.queryScheduleSettings(this.model.get("workingHoursId")).then(e=>{this.model.set("workingHoursTimeZone",e[0].Timezone__c),"User Member Timezone"===this.model.get("workingHoursTimeZone")?this.$el.find(".wh-timezone-container").html('<div class="highlighted-note">Integration User Timezone</div>'):this.model.get("workingHoursTimeZone")?this.$el.find(".wh-timezone-container").html('<div class="highlighted-note grey">Timezone: '+this.model.get("workingHoursTimeZone")+"</div>"):this.$el.find(".wh-timezone-container").html("")})},renderHolidayScheduleTimeZone:function(){let e=this.model.get("holidaysId")?'<div class="highlighted-note">Integration User Timezone</div>':"";this.$el.find(".hs-timezone-container").html(e)},updateHours:function(e){var t=$(e.currentTarget).val().trim();this.model.set("hours",parseInt(t)||0)},updateMinutes:function(e){var t=$(e.currentTarget).val().trim();this.model.set("minutes",parseInt(t)||0)},clearHolidays:function(e){this.model.set("holidaysId",null),this.holidaysDropdown.selection=[],this.holidaysDropdown.render(),this.renderHolidayScheduleTimeZone()},changeRerouteTimeFrameChoice:function(e){this.model.set("timeFrameChoice",this.$(e.target).val())},template:_.template(i(267)),validate:function(){let e="";if(this.model.get("workingHoursId"))return _LeanData.FlowBuilderController.queryScheduleSettings([this.model.get("workingHoursId")]).then(t=>{_.isEmpty(t)&&(e+="<p>Invalid working hours schedule: <strong>"+this.model.get("workingHoursId")+"</strong></p>"),this.$el.find(".time-frame-error").html(e)}),this.model.get("holidaysId")&&_LeanData.FlowBuilderController.queryScheduleSettings([this.model.get("holidaysId")]).then(t=>{_.isEmpty(t)&&(e+="<p>Invalid holidays schedule: <strong>"+this.model.get("holidaysId")+"</strong></p>"),this.$el.find(".time-frame-error").html(e)}),_.isEmpty(e);let t=parseInt(this.model.get("days"))||0,i=parseInt(this.model.get("hours"))||0,a=parseInt(this.model.get("minutes"))||0;return Magellan.Validation.isValidRerouteTimeFrame(t,i,a)||(e="<p>Time frame must be at minimum of 5 minutes and maximum of 30 days.</p>"),this.$el.find(".time-frame-error").html(e),_.isEmpty(e)},toggleRespectSchedule(e){let t=this.model.get("respectSchedules")||!1;!t&&this.model.get("days")&&0!=this.model.get("days")?_LeanData.Notification.showConfirmationDialog({header:"Notice: Working Hours in Time-Based Node",message:"To utilize this functionality, please adjust the specified time frame to hours and/or minutes only.<br><br>Days are not supported and will be cleared out upon confirmation.",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onConfirm:()=>{this.model.set("days",0),this.model.set("respectSchedules",!t)},onCancel:()=>{this.$el.find("#alternatefieldassignment").prop("checked",t)}}):this.model.set("respectSchedules",!t)},render:function(){var e=this.template({model:this.model,valid:this.validate()});this.$el.html(e);var t=this.validate.bind(this);this.daysDropdown=new Magellan.Views.LDDropdown({required:!0,disabled:this.model.get("respectSchedules")||!1,value:!0===this.model.get("respectSchedules")?0:this.model.get("days")||0,options:_.range(0,31),enableSearch:!1,isValid:t,onChange:function(e){this.model.set("days",e)}.bind(this)}),this.$el.find(".time-days-container").html(this.daysDropdown.render().$el),!0!==this.model.get("respectSchedules")&&(this.hoursDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("hours")||0,options:_.range(0,24),enableSearch:!1,isValid:t,onChange:function(e){this.model.set("hours",e)}.bind(this)}),this.$el.find(".time-hours-container").html(this.hoursDropdown.render().$el),this.minutesDropdown=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("minutes")||0,options:_.range(0,60),enableSearch:!1,isValid:t,onChange:function(e){this.model.set("minutes",e)}.bind(this)}),this.$el.find(".time-minutes-container").html(this.minutesDropdown.render().$el)),setTimeout(()=>{this.workingHoursDropdown||this.$el.find(".working-hours-dropdown").text("Loading working hours..."),this.holidaysDropdown||this.$el.find(".holidays-dropdown").text("Loading holidays...")},0),new Promise((e,t)=>{this.model.nodeInfo.workingHoursId?_LeanData.FlowBuilderController.queryScheduleSettings([this.model.nodeInfo.workingHoursId]).then(t=>{e(t)}).catch(t):e(null)}).then(e=>{this.workingHoursDropdown=new Magellan.Views.NestedTypeaheadSelector({asyncServiceCall:_LeanData.FlowBuilderController.searchWorkingHoursSchedules,disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!0,selection:e||[],onSelect:(e,t)=>{var i=t&&t.length>0?t[0]:null;this.model.set("workingHoursId",i.Id),this.getWorkingHoursTimeZone()}}),this.$el.find(".working-hours-dropdown").html(this.workingHoursDropdown.$el),this.workingHoursDropdown.validate()}),new Promise((e,t)=>{this.model.nodeInfo.holidaysId?_LeanData.FlowBuilderController.queryScheduleSettings([this.model.nodeInfo.holidaysId]).then(t=>{e(t)}).catch(t):e(null),this.validate()}).then(e=>{this.holidaysDropdown=new Magellan.Views.NestedTypeaheadSelector({asyncServiceCall:_LeanData.FlowBuilderController.searchHolidaysSchedules,disableBreadcrumbs:!0,requireSelectionFromData:!0,required:!1,selection:e||[],onSelect:(e,t)=>{var i=t&&t.length>0?t[0]:null;this.model.set("holidaysId",i.Id),this.renderHolidayScheduleTimeZone()}}),this.$el.find(".holidays-dropdown").html(this.holidaysDropdown.$el),this.holidaysDropdown.validate()}),this.renderHolidayScheduleTimeZone(),this.$el.find('.reroute-time-choice[value="'+this.model.get("timeFrameChoice")+'"]').prop("checked",!0).closest(".control--radio").toggleClass("checked",!0);var i=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275});return this.$el.find(".reroute-edges-config-container").html(i.render().$el),ld_initializeToolTip(this.$el.find(".respect-user-schedule-tooltip"),{title:"User Schedules",body:"When selected, the Time Frame will only elapse during the current ownerâ€™s Schedule (Working Hours, Vacations, and Holidays). To adjust the Schedules, visit People > Users > Schedules.<br><i>For example, if the Time Frame is 4 hours, the ownerâ€™s Schedule is 9AM-5PM, and a record enters this node at 3PM on a Friday, only two of the four working hours will have elapsed by the end of the day.  On Monday at 9AM, the following two hours will elapse and evaluate the condition at 11AM that Monday.</i>",width:"300px"}),ld_initializeToolTip(this.$el.find(".reroute-working-hours-tooltip"),{title:"Working-hours Based Routing",body:"If a record enters this node during the Working Hours selected, LeanData will evaluate the rules immediately. If a record enters this node outside of the Working Hours selected, LeanData will wait until the Working Hours commence, and then evaluate the rules.",width:"300px"}),this}})}},function(e,t){e.exports=function initializeMagellanValidation(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Validation&&(Magellan.Validation={}),Magellan.Validation.nodesWithMissingMatchTypes=[],Magellan.Validation.EMAIL_RECIPIENT_LIMIT=20,Magellan.Validation.doCyclesExist,Magellan.Validation.nodeNameToRelatedObjectTypes={},Magellan.Validation.nonUpgradedNodes={},Magellan.Validation.nodeNamesToVariableStatus,Magellan.Validation.isValidUserAssignmentField=((e,t)=>{const i=new Set(_.map(_LeanData.MetaDataController.getCustomUserFieldsByObject(t),function(e){return e.name}));let a=_LeanData.MetaDataController.getObjectMetaDataObject(t,!0).hasOwnerField;return"OwnerId"===e&&a||i.has(e)||_.isNull(e)||_.isUndefined(e)}),Magellan.Validation.validateMatchNode=async function(e){let t=!0;const i=e.nodeInfo;return"RA"===i.objectType||"RCM"===i.objectType?t=t&&Magellan.Validation.validateObjectRadioOptions(e):"C2A"!==i.objectType||_LeanData.FeatureProvisioning.getFeatureProvisioningFromModelName("Match_C2A","Contact",_LeanData.AppState.isHandoffGraph?"handoff":"routing")?"GR"===i.objectType&&(t=t&&await Magellan.Validation.validateGetRecordsMatchNode(i)):(Magellan.Validation.nonUpgradedNodes[i.name]=e,t=!1),t},Magellan.Validation.validateObjectRadioOptions=function(e){let t=!0;const i=e.nodeInfo;return"primary"===i.relatedToType?t=t&&[_LeanData.AppState.PrimarySObjectType,"primary","Object"].includes(i.relatedToValue):"reference"===i.relatedToType&&(t=t&&"Account"===i.relatedToValue&&["Contact","Opportunity","Case"].includes(_LeanData.AppState.PrimarySObjectType)),t},Magellan.Validation.validateAccountBasedRouting=async function(e){var t=!_.isUndefined(e.nodeInfo["abr type"])&&!_.isNull(e.nodeInfo["abr type"])&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType);if(t)if("custom field"===e.nodeInfo["abr type"])t=t&&Magellan.Validation.metadataFieldExists("Account",e.nodeInfo["custom field"]);else if("owner mapping"===e.nodeInfo["abr type"])t=t&&await Magellan.Validation.validateOwnerMapping(e.nodeInfo["owner mapping"]);else if("account team"===e.nodeInfo["abr type"]){const i="Meeting"!==_LeanData.AppState.PrimarySObjectType&&!_LeanData.AppState.isHandoffGraph&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS");i&&(Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e),t=t&&!i&&await Magellan.Validation.validateAccountTeam(e.nodeInfo["account team rule"])}return t},Magellan.Validation.validateAccountTeamRouting=async function(e){var t=Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType);return t=(t=t&&await Magellan.Validation.validateAccountTeam(e.nodeInfo["account team rule"]))&&Magellan.Validation.validateAccountTeamsEnabled()},Magellan.Validation.validateTerritoryRouting=function(e){var t=$.Deferred(),i=!!e.nodeInfo.segmentId&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType);e.nodeInfo["populate territory field"]&&(i=i&&!_.isEmpty(e.nodeInfo["populate territory field"]));const a=e.nodeInfo.fields;return a&&Object.keys(a).forEach(t=>{i=i&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,a[t],"STRING","Form Field Value")}),i?(Promise.all([_LeanData.FlowBuilderController.queryTerritorySegments(e.nodeInfo.segmentId),_LeanData.FlowBuilderController.getTerritorySegmentsWithUnprovisionedPools()]).then(([a,n])=>{if(n[e.nodeInfo.segmentId])return Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e,i=!1,t.resolve(i);a.length>0&&-1!==a[0].Fields_Used__c.indexOf("CustomField")&&(""===e.nodeInfo.fields.CustomField||void 0===e.nodeInfo.fields.CustomField)?i=!1:a.length>0&&(-1===a[0].Fields_Used__c.indexOf("PostalCode")||""!==e.nodeInfo.fields.PostalCode&&void 0!==e.nodeInfo.fields.PostalCode||(i=!1),-1===a[0].Fields_Used__c.indexOf("City")||""!==e.nodeInfo.fields.City&&void 0!==e.nodeInfo.fields.City||(i=!1),-1===a[0].Fields_Used__c.indexOf("State")||""!==e.nodeInfo.fields.State&&void 0!==e.nodeInfo.fields.State||(i=!1),-1===a[0].Fields_Used__c.indexOf("Country")||""!==e.nodeInfo.fields.Country&&void 0!==e.nodeInfo.fields.Country||(i=!1)),t.resolve(i&&a&&a.length>0)}),t):t.resolve(i)},Magellan.Validation.validateDataSetRouting=function(e){return new Promise((t,i)=>{let a=Boolean(e.dataSetId);a?_LeanData.FlowBuilderController.queryDataSets([e.dataSetId]).then(([i])=>{if(!(a=a&&i&&(_LeanData.AppState.businessUnitId?i.Business_Unit__c===_LeanData.AppState.businessUnitId:!i.Business_Unit__c)))return void t(a);const n=i.Active_Version__r;if(!(a=a&&n&&n.Metadata__c))return console.error("Unexpected error: Data Table contains invalid active version or the active version no longer exists."),void t(a);const o=Object.assign(_LeanData.Util.convertArrayToMap(e.mapping.input,"column"),_LeanData.Util.convertArrayToMap(e.mapping.output,"column")),l=_LeanData.AppState.getCurrentVariablesService().getVariablesMap(),s=_LeanData._function.VARIABLES_FIELDNAME,r=_LeanData.MetaDataController.getFieldMetaData(),d={activeVersionName:n.Name,columns:JSON.parse(n.Metadata__c)},c=d.columns.filter(e=>"input"===e.io),h=e.mapping.input;a=a&&h.length>0,c.forEach(t=>{const i=_LeanData._dataset.DATA_SET_VALID_TYPE_MAPPING[t.type.toUpperCase()],n=h.find(e=>e.column===t.field),d=n?_LeanData.StringUtil.debracketize(n.variable):"";if(d&&(a=a&&Magellan.Validation.isValidMergeFieldValue(e.name,n.variable,"STRING",n.variable))){const e=_LeanData.Util.convertFieldSelectionStringToArray(d,s,r,l),t=_.last(e);a=a&&i.includes(t.type)}delete o[t.field]});const p=d.columns.filter(e=>"output"===e.io),u=e.mapping.output;a=a&&u.length>0,p.forEach(t=>{const i=_LeanData._dataset.DATA_SET_VALID_TYPE_MAPPING[t.type.toUpperCase()],n=u.find(e=>e.column===t.field),d=n?_LeanData.StringUtil.debracketize(n.variable):"";if(d&&(a=_LeanData.VariablesService.isReservedVariable(d.split(".")[0],_LeanData.AppState.PrimarySObjectType)?a&&Magellan.Validation.isValidMergeFieldValue(e.name,n.variable,"STRING",n.variable):a&&_LeanData.Util.isValidVariableLabel(d)&&_LeanData.VariablesUtil.isValidVariableName(d))){const e=_LeanData.Util.convertFieldSelectionStringToArray(d,s,r,l),n=_.last(e);a="owner"===t.type&&"ID"===n.type?a&&["User","Group","Group/User"].includes(n.objectType):a&&i.includes(n.type)}delete o[t.field]}),a=a&&_.isEmpty(o),t(a)}):t(a)})},Magellan.Validation.validateETMRouting=function(e){return new Promise((t,i)=>{const a=e["selected role"],n=e["ordered territories"],o=e["etm role tiebreaker"];if(!a||!n.length||!o)return void t(!1);let l=Magellan.Validation.isValidUserAssignmentField(e["assignment field"],_LeanData.AppState.PrimarySObjectType);const s=_LeanData.StringUtil.debracketize(e.matchedVariable)||_LeanData.Variables.getReservedVariableName("routed",_LeanData.AppState.PrimarySObjectType);if(!Magellan.Validation.validateVariable(e.name,s))return void t(!1);if(!_LeanData.StringUtil.debracketize(e.outputVariable))return void t(!1);const r=_LeanData.AppState.getCurrentVariablesService().getVariableByName(s);Promise.all([_LeanData.FlowBuilderController.isETMEnabledOrActive(),_LeanData.FlowBuilderController.getTerritoryTypesAndRolesForActiveETM()]).then(([e,i])=>{if(l=l&&e,r&&"Lead"===r.sObject&&!i.isLeadAssignmentEnabled&&(l=!1),e&&i){const e=i.roles;l=l&&e&&e.includes(a);const t=i.territoryTypes;for(selectedTerrtoryType of n)if(!t.includes(selectedTerrtoryType)){l=!1;break}}t(Boolean(l))}).catch(e=>{t(!1)})})},Magellan.Validation.validateLeadBasedRouting=function(e){var t=!_.isEmpty(e.nodeInfo["routing type"]);return t=t&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType),"custom field"===e.nodeInfo["routing type"]&&(t=t&&Magellan.Validation.metadataFieldExists("Lead",e.nodeInfo["custom field"])),t},Magellan.Validation.validateContactBasedRouting=function(e){var t=!_.isEmpty(e.nodeInfo["routing type"]);return t=t&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType),"custom field"===e.nodeInfo["routing type"]&&(t=t&&Magellan.Validation.metadataFieldExists("Contact",e.nodeInfo["custom field"])),t},Magellan.Validation.validateOpportunityBasedRouting=function(e){var t=!_.isUndefined(e.nodeInfo["obr type"])&&!_.isNull(e.nodeInfo["obr type"])&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType);return t&&"custom field"===e.nodeInfo["obr type"]&&(t=t&&Magellan.Validation.metadataFieldExists("Opportunity",e.nodeInfo["custom field"])),t},Magellan.Validation.validateActivityBasedRouting=function(e){let t=!_.isUndefined(e.nodeInfo["rabr type"])&&!_.isNull(e.nodeInfo["rabr type"])&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType),i=!1;const a=_LeanData.Util.convertFieldSelectionStringToArray(e.nodeInfo["custom field"],"Activity",fieldMetaDataMap);return a.length>0&&(i=["User","Group/User","AssignedTo"].includes(a.at(-1).objectType)),"custom field"===e.nodeInfo["rabr type"]?t&&i:t},Magellan.Validation.validateCampaignMemberBasedRouting=function(e){var t=!_.isUndefined(e.nodeInfo["rcmbr type"])&&!_.isNull(e.nodeInfo["rcmbr type"])&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType);if(t&&"custom field"===e.nodeInfo["rcmbr type"]){let i=e.nodeInfo["custom field"];t=(t=t&&!_.isUndefined(i)&&!_.isNull(i))&&Magellan.Validation.metadataFieldExists("CampaignMember",e.nodeInfo["custom field"])}return t},Magellan.Validation.validateConvertedLeadStatus=function(e){var t=!_.isUndefined(e)&&!_.isNull(e),i=_.map(Object.keys(actionNodeMetaData.convertedLeadStatusApiNameToLabel),function(e){return e});return t=t&&_.includes(i,e)},Magellan.Validation.validateCreateAccount=function(e){var t=$.Deferred(),i=[],a=!e.nodeInfo.convertLeadToContact||Magellan.Validation.validateConvertedLeadStatus(e.nodeInfo["convert status"]);const n=e.nodeInfo.convertLeadToContact&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CONVERT")||!e.nodeInfo.doNotCreateOpportunity&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY")||!e.nodeInfo.doNotCreateOpportunity&&!e.nodeInfo.convertLeadToContact&&"accountTeamAssignment"===e.nodeInfo.ownerAssignmentType&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS");if(n&&(Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e),(a=a&&!n)&&e.nodeInfo.accFields){let t=!0;_.each(e.nodeInfo.accFields,function(i){if(i.dataType&&t)if("field"===i.type&&i.readFieldOrValue){let e=_LeanData.Util.convertFieldSelectionStringToArray(i.readFieldOrValue,_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap());if(0===e.length)t=!1;else{const a=e[e.length-1].type;t=t&&_.includes(_LeanData._function.SFDC_VALID_TYPE_MAPPING[a],i.dataType)}}else t=t&&Magellan.Validation.isValidValueOfType(i.dataType,i.readFieldOrValue);else t=!1;_.isEmpty(i.type)||"field"!==i.type||(a=a&&Magellan.Validation.metadataFieldExists(_LeanData._function.VARIABLES_FIELDNAME,i.readFieldOrValue)),null!=i.readFieldOrValue&&i.readFieldOrValue.includes("{!")&&(a=a&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,i.readFieldOrValue,"STRING",i.writeField))}),a=a&&t}const o=$.Deferred();i.push(o),null==e.nodeInfo.accRecordTypeId?o.resolve(!0):_.isUndefined(e.nodeInfo.accRecordTypeId)?(a=!1,o.resolve(!0)):_LeanData.FlowBuilderController.queryRecordTypes(e.nodeInfo.accRecordTypeId).then(function(e){const t=_LeanData.MetaDataController.getFieldMetaDataMap(),i=null!=t.Account&&t.Account.hasOwnProperty("recordtypeid");0==e.length&&i&&(a=!1)}).finally(()=>{o.resolve(!0)});const l=$.Deferred();return i.push(l),!a||e.nodeInfo.convertLeadToContact||e.nodeInfo.doNotCreateOpportunity?l.resolve():Magellan.Validation.validateCreateOpportunity(e).then(e=>{a=a&&e,l.resolve()}),$.when(...i).always(function(){t.resolve(a)}),t},Magellan.Validation.validateCreateOpportunity=function(e){var t=$.Deferred(),i=[],a=!0;e.nodeInfo.opportunityFields||(a=!1);const n=$.Deferred();i.push(n),null==e.nodeInfo.recordTypeId?n.resolve(!0):_.isUndefined(e.nodeInfo.recordTypeId)?(a=!1,n.resolve(!0)):_LeanData.FlowBuilderController.queryRecordTypes(e.nodeInfo.recordTypeId).then(function(e){const t=_LeanData.MetaDataController.getFieldMetaDataMap(),i=null!=t.Opportunity&&t.Opportunity.hasOwnProperty("recordtypeid");0==e.length&&i&&(a=!1)}).finally(()=>{n.resolve(!0)}),!(e.nodeInfo.closeDays<0||""===e.nodeInfo.closeDays)||null!=e.nodeInfo.closeDate&&""!=e.nodeInfo.closeDate&&e.nodeInfo.closeDate.match(/^([0][1-9]|[1][0-2])\/([0][1-9]|[1-2][0-9]|[3][0-1])\/\d{4}$/)||(a=!1),"customUserField"!=e.nodeInfo.ownerAssignmentType||null!=e.nodeInfo.customUserField&&""!=e.nodeInfo.customUserField||(a=!1),_.each(e.nodeInfo.opportunityFields,function(t){if(null==t.readFieldOrValue||null==t.writeField||""==t.readFieldOrValue||0==t.isValid)a=!1;else if(t.dataType&&"value"==t.type)a=(a=(a=a&&Magellan.Validation.isValidValueOfType(t.dataType,t.readFieldOrValue))&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,t.readFieldOrValue,"STRING",t.writeField))&&Magellan.Validation.metadataFieldExists("Opportunity",t.writeField);else if("name"===t.writeField){var i=Magellan.Validation.isValidMergeFieldValueMessages(e.nodeInfo.name,t.readFieldOrValue,"STRING","opportunity.name");a=a&&_.isEmpty(i)}_.isEmpty(t.type)||"field"!==t.type||(a=a&&Magellan.Validation.metadataFieldExists(_LeanData._function.VARIABLES_FIELDNAME,t.readFieldOrValue))});const o=$.Deferred();if(i.push(o),"accountTeamAssignment"==e.nodeInfo.ownerAssignmentType){const t=!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:ACCOUNT_TEAMS");t&&(Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e),(t||null==e.nodeInfo.ownerAssignmentValue||""==e.nodeInfo.ownerAssignmentValue)&&(a=!1),Magellan.Validation.validateAccountTeam(e.nodeInfo.ownerAssignmentValue).then(e=>{a=a&&e,o.resolve(e&&a)})}else"explicitOwnerAssignment"==e.nodeInfo.ownerAssignmentType?(null!=e.nodeInfo.ownerAssignmentValue&&""!=e.nodeInfo.ownerAssignmentValue||(a=!1,o.resolve(!1)),_LeanData.FlowBuilderController.queryUsers([e.nodeInfo.ownerAssignmentValue]).then(function(e){a=!(0===e.length||!e[0].IsActive),o.resolve(a)})):o.resolve(a);return $.when(...i).always(function(){t.resolve(a)}),t},Magellan.Validation.validateConvert=async function(e){var t=Magellan.Validation.validateConvertedLeadStatus(e.nodeInfo["convert status"]);if(!e.nodeInfo.doNotCreateOpportunity){const i=!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:CREATE_OPPORTUNITY");i&&(Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e),t=t&&!i}return e.nodeInfo["explicit account conversion"]&&await _LeanData.FlowBuilderController.queryAccounts([e.nodeInfo["explicit account id"]]).then(function(e){t=t&&!_.isEmpty(e)}),t},Magellan.Validation.validateMergeContact=function(e){return Magellan.Validation.validateConvertedLeadStatus(e.nodeInfo["merge status"])},Magellan.Validation.validateRoundRobin=async function(e){var t=e.nodeInfo["round robin id"],i=!_.isEmpty(t)&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],_LeanData.AppState.PrimarySObjectType);return i?(await _LeanData.FlowBuilderController.queryRoundRobinPools([t]).then(function(t){const a="Meeting"===_LeanData.AppState.PrimarySObjectType||_LeanData.AppState.isHandoffGraph||_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:ADVANCED_ROUND_ROBIN");i=t.length>0,t.forEach(t=>{const n=a||!_LeanData.Util.hasAdvancedRoundRobinFeatures(t);n||(Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e),i=i&&n&&(_LeanData.AppState.businessUnitId?t.LD_Business_Unit__c===_LeanData.AppState.businessUnitId:void 0===t.LD_Business_Unit__c)})}),i):i},Magellan.Validation.validateUpdatePrimary=function(e){var t=!0;_.isEmpty(e.nodeInfo.updates)&&_.isEmpty(e.nodeInfo.assignmentRuleSelection)&&(t=!1);const i=_LeanData.StringUtil.debracketize(e.nodeInfo.variable)||_LeanData.VariablesUtil.getReservedVariableName("routed",_LeanData.AppState.PrimarySObjectType);if(!Magellan.Validation.validateVariable(e.nodeInfo.name,i))return!1;const a=_LeanData.AppState.getCurrentVariablesService().getVariableByName(i);var n=_LeanData.MetaDataController.getAssignmentRulesIdMap(a.sObject);return!_.isEmpty(e.nodeInfo.assignmentRuleSelection)&&actionNodeMetaData.allowAssignmentRule&&(t=t&&n.hasOwnProperty(e.nodeInfo.assignmentRuleSelection)),_.each(e.nodeInfo.updates,function(i){t=t&&Magellan.Validation.validateFieldUpdateCondition(e,a.sObject,i)}),t},Magellan.Validation.validateFieldUpdateCondition=function(e,t,i){const a=e.nodeInfo.name,n=i.value,o=i.field,l=i.type;if(!Magellan.Validation.metadataFieldExists(t,o))return!1;let s=Magellan.Validation.isValidMergeFieldValue(a,n,l,o);const r="string"==typeof n&&n.match(_LeanData._regex.VARIABLE_REGEX())||[];if(e instanceof _LeanData.GraphModels.Action_UpdateRecord&&("ID"!==i.type&&"STRING"!==i.type&&"TEXTAREA"!==i.type||(s=s||Magellan.Validation.isValidMergeFieldValue(a,i.value,"STRING",i.field))),r.length>0)"String"!==_LeanData._function.SFDC_TYPE_TO_GROUPING[l]&&r[0]!==n&&(s=!1);else if(s){const e=!_LeanData.MetaDataController.getFieldMetaDataMap()[t][o].isNillable,i=""===n||null===n;let a=!e&&i;a||(a="PICKLIST"===l||Magellan.Validation.isValidValueOfType(l,n)),(e&&i||!a)&&(s=!1)}return s},Magellan.Validation.validateExplicitOwnerAssignment=function(e){const t=$.Deferred(),i=_LeanData.StringUtil.debracketize(e.nodeInfo.variable)||_LeanData.VariablesUtil.getReservedVariableName("routed",_LeanData.AppState.PrimarySObjectType);if(_LeanData._getOrganizationData(),!i.startsWith("routed ")&&!_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:RELATED_RECORDS_UPDATE"))return Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e,t.resolve(!1),t;if(!Magellan.Validation.validateVariable(e.nodeInfo.name,i))return t.resolve(!1),t;const a=_LeanData.AppState.getCurrentVariablesService().getVariableByName(i),n=a?a.sObject:_LeanData.AppState.PrimarySObjectType;if(_.isEmpty(e.nodeInfo.assignmentType)||"by user id"===e.nodeInfo.assignmentType){let i="string"==typeof(e.nodeInfo["explicit owner assignment id"]||null)&&!_.isEmpty(e.nodeInfo["assignment field"])&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],n);"None"===e.nodeInfo["explicit owner assignment id"]&&"OwnerId"!==e.nodeInfo["assignment field"]?t.resolve(i):_LeanData.FlowBuilderController.queryOwners([e.nodeInfo["explicit owner assignment id"]]).then(a=>{(i=i&&a.length>0)&&!a[0].Id.startsWith("00G")?i=i&&a[0].IsActive:i&&a[0].Id.startsWith("00G")&&(i=i&&!_LeanData.AppState.isHandoffGraph&&_LeanData.FBUtil.isObjectTypeQueueOwnable(n)&&"OwnerId"===e.nodeInfo["assignment field"]),t.resolve(i)})}else if("user field"===e.nodeInfo.assignmentType){const i=e.nodeInfo["user field"]||"",a=_LeanData.StringUtil.debracketize(i);let o=a.split(".",1)[0],l=!_.isEmpty(a)&&(a.endsWith("id")||a.endsWith("__c"))&&Magellan.Validation.validateVariable(e.nodeInfo.name,o)&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,i,"STRING","Explicit Owner Assignment")&&!_.isEmpty(e.nodeInfo["assignment field"])&&Magellan.Validation.isValidUserAssignmentField(e.nodeInfo["assignment field"],n);t.resolve(l)}return t},Magellan.Validation.validateEdgeNames=function(e){var t=!0;if(!_.isArray(e.nodeInfo.edges)||e.nodeInfo.edges.length<1)return t;if(!(e instanceof _LeanData.GraphModels.Decision_BranchNode||e instanceof _LeanData.GraphModels.TriggerNode||e instanceof _LeanData.GraphModels.Partner_ZoomInfo||e instanceof _LeanData.GraphModels.ReroutingNode))return!0;for(var i={},a=0,n=e.nodeInfo.edges.length;a<n;a++){var o=e.nodeInfo.edges[a];if(o.hasOwnProperty("name")){if(i.hasOwnProperty(o.name.toLowerCase())||""==o.name.trim()){t=!1;break}i[o.name.toLowerCase()]=!0}}return t},Magellan.Validation.validatePartnerUpdateFP=function(e){let t="";switch(e){case"Sendoso - Add Prospect to Touch":t="sendosoAddProspectToTouch";break;case"Kronologic - Book Meeting with AI":t="kronologicAIScheduling";break;case"Salesloft - Remove from Cadence":t="salesloftAddToCadence";break;case"Outreach - Remove from Sequence":t="outreachAddToSequence";break;case"Groove - Add To Flow":t="grooveAddToFlow";break;case"Gong - Add To Flow":t="gongAddToFlow"}return _LeanData.FeatureProvisioning.isFeatureEnabled(t)},Magellan.Validation.validateHVSAddToSalesCadence=function(e){if(_LeanData.MetaDataController.getPartnerAuthorization("salesforce sales engagement")){if(0===e.nodeInfo.salesCadenceSelection.length)return $.Deferred(e=>e.resolve(!1));const t=$.Deferred();let i;if("specific"===e.nodeInfo.assigneeSelection){if(0===e.nodeInfo.userSelection.length)return $.Deferred(e=>e.resolve(!1));i=_LeanData.FlowBuilderController.hvs_validateHVSUser(e.nodeInfo.userSelection)}else"owner"===e.nodeInfo.assigneeSelection?i=new Promise((e,t)=>e(!0)):"customField"===e.nodeInfo.assigneeSelection&&(i=new Promise((t,i)=>t(""!==e.nodeInfo.customUserField)));const a=_LeanData.FlowBuilderController.hvs_validateSalesCadence(e.nodeInfo.salesCadenceSelection);return Promise.all([i,a]).then(([e,i])=>{t.resolve(e&&i)}),t}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateOutreachAddToSequence=function(e){if(_LeanData.MetaDataController.getPartnerAuthorization("outreach")){const t=_LeanData.MetaDataController.getPartnerConfiguration("outreach");if(!(t.leadProspectIdField&&t.contactProspectIdField&&t.userIdField))return $.Deferred(e=>e.resolve(!1));if(!e.nodeInfo.sequenceSelection[0])return $.Deferred(e=>e.resolve(!1));const i=$.Deferred();let a,n;if("specific"===e.nodeInfo.mailboxSelection){if(!e.nodeInfo.userSelection[0])return $.Deferred(e=>e.resolve(!1));a=_LeanData.FlowBuilderController.outreach_validateOutreachUser(e.nodeInfo.userSelection[0])}else"owner"===e.nodeInfo.mailboxSelection?a=new Promise((e,t)=>e(!0)):"customField"===e.nodeInfo.mailboxSelection&&(a=new Promise((t,i)=>t(""!==e.nodeInfo.customUserField)));if("specific"===e.nodeInfo.ownershipSelection){if(!e.nodeInfo.ownerSelection[0])return $.Deferred(e=>e.resolve(!1));n=_LeanData.FlowBuilderController.outreach_validateOutreachUser(e.nodeInfo.ownerSelection[0])}else"owner"===e.nodeInfo.ownershipSelection?n=new Promise((e,t)=>e(!0)):"customField"===e.nodeInfo.ownershipSelection&&(n=new Promise((t,i)=>t(""!==e.nodeInfo.customUserOwnerField)));const o=_LeanData.FlowBuilderController.outreach_validateOutreachSequence(e.nodeInfo.sequenceSelection[0]);return Promise.all([a,n,o]).then(([e,t,a])=>{i.resolve(e&&t&&a)}),i}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateOutreachCreateTask=function(e){const t=$.Deferred();if(_LeanData.MetaDataController.getPartnerAuthorization("outreach")){const i=_LeanData.MetaDataController.getPartnerConfiguration("outreach");if(!i.userIdField||!i.accountIdField)return $.Deferred(e=>e.resolve(!1));let a;if("specificUser"===e.nodeInfo.assignToSelection){if(!e.nodeInfo.explicitOwnerAssignmentSelection[0])return $.Deferred(e=>e.resolve(!1));a=_LeanData.FlowBuilderController.outreach_validateOutreachUser(e.nodeInfo.explicitOwnerAssignmentSelection[0])}else"userField"===e.nodeInfo.assignToSelection&&(a=new Promise((t,i)=>{t(""!==e.nodeInfo.userField&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,e.nodeInfo.userField,"STRING","Outreach Create Task")&&"User"===_LeanData.Util.getMergeFieldSObjectType(e.nodeInfo.userField)[0])}));return"relative"===e.nodeInfo.dueDateSelection&&(!e.nodeInfo.dueDateValue||e.nodeInfo.dueDateValue<0)?$.Deferred(e=>e.resolve(!1)):Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.nodeName,e.nodeInfo.taskNote,"STRING","null")?(Promise.all([a]).then(([e])=>{t.resolve(e)}),t):$.Deferred(e=>e.resolve(!1))}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateZoominfoEnrichNode=function(e,t){return new Promise((e,i)=>{if(_LeanData.MetaDataController.getPartnerAuthorization("zoominfo")){if(0===_LeanData.MetaDataController.getPartnerApplicableObjectTypes("zoominfo",new Set([t])).size)return void i();Promise.all([_LeanData.RemotingRouter.zoominfo_appInstalled()]).then(([t])=>{t?e(!0):i()}).catch((...e)=>{console.error(e),i()})}else i()})},Magellan.Validation.validateSalesloftAddToCadence=function(e){if(_LeanData.MetaDataController.getPartnerAuthorization("salesloft")){if(!e.nodeInfo.cadenceSelection[0])return $.Deferred(e=>e.resolve(!1));const t=$.Deferred();let i;if("specific"===e.nodeInfo.assigneeSelection){if(!e.nodeInfo.userSelection[0])return $.Deferred(e=>e.resolve(!1));i=_LeanData.FlowBuilderController.salesloft_validateSalesloftUser(e.nodeInfo.userSelection[0])}else"owner"===e.nodeInfo.assigneeSelection?i=new Promise((e,t)=>e(!0)):"customField"===e.nodeInfo.assigneeSelection&&(i=new Promise((t,i)=>t(""!==e.nodeInfo.customUserField)));const a=_LeanData.FlowBuilderController.salesloft_validateSalesloftCadence(e.nodeInfo.cadenceSelection[0]);return Promise.all([i,a]).then(([e,i])=>{t.resolve(e&&i)}),t}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateSalesloftRhythmSendSignal=function(e){let t=!0;const i=_LeanData._flowbuilder.SALESLOFT_RHTYHM_SIGNAL_TYPE_MAP;if(_LeanData.MetaDataController.getPartnerAuthorization("salesloft rhythm"))if(e.nodeInfo.signalType){const a=e.nodeInfo.signalType,n=e.nodeInfo[a];for(let o of i[a])if(!o.isReadOnly)if("User"==o.type){let i=_LeanData.StringUtil.debracketize(n[o.label]).split("."),a=i[0],l=i[i.length-1];t=t&&this.validateVariable(e.nodeInfo.name,a)&&(l.endsWith("__c")||l.endsWith("id"))&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,n[o.label],"STRING","Salesloft Rhythm")}else t=t&&this.validateVariable(e.nodeInfo.name,n[o.label])}else t=!1;else t=!1;return $.Deferred(e=>e.resolve(t))},Magellan.Validation.validateGrooveAddToFlow=function(e,t){if(_LeanData.MetaDataController.getPartnerAuthorization("groove")){if(!e.nodeInfo.flowSelection[0])return $.Deferred(e=>e.resolve(!1));const i=$.Deferred();let a;if("specific"===e.nodeInfo.assigneeSelection){if(!e.nodeInfo.userSelection[0])return $.Deferred(e=>e.resolve(!1));a=_LeanData.FlowBuilderController.groove_validateGrooveUser(e.nodeInfo.userSelection[0])}else"owner"===e.nodeInfo.assigneeSelection?a=new Promise((e,t)=>e(!0)):"customField"===e.nodeInfo.assigneeSelection&&(a=new Promise((t,i)=>t(""!==e.nodeInfo.customUserField)));const n=_LeanData.FlowBuilderController.groove_validateFlow(e.nodeInfo.flowSelection[0]);return Promise.all([_LeanData.FlowBuilderController.partner_checkAuthorization("groove","grooveAuthorization",t),a,n]).then(([e,t,a])=>{i.resolve("success"===e.status&&t&&a)}),i}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateGongAddToFlow=function(e,t){if(_LeanData.MetaDataController.getPartnerAuthorization("gong")){if(!e.nodeInfo.flowSelection[0])return $.Deferred(e=>e.resolve(!1));const i=$.Deferred();let a;if("specific"===e.nodeInfo.assigneeSelection){if(!e.nodeInfo.userSelection[0])return $.Deferred(e=>e.resolve(!1));a=_LeanData.FlowBuilderController.gong_validateGongUser(e.nodeInfo.userSelection[0])}else"owner"===e.nodeInfo.assigneeSelection?a=new Promise((e,t)=>e(!0)):"customField"===e.nodeInfo.assigneeSelection&&(a=new Promise((t,i)=>t(""!==e.nodeInfo.customUserField)));const n=_LeanData.FlowBuilderController.gong_validateFlow(e.nodeInfo.flowSelection[0]);return Promise.all([_LeanData.FlowBuilderController.gong_checkAuthorization(t),a,n]).then(([e,t,a])=>{i.resolve("success"===e.status&&t&&a)}),i}return $.Deferred(e=>e.resolve(!1))},Magellan.Validation.validateSlackSendNotificationToken=function(e,t){const i=$.Deferred();return _LeanData.FlowBuilderController.slack_checkAuthorization(t).then(t=>{let a=t.ok;(e.nodeInfo.notifyPlus||e.nodeInfo.channelMode)&&(a=a&&!t.isLegacy),i.resolve(a)}),i},Magellan.Validation.validateSlackSendNotificationTokenAndChannel=function(e,t){const i=$.Deferred();let a=[];return e.nodeInfo.notificationSettings.success.recipients.slackChannels.length>0&&a.push(_LeanData.FlowBuilderController.slack_validateSlackChannel(e.nodeInfo.notificationSettings.success.recipients.slackChannels)),e.nodeInfo.notificationSettings.success.recipients.slackIds.length>0&&a.push(_LeanData.FlowBuilderController.slack_validateSlackUser(e.nodeInfo.notificationSettings.success.recipients.slackIds)),Promise.all([Magellan.Validation.validateSlackSendNotificationToken(e,t),...a]).then(([t,...a])=>{let n=t;e.nodeInfo.notifyPlus&&(n=n&&!t.isLegacy),i.resolve(n&&Array.from(a).reduce((e,t)=>e&&t,!0))}),i},Magellan.Validation.validateSixSenseEnrichCompany=function(e,t){return new Promise(i=>{let a=!0;a=a&&_.isInteger(e.minutes)&&e.minutes>=5&&e.minutes<=180,_LeanData.FlowBuilderController.sixsense_checkAuthorization(t).then(e=>{a=a&&"success"===e.status,i(a)})})},Magellan.Validation.validateCrossbeamAuthAndVariables=function(e,t){if(_.isEmpty(e.variableToPartnerNameMap))return!1;let i=!0;return Object.keys(e.variableToPartnerNameMap).forEach(t=>{i=(i=(i=i&&Magellan.Validation.validateVarName(t))&&_LeanData.AppState.getCurrentVariablesService().isValueCompatible(t,e.variableToPartnerNameMap[t],e.name))&&Magellan.Validation.isValidMergeFieldValue(e.name,e.variableToPartnerNameMap[t],"STRING","Identify Partner Overlaps")}),i=i&&_.isInteger(e.minutes)&&e.minutes>=5&&e.minutes<=180,_LeanData.FlowBuilderController.crossbeam_checkAuthorization(t).then(e=>i&&void 0!==e.user&&!0===e.user.active)},Magellan.Validation.validateMsftTeamsSendNotificationTokenAndChannel=function(e,t){const i=$.Deferred();let a=[];const n=e.nodeInfo.notificationSettings.success.recipients.microsoftTeamsTeamsAndChannels;return n.length>0&&(a.push(_LeanData.FlowBuilderController.microsoftTeams_validateTeamsChannel(n)),n.forEach(e=>{const t=e.id,i=JSON.parse(e.channelData);"private"==i.accessType&&a.push(_LeanData.FlowBuilderController.microsoftTeams_checkChannelMembership(t,i.id))})),e.nodeInfo.notificationSettings.success.recipients.microsoftTeamsIds.length>0&&a.push(_LeanData.FlowBuilderController.microsoftTeams_validateTeamsUser(e.nodeInfo.notificationSettings.success.recipients.microsoftTeamsIds)),Promise.all([_LeanData.FlowBuilderController.microsoftTeams_checkAuthorization(t),...a]).then(([e,...t])=>{i.resolve(e.ok&&Array.from(t).reduce((e,t)=>e&&t,!0))}),i},Magellan.Validation.validateCreateObject=function(e){const t=e.nodeInfo.eventCreation?"eventCreation":null,i=$.Deferred(),a=[];if(!(t?e.nodeInfo[t].assignedToType:e.nodeInfo.assignedToType))return!1;window.graph&&Magellan.Validation.getNodesToCurrentNode(e.nodeInfo.name);let n=!0;if(!Magellan.Validation.validateVariable(e.nodeInfo.name,t?e.nodeInfo[t].relatedToValue:e.nodeInfo.relatedToValue))return!1;if(!t||"routed meeting"!=_LeanData.StringUtil.debracketize(e.nodeInfo[t].relatedToValue)){const i=$.Deferred();a.push(i),_LeanData.MetaDataController.activityRelatedToObjects().then(i=>{const a=new Set(i),o=_LeanData.AppState.getCurrentVariablesService().getVariableByName(_LeanData.StringUtil.debracketize(t?e.nodeInfo[t].relatedToValue:e.nodeInfo.relatedToValue)),l=_LeanData.Validation.validateVariableSelection(e.nodeInfo.name,_LeanData.AppState.getCurrentVariablesService(),o,o?o.name:"",o?o.label:"","read",!1,"",a,_LeanData.AppState.PrimarySObjectType);n=""===l}).catch(()=>{n=!1}).finally(function(){i.resolve()})}if(t?"assignedToVariable"===e.nodeInfo[t].assignedToType:"assignedToVariable"===e.nodeInfo.assignedToType){const i=t?e.nodeInfo[t].assignedToValue:e.nodeInfo.assignedToValue;if(!Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,i,"STRING","task.ownerid"))return!1}if(!t){if(!_.isEmpty(e.nodeInfo.dueDate)&&e.nodeInfo.dueDate!==moment(e.nodeInfo.dueDate).format("MM/DD/YYYY"))return!1;let t=e.nodeInfo.taskDays.toString();if(_.isEmpty(t)||"-3"===t&&_.isEmpty(e.nodeInfo.dueDate)||!_.isEmpty(t.match(/[^0-9]/g))&&"-1"!==t&&"-3"!==t)return!1}var o=!0;if(_.each(t?e.nodeInfo[t].additionalFields:e.nodeInfo.taskFields,function(i){_.isEmpty(i.readFieldOrValue)||_.isEmpty(i.writeField)||!i.isValid?o=!1:i.dataType&&"value"==i.type&&(o=(o=o&&Magellan.Validation.isValidValueOfType(i.dataType,i.readFieldOrValue))&&Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,i.readFieldOrValue,"STRING",i.writeField)),_.isEmpty(i.type)||"field"!==i.type||(o=o&&Magellan.Validation.metadataFieldExists(_LeanData._function.VARIABLES_FIELDNAME,i.readFieldOrValue)),t&&"reminder"===i.writeField||(o=o&&Magellan.Validation.metadataFieldExists(t?"Event":"Task",i.writeField))}),t?"assignedToExplicitOwner"===e.nodeInfo[t].assignedToType:"assignedToExplicitOwner"===e.nodeInfo.assignedToType){const i=$.Deferred();a.push(i),_.isEmpty(t?e.nodeInfo[t].assignedToValue:e.nodeInfo.assignedToValue)?(o=!1,i.resolve()):_LeanData.FlowBuilderController.queryUsers([t?e.nodeInfo[t].assignedToValue:e.nodeInfo.assignedToValue]).then(function(e){0!==e.length&&e[0].IsActive||(o=!1)}).finally(function(){i.resolve()})}const l=$.Deferred();return a.push(l),(t?_LeanData.FlowBuilderController.getEventFieldValues:_LeanData.FlowBuilderController.getTaskFieldValues)().then(function(i){const a=i.statuses,n=i.priorities;if(a){var l=!1,s=_.filter(a,function(t){return t.active||t.value!==e.nodeInfo.taskStatus||(l=!0),t.active&&t.value===e.nodeInfo.taskStatus})[0];_.isEmpty(e.nodeInfo.taskStatus)&&(o=!1),!_.isEmpty(e.nodeInfo.taskStatus)&&l&&(o=!1),!_.isEmpty(e.nodeInfo.taskStatus)&&_.isEmpty(s)&&(o=!1)}if(_.isEmpty(t?e.nodeInfo[t].subject:e.nodeInfo.taskSubject)?o=!1:Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,t?e.nodeInfo[t].subject:e.nodeInfo.taskSubject,"STRING",e.nodeInfo.eventCreation?"event.subject":"task.subject")||(o=!1),n){var r=!1,d=_.filter(n,function(t){return t.active||t.value!==e.nodeInfo.taskPriority||(r=!0),t.active&&t.value===e.nodeInfo.taskPriority})[0];_.isEmpty(e.nodeInfo.taskPriority)&&(o=!1),!_.isEmpty(e.nodeInfo.taskPriority)&&r&&(o=!1),!_.isEmpty(e.nodeInfo.taskPriority)&&_.isEmpty(d)&&(o=!1)}}).finally(function(){l.resolve()}),$.when(...a).always(function(){i.resolve(o&&n)}),i},Magellan.Validation.validateAssignAccountTeamMembers=function(e){if(!_LeanData._getOrganizationData().statuses.accountTeamsEnabled)return!1;const t=e.nodeInfo["atm fields"];if(!t||0===t.length)return!1;const i=new Set,a=new Set;for(const e of t){if(!e.writeField)return!1;if("string"==typeof e.writeField){if(i.has(e.writeField))return!1;i.add(e.writeField)}else{if(a.has(e.writeField.Id))return!1;a.add(e.writeField.Id)}}return!!Array.from(i).every(e=>Magellan.Validation.isValidUserFieldValues(e,"Account",_LeanData.MetaDataController.getFieldMetaDataMap()))&&Promise.all([_LeanData.FlowBuilderController.searchAccountTeamRoles(),_LeanData.FlowBuilderController.queryUsers(Array.from(a))]).then(([e,i])=>i.every(e=>e.IsActive)&&a.size===i.length&&t.every(t=>e.AccountTeamRoles.some(e=>t.readField&&e.value===t.readField.value)))},Magellan.Validation.validateAssignOpportunityTeamMembers=function(e){if(!_LeanData._getOrganizationData().statuses.opportunityTeamsEnabled)return!1;const t=e.nodeInfo.oppTeamMembers;if(!t||0===t.length)return!1;const i=new Set,a=new Set;for(const e of t){if(!e.keyField||!e.memberRole)return!1;if("string"==typeof e.keyField){if(i.has(e.keyField))return!1;i.add(e.keyField)}else{if(0===e.keyField.length)return!1;if(a.has(e.keyField[0].Id))return!1;a.add(e.keyField[0].Id)}if(0===e.memberRole.length)return!1}return!!Array.from(i).every(e=>Magellan.Validation.isValidUserFieldValues(e,"Opportunity",_LeanData.MetaDataController.getFieldMetaDataMap()))&&Promise.all([_LeanData.FlowBuilderController.searchOpportunityTeamRoles(),_LeanData.FlowBuilderController.queryUsers(Array.from(a))]).then(([e,i])=>i.every(e=>e.IsActive)&&a.size===i.length&&t.every(t=>e.OpportunityTeamRoles.some(e=>t.memberRole&&e.value===t.memberRole[0].value)))},Magellan.Validation.validateAssignContactRole=function(e){const t=_LeanData.MetaDataController.getFieldMetaDataMap();let i=!0;return Promise.all([_LeanData.RemotingRouter.getOpportunityContactRoles(),_LeanData.RemotingRouter.getContactRoleRules()]).then(([e,a])=>(a.contactRoleRules&&(i=!a.defaultRole||e.some(e=>e.value===a.defaultRole),_.forEach(a.contactRoleRules,a=>{a.conditionsValid=a.conditions.every(e=>!(!t.hasOwnProperty(e["picklist object"])||!t[e["picklist object"]][e["picklist field"]])),a.roleValid=e.some(e=>e.value===a.contactRole),a.conditionsValid&&a.roleValid||(i=!1)})),i))},Magellan.Validation.validateAddCampaignMember=function(e){const t=e.nodeInfo.campaign,i=e.nodeInfo.campaignMemberStatus;return 0!==Object.keys(t).length&&0!==Object.keys(i).length&&Promise.all([_LeanData.FlowBuilderController.validateAccountAsCampaignMember(),_LeanData.FlowBuilderController.queryCampaigns([t]),_LeanData.RemotingRouter.retrievePicklistLabelToApiMapping("CampaignMember","Status",!0)]).then(([e,t,a])=>{const n="Account"!==_LeanData.AppState.PrimarySObjectType||e,o=!_.isEmpty(t);return n&&o&&i in a})},Magellan.Validation.validateSetVariable=function(e){if(_.isEmpty(e.variableValues))return!1;let t=!0;return Object.keys(e.variableValues).forEach(i=>{t=(t=(t=t&&Magellan.Validation.validateVarName(i))&&_LeanData.AppState.getCurrentVariablesService().isValueCompatible(i,e.variableValues[i],e.name))&&Magellan.Validation.isValidMergeFieldValue(e.name,e.variableValues[i],"STRING","Set Variable")}),t},Magellan.Validation.isValidRerouteTimeFrame=function(e,t,i){var a=1440*e+60*t+i;return a>=5&&a<=43200},Magellan.Validation.metadataFieldExists=function(e,t){if(_.isEmpty(t))return!1;let i=_LeanData.MetaDataController.getFieldValidationCache(e);if(i||(i=_LeanData.MetaDataController.setFieldValidationCache(e,{})),_.isBoolean(i[t]))return i[t];const a=e===_LeanData._function.VARIABLES_FIELDNAME?[]:_LeanData.Util.convertFieldSelectionStringToArray(t,e,_LeanData.MetaDataController.getOptimaFieldMetaDataMap()),n=_LeanData.MetaDataController.getFieldMetaDataMap(),o=_LeanData.AppState.getCurrentVariablesService(),l=o?o.getVariablesMap(_LeanData.AppState.PrimarySObjectType):{},s=o?o.getOriginalNameCaseMap():{},r=_LeanData.Util.convertFieldSelectionStringToArray(t,e,n,l,s),d=a.length>0&&"REFERENCE"!==a[a.length-1].type&&"SOBJECT"!==a[a.length-1].type||r.length>0&&"REFERENCE"!==r[r.length-1].type&&"SOBJECT"!==r[r.length-1].type;return i[t]=d,_LeanData.MetaDataController.setFieldValidationCache(e,i),d},Magellan.Validation.isValidUserFieldValues=function(e,t,i){var a=_LeanData.Util.convertFieldSelectionStringToArray(e,t,i);if(_.isEmpty(a))return!1;var n=a[a.length-1],o="REFERENCE"===n.type&&n.parent.indexOf("User")>-1;return"ID"===n.type&&("User"===n.objectType||"Group/User"===n.objectType||"AssignedTo"===n.objectType||"Account"===n.objectType||"Contact"===n.objectType)||o},Magellan.Validation.isValidUserVariable=function(e){const t=_LeanData.Util.convertFieldSelectionStringToArray(_LeanData.StringUtil.debracketize(e),_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap());if(_.isEmpty(t))return!1;const i=t[t.length-1],a="REFERENCE"===i.type&&i.parent.indexOf("User")>-1;return"ID"===i.type&&["User","Group/User","AssignedTo","Account","Contact"].includes(i.objectType)||a},Magellan.Validation.validateVariableSetter=async function(e,t){let i=!0,a={};const n=_LeanData.GraphModelTypeMap[e._model];n&&"function"==typeof n.getVariableNamesToExpectedSObjectTypes&&(a=await n.getVariableNamesToExpectedSObjectTypes(e,t));for(let e in a){const t=_LeanData.AppState.getCurrentVariablesService().getVariableByName(_LeanData.StringUtil.debracketize(e));i=i&&e&&Magellan.Validation.validateVarName(e)&&(0==a[e].length||a[e].includes(t.sObject))}return i},Magellan.Validation.validateActiveChatterUsers=async function(e){try{return!(await _LeanData.FlowBuilderController.searchChatterUsers("",e,!0)).some(e=>!e.IsActive)}catch(e){return console.error("Error validating notification recipients:",e),!1}},Magellan.Validation.validateVarName=function(e){e=_LeanData.StringUtil.debracketize(e);let t=!0,i=_LeanData.AppState.getCurrentVariablesService().getVariableByName(e);return t=t&&i&&i.label&&_LeanData.Util.isValidVariableLabel(i.label,_LeanData.AppState.PrimarySObjectType)&&_LeanData.VariablesUtil.isValidVariableName(e)},Magellan.Validation.validateReadVariable=function(e,t){return _.get(Magellan.Validation.nodeNamesToVariableStatus,[e,t])},Magellan.Validation.validateGetRecordsMatchNode=function(e){const t=_LeanData.MetaDataController.getFieldMetaDataMap();let i=e.relatedObject.length>0&&(e.relatedObjectField.length>0&&"{!}"!==e.relatedTo||e.soqlCondition.length>0);if(i=i&&e.relatedObject in _LeanData.MetaDataController.getFieldMetaData(),_.isEmpty(e.soqlCondition)){const a=_LeanData.StringUtil.debracketize(e.relatedTo).split(".")[0].replace(new RegExp("__r$"),"__c");i=(i=i&&Magellan.Validation.validateVariable(e.name,a))&&Magellan.Validation.isValidMergeFieldValue(e.name,e.relatedTo,"STRING","Get Records");let n=t[e.relatedObject],o=e.relatedObjectField;i=i&&n&&o.toLowerCase()in n;const l=_LeanData.Util.getMergeFieldSObjectType(e.relatedTo);if(i=i&&!!l){const e=_LeanData.Util.getParentsArray(l),t=_LeanData.Util.getParentsArray(n[o.toLowerCase()].parent);i=i&&e.some(e=>t.includes(e))}return Promise.resolve(i)}{i=(i=i&&Magellan.Validation.isValidMergeFieldValue(e.name,e.soqlCondition,"STRING","soql builder"))&&_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(e.soqlCondition,"DATETIME","soql builder");const a=e.soqlCondition.match(_LeanData._regex.ALL_RELATIVE_DATES_REGEX())||[],n=e.soqlCondition.match(_LeanData._regex.VARIABLE_REGEX())||[];if(i){let i={"match type":e.relatedObject,"query condition":e.soqlCondition,primarySObjectType:e.relatedObject};if(a.length>0||n.length>0){let e={};const o=_LeanData._function.VARIABLES_FIELDNAME,l=_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType)||{},s=_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap()||{};a.forEach(t=>{e[t]="DATE"}),n.forEach(i=>{const a=_LeanData.StringUtil.debracketize(i),n=_LeanData.Util.convertFieldSelectionStringToArray(a,o,t,l,s);e[a]=n[n.length-1].type}),i.variables=e}return _LeanData.RemotingRouter.validateSOQL(JSON.stringify(i)).then(e=>e.success)}return Promise.resolve(i)}},Magellan.Validation.validateMeetingInfo=async function(e,t){let i=!0;return"hidden"===_LeanData._getOrganizationData().bookItFieldMapping||t||(i=i&&await Magellan.Validation.validateFormFieldMapping(e)),i=(i=i&&await Magellan.Validation.validateMeetingType(e.nodeInfo["meeting type id"],t))&&await Magellan.Validation.validateAdditionalAttendees(e),e.nodeInfo.eventCreation&&(i=i&&await Magellan.Validation.validateCreateObject(e)),i},Magellan.Validation.validateNode=async function(e){if(Magellan.Validation.nodeNameToIsValidCache&&Magellan.Validation.nodeNameToIsValidCache.hasOwnProperty(this.nodeInfo.name))return Magellan.Validation.nodeNameToIsValidCache[this.nodeInfo.name];if(_.isBoolean(this._isValid)&&currentTime-this._lastValidationTime<1e3)return this._lastValidationTime=currentTime,this._isValid;var t=$.Deferred();const i=[];var a=!0;_.includes(Magellan.Validation.nodesWithMissingMatchTypes,this)&&(a=!1),a=a&&_LeanData.FeatureProvisioning.getFeatureProvisioningFromModelType(this.nodeInfo._model,_LeanData.AppState.PrimarySObjectType,_LeanData.AppState.isHandoffGraph?"handoff":"routing");var n=e=>{var t=!0;return _.each(e,e=>{Magellan.Validation.isValidUserVariable(e)&&Magellan.Validation.validateVariable(this.nodeInfo.name,e)||(t=!1)}),t};if(this instanceof _LeanData.GraphModels.MatchNode){if(a=a&&await Magellan.Validation.validateMatchNode(this),this instanceof _LeanData.GraphModels.Match_Ca2A||this instanceof _LeanData.GraphModels.Match_AO2A){_LeanData.AppState.getFieldMappingService().setValidationMap(_LeanData.AppState.PrimarySObjectType,"Account");let e=await _LeanData.AppState.getFieldMappingService().validateMappings();a=a&&e.valid}}else if(this instanceof _LeanData.GraphModels.Action_RouteToMatchedAccount||this instanceof _LeanData.GraphModels.Action_RouteToAccount||this instanceof _LeanData.GraphModels.Action_RouteToAccount||this instanceof _LeanData.GraphModels.Action_RouteToDuplicateAccount)a=a&&await Magellan.Validation.validateAccountBasedRouting(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToMatchedLead||this instanceof _LeanData.GraphModels.Action_RouteToDuplicateLead)a=a&&Magellan.Validation.validateLeadBasedRouting(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToDuplicateContact||this instanceof _LeanData.GraphModels.Action_RouteToMatchedContact)a=a&&Magellan.Validation.validateContactBasedRouting(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToMatchedOpportunity)a=a&&Magellan.Validation.validateOpportunityBasedRouting(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToMatchedActivity)a=a&&Magellan.Validation.validateActivityBasedRouting(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToMatchedCampaignMember)a=a&&await Magellan.Validation.validateCampaignMemberBasedRouting(this);else if(this instanceof _LeanData.GraphModels.Action_ConvertLead)a=a&&await Magellan.Validation.validateConvert(this);else if(this instanceof _LeanData.GraphModels.Action_RoundRobin)a=a&&await Magellan.Validation.validateRoundRobin(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_UpdateRecord||this instanceof _LeanData.GraphModels.Partner_Update){if(this instanceof _LeanData.GraphModels.Partner_Update)a=a&&Magellan.Validation.validatePartnerUpdateFP(this.nodeInfo.actionType);else if(this instanceof _LeanData.GraphModels.Action_UpdateRecord){const e=_LeanData.StringUtil.debracketize(this.nodeInfo.variable)||_LeanData.VariablesUtil.getReservedVariableName("routed",_LeanData.AppState.PrimarySObjectType);_LeanData._getOrganizationData(),e.startsWith("routed ")||_LeanData.FeatureProvisioning.isFeatureEnabled("NODE:RELATED_RECORDS_UPDATE")||(Magellan.Validation.nonUpgradedNodes[this.nodeInfo.name]=this,a=!1)}a=a&&Magellan.Validation.validateUpdatePrimary(this)}else if(this instanceof _LeanData.GraphModels.Action_MergeDuplicateContact)a=a&&Magellan.Validation.validateMergeContact(this);else if(this instanceof _LeanData.GraphModels.Action_CreateAccount)a=a&&await Magellan.Validation.validateCreateAccount(this);else if(this instanceof _LeanData.GraphModels.Action_CreateOpportunity)a=a&&await Magellan.Validation.validateCreateOpportunity(this);else if(this instanceof _LeanData.GraphModels.Action_AssignOwner)a=a&&await Magellan.Validation.validateExplicitOwnerAssignment(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToOwnerMapping)a=a&&await Magellan.Validation.validateOwnerMapping(this.nodeInfo["owner mapping"]);else if(this instanceof _LeanData.GraphModels.Action_RouteToAccountTeam)a=a&&await Magellan.Validation.validateAccountTeamRouting(this);else if(this instanceof _LeanData.GraphModels.Action_RouteToUserField)a=a&&Magellan.Validation.metadataFieldExists("Account",this.nodeInfo["custom field"]);else if(this instanceof _LeanData.GraphModels.Action_RouteToTerritorySegment)a=a&&await Magellan.Validation.validateTerritoryRouting(this),(_LeanData.AppState.isHandoffGraph||"Meeting"===_LeanData.AppState.PrimarySObjectType)&&(a=a&&await Magellan.Validation.validateMeetingInfo(this,_LeanData.AppState.isHandoffGraph));else if(this instanceof _LeanData.GraphModels.Action_RouteToDataSet)a=a&&await Magellan.Validation.validateDataSetRouting(this.nodeInfo);else if(this instanceof _LeanData.GraphModels.Action_RouteToETMModel)a=a&&await Magellan.Validation.validateETMRouting(this.nodeInfo);else if(this instanceof _LeanData.GraphModels.Action_RedirectToUrl)a=a&&await Magellan.Validation.validateRedirectToUrl(this),"hidden"!==_LeanData._getOrganizationData().bookItFieldMapping&&(a=a&&await Magellan.Validation.validateFormFieldMapping(this));else if(this instanceof _LeanData.GraphModels.Action_CreateTask)a=a&&await Magellan.Validation.validateCreateObject(this);else if(this instanceof _LeanData.GraphModels.Action_AssignAccountTeamMembers)a=a&&await Magellan.Validation.validateAssignAccountTeamMembers(this);else if(this instanceof _LeanData.GraphModels.Action_AssignOpportunityTeamMembers)a=a&&await Magellan.Validation.validateAssignOpportunityTeamMembers(this);else if(this instanceof _LeanData.GraphModels.Action_AssignContactRole)a=a&&await Magellan.Validation.validateAssignContactRole(this);else if(this instanceof _LeanData.GraphModels.Action_AddCampaignMember)a=a&&await Magellan.Validation.validateAddCampaignMember(this);else if(this instanceof _LeanData.GraphModels.Action_SetVariable)a=a&&Magellan.Validation.validateSetVariable(this.nodeInfo);else if(this instanceof _LeanData.GraphModels.Rerouting_TimeBased)a=a&&await Magellan.Validation.validateRerouteTimeFrame(this);else if(this instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment)a=a&&await Magellan.Validation.validateHoldUntilNode(this);else if(this instanceof _LeanData.GraphModels.DecisionNode){const e=this.nodeInfo.leftInputVariable;if(e&&e.startsWith("{!triggered")){const e="RCM"===this.nodeInfo.objectType?"CampaignMember":"Activity",t=Magellan.Validation.getNodesToCurrentNode(this.nodeInfo.name).triggered.filter(t=>t===e);a=a&&0!==t.length}}else if(this instanceof _LeanData.GraphModels.Partner_Outreach_AddToSequence){const e=$.Deferred();Magellan.Validation.validateOutreachAddToSequence(this).then(function(t){a=a&&t,e.resolve()},function(...t){console.error(t),a=!1,e.resolve()}),i.push(e)}else if(this instanceof _LeanData.GraphModels.Partner_Outreach_CreateTask)a=a&&await Magellan.Validation.validateOutreachCreateTask(this);else if(this instanceof _LeanData.GraphModels.Partner_HVS_AddToSequence){const e=$.Deferred();Magellan.Validation.validateHVSAddToSalesCadence(this).then(function(t){a=a&&t,e.resolve()},function(...t){console.error(t),a=!1,e.resolve()}),i.push(e)}else if(this instanceof _LeanData.GraphModels.Partner_ZoomInfo){const e=$.Deferred();Magellan.Validation.validateZoominfoEnrichNode(this,_LeanData.AppState.PrimarySObjectType).then(e=>{a=a&&e}).catch(e=>{a=!1}).finally(()=>{e.resolve()}),i.push(e)}else if(this instanceof _LeanData.GraphModels.Partner_Salesloft_AddToCadence){const e=$.Deferred();Magellan.Validation.validateSalesloftAddToCadence(this).then(function(t){a=a&&t,e.resolve()},function(...t){console.error(t),a=!1,e.resolve()}),i.push(e)}else if(this instanceof _LeanData.GraphModels.Partner_Salesloft_SendRhythmSignal)a=a&&await Magellan.Validation.validateSalesloftRhythmSendSignal(this);else if(this instanceof _LeanData.GraphModels.Partner_Gong_AddToFlow)a=a&&await Magellan.Validation.validateGongAddToFlow(this,e);else if(this instanceof _LeanData.GraphModels.Partner_Groove_AddToFlow)a=a&&await Magellan.Validation.validateGrooveAddToFlow(this,e);else if(this instanceof _LeanData.GraphModels.Partner_Slack_SendNotification||this instanceof _LeanData.GraphModels.Partner_Slack_NotifyPlus)if(_LeanData.MetaDataController.getPartnerAuthorization("slack")){var o=[("routed "+_LeanData.AppState.PrimarySObjectType).toLowerCase()];const t=Magellan.Validation.getNodesToCurrentNode(this.nodeInfo.name),s=t.matched,r=t.created,d=t.triggered;s.forEach(e=>{o.push(("matched "+e).toLowerCase())}),r.forEach(e=>{o.push(("created "+e).toLowerCase())}),d.forEach(e=>{o.push(("triggered "+e).toLowerCase())});var l=this.nodeInfo.notificationSettings?this.nodeInfo.notificationSettings.success.message:"";if(a=a&&Magellan.Validation.isValidMergeFieldValue(this.nodeInfo.name,l,"STRING","Slack Send Notification"),this.nodeInfo.notificationSettings||(a=!1),a=a&&!_.isEmpty(this.nodeInfo.notificationSettings.success)&&""!==this.nodeInfo.notificationSettings.success.message&&this.nodeInfo.notificationSettings.success.message.length<=(this.nodeInfo.notifyPlus?3e3:4e3)&&_LeanData.Util.hasRecipientsData(this.nodeInfo.notificationSettings.success.recipients),(a=this.nodeInfo.notifyPlus?a&&(e=>{var t=!0;return _.each(e,e=>{Magellan.Validation.validateVariable(this.nodeInfo.name,e)||(t=!1)}),t})(this.nodeInfo.notificationSettings.success.recipients.additionalObjectUserFields):a&&n(this.nodeInfo.notificationSettings.success.recipients.additionalObjectUserFields))&&this.nodeInfo.notificationSettings.success.recipients.recordAssociations)for(const e of this.nodeInfo.notificationSettings.success.recipients.recordAssociations){const t=_LeanData.StringUtil.debracketize(e.variable);if(!(a=a&&Magellan.Validation.validateVariable(this.nodeInfo.name,t)))break}if(this.nodeInfo.notifyPlus){const e=this.nodeInfo.notificationSettings&&this.nodeInfo.notificationSettings.success.actions||[];0===e.length&&(a=!1),e.forEach(e=>{e.recordType&&e.buttonText||(a=!1),e.variable&&!Magellan.Validation.validateVariable(this.nodeInfo.name,e.variable)&&(a=!1),e.formFields.forEach(t=>{t.field&&(""===t.value||_.isNil(t.value))||(a=a&&Magellan.Validation.validateFieldUpdateCondition(this,e.recordType,t))})})}if(a){const t=$.Deferred();Magellan.Validation.validateSlackSendNotificationTokenAndChannel(this,e).then(function(e){a=a&&e,t.resolve()},function(...e){a=!1,console.error(e),t.resolve()}),i.push(t)}}else a=!1;else if(this instanceof _LeanData.GraphModels.Partner_Slack_NotifyPlus_CreateChannel||this instanceof _LeanData.GraphModels.Partner_Slack_NotifyPlus_ManageChannel)if(_LeanData.MetaDataController.getPartnerAuthorization("slack")){o=[("routed "+_LeanData.AppState.PrimarySObjectType).toLowerCase()];const t=Magellan.Validation.getNodesToCurrentNode(this.nodeInfo.name),l=t.matched,s=t.created,r=t.triggered;l.forEach(e=>{o.push(("matched "+e).toLowerCase())}),s.forEach(e=>{o.push(("created "+e).toLowerCase())}),r.forEach(e=>{o.push(("triggered "+e).toLowerCase())}),a=a&&!_.isEmpty(this.nodeInfo.channelDetails)&&null!==this.nodeInfo.channelDetails.channelRecord&&Magellan.Validation.validateVariable(this.nodeInfo.name,this.nodeInfo.channelDetails.channelRecord);const d="archive"==this.nodeInfo.channelMode;if("create"==this.nodeInfo.channelMode&&(a=a&&this.nodeInfo.notificationSettings&&!_.isEmpty(this.nodeInfo.notificationSettings.success)&&this.nodeInfo.channelDetails.name&&_LeanData.Util.hasRecipientsData(this.nodeInfo.notificationSettings.success.recipients)),"update"==this.nodeInfo.channelMode&&(a=this.nodeInfo.notificationSettings&&!_.isEmpty(this.nodeInfo.notificationSettings)?a&&_LeanData.Util.hasRecipientsData(this.nodeInfo.notificationSettings.success.recipients):a&&!_.isEmpty(this.nodeInfo.channelDetails)&&(!_.isEmpty(this.nodeInfo.channelDetails.name)||!_.isEmpty(this.nodeInfo.channelDetails.topic)||!_.isEmpty(this.nodeInfo.channelDetails.description)||!_.isEmpty(this.nodeInfo.channelDetails.bookmarks[0].name)||!_.isEmpty(this.nodeInfo.channelDetails.bookmarks[0].link))),a){const e=this.nodeInfo.channelDetails.name.replace(_LeanData._regex.VARIABLE_REGEX(),"").replace(_LeanData._regex.ALL_RELATIVE_DATES_REGEX(),"");a=a&&!_LeanData._regex.NONALPHANUMERIC_DASH_UNDERSCORE_REGEX().test(e)}let c=[];if(a&&!d){if(this.nodeInfo.channelDetails.name){a=a&&this.nodeInfo.channelDetails.name.length<=80;const e=this.nodeInfo.channelDetails.name.match(_LeanData._regex.VARIABLE_REGEX())||[];e.length>0&&c.push(...e)}if(a&&this.nodeInfo.notificationSettings&&(a=a&&n(this.nodeInfo.notificationSettings.success.recipients.additionalObjectUserFields)),a&&this.nodeInfo.channelDetails.topic){a=a&&this.nodeInfo.channelDetails.topic.length<=250;const e=this.nodeInfo.channelDetails.topic.match(_LeanData._regex.VARIABLE_REGEX())||[];e.length>0&&c.push(...e)}if(a&&this.nodeInfo.channelDetails.description){a=a&&this.nodeInfo.channelDetails.description.length<=250;const e=this.nodeInfo.channelDetails.description.match(_LeanData._regex.VARIABLE_REGEX())||[];e.length>0&&c.push(...e)}if(a&&this.nodeInfo.channelDetails.bookmarks){if(this.nodeInfo.channelDetails.bookmarks[0].name){a=a&&this.nodeInfo.channelDetails.bookmarks[0].link&&this.nodeInfo.channelDetails.bookmarks[0].name.length<=257;const e=this.nodeInfo.channelDetails.bookmarks[0].name.match(_LeanData._regex.VARIABLE_REGEX())||[];e.length>0&&c.push(...e)}this.nodeInfo.channelDetails.bookmarks[0].link&&(a=a&&Magellan.Validation.validateVariable(this.nodeInfo.name,this.nodeInfo.channelDetails.bookmarks[0].link))}}if(c.length>0)for(const e of c)if(!(a=a&&Magellan.Validation.validateVariable(this.nodeInfo.name,e)))break;if(a){const t=$.Deferred();(d||!this.nodeInfo.notificationSettings?Magellan.Validation.validateSlackSendNotificationToken:Magellan.Validation.validateSlackSendNotificationTokenAndChannel)(this,e).then(function(e){a=a&&e,t.resolve()},function(...e){a=!1,console.error(e),t.resolve()}),i.push(t)}}else a=!1;else if(this instanceof _LeanData.GraphModels.Partner_Microsoft_Teams_SendNotification)if(_LeanData.MetaDataController.getPartnerAuthorization("microsoft teams")){o=[("routed "+_LeanData.AppState.PrimarySObjectType).toLowerCase()];const t=Magellan.Validation.getNodesToCurrentNode(this.nodeInfo.name),s=t.matched,r=t.created,d=t.triggered;if(s.forEach(e=>{o.push(("matched "+e).toLowerCase())}),r.forEach(e=>{o.push(("created "+e).toLowerCase())}),d.forEach(e=>{o.push(("triggered "+e).toLowerCase())}),l=this.nodeInfo.notificationSettings?this.nodeInfo.notificationSettings.success.message:"",a=a&&Magellan.Validation.isValidMergeFieldValue(this.nodeInfo.name,l,"STRING","Microsoft Teams Send Notification"),this.nodeInfo.notificationSettings||(a=!1),a=a&&!_.isEmpty(this.nodeInfo.notificationSettings.success)&&""!==this.nodeInfo.notificationSettings.success.message&&this.nodeInfo.notificationSettings.success.message.length<=4e3&&_LeanData.Util.hasRecipientsData(this.nodeInfo.notificationSettings.success.recipients)&&n(this.nodeInfo.notificationSettings.success.recipients.additionalObjectUserFields)){const t=$.Deferred();Magellan.Validation.validateMsftTeamsSendNotificationTokenAndChannel(this,e).then(function(e){a=a&&e,t.resolve()},function(...e){a=!1,console.error(e),t.resolve()}),i.push(t)}}else a=!1;else this instanceof _LeanData.GraphModels.Partner_Cloudingo_MergeRecords?(_LeanData.MetaDataController.getPartnerAuthorization("cloudingo")||(a=!1),_LeanData.FeatureProvisioning.isFeatureEnabled("cloudingoMergeRecords")||(a=!1)):this instanceof _LeanData.GraphModels.Trigger_NewProspect||this instanceof _LeanData.GraphModels.Trigger_NewChatProspect?a=a&&await Magellan.Validation.validateWebFormTrigger(this):"SixSense - Enrich Company"===this.nodeInfo.actionType?a=a&&await Magellan.Validation.validateSixSenseEnrichCompany(this.nodeInfo,e):"Crossbeam - Identify Partner Overlaps"===this.nodeInfo.actionType&&(a=a&&await Magellan.Validation.validateCrossbeamAuthAndVariables(this.nodeInfo,e));let s;const r=_LeanData.AppState.getCurrentVariablesService();var d,c;this.nodeInfo&&this.nodeInfo.relatedToType&&(s="primary"===this.nodeInfo.relatedToType?_LeanData.AppState.PrimarySObjectType:r.getVariableByName(_LeanData.StringUtil.debracketize(this.nodeInfo.relatedToValue))?r.getVariableByName(_LeanData.StringUtil.debracketize(this.nodeInfo.relatedToValue)).sObject:this.nodeInfo.relatedToValue);var h=this.get("primary-object")||s||_LeanData.AppState.PrimarySObjectType,p=this.get("secondary-object")||Magellan.Views.getAPIObjectNameFromObjectType(this.nodeInfo.objectType);"GR"===this.nodeInfo.objectType&&(p=this.nodeInfo.relatedObject),this.get("reversed-condition-operands")?(d=_LeanData.AppState.PrimarySObjectType,c=p):p?(d=p,c=h):d=_LeanData.AppState.PrimarySObjectType,d="Meeting"===d?_LeanData._function.VARIABLES_FIELDNAME:d,c="Meeting"===c?_LeanData._function.VARIABLES_FIELDNAME:c;const u=_LeanData.StringUtil.debracketize(this.nodeInfo.leftInputVariable),m=_LeanData.StringUtil.debracketize(this.nodeInfo.rightInputVariable);if(u&&r.getVariableByName(u)&&(d=r.getVariableByName(u).sObject),m&&r.getVariableByName(m)&&(c=r.getVariableByName(m).sObject),"General"!==this.nodeInfo.objectType||u||(d=_LeanData._function.VARIABLES_FIELDNAME),this instanceof _LeanData.GraphModels.Trigger_PrimaryObject){const e=new Set(this.nodeInfo.edges.map(e=>e.name)),t=(_LeanData.AppState.scheduledJobs||[]).filter(e=>e.nodeType===this.nodeInfo.type);t.length>0&&0===this.nodeInfo.edges.length?a=!1:t.forEach(t=>{e.has(t.edgeName)||(a=!1)})}this instanceof _LeanData.GraphModels.TriggerNode||!this.nodeInfo.filter||"none"===this.nodeInfo["filter type"]||"conditions"!==this.nodeInfo.filter.type||(a=a&&Magellan.Validation.validateFilterRules(this.nodeInfo.filter,d,c,this.nodeInfo["filter type"],this));const g=this instanceof _LeanData.GraphModels.Trigger_Updated||this instanceof _LeanData.GraphModels.Trigger_UpdatedCampaignMember||this instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment?_LeanData._blacklist.UPDATE_TRIGGER_BLACKLIST:null;if(this instanceof _LeanData.GraphModels.Trigger_Updated&&"inclusion"===this.nodeInfo["filter type"]&&(a=a&&Magellan.Validation.hasValidEdges(this.nodeInfo.edges,g)),(this instanceof _LeanData.GraphModels.Trigger_UpdatedCampaignMember||this instanceof _LeanData.GraphModels.Trigger_NewCampaignMember&&"inclusion"===this.nodeInfo["filter type"])&&(a=a&&Magellan.Validation.hasValidMultiConditionEdges(this.nodeInfo.edges,"Object","CampaignMember",g)),this instanceof _LeanData.GraphModels.Trigger_NewActivity&&"inclusion"===this.nodeInfo["filter type"]&&(a=a&&Magellan.Validation.hasValidMultiConditionEdges(this.nodeInfo.edges,_LeanData.AppState.PrimarySObjectType,"Activity",g)),this.nodeInfo.tiebreakers&&(a=a&&Magellan.Validation.validateTiebreakers(this.nodeInfo.tiebreakers,d,c,this)),this.nodeInfo.edges){const e=this instanceof _LeanData.GraphModels.Trigger_Updated||this instanceof _LeanData.GraphModels.Rerouting_HoldUntil||this instanceof _LeanData.GraphModels.Rerouting_HoldUntilEnrichment?_LeanData._blacklist.UPDATE_TRIGGER_BLACKLIST:null;let t=d;this instanceof _LeanData.GraphModels.Trigger_CampaignMember?t="CampaignMember":this instanceof _LeanData.GraphModels.Trigger_Activity&&(t="Activity"),_.each(this.nodeInfo.edges,i=>{if("conditions"===i.type){a=a&&Magellan.Validation.validateConditions(this,i,i.objectType||t,c,e);var n=i.referenceFilters;if(n&&n.conditions.length>0){const t=this instanceof _LeanData.GraphModels.Trigger_CampaignMember?"Object":_LeanData.AppState.PrimarySObjectType;a=a&&Magellan.Validation.validateConditions(this,n,t,c,e)}}else"soql"===i.type?a=a&&!_.isEmpty(i.soqlCondition)&&!1!==i.isValid:i.type||(a=!1)})}a=a&&Magellan.Validation.validateEdgeNames(this),this instanceof _LeanData.GraphModels.Action_SendNotification&&_LeanData.GraphValidatorUtil.checkEmptyNotifSettings(this.nodeInfo.notificationSettings)&&(a=!1);const f=[_LeanData.GraphModels.Partner_Slack_SendNotification,_LeanData.GraphModels.Partner_Slack_NotifyPlus,_LeanData.GraphModels.Partner_Slack_NotifyPlus_CreateChannel,_LeanData.GraphModels.Partner_Slack_NotifyPlus_ManageChannel,_LeanData.GraphModels.Partner_Microsoft_Teams_SendNotification];var b,v,y,w;if(a&&!_LeanData.GraphValidatorUtil.checkEmptyNotifSettings(this.nodeInfo.notificationSettings)&&!f.some(e=>this instanceof e)&&(_.each(["success","failure"],e=>{var t=this.nodeInfo.notificationSettings[e];if(!_LeanData.Util.hasNotificationData(t))return!0;(!t.useEmailComposer&&_.isEmpty(t.template)||t.useEmailComposer&&(_.isEmpty(t.message)||_.isEmpty(t.subject)))&&(a=!1),b||((b=Magellan.Validation.getNodesToCurrentNode(this.nodeInfo.name)).matched&&(v=b.matched),y=b.created,w=b.triggered),a=!!_LeanData.Util.hasRecipientsData(t.recipients)&&a&&n(t.recipients.additionalObjectUserFields);var o=Magellan.Validation.CREATED_ACTION_TYPE_MAP[this.nodeInfo.actionType];if(t.recipients.notifyNewObjectOwner&&0===y.length&&!o&&(a=!1),_.each(t.recipients.additionalObjectUserFields,e=>{"matched"===e.contextType?a=a&&-1!==v.indexOf(e.objectType):"created"===e.contextType?a=a&&-1!==y.indexOf(e.objectType):"triggered"===e.contextType&&(a=a&&-1!==w.indexOf(e.objectType))}),t.template&&!t.useEmailComposer){var l=_LeanData.FlowBuilderController.queryEmailTemplates([t.template]).then(function(e){a=a&&!_.isEmpty(e)});i.push(l)}else{const e=!t.useEmailComposer||!_.isEmpty(t.subject)&&!_.isEmpty(t.message);let i=!0;(this.nodeInfo.actionType==="Update "+_LeanData.AppState.PrimarySObjectType||o)&&t.message&&(t.message.includes("<New.Owner>")||t.message.includes("<Previous.Owner>"))&&(i=!1),a=a&&e&&i&&Magellan.Validation.isValidMergeFieldValue(this.nodeInfo.name,t.message,"STRING","Send Notification")&&_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(t.message,"DATETIME","Send Notification")}}),!_.isEmpty(this.nodeInfo.notificationSettings.chatter))){a=a&&""!==this.nodeInfo.notificationSettings.chatter.message&&this.nodeInfo.notificationSettings.chatter.message.length<=2e3&&_LeanData.Util.hasRecipientsData(this.nodeInfo.notificationSettings.chatter.recipients)&&(e=>{var t=!0,i={Lead:!0,Account:!0,Opportunity:!0,Case:!0,Contact:!0};return _.each(e,e=>{e=_LeanData.StringUtil.debracketize(e);const a=_LeanData.AppState.getCurrentVariablesService().getRootVariableSObjectType(e);Magellan.Validation.isValidUserVariable(e)&&Magellan.Validation.validateVariable(this.nodeInfo.name,e)||("id"===e.split(".")[1]||e.endsWith("__c")||e.endsWith("__r.id"))&&i.hasOwnProperty(a)||(t=!1)}),t})(this.nodeInfo.notificationSettings.chatter.recipients.additionalObjectUserFields)&&Magellan.Validation.isValidMergeFieldValue(this.nodeInfo.name,this.nodeInfo.notificationSettings.chatter.message,"STRING","Send Notification");var T=new Set;this.nodeInfo.notificationSettings.chatter.recipients.groups.forEach(e=>T.add(e.id));const e=$.Deferred();0===T.size?e.resolve():_LeanData.FlowBuilderController.searchChatterGroups("",Array.from(T),!0).then(function(e){T.forEach(t=>{let i=_.find(e,e=>e.Id===t);_.isEmpty(i)&&(a=!1)})}).finally(function(){e.resolve()}),i.push(e);var D=new Set;(this.nodeInfo.notificationSettings.chatter.recipients.users?this.nodeInfo.notificationSettings.chatter.recipients.users:[]).forEach(e=>D.add(e.id));const t=$.Deferred();a=a&&await Magellan.Validation.validateActiveChatterUsers(Array.from(D)),0===D.size?t.resolve():_LeanData.FlowBuilderController.searchChatterUsers("",Array.from(D),!0).then(function(e){D.forEach(t=>{let i=_.find(e,e=>e.Id===t);_.isEmpty(i)&&(a=!1)})}).finally(function(){t.resolve()}),i.push(t)}return a=(a=a&&await Magellan.Validation.validateVariableSetter(this.nodeInfo,h))&&0===this.getNumberOfDanglingEdges(),$.when(...i).always(function(){t.resolve(a)}.bind(this)),t},Magellan.Validation.validateFilterRules=function(e,t,i,a,n){var o=!0;return a=a||e["filter type"],["inclusion","exclusion"].indexOf(a)<0?o:!!(o=o&&!_LeanData.ConditionValidatorUtil.criterionEmpty(e)&&!_LeanData.ConditionValidatorUtil.criterionInvalid(e))&&(_.each(e.conditions,function(e){o=o&&Magellan.Validation.validateSingleCondition(e,t,i,null,n)}),o=o&&0===_LeanData.FunctionUtil.parseTokenLogic(e.conditions.length,e.logic,e.conditions.length>=2).feedbackMessage.length)},Magellan.Validation.validateConditions=function(e,t,i,a,n){let o=t.conditions&&t.conditions.length>0;return t.conditions.forEach(t=>{o=o&&Magellan.Validation.validateSingleCondition(t,i,a,n,e)}),o&&0===_LeanData.FunctionUtil.parseTokenLogic(t.conditions.length,t.logic,t.conditions.length>=2).feedbackMessage.length},Magellan.Validation.validateIndividualEdgeConditions=function(e,t,i){var a=!0;for(let n of t)if(!(a=a&&Magellan.Validation.validateValueTypeCondition(n,e,i)))return!1;return a},Magellan.Validation.hasValidMultiConditionEdges=function(e,t,i,a){if(_.isEmpty(e))return!1;var n=!0;for(let o of e){const e=o.referenceFilters;if(n=n&&Magellan.Validation.validateIndividualEdgeConditions(i,o.conditions,a),e.conditions.length>0&&(n=n&&Magellan.Validation.validateIndividualEdgeConditions(t,e.conditions,a)),!n)return!1}return n},Magellan.Validation.hasValidEdges=function(e,t){if(_.isEmpty(e))return!1;var i=!0;for(let a of e)if(!(i=i&&Magellan.Validation.validateIndividualEdgeConditions(_LeanData.AppState.PrimarySObjectType,a.conditions,t)))return!1;return i},Magellan.Validation.validateTiebreakers=function(e,t,i,a){var n=!0;return _.each(e,e=>{"conditions"===e.type?(n=n&&!_LeanData.ConditionValidatorUtil.criterionEmpty(e)&&!_LeanData.ConditionValidatorUtil.criterionInvalid(e),_.each(e.conditions,function(e){n=n&&Magellan.Validation.validateSingleCondition(e,t,i,null,a)}),n=n&&0===_LeanData.FunctionUtil.parseTokenLogic(e.conditions.length,e.logic,e.conditions.length>=2).feedbackMessage.length):"soql"===e.type?n=n&&!_.isEmpty(e.soqlCondition)&&!1!==e.isValid:"custom"===e.type?n=n&&Magellan.Validation.validateCustomTiebreaker(e.parameter):"optima"===e.type?n=n&&Magellan.Validation.metadataFieldExists(t,e.field):e.type||(n=!1)}),n},Magellan.Validation.validateSingleCondition=function(e,t,i,a,n){var o=!0;if(!e.hasOwnProperty("value/field"))return!1;if("value"===e["value/field"]){if(o=o&&Magellan.Validation.validateValueTypeCondition(e,t,a,n&&n.nodeInfo),n instanceof _LeanData.GraphModels.TriggerNode&&(o=o&&Magellan.Validation.validateCountryStateCodeFieldTypes(e,t,null)),_LeanData._function.UNARY_OPERATORS.has(e.operator))return o;if("has changed"===e.operator)return!(_.isEmpty(e.field)||e.field.indexOf(".")>-1)&&o;if(n&&_.isString(e.operand)){if(e.operand.includes("{!"))return o=o&&Magellan.Validation.isValidMergeFieldValue(n.nodeInfo.name,e.operand,e.type,e.field)}else if(n&&_.isArray(e.operand))return e.operand.forEach(t=>{_.isString(t)&&(o=o&&Magellan.Validation.isValidMergeFieldValue(n.nodeInfo.name,t,"STRING",e.field))}),o;o=o&&Magellan.Validation.isValidValueOfType(e.type,e.operand,e.operator)}else"field"===e["value/field"]&&(o=o&&Magellan.Validation.validateFieldTypeCondition(e,t,i,n));return o},Magellan.Validation.countryStateCodeFields=new Set(["countrycode","statecode","billingstatecode","billingcountrycode","mailingcountrycode","shippingcountrycode","othercountrycode"]),Magellan.Validation.countryStateFields=new Set(["country","state","billingstate","billingcountry","mailingcountry","shippingcountry","othercountry"]);const e=_LeanData._getOrganizationData().countryStateCodeEnabled;Magellan.Validation.invalidCountryStateCodeField=(t=>Magellan.Validation.countryStateCodeFields.has(t)&&!e),Magellan.Validation.invalidCountryStateField=(t=>Magellan.Validation.countryStateFields.has(t)&&e),Magellan.Validation.validateValueTypeCondition=function(e,t,i,a){if(_.isEmpty(e.field)||!Magellan.Validation.metadataFieldExists(t,e.field))return!1;if(i instanceof Set&&i.has(e.field))return!1;if(_LeanData._function.UNARY_OPERATORS.has(e.operator))return!0;if(_LeanData.Validation.isWewEnabledForCondition(e,t)&&("EMAIL"===e.type||"{!email}"===e.field)&&_LeanData._function.DOMAIN_UNARY_OPERATORS.includes(e.operator))return!0;const n=_LeanData.Validation.getConditionOperators(e,t);return!(!_.includes(n,e.operator)||Magellan.Validation.invalidCountryStateCodeField(e.field)||_.isNull(e.operand)||_.isUndefined(e.operand)||""===e.operand||e.field.startsWith("{!")&&a&&Magellan.Validation.nodeNamesToVariableStatus&&!Magellan.Validation.validateVariable(a.name,e.field))},Magellan.Validation.isValidValueOfType=function(e,t,i){if(!e)return!1;switch(e.toUpperCase()){case"ID":return _.isString(t)&&t.split(",").reduce(function(e,t){const a=t.trim();return e&&("starts with"===i||"does not start with"==i||15===a.length||18===a.length)&&/^[a-zA-Z0-9]+$/.test(a)},!0);case"INTEGER":return!isNaN(t)&&null!==t&&("string"!=typeof t||""!==t.trim())&&Math.round(+t).toString()===(+t).toString();case"DOUBLE":return!(_.isString(t)&&_.isEmpty(t.trim())||null===t||_.isNaN(Number(t)));case"CURRENCY":case"PERCENT":return/^\d*(?:\.\d*){0,1}$/.test(t);case"BOOLEAN":return _.isBoolean(t)||_.isString(t)&&["true","false"].includes(t.toLowerCase());case"STRING":return _.isString(t)&&t.split(",").reduce(function(e,t){const i=t.trim();return e&&i.length>0},!0);case"EMAIL":return _.isString(t)&&t.split(",").reduce(function(e,t){const a=t.trim(),n=!(!i||["equals","not equal to"].includes(i))||_LeanData.Validation.isValidEmail(a);return e&&a.length>0&&n},!0);case"PICKLIST":return null!==t&&t.length>0;case"COMBOBOX":case"TEXTAREA":case"MULTIPICKLIST":case"URL":case"PHONE":case"ADDRESS":case"TEXT":return!0;case"DATE":return moment(t,_LeanData._datetime.DATE_FORMAT,!0).isValid()||t&&_LeanData.DateUtil_LDL.isValidDateLiteral(t)||_LeanData.ConditionValidatorUtil.isValidRelativeDateLiteral(t);case"DATETIME":return moment(t,_LeanData._datetime.DATETIME_FORMAT,!0).isValid()||t&&_LeanData.DateUtil_LDL.isValidDateLiteral(t)||_LeanData.ConditionValidatorUtil.isValidRelativeDateLiteral(t)}},Magellan.Validation.isValidMergeFieldValue=function(e,t,i,a){return 0===Magellan.Validation.isValidMergeFieldValueMessages(e,t,i,a).length},Magellan.Validation.isReservedVariable=function(e){const t=new Set(["routed","matched","created","triggered"]),i=new Set(["lead","contact","account","opportunity","activity","campaignmember","case","task","event"]),a=e.split(".")[0].split(" ");return!(1==a.length||!t.has(a[0]))&&(i.has(a[1])||_LeanData.Util.isAnyObject(a[1]))},Magellan.Validation.isValidMergeFieldValueMessages=function(e,t,i,a){var n=[];if(_.isEmpty(a))return n.push("Please select a field to update."),n;if(_.isString(t))if(t.includes("{!")){let h,p;for(var o,l=_LeanData._regex.VARIABLE_REGEX(),s=[];o=l.exec(t);){p=(h=Magellan.Validation.isReservedVariable(o[1]))?_LeanData._regex.MERGE_FIELD_WITH_SPACES_REGEX():_LeanData._regex.MERGE_FIELD_WITHOUT_SPACES_REGEX(),"Get Records"===a&&(p=h?/^{!([\w\d]+\s(?:[\w\d]+\.*)+[\w\d]+)}$/i:/^{!((?:[\w\d]+\.*)?[\w\d]+)}$/i);var r=p.exec(o[0]);null!=r?s.push(r):n.push("The variable "+o[0]+" is incorrectly formatted.")}if("URL"===i){if(/\s(?![^{]*})|\n/.test(t.trim()))return n.push('The Field: "'+a+'" cannot include spaces or line breaks.'),n;let e=s.reduce((e,t)=>e+=t[0].length,0);if(t.length-e>255)return n.push(`The Field: "${a}" cannot exceed the 255 character limit.`),n}if("event.subject"===a){let e=s.reduce((e,t)=>e+=t[0].length,0);if(t.length-e>255)return n.push("Event subject exceeds the maximum character length. Please limit to 255 characters."),n}const u=new Set(["TEXT","TEXTAREA","STRING","COMBOBOX","URL"]).has(i);var d=Magellan.Validation.getNodesToCurrentNode(e),c=new Set(d.matched||[]);c.has("Activity")&&(c.add("Task"),c.add("Event")),new Set(d.created||[]),new Set(d.triggered||[]),_.each(s,t=>{var o=t[1];h=Magellan.Validation.isReservedVariable(o);var l=o.split(".");"Get Records"!==a&&l.length<2&&(n.invalidMergeFieldSyntax='Invalid Variable Syntax: "'+t[0]+'"');const s=_LeanData.MetaDataController.getFieldMetaDataMap(),r=_LeanData._function.VARIABLES_FIELDNAME,d=_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType)||{},c=_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap()||{};var p=_LeanData.Util.convertFieldSelectionStringToArray(o,r,s,d,c);if(_.isEmpty(p))n.push("Invalid variable: "+o+" check if referenced fields still exist.");else{const t=p[p.length-1],s=new Set(_LeanData._function.SFDC_VALID_TYPE_MAPPING[i]);!("Get Records"!==a||l.length>1)||"REFERENCE"!==t.type&&"SOBJECT"!==t.type?u||s.has(t.type)?Magellan.Validation.validateVariable(e,p[0].name)?l.length>1&&"SOBJECT"!==p[0].type&&n.push("Invalid variable: "+o):n.push("Invalid variable: "+o):n.push(o+" has invalid field type for '"+a+"'"):n.push("Invalid variable: "+o)}})}else{if("URL"===i&&t.length>255)return n.push(`The Field: "${a}" cannot exceed the 255 character limit.`),n;if("event.subject"===a&&t.length>255)return n.push("Event subject exceeds the maximum character length. Please limit to 255 characters."),n}return _.isEmpty(n)||console.warn(n,e),n},Magellan.Validation.validateCountryStateCodeFieldTypes=function(e,t,i){let a=e.field.toLowerCase();if("Lead"===t&&(Magellan.Validation.invalidCountryStateCodeField(a)||Magellan.Validation.invalidCountryStateField(a)))return!1;if(e.operand&&null!==i){let t=e.operand.toLowerCase();if("Lead"===i&&(Magellan.Validation.invalidCountryStateCodeField(t)||Magellan.Validation.invalidCountryStateField(t)))return!1}return!0},Magellan.Validation.validateFieldTypeCondition=function(e,t,i,a){if(_.isEmpty(e.field)||!Magellan.Validation.metadataFieldExists(t,e.field))return!1;if(_LeanData._function.UNARY_OPERATORS.has(e.operator))return!0;const n=_LeanData.Validation.isWewEnabledForCondition(e,t);if(n&&"EMAIL"===e.type&&_LeanData._function.DOMAIN_UNARY_OPERATORS.includes(e.operator))return!0;const o=_LeanData.Validation.getConditionOperators(e,t);if(!_.includes(o,e.operator))return!1;if(_.isEmpty(e.operand)||!Magellan.Validation.metadataFieldExists(i,e.operand))return!1;if(Magellan.Validation.invalidCountryStateCodeField(e.field)||Magellan.Validation.invalidCountryStateCodeField(e.operand))return!1;if(a&&a.nodeInfo&&Magellan.Validation.nodeNamesToVariableStatus){let t=!0;const i=!e.field.startsWith("{!")||Magellan.Validation.validateVariable(a.nodeInfo.name,e.field),n=!e.operand.startsWith("{!")||Magellan.Validation.validateVariable(a.nodeInfo.name,e.operand);if(!(t=i&&n))return t}return n&&_LeanData._function.DOMAIN_MATCH_OPERATORS.includes(e.operator)?["URL","EMAIL"].includes(e["operand type"])||_LeanData._function.DOMAIN_MATCH_SUPPORTING_PRESET_VARIABLES.has(e.operand):_LeanData._function.SFDC_TYPE_TO_GROUPING[e.type]===_LeanData._function.SFDC_TYPE_TO_GROUPING[e["operand type"]]},Magellan.Validation.validateCustomTiebreaker=function(e){return void 0!==e&&null!==e&&""!==e},Magellan.Validation.getVariablesReferenced=function(e){const t=[],i=_LeanData.GraphModelTypeMap[e.nodeInfo._model];return i&&"function"==typeof i.getVariableNamesReferenced&&t.push(...i.getVariableNamesReferenced(e.nodeInfo,e.get("primaryObjectType")).read),_.uniq(t).filter(e=>!e.startsWith("routed "))},Magellan.Validation.findSetOfCycles=function(e,t){_.each(t,function(t){var i=e.nodeNamesToNodeWrappersMap[t];void 0===i.index&&Magellan.Validation.strongConnect(e,i)});for(let t=0;t<e.rerunReroute.length;t++)Magellan.Validation.strongConnect(e,e.rerunReroute[t]);var i=_.filter(e.stronglyConnectedComponents,function(e){return e.length>1}),a=_.map(i,function(e){return _.map(e,function(e){return e.nodeReference instanceof _LeanData.GraphModels.ReroutingNode?"VALID CYCLE":e.nodeReference})});return a=a.filter(function(e){return e instanceof Array&&!e.includes("VALID CYCLE")})},Magellan.Validation.strongConnect=function(e,t){t.index=e.index,t.lowLink=e.index,e.index=e.index+1,e.stack.push(t),t.onStack=!0;var i=_.filter(e.edges,function(i){const a="REROUTING"===i.target.nodeInfo.type||"HOLDUNTIL"===i.target.nodeInfo.type;return a&&(_.includes(e.processedRerouteNodes,i.target.nodeInfo.name)||(e.rerunReroute.push(e.nodeNamesToNodeWrappersMap[i.target.nodeInfo.name]),e.processedRerouteNodes.push(i.target.nodeInfo.name))),i.source===t.nodeReference&&!a});if(_.each(i,function(i){var a=i.target.nodeInfo.name,n=e.nodeNamesToNodeWrappersMap[a];void 0===n.index?(Magellan.Validation.strongConnect(e,n),t.lowLink=Math.min(t.lowLink,n.lowLink)):n.onStack&&(t.lowLink=Math.min(t.lowLink,n.lowLink))}),t.lowLink===t.index){var a=[];do{var n=e.stack.pop();n.onStack=!1,a.push(n)}while(t!==n);e.stronglyConnectedComponents.push(a)}},Magellan.Validation.findDanglingNodes=function(e,t){var i=_LeanData.FBUtil.getContiguousNodeNames(e,t),a=_.difference(_.keys(e),i);return _.map(a,function(t){return e[t]})},Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP={Primary:"Lead",L2L:"Lead",L2A:"Account",L2O:"Opportunity",Dupe:"Lead",DupeC:"Contact",DupeA:"Account",C2O:"Opportunity",C2C:"Contact",C2A:"Account",CDupe:"Contact",A2O:"Opportunity",O2O:"Opportunity",O2C:"Contact",Ca2A:"Account",AO2A:"Account",RA:"Activity",RCM:"CampaignMember",P2L:"Lead",P2A:"Account",P2O:"Opportunity",P2DupeL:"Lead",P2DupeC:"Contact"},Magellan.Validation.MATCH_TYPE_TO_OBJECT_PLURAL_MAP={Primary:"Leads",L2L:"Leads",L2A:"Accounts",L2O:"Opportunities",Dupe:"Leads",DupeC:"Contacts",DupeA:"Accounts",C2O:"Opportunities",C2C:"Contacts",C2A:"Accounts",CDupe:"Contacts",A2O:"Opportunities",O2O:"Opportunities",O2C:"Contacts",Ca2A:"Accounts",AO2A:"Accounts",P2L:"Leads",P2A:"Accounts",P2O:"Opportunities",P2Dupe:"Leads",P2DupeC:"Contacts"},Magellan.Validation.CREATED_ACTION_TYPE_MAP={"Account Creation":"Account","Create Opportunity":"Opportunity","Create Task":"Task"},Magellan.Validation.TRIGGERS_TO_TRIGGER_TYPES_MAP={"ACTIVITY TRIGGER":"ACTIVITY TRIGGER","CAMPAIGN MEMBER TRIGGER":"CAMPAIGN MEMBER TRIGGER","UPDATE CAMPAIGN MEMBER TRIGGER":"CAMPAIGN MEMBER TRIGGER","HOLD UNTIL ACTIVITY TRIGGER":"ACTIVITY TRIGGER"},Magellan.Validation.TRIGGERED_TYPE_TO_RESERVED_VARIABLE_MAP={"CAMPAIGN MEMBER TRIGGER":"triggered campaignmember","UPDATE CAMPAIGN MEMBER TRIGGER":"triggered campaignmember",HOLDUNTIL:"triggered activity","ACTIVITY TRIGGER":"triggered activity"},Magellan.Validation.CREATED_ACTION_TYPE_TO_RESERVED_VARIABLE_MAP={"Account Creation":"created account","Create Opportunity":"created opportunity","Create Task":"created task"},Magellan.Validation.TRIGGERED_TYPES_MAP={"CAMPAIGN MEMBER TRIGGER":"CampaignMember","ACTIVITY TRIGGER":"Activity"},Magellan.Validation.getNodesToCurrentNode=function(e,t){if(!t&&Magellan.Validation.nodeNameToRelatedObjectTypes&&Magellan.Validation.nodeNameToRelatedObjectTypes.hasOwnProperty(e))return Magellan.Validation.nodeNameToRelatedObjectTypes[e];var i={matched:new Set,created:new Set,triggered:new Set},a=_LeanData.FBUtil.getNodeNamesToNodesMap(),n={matchType:void 0,nodeNamesToMatchTypeStatus:{},nodeNamesToAvailableDupeMatchVariableStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToTriggerTypeStatus:{},nodeNamesToVariableStatus:{},nodeNamesToNodesMap:a};return Magellan.Validation.doCyclesExist||Magellan.Validation.findNodesWithInvalidVariableReferences(a,n),_.each(n.nodeNamesToMatchTypeStatus[e],(e,t)=>{if(e&&t&&Magellan.Validation.isReservedVariable(t)){let e=_LeanData.StringUtil.capitalizeString(t.split(" ")[1],!1,!0);"Campaignmember"===e&&(e="CampaignMember"),i.matched.add(e)}}),_.each(n.nodeNamesToCreatedActionTypeStatus[e],(e,t)=>{if(e&&t&&Magellan.Validation.isReservedVariable(t)){let e=_LeanData.StringUtil.capitalizeString(t.split(" ")[1],!1,!0);"Campaignmember"===e&&(e="CampaignMember"),i.created.add(e)}}),_.forEach(n.nodeNamesToTriggerTypeStatus[e],(e,t)=>{if(e&&t&&Magellan.Validation.isReservedVariable(t)){let e=_LeanData.StringUtil.capitalizeString(t.split(" ")[1],!1,!0);"Campaignmember"===e&&(e="CampaignMember"),i.triggered.add(e)}}),i.matched=Array.from(i.matched),i.created=Array.from(i.created),i.triggered=Array.from(i.triggered),Magellan.Validation.nodeNameToRelatedObjectTypes[e]=i,i},Magellan.Validation.findNodesWithInvalidVariableReferences=function(e,t){t=t||{matchType:void 0,nodeNamesToMatchTypeStatus:{},nodeNamesToAvailableDupeMatchVariableStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToTriggerTypeStatus:{},nodeNamesToVariableStatus:{},nodeNamesToNodesMap:e};var i=_LeanData.FBUtil.getStartNodeNames(e),a=_.union(i.TriggerNode),n=_LeanData.FBUtil.getContiguousNodeNames(e,a),o=[];_.each(a,function(t){var i=e[t],a={startNodeName:t,nodeNamesToMatchTypeStatus:{},nodeNamesToAvailableDupeMatchVariableStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToTriggerTypeStatus:{},nodeNamesToVariableStatus:{},nodeNamesToNodesMap:e};Magellan.Validation.markMatchTypes(a,i,{},{}),Magellan.Validation.markCreatedActionTypes(a,i,{}),Magellan.Validation.markTriggerTypes(a,i,{});const n=_LeanData.ObjectUtil.getFalseMap(_LeanData.AppState.getCurrentVariablesService().getVariablesMap(null));Magellan.Validation.markVariables(a,i,_.clone(n)),o.push(a)}),_.each(o,function(e){_.each(e.nodeNamesToVariableStatus,function(i,a){t.nodeNamesToVariableStatus.hasOwnProperty(a)||(t.nodeNamesToVariableStatus[a]={}),_.each(e.nodeNamesToVariableStatus[a],function(i,n){let o=i||(e.nodeNamesToMatchTypeStatus[a]||{})[n]||(e.nodeNamesToCreatedActionTypeStatus[a]||{})[n]||(e.nodeNamesToTriggerTypeStatus[a]||{})[n]||!1;t.nodeNamesToVariableStatus[a].hasOwnProperty(n)&&(o=o&&t.nodeNamesToVariableStatus[a][n]),t.nodeNamesToVariableStatus[a][n]=o})}),_.each(e.nodeNamesToMatchTypeStatus,function(i,a){t.nodeNamesToMatchTypeStatus.hasOwnProperty(a)?(_.each(t.nodeNamesToMatchTypeStatus[a],function(i,n){t.nodeNamesToMatchTypeStatus[a][n]=!!e.nodeNamesToMatchTypeStatus[a][n]&&i}),_.each(t.nodeNamesToAvailableDupeMatchVariableStatus[a],function(i,n){t.nodeNamesToAvailableDupeMatchVariableStatus[a][n]=!!e.nodeNamesToMatchTypeStatus[a][n]&&i})):(t.nodeNamesToMatchTypeStatus[a]=e.nodeNamesToMatchTypeStatus[a],t.nodeNamesToAvailableDupeMatchVariableStatus[a]=e.nodeNamesToAvailableDupeMatchVariableStatus[a])}),_.each(e.nodeNamesToCreatedActionTypeStatus,function(i,a){!t.nodeNamesToCreatedActionTypeStatus.hasOwnProperty(a)||_.isEmpty(t.nodeNamesToCreatedActionTypeStatus[a])?t.nodeNamesToCreatedActionTypeStatus[a]=e.nodeNamesToCreatedActionTypeStatus[a]:_.each(t.nodeNamesToCreatedActionTypeStatus[a],function(i,n){t.nodeNamesToCreatedActionTypeStatus[a][n]=!!e.nodeNamesToCreatedActionTypeStatus[a][n]&&i})}),_.each(e.nodeNamesToTriggerTypeStatus,function(i,a){!t.nodeNamesToTriggerTypeStatus.hasOwnProperty(a)||_.isEmpty(t.nodeNamesToTriggerTypeStatus[a])?t.nodeNamesToTriggerTypeStatus[a]=e.nodeNamesToTriggerTypeStatus[a]:_.each(t.nodeNamesToTriggerTypeStatus[a],function(i,n){t.nodeNamesToTriggerTypeStatus[a][n]=!!e.nodeNamesToTriggerTypeStatus[a][n]&&i})})}),Magellan.Validation.nodeNamesToVariableStatus=t.nodeNamesToVariableStatus,Magellan.Validation.nodeNamesToMatchTypeStatus=t.nodeNamesToMatchTypeStatus,Magellan.Validation.nodeNamesToAvailableDupeMatchVariableStatus=t.nodeNamesToAvailableDupeMatchVariableStatus;var l=_.filter(n,function(i){var a=e[i],n=Magellan.Validation.getVariablesReferenced(a),o=_.filter(n,function(e){return!Magellan.Validation.validateVariable(i,e)});if(new Set(["Merge Dupe Lead","Contact Merge Dupe","Merge Dupe Contact","Dupe Based Routing","Dupe Contact Based Routing","Dupe Account Based Routing","Cloudingo - Merge Records"]).has(a.nodeInfo.actionType)){const e=Magellan.Validation.getVariablesReferenced(a)[0];_.get(t.nodeNamesToAvailableDupeMatchVariableStatus,[i,e])||o.push(e)}return o.length>0});return _.map(l,t=>e[t])},Magellan.Validation.markMatchTypes=function(e,t,i,a){_.isEmpty(e.nodeNamesToMatchTypeStatus)&&(e.nodeNameToAncestors={});var n=e.nodeNameToAncestors[t.nodeInfo.name]=e.nodeNameToAncestors[t.nodeInfo.name]||new Set,o=_.clone(i);const l=_.clone(a);if(e.nodeNamesToMatchTypeStatus[t.nodeInfo.name]){var s=!0,r=e.nodeNamesToMatchTypeStatus[t.nodeInfo.name];const i=e.nodeNamesToAvailableDupeMatchVariableStatus[t.nodeInfo.name];if(_.forEach(Object.assign({},o,r),(e,t)=>{if(!o[t]&&r[t]||!l[t]&&i[t])return s=!1,!1}),s)return;Object.keys(e.nodeNamesToMatchTypeStatus[t.nodeInfo.name]).forEach(i=>{e.nodeNamesToMatchTypeStatus[t.nodeInfo.name][i]=e.nodeNamesToMatchTypeStatus[t.nodeInfo.name][i]&&o[i],e.nodeNamesToAvailableDupeMatchVariableStatus[t.nodeInfo.name][i]=e.nodeNamesToAvailableDupeMatchVariableStatus[t.nodeInfo.name][i]&&l[i]})}else e.nodeNamesToMatchTypeStatus[t.nodeInfo.name]=_.clone(o),e.nodeNamesToAvailableDupeMatchVariableStatus[t.nodeInfo.name]=_.clone(l);if(_.each(t.nodeInfo.edges,function(i){var a=e.nodeNameToAncestors[i.target];e.nodeNameToAncestors[i.target]=a=a||new Set,n.forEach(e=>a.add(e)),a.add(t.nodeInfo.name)}),t instanceof _LeanData.GraphModels.MatchNode){let i,a;const s=t.nodeInfo.objectType,r=new Set(["Dupe","CDupe","DupeC","DupeA","P2DupeL","P2DupeC"]).has(s),m="L2L"===s||"C2C"===s;t.nodeInfo.outputVariable?i=t.nodeInfo.outputVariable:Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP.hasOwnProperty(t.nodeInfo.objectType)&&(i=_LeanData.VariablesUtil.getReservedVariableName("matched",Magellan.Validation.MATCH_TYPE_TO_OBJECT_MAP[t.nodeInfo.objectType]).toLowerCase()),i&&(a=l[i],o[i]=!0,l[i]=r||a&&!m),"L2O"!==t.nodeInfo.objectType&&"P2O"!==t.nodeInfo.objectType||t.nodeInfo["restrict l2o to chosen account"]||!t.nodeInfo.objectVariable||(o[t.nodeInfo.objectVariable]=!0);var d=_.filter(t.nodeInfo.edges,function(e){return new Set(["Match","Match without Parent","Match (Parent)","Match (Ultimate Parent)"]).has(e.name)});_.each(d,function(t){var i=t.target;if(!_.isNull(i)&&!_.isUndefined(i)&&-1!==i&&!n.has(i)){var a=e.nodeNamesToNodesMap[i];Magellan.Validation.markMatchTypes(e,a,o,l)}}),i&&(o[i]=!1,l[i]=!!a&&!m),"L2O"!==t.nodeInfo.objectType&&"P2O"!==t.nodeInfo.objectType||t.nodeInfo["restrict l2o to chosen account"]||!t.nodeInfo.objectVariable||(o[t.nodeInfo.objectVariable]=!1);var c=_.filter(t.nodeInfo.edges,function(e){return"No Match"===e.name})[0].target,h=_.filter(t.nodeInfo.edges,function(e){return"Multiple Matches"===e.name})[0];if(!_.isNull(c)&&!_.isUndefined(c)&&-1!==c&&0!==c&&-2!==c&&!n.has(c)){var p=e.nodeNamesToNodesMap[c];Magellan.Validation.markMatchTypes(e,p,o,l)}if(!_.isUndefined(h)){var u=h.target;_.isNull(u)||_.isUndefined(u)||-1===u||0===u||-2===u||n.has(u)||(p=e.nodeNamesToNodesMap[u],Magellan.Validation.markMatchTypes(e,p,o,l))}}else{let i={};_.each(t.nodeInfo.edges,function(t){const a=t.target;if(!(i[a]||_.isNull(a)||_.isUndefined(a)||-1===a||0===a||-2===a||n.has(a))){i[a]=!0;const t=e.nodeNamesToNodesMap[a];Magellan.Validation.markMatchTypes(e,t,o,l)}})}},Magellan.Validation.markCreatedActionTypes=function(e,t,i){_.isEmpty(e.nodeNamesToCreatedActionTypeStatus)&&(e.nodeNameToAncestors={});var a=e.nodeNameToAncestors[t.nodeInfo.name]=e.nodeNameToAncestors[t.nodeInfo.name]||new Set,n=_.clone(i);if(e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name]){var o=!0,l=e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name];if(_.forEach(n,(e,t)=>{if(!n[t]&&l[t])return o=!1,!1}),o)return;Object.keys(e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name]).forEach(i=>{e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name][i]=e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name][i]&&n[i]})}else e.nodeNamesToCreatedActionTypeStatus[t.nodeInfo.name]=_.clone(n);if(_.each(t.nodeInfo.edges,function(i){var n=e.nodeNameToAncestors[i.target];e.nodeNameToAncestors[i.target]=n=n||new Set,a.forEach(e=>n.add(e)),n.add(t.nodeInfo.name)}),Magellan.Validation.CREATED_ACTION_TYPE_MAP.hasOwnProperty(t.nodeInfo.actionType)){n[t.nodeInfo.outputVariable]=!0,"Account Creation"==t.nodeInfo.actionType&&0==t.nodeInfo.doNotCreateOpportunity&&0==t.nodeInfo.convertLeadToContact&&(n[t.nodeInfo.objectVariable]=!0);var s=_.filter(t.nodeInfo.edges,function(e){return"Next Node"===_.startCase(e.name)})[0],r=s?s.target:null;if(!_.isNull(r)&&!_.isUndefined(r)&&-1!==r&&0!==r&&-2!==r&&!a.has(r)){var d=e.nodeNamesToNodesMap[r];Magellan.Validation.markCreatedActionTypes(e,d,n)}n[t.nodeInfo.outputVariable]=!1,"Account Creation"==t.nodeInfo.actionType&&0==t.nodeInfo.doNotCreateOpportunity&&0==t.nodeInfo.convertLeadToContact&&(n[t.nodeInfo.objectVariable]=!1);const i=_.filter(t.nodeInfo.edges,function(e){return"Next Node"!==_.startCase(e.name)});_.each(i,function(t){const i=t.target;if(!_.isNull(i)&&!_.isUndefined(i)&&-1!==i&&0!==i&&-2!==i&&!a.has(i)){const t=e.nodeNamesToNodesMap[i];Magellan.Validation.markCreatedActionTypes(e,t,n)}})}else{var c={};_.each(t.nodeInfo.edges,function(t){var i=t.target;if(!c[i]&&i!==_LeanData._flowbuilder.EDGE_TARGET.NONE&&!_.isUndefined(i)&&i!==_LeanData._flowbuilder.EDGE_TARGET.EOF&&i!==_LeanData._flowbuilder.EDGE_TARGET.REROUTE&&i!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&!a.has(i)){c[i]=!0;var o=e.nodeNamesToNodesMap[i];Magellan.Validation.markCreatedActionTypes(e,o,n)}})}},Magellan.Validation.markTriggerTypes=function(e,t,i){_.isEmpty(e.nodeNamesToTriggerTypeStatus)&&(e.nodeNameToAncestors={});var a=e.nodeNameToAncestors[t.nodeInfo.name]=e.nodeNameToAncestors[t.nodeInfo.name]||new Set,n=_.clone(i);if(e.nodeNamesToTriggerTypeStatus[t.nodeInfo.name]){var o=!0,l=e.nodeNamesToTriggerTypeStatus[t.nodeInfo.name];if(_.forEach(n,(e,t)=>{if(!n[t]&&l[t])return o=!1,!1}),o)return;e.nodeNamesToTriggerTypeStatus[t.nodeInfo.name]=_.merge(e.nodeNamesToTriggerTypeStatus[t.nodeInfo.name],n)}else e.nodeNamesToTriggerTypeStatus[t.nodeInfo.name]=_.clone(n);t.nodeInfo.edges.forEach(i=>{var n=e.nodeNameToAncestors[i.target];e.nodeNameToAncestors[i.target]=n=n||new Set,a.forEach(e=>n.add(e)),n.add(t.nodeInfo.name)});var s={},r=Magellan.Validation.TRIGGERED_TYPE_TO_RESERVED_VARIABLE_MAP[t.nodeInfo.type];r&&"HOLDUNTIL"!==t.nodeInfo.type&&(n[r]=!0);var d=n[r];t.nodeInfo.edges.forEach(i=>{t instanceof _LeanData.GraphModels.ReroutingNode&&(n["triggered activity"]=d||"Task"===i.objectType||"Event"==i.objectType);var o=i.target;if((!s[o]||t instanceof _LeanData.GraphModels.ReroutingNode)&&o!==_LeanData._flowbuilder.EDGE_TARGET.NONE&&!_.isUndefined(o)&&o!==_LeanData._flowbuilder.EDGE_TARGET.EOF&&o!==_LeanData._flowbuilder.EDGE_TARGET.REROUTE&&o!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&!a.has(o)){s[o]=!0;var l=e.nodeNamesToNodesMap[o];Magellan.Validation.markTriggerTypes(e,l,n)}})},Magellan.Validation.markVariables=function(e,t,i){_.isEmpty(e.nodeNamesToVariableStatus)&&(e.nodeNameToAncestors={});const a=e.nodeNameToAncestors[t.nodeInfo.name]=e.nodeNameToAncestors[t.nodeInfo.name]||new Set,n=_.clone(i);if(e.nodeNamesToVariableStatus[t.nodeInfo.name]){let i=!0;const a=e.nodeNamesToVariableStatus[t.nodeInfo.name];if(_.forEach(n,(e,t)=>{if(!n[t]&&a[t])return i=!1,!1}),i)return;Object.keys(e.nodeNamesToVariableStatus[t.nodeInfo.name]).forEach(i=>{e.nodeNamesToVariableStatus[t.nodeInfo.name][i]=e.nodeNamesToVariableStatus[t.nodeInfo.name][i]&&n[i]})}else e.nodeNamesToVariableStatus[t.nodeInfo.name]=_.clone(n);_.each(t.nodeInfo.edges,function(i){let n=e.nodeNameToAncestors[i.target];e.nodeNameToAncestors[i.target]=n=n||new Set,a.forEach(e=>n.add(e)),n.add(t.nodeInfo.name)});const o=_LeanData.AppState.getCurrentVariablesService().getVariablesBySource(t.nodeInfo.name),l=[_LeanData.GraphModels.Action_SetVariable,_LeanData.GraphModels.Trigger_NewProspect,_LeanData.GraphModels.Trigger_NewChatProspect,_LeanData.GraphModels.Partner_Crossbeam_IdentifyPartnerOverlaps,_LeanData.GraphModels.Action_RouteToDataSet,_LeanData.GraphModels.Action_RouteToETMModel,_LeanData.GraphModels.Trigger_General,_LeanData.GraphModels.Action_CustomInterface,_LeanData.GraphModels.Action_CustomInterfaceSchedule].some(e=>t instanceof e);if(o&&l)Object.keys(o).forEach(e=>{n[e]=!0}),_.each(t.nodeInfo.edges,function(t){const i=t.target;if(i!==_LeanData._flowbuilder.EDGE_TARGET.NONE&&!_.isNil(i)&&i!==_LeanData._flowbuilder.EDGE_TARGET.EOF&&i!==_LeanData._flowbuilder.EDGE_TARGET.REROUTE&&i!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&!a.has(i)){const t=e.nodeNamesToNodesMap[i];Magellan.Validation.markVariables(e,t,n)}});else{let i={};_.each(t.nodeInfo.edges,function(t){const o=t.target;if(!i[o]&&o!==_LeanData._flowbuilder.EDGE_TARGET.NONE&&!_.isNil(o)&&o!==_LeanData._flowbuilder.EDGE_TARGET.EOF&&o!==_LeanData._flowbuilder.EDGE_TARGET.REROUTE&&o!==_LeanData._flowbuilder.EDGE_TARGET.DISABLED&&!a.has(o)){i[o]=!0;const t=e.nodeNamesToNodesMap[o];Magellan.Validation.markVariables(e,t,n)}})}},Magellan.Validation.validateAllNodes=function(e){let t=$.Deferred(),i=[],a=new Set,n=new Set;return Object.values(e).forEach(e=>{if(e.nodeInfo.notificationSettings){var t=_.get(e,"nodeInfo.notificationSettings.chatter.recipients.groups");t&&t.forEach(e=>a.add(e.id));var i=_.get(e,"nodeInfo.notificationSettings.chatter.recipients.users");i&&i.forEach(e=>n.add(e.id))}}),Promise.all([_LeanData.FlowBuilderController.searchChatterGroups(null,[...a]),_LeanData.FlowBuilderController.searchChatterUsers(null,[...n])]).then(()=>{let a=[];Object.values(e).forEach(e=>{a.push((e=>new Promise((t,a)=>{e.isValid(!0).then(a=>{a||i.push(e),Magellan.Validation.nodeNameToIsValidCache&&(Magellan.Validation.nodeNameToIsValidCache[e.nodeInfo.name]=a),t(a)}).catch(i=>{console.error(`Error validating node "${e.nodeInfo.name}"`,i),t(!1)})}))(e))}),Promise.all(a).then(function(){t.resolve(i),Magellan.Validation.nodeNameToIsValidCache=null})}).catch(e=>{console.error("Error: ",e)}),t},Magellan.Validation.fetchVariablesAndValidateGraph=function(e,t,i){return _LeanData.AppState.selectedDeploymentId?Magellan.Validation.validateGraph(e,t,i):(_LeanData.AppState.createVariablesService(_LeanData.AppState.selectedDeploymentId),new Promise((a,n)=>{_LeanData.AppState.getCurrentVariablesService().fetchVariables(e.variables).then(()=>{Magellan.Validation.validateGraph(e,t,i).then(a).fail(n)}).catch(e=>{n(e)})}))},Magellan.Validation.validateGraph=function(e,t,i){t&&(_LeanData.AppState.PrimarySObjectType=t),_LeanData.AppState.businessUnitId=i,_LeanData.AppState.selectedDeploymentId||(_LeanData.AppState.createVariablesService(_LeanData.AppState.selectedDeploymentId),_LeanData.AppState.getCurrentVariablesService().fetchVariables(e.variables),_LeanData.AppState.getFieldMappingService().initFieldMappings(new Map(Object.entries(e.matchingFieldMappings||{})))),Magellan.Validation.nodeNameToIsValidCache={};var a=$.Deferred(),n={},o=[],l=[],s=[],r=[];Magellan.Validation.nonUpgradedNodes={};var d={},c={},h=[],p=new Map,u=new Map,m=new Map;window.graph=e;var g=_LeanData.FBUtil.getAllNodes(e),f={},b=[];_.eachRight(g,function(e){const i=_LeanData.GraphModelTypeMap[e.nodeInfo._model];i.hasOwnProperty("handleWriteVariables")&&i.handleWriteVariables(e.nodeInfo,_LeanData.AppState.getCurrentVariablesService(),!1),("Convert Lead"===e.nodeInfo.actionType||e.nodeInfo.convertLeadToContact)&&b.push(e);var a=e.nodeInfo.name;e instanceof _LeanData.GraphModels.TriggerNode&&l.push(a),e instanceof _LeanData.GraphModels.CollapsedNode&&s.push(a);const g=e.nodeInfo.hasOwnProperty("variableValues")?"variableValues":e.nodeInfo.hasOwnProperty("formField")?"formField":null;!_LeanData.AppState.selectedDeploymentId&&g&&Object.keys(e.nodeInfo[g]).forEach(e=>{_LeanData.AppState.getCurrentVariablesService().addVariableSource(e,a)}),(_LeanData.Util.isAnyObject(t)&&!_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:ANY_OBJECT_ROUTING")||_LeanData.LD_JOURNEY===t&&!_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BG_JOURNEY")||!_LeanData.Util.isAnyObject(t)&&!_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:"+t.toUpperCase()+"_ROUTING"))&&(d.disabledObject=!0),_LeanData.FeatureProvisioning.getUpgradeStatusFromModelType(e.nodeInfo._model,_LeanData.AppState.PrimarySObjectType,_LeanData.AppState.isHandoffGraph?"handoff":"routing")&&(Magellan.Validation.nonUpgradedNodes[e.nodeInfo.name]=e),n[a]=e,c[a]=new function TarjanNodeWrapper(e){this.index=void 0,this.lowLink=void 0,this.onStack=!1,this.nodeReference=e}(e),"HOLDUNTIL"==e.nodeInfo.type&&(u.has(a.toLowerCase())||u.set(a.toLowerCase(),[]),u.get(a.toLowerCase()).push(a)),e.nodeInfo.actionType&&e.nodeInfo.actionType.startsWith("ZoomInfo")&&(p.has(a.toLowerCase())||p.set(a.toLowerCase(),[]),p.get(a.toLowerCase()).push(a)),e.nodeInfo.actionType&&e.nodeInfo.actionType.startsWith("Slack")&&(m.has(a.toLowerCase())||m.set(a.toLowerCase(),[]),m.get(a.toLowerCase()).push(a));var v={};_.each(e.nodeInfo.edges,function(t){var i=t.target;if(-1!==i&&0!==i&&-2!==i&&!_.isNull(i)&&!_.isUndefined(i)&&!v.hasOwnProperty(i)){var a=v[i]={target:n[i],source:e};_.isObject(n[i])||(_.isArray(f[i])||(f[i]=[]),f[i].push(a)),a.target===a.source&&r.push(a)}}),Array.prototype.push.apply(o,_.values(v)),f.hasOwnProperty(a)&&(_.each(f[a],function(t){t.target=e,t.target===t.source&&r.push(t)}),delete f[a]),e.getNumberOfDanglingEdges()>0&&h.push(e)}),d.invalidZoomInfoNodeNamesGroups=p,d.invalidHoldUntilNodeNamesGroups=u,d.invalidSlackNodeNamesGroups=m;var v=new Set(["Account Creation","Create Opportunity","Create Task"]);if(d.invalidLeadConversionEdges=Magellan.Validation.findNodesWithInvalidSucceedingActions(n,b,v),_.isEmpty(f)||console.warn({message:"Graph JSON contains edges that are targeting non-existing nodes","erroneous edges":f}),r.length>0){var y=r.map(function(e){return e.source.nodeInfo.name});d.specialSelfPointingNodesErrors=y,console.warn("The following nodes have self pointing edges: "+y.join(", "))}var w=new function TarjanContext(e,t){this.index=0,this.stronglyConnectedComponents=[],this.stack=[],this.nodeNamesToNodeWrappersMap=e,this.edges=t,this.processedRerouteNodes=[],this.rerunReroute=[]}(c,o);if(d.setOfNodeCycles=Magellan.Validation.findSetOfCycles(w,l),d.setOfNodeCycles.length>0)Magellan.Validation.doCyclesExist=!0;else{Magellan.Validation.doCyclesExist=!1,Magellan.Validation.nodeNameToRelatedObjectTypes={};var T=T||{matchType:void 0,nodeNamesToMatchTypeStatus:{},nodeNamesToAvailableDupeMatchVariableStatus:{},nodeNamesToCreatedActionTypeStatus:{},nodeNamesToTriggerTypeStatus:{},nodeNamesToVariableStatus:{},nodeNamesToNodesMap:n};d.nodesWithMissingMatchTypes=Magellan.Validation.findNodesWithInvalidVariableReferences(n,T),_.each(n,function(e,t){var i={matched:new Set,created:new Set,triggered:new Set};_.each(T.nodeNamesToMatchTypeStatus[t],(e,t)=>{if(e&&t&&Magellan.Validation.isReservedVariable(t)){let e=_LeanData.StringUtil.capitalizeString(t.split(" ")[1],!1,!0);"Campaignmember"===e&&(e="CampaignMember"),i.matched.add(e)}}),_.each(T.nodeNamesToCreatedActionTypeStatus[t],(e,t)=>{if(e&&t&&Magellan.Validation.isReservedVariable(t)){let e=_LeanData.StringUtil.capitalizeString(t.split(" ")[1],!1,!0);"Campaignmember"===e&&(e="CampaignMember"),i.created.add(e)}}),_.each(T.nodeNamesToTriggerTypeStatus[t],function(e,t){if(e&&t&&Magellan.Validation.isReservedVariable(t)){let e=_LeanData.StringUtil.capitalizeString(t.split(" ")[1],!1,!0);"Campaignmember"===e&&(e="CampaignMember"),i.triggered.add(e)}},this),i.matched=Array.from(i.matched),i.created=Array.from(i.created),i.triggered=Array.from(i.triggered),Magellan.Validation.nodeNameToRelatedObjectTypes[t]=i}),Magellan.Validation.nodesWithMissingMatchTypes=d.nodesWithMissingMatchTypes}return d.nodesWithDanglingEdges=h,d.danglingNodes=Magellan.Validation.findDanglingNodes(n,[...l,...s]),Magellan.Validation.validateAllNodes(n).then(e=>{d.nodesFailingIsValid=e,_.isEmpty(Magellan.Validation.nonUpgradedNodes)||(d.nonUpgradedNodes=Object.values(Magellan.Validation.nonUpgradedNodes)),a.resolve(d)}),a},Magellan.Validation.findNodesWithInvalidSucceedingActions=function(e,t,i){var a=new Set,n=new Set,o=function(t){if(n.has(t.nodeInfo.name))return!0;var l=!1;return i.has(t.nodeInfo.actionType)?(t.nodeInfo.edges.forEach(t=>{t.target!==_LeanData._flowbuilder.EDGE_TARGET.EOF&&t.target!=_LeanData._flowbuilder.EDGE_TARGET.NONE&&o(e[t.target])&&(n.add(t.target),l=!0)}),l):(n.add(t.nodeInfo.name),a.add(t),!0)};return t.forEach(t=>{t.nodeInfo.edges.forEach(t=>{t.target!==_LeanData._flowbuilder.EDGE_TARGET.EOF&&t.target!==_LeanData._flowbuilder.EDGE_TARGET.NONE&&"Next Node"==t.condition&&o(e[t.target])&&n.add(t.target)})}),[...a]},Magellan.Validation.validateOwnerMapping=async function(e){var t=await _LeanData.FlowBuilderController.queryOwnerMappings([e]);return!_.isEmpty(t)},Magellan.Validation.validateAccountTeam=async function(e){var t=await _LeanData.FlowBuilderController.queryAccountTeams([e]);return!_.isEmpty(t)},Magellan.Validation.validateAccountTeamsEnabled=function(){return _LeanData._getOrganizationData().statuses.accountTeamsEnabled},Magellan.Validation.validateMeetingType=function(e,t){return new Promise((i,a)=>{_.isEmpty(e)?i(!!t):_LeanData.FlowBuilderController.heroku_getMeetingInfo().then(a=>{const n=t?"BookIt Handoff":"BookIt for Forms";let o=_.find(a,t=>{const i=t.product_access||[];let a={dateRangeType:t.dateRangeType,minBookingNotice:t.minBookingNotice,customRange:t.customRange};const o=!Magellan.Validation.isValidMeetingTypeDateRange(a);return t.id===e&&i.includes(n)&&!o});i(!_.isEmpty(o))})})},Magellan.Validation.isValidMeetingTypeDateRange=function(e){if("relative"===e.dateRangeType)return!0;const t=new Date,i=moment.duration(e.minBookingNotice.value,{hr:"hours",min:"minutes"}[e.minBookingNotice.unit]||e.minBookingNotice.unit).asMilliseconds(),a=t.getTime()+i;return e.customRange.endTime-a>0},Magellan.Validation.validateAdditionalAttendees=function(e){return new Promise((t,i)=>{let a=!0;if(!e.nodeInfo.additionalAttendeeList||0===e.nodeInfo.additionalAttendeeList.length)return t(a);let n=new Set;if(e.nodeInfo.additionalAttendeeList.forEach(t=>{if("Specific User"===t.type)0===t.keyField.length?a=!1:n.add(t.keyField[0].Id);else if("User Field on Variable"===t.type){""===t.keyField&&(a=!1);const i=t.keyField;Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,_LeanData.StringUtil.bracketize(i),"STRING","Additional Attendee")||(a=!1)}}),!a)return t(a);_LeanData.FlowBuilderController.queryUsers(Array.from(n)).then(e=>{a=e.every(t=>t.IsActive&&n.size===e.length),t(a)})})},Magellan.Validation.validateRerouteTimeFrame=function(e){return new Promise((t,i)=>{if(e.nodeInfo.workingHoursId){const a=[];a.push(_LeanData.FlowBuilderController.queryScheduleSettings([e.nodeInfo.workingHoursId])),e.nodeInfo.holidaysId&&a.push(_LeanData.FlowBuilderController.queryScheduleSettings([e.nodeInfo.holidaysId])),Promise.all(a).then(([i,a])=>{var n=!_.isEmpty(i);e.nodeInfo.holidaysId&&(n=n&&!_.isEmpty(a)),t(n)}).catch(e=>{i(e),console.err(e)})}else{let i=e.nodeInfo.days||0,a=e.nodeInfo.hours||0,n=e.nodeInfo.minutes||0;t(Magellan.Validation.isValidRerouteTimeFrame(i,a,n))}})},Magellan.Validation.validateHoldUntilNode=function(e){return new Promise((t,i)=>{let a=!0;const n=_LeanData.AppState.PrimarySObjectType;if(e.nodeInfo.ttatField){const t="owner.id"==e.nodeInfo.ttatField;_LeanData.MetaDataController.getObjectMetaDataObject(n,!0).hasOwnerField||(a=a&&!t),a=a&&(t||Magellan.Validation.isValidUserAssignmentField(e.nodeInfo.ttatField,n))}const o=e.nodeInfo.days,l=e.nodeInfo.hours,s=e.nodeInfo.minutes;t(a=a&&_LeanData.Validation.isValidHoldUntilTimeFrame(o,l,s))})},Magellan.Validation.validateWebFormTrigger=function(e){return new Promise((t,i)=>{_.isEmpty(e.nodeInfo.formField)&&t(!1);let a=!0;Object.keys(e.nodeInfo.formField).forEach(t=>{a=a&&!_.isEmpty(e.nodeInfo.formField[t])&&_LeanData.VariablesUtil.isValidVariableName(t)&&_LeanData.Util.isValidVariableLabel(_LeanData.AppState.getCurrentVariablesService().getVariableByName(t).label,_LeanData.AppState.PrimarySObjectType)}),t(a)})},Magellan.Validation.validateFormFieldMapping=function(e){const t=new Set(["{!logid}","{!leandataterritory}"]);return new Promise((i,a)=>{e.nodeInfo.fieldMapping||i(!1);const n=e.nodeInfo.fieldMapping,o=new Set;let l=!0;n.forEach(i=>{const a=i["value field"];l=l&&!_.isEmpty(i["form field"])&&!o.has(i["form field"])&&!_.isEmpty(a)&&(t.has(a.toLowerCase())||Magellan.Validation.isValidMergeFieldValue(e.nodeInfo.name,a,"STRING","Form Field Value")),o.add(i["form field"])}),i(l)})},Magellan.Validation.validateRedirectToUrl=function(e){return new Promise((t,i)=>{t(_LeanData.Validation.validateUrl(e.nodeInfo["redirect url"]))})},Magellan.Validation.validateVariable=function(e,t){return!((t=(t=_LeanData.StringUtil.debracketize(t)).split(".")[0])!==`routed ${_LeanData.AppState.PrimarySObjectType.toLowerCase()}`&&(_.isEmpty(Magellan.Validation.nodeNamesToVariableStatus)&&Magellan.Validation.getNodesToCurrentNode(e),Magellan.Validation.doCyclesExist&&!Magellan.Validation.nodeNamesToVariableStatus?(console.error("Cycle in graph prevents variable status map from populating"),1):!Magellan.Validation.nodeNamesToVariableStatus[e]||!Magellan.Validation.nodeNamesToVariableStatus[e][t]))}}},function(e,t){e.exports=' <div id="<%- uniqueId %>-modal" class="modal fade"> <div class=modal-dialog> <div class=modal-content style=height:initial> <div class=dg_inner-wrapper-header id="<%- uniqueId %>-text" style=display:flex;justify-content:center;align-items:center;margin-top:10px> <%- headerText %> </div> <div class=modal-content-section style="height:initial;padding:30px 0 30px 0;overflow:visible"> <div class=modal-content-text id="<%- uniqueId %>-modal-text" style=height:initial><%= mainText %></div> <div class=modal-content-extra id="<%- uniqueId %>-extra" style=height:initial;padding-top:20px></div> </div> <div id="<%- uniqueId %>-button-div" class=modal-button-section style=height:initial;padding-bottom:20px> <% if (!_.isNull(button1Name) && !_.isUndefined(button1Name)) { %> <% if (!_.isNull(button1Action) && !_.isUndefined(button1Action)) { %> <button type=button class=lds-tertiary-large-button data-bs-dismiss=modal onclick="<%- button1Action() %>" id="<%- uniqueId %>-button-1"> <% } else { %> <button type=button class=lds-tertiary-large-button data-bs-dismiss=modal id="<%- uniqueId %>-button-1"> <% } %> <%- button1Name %> </button> <% } %> <% if (!_.isNull(button2Name) && !_.isUndefined(button2Name)) { %> <% if (!_.isNull(button2Action) && !_.isUndefined(button2Action)) { %> <button type=button class=lds-primary-large-button data-bs-dismiss=modal role=button onclick="<%- button2Action() %>" id="<%- uniqueId %>-button-2"> <% } else { %> <button type=button class=lds-primary-large-button data-bs-dismiss=modal role=button id="<%- uniqueId %>-button-2"> <% } %> <%- button2Name %> </button> <% } %> </button></button></div> </div> </div> </div> '},function(e,t){e.exports='<div id=createModalText>Add Territory Segments Manager(s) to the following <span id=segmentsNumber></span> segment(s): <br/> <br/> <div id=selected-territories-list class=mb20></div> <div class="inline-flex align-start"> <div class="pr15 flex justify-end align-center" style=width:170px;text-align:right> <div class="flex semi-bold" style=flex-direction:column> Territory Segment Manager(s) </div> <ldc-tooltip-angular class="angular-component-in-magellan ml5 pb5" id=tm-tooltip style=flex-shrink:0;text-align:left></ldc-tooltip-angular> </div> <div class=territory-manager-data-wrapper> <div> <ld-typeahead-angular class=angular-component-in-magellan id=manager-dropdown> </ld-typeahead-angular> </div> <div class="manager-list pt10"></div> </div> </div> </div> '},function(e,t){e.exports='<div id=createModalText> <div style=display:inline-flex;margin-bottom:10px> <div class=semi-bold style=padding-right:20px;width:150px;display:flex;justify-content:flex-end> Segment Name </div> <div> <input type=text style=width:200px;height:27.5px id=copyTerritoryInput> <div class=ld-text-danger style=display:none;margin-top:10px id=copyNameWarningDiv></div> </div> </div> <div style=display:inline-flex class=territory-business-unit-modal> <div class="flex semi-bold align-center" style=padding-right:20px;width:150px;justify-content:flex-end;margin-top:5px> Business Unit <ldc-tooltip-angular class="angular-component-in-magellan ml5" id=bu-tooltip></ldc-tooltip-angular> </div> <div id=territory-copy-bu-typeahead style=width:200px></div> </div> </div> '},function(e,t){e.exports='<div class="inline-flex mb10 mt10"> <div class="semi-bold mt5 flex pr20 justify-end" style=width:170px>Segment Name</div> <div> <input class=ld-input-large type=text style=width:250px;height:27.5px id=createTerritoryInput autocomplete=chrome-off> <div class="ld-text-danger mt10" style=display:none id=nameWarningDiv></div> </div> </div> <div class="inline-flex mb10 territory-business-unit-modal align-center"> <div class="flex justify-end pr15 mt5 semi-bold align-center" style=width:170px> <div style=margin-bottom:8px> Business Unit </div> <ldc-tooltip-angular class="angular-component-in-magellan ml5 mb15 pt10" id=bu-tooltip></ldc-tooltip-angular> </div> <div id=territory-bu-typeahead-create style=width:250px></div> </div> <div class="inline-flex align-start"> <div class="pr15 flex justify-end align-center semi-bold" style=width:170px;text-align:right> <div class=flex style=flex-direction:column> Territory Segment Manager(s) <div class=ld-hint-medium>optional</div> </div> <ldc-tooltip-angular class="angular-component-in-magellan ml5 pb20" id=tm-tooltip style=flex-shrink:0;text-align:left></ldc-tooltip-angular> </div> <div class=territory-manager-data-wrapper> <div> <ld-typeahead-angular class=angular-component-in-magellan id=manager-dropdown> </ld-typeahead-angular> </div> <div class="manager-list pt10"></div> </div> </div> '},function(e,t){e.exports='<div class="inline-flex mb10 mt10"> <div class="flex pr20 justify-end semi-bold" style=width:170px>Segment Name</div> <div> <input class=ld-input-large type=text style=width:250px;height:27.5px id=editTerritoryInput autocomplete=chrome-off> <div class="ld-text-danger mt10" style=display:none id=nameWarningDiv></div> </div> </div> <div class="inline-flex mb10 territory-business-unit-modal"> <div class="flex justify-end pr15 mt5 semi-bold" style=width:170px> Business Unit <ldc-tooltip-angular class="angular-component-in-magellan ml5 mb15" id=bu-tooltip></ldc-tooltip-angular> </div> <div id=territory-bu-typeahead-edit style=width:250px></div> </div> <div class="inline-flex align-start"> <div class="flex justify-end pr15" style=width:170px;text-align:right;flex-direction:column> <div class="flex semi-bold" style=flex-direction:row> Territory Segment Manager(s) <ldc-tooltip-angular class="angular-component-in-magellan ml5 pb5" id=tm-tooltip style=flex-shrink:0;text-align:left></ldc-tooltip-angular> </div> <div class=ld-hint-medium style=align-self:center;margin-left:60px>optional</div> </div> <div class=territory-manager-data-wrapper> <div overflow=visible> <ld-typeahead-angular overflow=visible class=angular-component-in-magellan id=manager-dropdown> </ld-typeahead-angular> </div> <div class="manager-list pt10"></div> </div> </div> '},function(e,t){e.exports="<div id=createModalText style=height:60px> Edit existing Segment name<br><br> <input style=margin-left:10px;width:125px;height:22px type=text id=renameTerritoryInput> <div class=ld-text-danger style=display:none;margin-top:10px;margin-left:10px id=renameNameWarningDiv></div> </div> <div class=modal-content-extra id=renameSegmentContent> </div> "},function(e,t){e.exports='<div class=ld-tooltip> <div class="ld-tooltip-close-icon ld-cross-icon-grey-small"></div> <div class=ld-tooltip-title><%= title %></div> <div class=ld-tooltip-body style=white-space:pre-wrap><%= body %></div> </div> '},function(e,t){e.exports=function(){return Backbone.Model.extend({initialize:function(e){this.set(_LeanData.Util.getDefaultChatterNotificationSettings().recipients),this.set(e),this.set("matchedObjectTypes",e.matchedObjectTypes||[]),this.set("showOwnerOptions",!_.isBoolean(e.notifyOwners)||e.notifyOwners),this.set("showAdditionalObjectUserOptions",!_.isBoolean(e.notifyAdditionalObjectUsers)||e.notifyAdditionalObjectUsers),this.set("showChatterOptions",!_.isBoolean(e.notifyChatterRecipients)||e.notifyChatterRecipients),this.set("groups",e.groups||[]),this.set("users",e.users||[]),this.originalModel=_.cloneDeep(this.toJSON())}})}},function(e,t,i){e.exports=function(){var e=i(2)(),t=i(65)();return Backbone.View.extend({className:"chatter-recipient-selector-wrapper",template:_.template(i(163)),events:{"click .edit-recipients-button":"_showEditor","click .save-receipients-button":"_hideEditor","click .notif-owner-checkbox":"_toggleOwner","click .subcontent-toggle":"_toggleSubcontentForm","click .additional-options-checkbox":"_toggleAdditionalOptions"},initialize:function(e){this.currentCacheState=_LeanData.MetaDataController.getPartnerMetaDataCache("searchChatterGroups")||{},this.hasOwnerField=e.hasOwnerField,e=e||{},this.editMode=e.editMode||!1,this.additionalRecipients=e.additionalNotificationOptions?e.additionalNotificationOptions:{},this.onSaveCallback=_.isFunction(e.onSave)?e.onSave:_.noop,this.chatterRecipientLimit=Magellan.Validation.EMAIL_RECIPIENT_LIMIT||20,this.chatterRecipientObjs={Lead:!0,Account:!0,Opportunity:!0,Case:!0,Contact:!0},this.model=new Magellan.Models.ChatterRecipientSelector(e),this.model.set("chatter",!0),this.model.set("additionalOptions",this.additionalRecipients),this._processChatterFields(),this._processAdditionalObjectUserFields()},_processChatterFields:function(){this.chatterGroups=[],_.each(this.model.get("groups"),e=>{this.chatterGroups.push(e)}),this.chatterUsers=[],_.each(this.model.get("users"),e=>{this.chatterUsers.push(e)})},_processAdditionalObjectUserFields:function(){var e={},t={};_.forEach(_LeanData._app.OBJECT_TYPES,i=>{var a=_.cloneDeep(_LeanData.MetaDataController.getFlattenedFieldsByObject(i));e[i]=_.filter(a,function(e){if(!_LeanData._blacklist.FIELD_BLACKLIST_SETS.USER_FIELDS.has(e.name)&&_.includes(e.parent,"User")){if(e.name.endsWith("id")){var t=e.name.length-2;e.name=e.name.substr(0,t)+"."+e.name.substr(t)}else e.name=e.name.replace("__c","__r.id");return!0}return!1}),t[i]=_.keyBy(e[i],"name")}),this.model.set("userFieldOptions",e),this.model.set("userFieldOptionsMap",t),this.matchedObjectData=new Set,this.matchedObjectDropdownViews={},this.additionalObjects=[],_.each(this.model.get("additionalObjectUserFields"),e=>{this.additionalObjects.push(e)}),this.render()},_isValidChatterAdditionalRecipient:function(e){e=_LeanData.StringUtil.debracketize(e);const t=_LeanData.AppState.getCurrentVariablesService().getRootVariableSObjectType(e);return!("id"!==e.split(".")[1]&&!e.endsWith("__c")&&!e.endsWith("__r.id")||!this.chatterRecipientObjs.hasOwnProperty(t))},_setChatterGroupInModel:function(){var e=[];this.$el.find(".group-toggle").prop("checked")&&(e=e.concat(this.chatterGroupRecipientRowsView.getSelections()),this.chatterGroupRecipientRowsView.getSelections().forEach(e=>{e.id in this.currentCacheState||(this.currentCacheState[e.id]=e)})),this.model.set("groups",_.cloneDeep(e))},_setChatterUserInModel:function(){var e=[];this.$el.find(".user-toggle").prop("checked")&&(e=e.concat(this.chatterUserRecipientRowsView.getSelections())),this.model.set("users",e)},_setAdditionalObjectUserFieldsInModel:function(){var e=[];this.matchedObjectData.clear(),this.$el.find(".additional-recipients-toggle").prop("checked")&&(e=e.concat(this.additionalRecipientRowsView.getSelections())),this.model.set("additionalObjectUserFields",e)},_showEditor:function(e){e.preventDefault(),this.editMode=!0,this._processChatterFields(),this._processAdditionalObjectUserFields()},_setDataInModel:function(){this._setAdditionalObjectUserFieldsInModel(),this._setChatterGroupInModel(),this._setChatterUserInModel()},_hideEditor:function(){this._setDataInModel(),this.validate().then((e=>{if(_.isEmpty(e)){var t=this._getSaveableData();this.trigger("savedRecipients",t),this.onSaveCallback(t),this.editMode=!1,this._processChatterFields(),this._processAdditionalObjectUserFields()}else this.$el.find(".chatter-recipients-error-messages").html(Object.values(e).join("<br>"))}).bind(this))},_getSaveableData:function(){var e={groups:this.model.get("groups"),users:this.model.get("users")};return this.model.get("showOwnerOptions")&&(e.notifyPostOwner=this.model.get("notifyPostOwner"),e.notifyPreOwner=this.model.get("notifyPreOwner"),e.notifyNewObjectOwner=this.model.get("notifyNewObjectOwner")),this.model.get("showAdditionalObjectUserOptions")&&(e.additionalObjectUserFields=this.model.get("additionalObjectUserFields")),e.additionalOptions=this.model.get("additionalOptions"),e},_toggleOwner:function(e){var t=$(e.target);this.model.set(t.data("ownerType"),t.prop("checked"))},_toggleSubcontentForm:function(e){var t=$(e.target),i=t.prop("checked");t.closest(".recipient-editor-row").find(".recipient-editor-subcontent").toggleClass("hidden",!i)},_toggleAdditionalOptions:function(e){let t=$(e.target),i=t.data("ownerType"),a=this.model.get("additionalOptions");a[i]=t.prop("checked"),this.model.set("additionalOptions",a)},_getAdditionalObjectsLabels:function(e){return _.map(e,e=>{return _.map(_LeanData.Util.convertFieldSelectionStringToArray(_LeanData.StringUtil.debracketize(e),_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap()),(e,t,i)=>t===i.length-1?e.label:e.label.replace(" ID","")).join(" > ")})},_validateAdditionalObjects:function(e){return _.map(e,e=>this._validateSingleAdditionalObject(e))},_validateSingleAdditionalObject:function(e){return Magellan.Validation.validateVariable(this.model.get("nodeInfo").name,e)&&(Magellan.Validation.isValidUserVariable(e)||this._isValidChatterAdditionalRecipient(e))},_createRecipientCards:async function(){this.recipientCards=[];const e=(e,t)=>({name:e,valid:t});this.model.get("notifyPostOwner")&&this.recipientCards.push(e("New Owner",!0)),this.model.get("notifyPreOwner")&&this.recipientCards.push(e("Previous Owner",!0)),_.forEach(this.model.get("groups"),t=>{this.recipientCards.push(e(t.label,!!this.currentCacheState[t.id]))});const t=this.model.get("users").map(e=>e.id);if(t.length>0){const i=await _LeanData.FlowBuilderController.searchChatterUsers("",t,!0);_.forEach(this.model.get("users"),t=>{const a=_.find(i,{Id:t.id}),n=!!a&&a.IsActive;this.recipientCards.push(e(t.label,n))})}_.forEach(this.model.get("additionalObjectUserFields"),t=>{Magellan.Validation.isValidUserVariable(t)&&Magellan.Validation.validateVariable(this.model.get("nodeInfo").name,t)||this._isValidChatterAdditionalRecipient(t)?this.recipientCards.push(e(this._getAdditionalObjectsLabels([t]),!0)):this.recipientCards.push(e(t+" (DELETED)"))}),_.each(this.model.get("additionalOptions"),(t,i)=>{t&&this.recipientCards.push(e(i,!0))})},_getElementClasses:function(){var e={"edit-recipients-button":new Set(["edit-recipients-button"]),"chatter-recipients-wrapper":new Set(["chatter-recipients-wrapper"]),"chatter-recipients-editor":new Set(["chatter-recipients-editor","hidden"]),"empty-recipients-message":new Set(["empty-recipients-message"]),"next-owner-row":new Set(["next-owner-row","hidden"]),"previous-owner-row":new Set(["previous-owner-row","hidden"]),"new-object-owner-row":new Set(["new-object-owner-row","hidden"]),"matched-object-row":new Set(["matched-object-row","hidden"]),"group-row":new Set(["group-row","hidden"]),"user-row":new Set(["user-row","hidden"]),"additional-recipients-row":new Set(["additional-recipients-row","hidden"])};return this.editMode&&(e["edit-recipients-button"].add("invisible"),e["chatter-recipients-wrapper"].add("hidden"),e["chatter-recipients-editor"].delete("hidden")),this.model.get("showOwnerOptions")&&(this.model.get("showNewPreviousOwnerOptions")&&(e["next-owner-row"].delete("hidden"),e["previous-owner-row"].delete("hidden")),this.model.get("showNewObjectOption")&&e["new-object-owner-row"].delete("hidden")),this.model.get("showChatterOptions")&&(e["group-row"].delete("hidden"),e["user-row"].delete("hidden")),this.model.get("showAdditionalObjectUserOptions")&&(e["matched-object-row"].delete("hidden"),e["additional-recipients-row"].delete("hidden")),this.recipientCards.length>0&&e["empty-recipients-message"].add("hidden"),e},validate:function(e){var t=$.Deferred(),i={};return e&&this.model.set("groups",this.chatterGroups),e&&this.model.set("users",this.chatterUsers),!this.model.get("showNewObjectOption")&&this.model.get("notifyNewObjectOwner")&&(i.missingCreatedObject="Created object node no longer exists",this.model.set("notifyNewObjectOwner",!1)),_.each(this.model.get("additionalObjectUserFields"),(e,t)=>{this._validateSingleAdditionalObject(e)||(i.invalidMatchedObjectData="Previously selected "+e+" no longer exists.")}),t.resolve(i)},render:async function(){await this._createRecipientCards();var i=_.mapValues(this._getElementClasses(),function(e){return Array.from(e).join(" ")}),a=this.template({classes:i,hasOwnerField:this.hasOwnerField,primaryObjectType:this.model.get("primaryObjectType"),recipientCards:this.recipientCards,recipientData:this.model.toJSON(),matchedObjectTypes:this.model.get("matchedObjectTypes"),matchedObjectData:this.matchedObjectData,hasAdditionalObjectData:this.additionalObjects.length>0,hasChatterGroups:this.chatterGroups.length>0,hasChatterUsers:this.chatterUsers.length>0,additionalOptions:this.model.get("additionalOptions")});this.$el.html(a),this.chatterGroupRecipientRowsView=new t({model:this.model,additionalObjects:this.chatterGroups,type:"chatter"}),this.$el.find(".chatter-group-recipients-content").html(this.chatterGroupRecipientRowsView.$el),this.chatterUserRecipientRowsView=new t({model:this.model,additionalObjects:this.chatterUsers,type:"chatterUser"}),this.$el.find(".chatter-user-recipients-content").html(this.chatterUserRecipientRowsView.$el),this.additionalRecipientRowsView=new e({model:this.model,additionalObjects:this.additionalObjects,_getAdditionalObjectsLabels:this._getAdditionalObjectsLabels,_validateAdditionalObjects:this._validateAdditionalObjects.bind(this)}),this.$el.find(".additional-recipients-content").html(this.additionalRecipientRowsView.$el),ld_initializeToolTip(this.$el.find(".additional-object-recipient-tooltip"),{title:"Meeting"===_LeanData.AppState.PrimarySObjectType?"Recipients ":"Additional Recipients",body:"Select the variable(s) which contain the additional recipient(s) you would like to send the notification. "}),$(".additional-object-recipient-tooltip .ld-tooltip").css("display","block"),$(".additional-object-recipient-tooltip .ld-tooltip").css("position","absolute"),_LeanData.RemotingRouter.chatterLoggingEnabled().then(e=>{e?(ld_initializeToolTip(this.$el.find(".chatter-recipient-tooltip"),{title:"Standard LeanData Chatter Notifications",body:"If youâ€™d like to disable the standard LeanData Chatter posts, please navigate to ",clickableContent:!0}),$(".chatter-recipient-tooltip .ld-tooltip-body").append('<a href="#admin/settings" style="display:contents;font-size:12px;color:var(--ld-green)" class="hoverLink">Admin > Settings</a>.'),$("a.hoverLink").hover(function(){$(this).css("color","var(--ld-green)")})):this.$el.find(".chatter-recipient-tooltip").hide()});const n=this.recipientCards.reduce((e,t)=>e&&t.valid,!0);return this.validate().then(function(e){n||(e.invalidGroup="One or more recipients are invalid. Please enter valid recipients."),_.isEmpty(this.recipientCards)&&(e.emptyChatterRecipients="Recipient is required"),this.$el.find(".chatter-recipients-error-messages").html(_.isEmpty(e)?"":Object.values(e).join("<br>"))}.bind(this)),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({initialize:function(e){this.set(_LeanData.Util.getDefaultNotificationSettings().recipients),this.set(e),this.set("matchedObjectTypes",e.matchedObjectTypes||[]),this.set("showOwnerOptions",!_.isBoolean(e.notifyOwners)||e.notifyOwners),this.set("showAdditionalObjectUserOptions",!_.isBoolean(e.notifyAdditionalObjectUsers)||e.notifyAdditionalObjectUsers),this.set("showAdditionalOptions",!!(e.additionalNotificationOptions&&e.additionalNotificationOptions.length>0)),this.set("emails",e.emails||[]),this.originalModel=_.cloneDeep(this.toJSON())}})}},function(e,t,i){e.exports=function(){var e=i(2)();return Backbone.View.extend({className:"email-recipient-selector-wrapper",template:_.template(i(166)),events:{"click .edit-recipients-button":"_showEditor","click .save-receipients-button":"_hideEditor","click .notif-owner-checkbox":"_toggleOwner","input .emails-text-area":"_emailTextareaHandler","click .subcontent-toggle":"_toggleSubcontentForm","click .additional-options-checkbox":"_toggleAdditionalOptions"},initialize:function(e){e=e||{},this.hasOwnerField=e.hasOwnerField,this.editMode=e.editMode||!1,this.onSaveCallback=_.isFunction(e.onSave)?e.onSave:_.noop,this.emailRecipientLimit=Magellan.Validation.EMAIL_RECIPIENT_LIMIT||20,this.additionalRecipients=e.additionalNotificationOptions?e.additionalNotificationOptions:{},this.model=new Magellan.Models.EmailRecipientSelector(e),this.model.set("fieldMetaData",fieldMetaData),this.model.set("additionalOptions",this.additionalRecipients),this._processAdditionalObjectUserFields()},_processAdditionalObjectUserFields:function(){var e={},t={};_.forEach(_LeanData._app.OBJECT_TYPES,i=>{var a=_.cloneDeep(_LeanData.MetaDataController.getFlattenedFieldsByObject(i));e[i]=_.filter(a,e=>{if(!_LeanData._blacklist.FIELD_BLACKLIST_SETS.USER_FIELDS.has(e.name)&&_.includes(e.parent,"User")){if(e.name.endsWith("id")){var t=e.name.length-2;e.name=e.name.substr(0,t)+"."+e.name.substr(t)}else e.name=e.name.replace("__c","__r.id");return!0}return!1}),t[i]=_.keyBy(e[i],"name")}),this.model.set("userFieldOptions",e),this.model.set("userFieldOptionsMap",t),this.matchedObjectData=new Set,this.matchedObjectDropdownViews={},this.additionalObjects=[],_.each(this.model.get("additionalObjectUserFields"),e=>{this.additionalObjects.push(e)}),this.render()},_setAdditionalObjectUserFieldsInModel:function(){var e=[];this.matchedObjectData.clear(),this.$el.find(".additional-recipients-toggle").prop("checked")&&(e=e.concat(this.additionalRecipientRowsView.getSelections())),this.model.set("additionalObjectUserFields",e)},_showEditor:function(e){e.preventDefault(),this.editMode=!0,this._processAdditionalObjectUserFields()},_hideEditor:function(){this._setAdditionalObjectUserFieldsInModel();var e={emails:this.model.get("emails")};this.model.get("showOwnerOptions")&&(e.notifyPostOwner=this.model.get("notifyPostOwner"),e.notifyPreOwner=this.model.get("notifyPreOwner"),e.notifyNewObjectOwner=this.model.get("notifyNewObjectOwner")),this.model.get("showAdditionalObjectUserOptions")&&(e.additionalObjectUserFields=this.model.get("additionalObjectUserFields")),e.additionalOptions=this.model.get("additionalOptions"),this.trigger("savedRecipients",e),this.onSaveCallback(e),this.editMode=!1,this._processAdditionalObjectUserFields()},_toggleOwner:function(e){var t=$(e.target);this.model.set(t.data("ownerType"),t.prop("checked"))},_toggleSubcontentForm:function(e){var t=$(e.target),i=t.prop("checked");t.closest(".recipient-editor-row").find(".recipient-editor-subcontent").toggleClass("hidden",!i),t.prop("className").includes("emails-toggle")&&this.model.set("emails",[])},_toggleAdditionalOptions:function(e){let t=$(e.target),i=t.data("ownerType"),a=this.model.get("additionalOptions");a[i]=t.prop("checked"),this.model.set("additionalOptions",a)},_getAdditionalObjectsLabels:function(e){return _.map(e,e=>{return _.map(_LeanData.Util.convertFieldSelectionStringToArray(_LeanData.StringUtil.debracketize(e),_LeanData._function.VARIABLES_FIELDNAME,_LeanData.MetaDataController.getFieldMetaDataMap(),_LeanData.AppState.getCurrentVariablesService().getVariablesMap(_LeanData.AppState.PrimarySObjectType),_LeanData.AppState.getCurrentVariablesService().getOriginalNameCaseMap()),(e,t,i)=>t===i.length-1?e.label:e.label.replace(" ID","")).join(" > ")})},_validateAdditionalObjects:function(e){return _.map(e,e=>this._validateSingleAdditionalObject(e))},_validateSingleAdditionalObject:function(e){return Magellan.Validation.isValidUserVariable(e)&&Magellan.Validation.validateVariable(this.model.get("nodeInfo").name,e)},_createRecipientCards:function(){this.recipientCards=[];const e=(e,t)=>({name:e,valid:t});this.model.get("notifyPostOwner")&&this.recipientCards.push(e("New Owner",!0)),this.model.get("notifyPreOwner")&&this.recipientCards.push(e("Previous Owner",!0)),this.model.get("notifyNewObjectOwner")&&this.recipientCards.push(e("Created Object Owner",!0)),_.each(this.model.get("emails"),t=>{this.recipientCards.push(e(t,!0))}),_.each(this.model.get("additionalObjectUserFields"),t=>{Magellan.Validation.isValidUserVariable(t)&&Magellan.Validation.validateVariable(this.model.get("nodeInfo").name,t)?this.recipientCards.push(e(this._getAdditionalObjectsLabels([t]),!0)):this.recipientCards.push(e(t+" (DELETED)",!1))}),_.each(this.model.get("additionalOptions"),(t,i)=>{t&&this.recipientCards.push(e(i,!0))})},_getElementClasses:function(){var e={"edit-recipients-button":new Set(["edit-recipients-button"]),"email-recipients-wrapper":new Set(["email-recipients-wrapper"]),"email-recipients-editor":new Set(["email-recipients-editor","hidden"]),"empty-recipients-message":new Set(["empty-recipients-message"]),"next-owner-row":new Set(["next-owner-row","hidden"]),"previous-owner-row":new Set(["previous-owner-row","hidden"]),"new-object-owner-row":new Set(["new-object-owner-row","hidden"]),"matched-object-row":new Set(["matched-object-row","hidden"]),"additional-recipients-row":new Set(["additional-recipients-row","hidden"])};return this.editMode&&(e["edit-recipients-button"].add("invisible"),e["email-recipients-wrapper"].add("hidden"),e["email-recipients-editor"].delete("hidden")),this.model.get("showOwnerOptions")&&(this.model.get("showNewPreviousOwnerOptions")&&(e["next-owner-row"].delete("hidden"),e["previous-owner-row"].delete("hidden")),this.model.get("showNewObjectOption")&&e["new-object-owner-row"].delete("hidden")),this.model.get("showAdditionalObjectUserOptions")&&(e["matched-object-row"].delete("hidden"),e["additional-recipients-row"].delete("hidden")),this.recipientCards.length>0&&e["empty-recipients-message"].add("hidden"),e},_emailTextareaHandler:_.debounce(function(e){this.model.set("emails",$(e.target).val()),this.validate(!0).then(function(e){_.isEmpty(e)?this.$el.find(".email-recipients-error-messages").html(""):this.$el.find(".email-recipients-error-messages").html(Object.values(e).map(e=>_.escape(e)).join("<br>"))}.bind(this))},300),validate:function(e){var t=$.Deferred(),i={},a=_LeanData.Validation.validateEmailString(this.$el.find(".emails-text-area").val()),n=a.isValid,o=a.validEmails,l=a.invalidEmails,s=this.$el.find(".emails-toggle").prop("checked"),r=!s||s&&n;return this.$el.find(".emails-text-area").toggleClass("lds-textarea-invalid",!r),r?o.length>this.emailRecipientLimit?i.emailRecipientCountExceedsLimit="Number of valid email recipients exceeds limit of "+this.emailRecipientLimit:this.model.set("emails",s?o:[]):i.invalidEmailRecipients="Invalid email recipients listed: "+l.join(", "),e&&this.model.set("emails",o),!this.model.get("showNewObjectOption")&&this.model.get("notifyNewObjectOwner")&&(i.missingCreatedObject="Created object node no longer exists",this.model.set("notifyNewObjectOwner",!1)),_.each(this.model.get("additionalObjectUserFields"),(e,t)=>{this._validateSingleAdditionalObject(e)||(i.invalidMatchedObjectData="Previously selected "+e+" no longer exists or is not a valid User field.")}),t.resolve(i)},render:function(){this._createRecipientCards();var t=_.mapValues(this._getElementClasses(),function(e){return Array.from(e).join(" ")}),i=this.template({classes:t,hasOwnerField:this.hasOwnerField,recipientCards:this.recipientCards,recipientData:this.model.toJSON(),matchedObjectTypes:this.model.get("matchedObjectTypes"),matchedObjectData:this.matchedObjectData,hasAdditionalObjectData:this.additionalObjects.length>0,additionalOptions:this.model.get("additionalOptions")?this.model.get("additionalOptions"):[]});return this.$el.html(i),_.each(this.matchedObjectDropdownViews,e=>{this.$el.find(e.selector).html(e.view.$el),e.view.delegateEvents()}),this.additionalRecipientRowsView=new e({model:this.model,additionalObjects:this.additionalObjects,_getAdditionalObjectsLabels:this._getAdditionalObjectsLabels,_validateAdditionalObjects:this._validateAdditionalObjects.bind(this)}),this.$el.find(".additional-recipients-content").html(this.additionalRecipientRowsView.$el),ld_initializeToolTip(this.$el.find(".additional-object-recipient-tooltip"),{title:"Meeting"===_LeanData.AppState.PrimarySObjectType?"Recipients ":"Additional Recipients",body:"Select the variable(s) which contain the additional recipient(s) you would like to send the notification."}),this.validate().then(function(e){_.isEmpty(this.recipientCards)&&(e.emptyEmailRecipients="Recipient is required"),this.$el.find(".email-recipients-error-messages").html(_.isEmpty(e)?"":Object.values(e).join("<br>"))}.bind(this)),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{templateId:null,templateName:null}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"email-template-selector-wrapper",template:_.template(i(167)),events:{"click .view-email-template-link":"_viewTemplate"},initialize:function(e){e=e||{},this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.model=new Magellan.Models.EmailTemplateSelector,this.model.set("templateId",e.templateId||null),this.render()},getTemplateInfo:function(){return this.model.get("templateId")},_initializeEmailTypeahead:function(){this.emailNestedTypeaheadView&&this.emailNestedTypeaheadView.remove(),this.emailNestedTypeaheadView=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:_LeanData.FlowBuilderController.searchEmailTemplates}),this.$el.find(".email-template-selector").html(this.emailNestedTypeaheadView.$el),this.emailNestedTypeaheadView.$el.on("nestedTypeaheadSelector:select",this._selectTemplate.bind(this)),this.emailNestedTypeaheadView.fetchSelectionWithAsyncService(this.model.get("templateId")).then(e=>{if(_.isEmpty(e)){var t=this.$el.find(".email-template-error-message");t.toggleClass("hidden",!1),_.isEmpty(this.model.get("templateId"))||t.html("Previously selected template (Id: "+this.model.get("templateId")+") is invalid")}else this.model.set("templateName",e[0].Name)}).always(()=>{this.emailNestedTypeaheadView.validate()})},_selectTemplate:function(e,t){this.$el.find(".email-template-error-message").toggleClass("hidden",!0);var i=t.selection[0],a=i?{id:i.Id,Name:i.Name}:{};this.model.set("templateId",a.id),this.model.set("templateName",a.Name),this.trigger("selectedTemplate",this.getTemplateInfo()),this.onChangeCallback(this.getTemplateInfo())},_viewTemplate:function(){var e=this.model.get("templateId");_.isNull(e)||window.open("/"+e)},render:function(){var e=this.template({});return this.$el.html(e),_.defer(()=>{this._initializeEmailTypeahead()}),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{message:"",subject:""},initialize:function(e){this.set(e)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"custom-message-creator-wrapper",template:_.template(i(176)),events:{"click .relative-date-btn":"_addRelativeDate","input .message-text-area":"_customTextareaHandler","input .subject-input":"_subjectInputHandler","click .message-text-area":"_setCursorLocation","keydown .message-text-area":"_setCursorLocation","click .subject-input":"_setCursorLocation","keydown .subject-input":"_setCursorLocation","click .restore-default":"_setDefaultMessage"},initialize:function(e){(e=e||{}).message||(e.message=""),e.subject||(e.subject=""),this.hasOwnerField=e.hasOwnerField,this.defaultMessage=e.defaultMessage,this.model=new Magellan.Models.MessageCreator(e),this.onChangeCallback="function"==typeof e.onChange?e.onChange:_.noop,this.messageType=this.model.get("messageType");var t=_.map(_LeanData.MetaDataController.getObjectContextDropdownOptions(this.model.get("primaryObjectType"),this.model.get("matchedObjectTypes"),this.model.get("createdObjectTypes"),this.model.get("triggeredObjectTypes")),e=>{if(e)return e.label});t=t.filter(e=>!_.isUndefined(e)&&!_.isNull(e)),this.contextOptionsSet=new Set(t),this.cursorTextArea="message",this.showNewPreviousOwnerMergeFields=this.model.get("showNewPreviousOwnerMergeFields")||!1,this.cursorLocation=this.model.get("message").length||0,this.render()},_initializeFieldTypeahead:function(){this.fieldTypeahead&&this.fieldTypeahead.remove(),this.userDropdown&&this.userDropdown.remove();const e=this.model.get("primaryObjectType"),t=_LeanData.Util.getDynamicFieldMetaData(_LeanData._function.VARIABLES_FIELDNAME,this.model.get("primaryObjectType"),_.cloneDeep(window.fieldMetaData),null),i=this.hasOwnerField,a={};i&&("outreachCreateTask"===this.messageType?a.Owner=[{type:"owner",email:"",id:"New.Account.Owner",label:"New Account Owner",name:"New Account Owner"},{type:"owner",email:"",id:"Previous.Account.Owner",label:"Previous Account Owner",name:"Previous Account Owner"}]:a.Owner=[{type:"owner",email:"",id:"New.Owner",label:"New Owner",name:"New Owner"},{type:"owner",email:"",id:"Previous.Owner",label:"Previous Owner",name:"Previous Owner"}]),a.Field=[],"outreachCreateTask"!==this.messageType&&a.Field.push({type:"audit log",email:"",id:"Audit.Log",label:"Audit Log Link",name:"Audit Log Link"}),"Meeting"!==e&&(i&&a.Field.push({parent:["Owner"],type:"REFERENCE",label:"Owner",name:"Owner"}),"outreachCreateTask"!==this.messageType&&a.Field.push({type:"audit log",email:"",id:"Audit.Log.Full",label:"Full Audit Log Link",name:"Full Audit Log Link"}));let n=function(e,t=!1){const i=this.model&&!t?this.model.toJSON():_.cloneDeep(a),n=Object.assign({},e,i);return n[_LeanData._function.VARIABLES_FIELDNAME]=a.Field.concat(n[_LeanData._function.VARIABLES_FIELDNAME]),n};const o={selector:"ld-typeahead-angular#field-typeahead",events:{onSelect:e=>{if(!e.length||e[e.length-1].parent&&0!==e[e.length-1].parent.length||"SOBJECT"===e[e.length-1].type)return;let t="";const i=e[e.length-1].type;if("user"===i)t+="<@"+e[1].id+">";else if("owner"===i||"audit log"===i)t+="<"+e[e.length-1].id+">";else{t+="{!"+(e[0].name.startsWith("{!")?e[0].name.slice(2,-1):e[0].name).toLowerCase();for(let i=1;i<e.length-1;i++)t+=".",e[i].name.endsWith("__c")?t+=e[i].name.slice(0,-1)+"r":t+=e[i].name.slice(0,-2);e.length>1&&(t+="."+e[e.length-1].name),t+="}"}this._insertText(t)}},inputs:{nestingRoot:_LeanData._function.VARIABLES_FIELDNAME,placeholder:"Insert Variables",readOnly:!_LeanData.AppState.isLockedForEditing,data:n(t()),getDynamicData:function(e){const i=t(e),n=this.model?this.model.toJSON():_.cloneDeep(a),o=Object.assign({},i,n);return o[_LeanData._function.VARIABLES_FIELDNAME]=a.Field.concat(o[_LeanData._function.VARIABLES_FIELDNAME]),o},refreshMetadata:()=>{const e=_LeanData.AppState&&_LeanData.AppState.getCurrentVariablesService()?_LeanData.AppState.getCurrentVariablesService().getVariableObjectTypes():[];return _LeanData.MetaDataController.getFieldsMetaData(!0,e,!0)},processRefreshedMetadata:n,filter:t=>{const i=t[0]?t[0].objectType:"",a=_LeanData.Util.createBlacklistFilter(i);let n;this.showNewPreviousOwnerMergeFields||(t=_.filter(t,e=>"Owner"!==e.name)),t=a(t);for(let e=0;e<t.length;e++)if("audit log"==t[e].type){n=t[e],t.splice(e,1);break}if(n&&t.push(n),t&&t.filter(e=>e.isCategoryLabel).length>0)return t;return _LeanData.Util.groupTypeaheadSuggestions(t,["owner","routed","triggered","matched","created","other","link"],_LeanData.VariablesService.groupSuggestionsByRoutingCategory.bind(null,e))}}};_LeanDataUtil.Backbone.loadAngularComponent(this,o);let l=["Specific User"];"Meeting"!==this.model.get("primaryObjectType")&&(this.hasOwnerField&&(l=l.concat(["New Owner","Previous Owner"])),l=l.concat(["User in Field"])),this.userDropdown=new Magellan.Views.LDDropdown({value:null,options:l,alignMenuRight:!1,placeholder:"Mention User",onChange:t=>{switch(t){case"New Owner":case"Previous Owner":this._addOwnerToMessage(t);break;case"Specific User":var i=new Magellan.Views.MergeFieldUsers({asyncServiceCall:_LeanData.FlowBuilderController.searchUsers});i.open(),this.listenTo(i,"addUser",this._addUserToMessage);break;case"User in Field":var a=new Magellan.Views.MergeFieldObject({fieldMetaData:_LeanData.MetaDataController.getFieldMetaData(),objectType:e,fieldMetaDataFilter:_LeanData.Util.createUserFieldsFilter()});a.open(),this.listenTo(a,"addUserField",this._addUserFieldToMessage);break;default:console.log("Invalids option:",t)}this.userDropdown.set(null)}}),this.$el.find(".user-dropdown").html(this.userDropdown.$el)},_addUserToMessage:function(e){if(!(e[e.length-1].parent&&0!==e[e.length-1].parent.length||"SOBJECT"===e[e.length-1].type)){var t="";t+="<@"+e[0].Id+">",this._insertText(t)}},_addOwnerToMessage:function(e){var t="";t+="<"+e.replace(" ",".")+">",this._insertText(t)},_addUserFieldToMessage:function(e){let t=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(e);const i=`<@{!routed ${this.model.get("primaryObjectType").toLowerCase()}.${t}}>`;this._insertText(i)},_addRelativeDate:function(e){e.preventDefault(),new Magellan.Views.RelativeDateModal({isDatetime:!0,onSelect:this._insertText.bind(this)}).open()},_insertText:function(e){var t=this.model.get(this.cursorTextArea)||"",i=t.substring(0,this.cursorLocation),a=t.substring(this.cursorLocation,t.length);this.model.set(this.cursorTextArea,i+e+a),this.render()},_customTextareaHandler:function(e){this.model.set("message",$(e.target).val());this.model.get("message");this.checkValidation()},_subjectInputHandler:function(e){this.model.set("subject",$(e.target).val()),this.checkValidation()},_setCursorLocation:function(e){this.cursorTextArea=".subject-input"===e.handleObj.selector?"subject":"message",this.cursorLocation=e.target.selectionStart,"keydown"===e.handleObj.type&&(this.cursorLocation++,$(".restore-default").removeClass("disabled"))},_setDefaultMessage:function(e){this.model.set("message",this.defaultMessage);var t={message:this.model.get("message")};this.onChangeCallback(t),this.render()},checkValidation:function(){this.validate().then(function(e){this.$el.find(".custom-error-message").html(_.isEmpty(e)?"":Object.values(e).join("<br>"));var t={message:this.model.get("message"),subject:this.model.get("subject")};t&&this.defaultMessage&&!_LeanDataGraphEditor.service.isReadOnly&&(t.message.toLowerCase()===this.defaultMessage.toLowerCase()?$(".restore-default").addClass("disabled"):$(".restore-default").removeClass("disabled")),this.trigger("createMessage",t),this.onChangeCallback(t)}.bind(this))},validate:function(){let e=$.Deferred(),t={},i=[],a=this.model.get("message"),n=this.model.get("nodeInfo");if("email"===this.messageType){let e=this.model.get("subject");null===e&&(t.nullSubject="Subject does not exist"),""===e&&(t.emptySubject="Required: Must input a subject"),e.length>998&&(t.subjectLimit="Subject has exceeded 998 character limit"),e.includes("<Audit.Log>")&&(t.subjectAuditLog="Subject may not contain a hyperlink to Audit Logs"),i=i.concat(Magellan.Validation.isValidMergeFieldValueMessages(n.name,e,"STRING","Send Notification")),_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(e,"DATETIME","Send Notification")||i.push("Incorrectly formatted subject. Please check the formatting of dates."),_LeanData.ConditionValidatorUtil.isValidRelativeDateValue(a,"DATETIME","Send Notification")||i.push("Incorrectly formatted message. Please check the formatting of dates."),this.model.set("subject",e)}if(null===a&&(t.nullMessage="Message does not exist"),""===a&&(t.emptyMessage="Required: Must input a message"),0!==(i=i.concat(Magellan.Validation.isValidMergeFieldValueMessages(n.name,a,"STRING","Send Notification"))).length){const e=i.map(e=>_.escape(e));t.invalidMessage="<i>"+e.join("</i><br><i>")+"</i>"}return this.showNewPreviousOwnerMergeFields||"chatter"===this.messageType||(a.includes("<New.Owner>")||a.includes("<Previous.Owner>"))&&(t.invalidOwner="New Owner and Previous Owner cannot be inserted in this message."),this.model.set("message",a),e.resolve(t)},render:function(){var e=this.template({subject:this.model.get("subject"),message:this.model.get("message"),messageType:this.messageType,disabled:_LeanDataGraphEditor.service.isReadOnly});return this.$el.html(e),$(".restore-default").addClass("disabled"),$(".message-text-area").on("click keydown",e=>{this.cursorTextArea="message",this.cursorLocation=e.target.selectionStart}),this._initializeFieldTypeahead(),this.checkValidation(),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"additional-recipients-wrapper",template:_.template(i(182)),events:{"click .remove-additional-recipient-row":"_removeAdditionalRecipientRow"},initialize:function(e){this.model=e.model,this.type=e.type,this.validationErrorMessage=e.validationErrorMessage||"",this.additionalObjects=e.additionalObjects,this.render()},getSelections:function(){return this.additionalObjects},_addAdditionalRecipientRow:function(e){if(this.additionalRecipientsTypeahead.validate()){var t=_.cloneDeep(this.additionalRecipientsTypeahead.selection);t.length>0&&this.additionalObjects.push(t[0]),this.render()}},_removeAdditionalRecipientRow:function(e){var t=$(e.target).data("index");this.additionalObjects.splice(t,1),"chatter"==this.type?this.model.set("groups",this.additionalObjects):this.model.set("users",this.additionalObjects),this.render()},_getAdditionalObjectsLabels:function(e){return _.map(e,e=>e.label)},render:function(){var e=this.template({additionalObjectsLabels:this._getAdditionalObjectsLabels(this.additionalObjects)});this.$el.html(e);var t=function(){return[]};return""===this.validationErrorMessage&&(t="chatterUser"===this.type?_LeanData.FlowBuilderController.chatter_getChatterUsersForTypeahead:_LeanData.FlowBuilderController.chatter_getChatterGroupsForTypeahead),this.additionalRecipientsTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,asyncServiceCall:t,requireSelectionFromData:!0,onSelect:this._addAdditionalRecipientRow.bind(this)}),this.$el.find(".additional-recipient-typeahead").html(this.additionalRecipientsTypeahead.$el),this}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{object:"Object",fields:new Backbone.Collection([]),updates:new Backbone.Collection([])},initialize:function(){this.get("fields")instanceof Backbone.Collection||!_.isArray(this.get("fields"))||this.set("fields",new Backbone.Collection(this.get("fields"))),this.get("updates")instanceof Backbone.Collection||!_.isArray(this.get("updates"))||this.set("updates",new Backbone.Collection(this.get("updates")))}})}},function(e,t){e.exports=function(){Magellan.Models.TupleConditions=Backbone.Model.extend({defaults:{},initialize:function(e){if(this.set({data:e.data||{},selectedRoutingType:e.selectedRoutingType||"New",fieldObjectType:e.fieldObjectType||"Lead",operandObjectType:e.operandObjectType||"Lead",flattenField:e.flattenField||!1,flattenOperand:e.flattenOperand||!1,conditions:e.conditions||[],logic:e.logic||"",rpnLogic:e.rpnLogic||[],rpnLogicErrorMessages:[],hideToggleColumn:e.hideToggleColumn||!1,enableSearch:e.enableSearch,operandHeader:e.operandHeader||"Value",showSeparatorPerRow:e.showSeparatorPerRow||!1,filterOutTextArea:e.filterOutTextArea||!1,allowFormulaField:e.allowFormulaField||!1,allowDateLiterals:e.allowDateLiterals||!1,customPlaceholderText:e.customPlaceholderText||"Input the API Name of the Value"}),this.rpnLogicIsValid=!0,e.logic&&e.conditions){let t=this.getParsedLogicObject(e.logic);this.rpnLogicIsValid=this.isRpnLogicValid(t)}this.processData()},processData:function(){var e=this.get("data"),t={},i=this.get("fieldObjectType");this.get("flattenField")?t[i]=_LeanData.Util.createFlattenedFields(e[i]):t[i]=e[i],this.set("fieldData",t);var a={},n=this.get("operandObjectType");this.get("flattenOperand")?a[n]=_LeanData.Util.createFlattenedFields(e[n]):a[n]=e[n],this.set("operandData",a)},addCondition:function(e,t){_.isEmpty(e)&&(e={"value/field":"value",field:null,type:null,operator:null,operand:null});var i=_.cloneDeep(this.get("conditions"));i.push(e),this.set("conditions",i),this.parseLogic(t),this.trigger("addedCondition")},deleteCondition:function(e){var t=_.cloneDeep(this.get("conditions"));t.splice(e,1),this.set("conditions",t);var i=t.length+1,a=new RegExp(" AND "+i+"| OR "+i,"g");this.set("logic",this.get("logic").replace(a,"")),this.parseLogic(this.get("logic")),this.trigger("deletedCondition")},isRpnLogicValid:function(e){return 0===e.feedbackMessage.length},getParsedLogicObject:function(e){let t=this.get("conditions");var i=void 0!==e?e:1===t.length?"1":this.get("logic")+" AND "+t.length;return _LeanData.FunctionUtil.parseTokenLogic(t.length,i,!0)},parseLogic:function(e){var t=this.get("conditions");let i=this.getParsedLogicObject(e);var a=void 0!==e?e:1===t.length?"1":this.get("logic")+" AND "+t.length;this.set("logic",a),this.set("rpnLogic",i.RPNTokens),this.rpnLogicIsValid=this.isRpnLogicValid(i),this.set("rpnLogicErrorMessages",i.feedbackMessage)},setDefaultLogic:function(){for(var e=this.get("conditions"),t=[],i=0;i<e.length;i++)t.push(i+1);var a=t.join(" AND ");this.parseLogic(a),this.trigger("resetLogic")},validate:function(){var e=!0,t=this.get("conditions");return this.parseLogic(this.get("logic")),e=(e=e&&this.rpnLogicIsValid)&&t.length>0,_.each(t,(t,i)=>{var a=Magellan.Validation.validateSingleCondition(t,this.get("fieldObjectType"),this.get("operandObjectType"));e=e&&!0===a}),e}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"merge-field-owners",initialize:function(e){this.fieldMetaDataFilter=_.isFunction(e.fieldMetaDataFilter)?e.fieldMetaDataFilter:e=>e,this.fieldMetaData=e.fieldMetaData,this.objectType=e.objectType},template:_.template(i(187)),render:function(){let e=this.template({});return this.$el.html(e),this},open:function(){let e=new Magellan.Views.NestedTypeaheadSelector({root:"Routed_"+this.objectType,data:this.fieldMetaData,filter:this.fieldMetaDataFilter,required:!0,onSelect:(e,t)=>{let i=t?t[t.length-1]:null;i&&"REFERENCE"!==i.type?this.mergeFieldsModal.enablePrimaryButton():this.mergeFieldsModal.disablePrimaryButton()},placeholder:"Select a User Field"});this.mergeFieldsModal=new Magellan.Views.ConfirmationModal({header:"Mention User Field",contentElement:this.render().$el,primaryButtonText:"Mention User Field",secondaryButtonText:"Cancel",onConfirmed:()=>{this.trigger("addUserField",e.selection)}}),this.mergeFieldsModal.open(),this.mergeFieldsModal.disablePrimaryButton(),this.$el.find(".field-selector").html(e.$el)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"merge-field-owners",initialize:function(e){this.asyncServiceCall=e.asyncServiceCall},template:_.template(i(188)),render:function(){let e=this.template({});return this.$el.html(e),this},value:null,open:function(){let e=new Magellan.Views.NestedTypeaheadSelector({required:!1,placeholder:"Select a User",disableBreadcrumbs:!0,asyncServiceCall:this.asyncServiceCall,onSelect:(e,t)=>{let i=t?t[t.length-1]:null;i&&"REFERENCE"!==i.type?this.mergeFieldsModal.enablePrimaryButton():this.mergeFieldsModal.disablePrimaryButton()}});this.mergeFieldsModal=new Magellan.Views.ConfirmationModal({header:"Mention Specific User",contentElement:this.render().$el,primaryButtonText:"Mention User",secondaryButtonText:"Cancel",onConfirmed:()=>{this.trigger("addUser",e.selection)}}),this.mergeFieldsModal.open(),this.mergeFieldsModal.disablePrimaryButton(),this.$el.find(".field-selector").html(e.$el)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"merge-field-selector",initialize:function(e){if(this.nodeModel=e.nodeModel,this.disableAuditLogFullLink=e.hideAuditLogFullLink,!this.nodeModel)throw new Error("merge-field-creator.view: options.nodeModel are required.");this.onSelect=_.isFunction(e.onSelect)?e.onSelect:_.noop,this.fieldMetadataFilter=_.isFunction(e.fieldMetadataFilter)?e.fieldMetadataFilter:null},template:_.template(i(189)),render:function(){var e=this.template({});return this.$el.html(e),this},onSelect:_.noop,fieldMetadataFilter:null,groupingFunction:function(e,t){if("Owner"===t.label)return"owner";let i="other";if(_LeanData.VariablesService.isReservedVariableLabel(t.label,e)){const e=t.label.toLowerCase(),a=["routed","matched","created"];for(const t of a)if(e.startsWith(t)){i=t;break}}return i},open:function(){const e=_LeanData.Util.createBlacklistFilter();var t=new Magellan.Views.NestedTypeaheadSelector({getDynamicData:_LeanData.Util.getDynamicFieldMetaData(_LeanData._function.VARIABLES_FIELDNAME,_LeanData.AppState.PrimarySObjectType,_.cloneDeep(window.fieldMetaData)),root:_LeanData._function.VARIABLES_FIELDNAME,filter:i=>{const a=_.isEmpty(t.selection);let n=e(i);if(_.isFunction(this.fieldMetadataFilter)&&(n=this.fieldMetadataFilter(n)),a){let e=_LeanData.AppState.PrimarySObjectType;const t=["owner","routed","triggered","matched","created","other","link"];n=_LeanData.Util.groupTypeaheadSuggestions(i,t,_LeanData.VariablesService.groupSuggestionsByRoutingCategory.bind(null,e))}return 0!==t.selection.length||this.disableAuditLogFullLink||n.push({type:"STRING",label:"Full Audit Log Link",name:"Full Audit Log Link"}),n},required:!0,onSelect:(e,t)=>{var i=t?t[t.length-1]:null;i&&"REFERENCE"!==i.type?this.mergeFieldsModal.enablePrimaryButton():this.mergeFieldsModal.disablePrimaryButton()}});this.mergeFieldsModal=new Magellan.Views.ConfirmationModal({header:"Insert Variables",contentElement:this.render().$el,primaryButtonText:"Insert",secondaryButtonText:"Cancel",onConfirmed:()=>{var e=t.selection[t.selection.length-1];if(!e||"REFERENCE"===e.type)return;const i="Full Audit Log Link"===e.name?"<Audit.Log.Full>":_LeanData.Util.createMergeField(t.selection);this.onSelect(i)}}),this.mergeFieldsModal.open(),this.mergeFieldsModal.disablePrimaryButton(),this.$el.find(".field-selector").html(t.$el)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({className:"relative-date-modal",$duration:null,$durationValue:null,$durationLabel:null,initialize:function(e){this.nodeModel=e.nodeModel,this.selections=e.selections,this.isComparison=null!=e.nodeModel&&1==e.nodeModel.isComparison,this.selections&&this.selections.length&&"DATETIME"===this.selections[0].type?this.isDatetime=!0:this.isDatetime=!0===e.isDatetime,this.onSelect=_.isFunction(e.onSelect)?e.onSelect:_.noop,this.beforeAfterSelection="After",this.name=e.name},template:_.template(i(190)),render:function(){var e=this.template({isDatetime:this.isDatetime,isComparison:this.isComparison});return this.$el.html(e),this.$beforeAfterDropdown=new Magellan.Views.LDDropdown({value:"After",options:["After","Before"],required:!1,onChange:e=>{this.beforeAfterSelection=e}}),this.$el.find("#beforeAfterDropdown").html(this.$beforeAfterDropdown.$el),this},events:{"input input[id=duration-value]":"isValidDuration","change input[id=duration-num]":"isValidDuration"},isValidDuration:function(e){""===this.$el.find("#duration-value").val()?this.relativeDateModal.disablePrimaryButton():this.relativeDateModal.enablePrimaryButton()},onSelect:_.noop,toggleDisabledInputs:function(){var e=!("beforeAfter"===this.$el.find('input[name="duration"]:checked').val());this.$durationValue.prop("disabled",e),e?(this.$durationLabel.addClass("disabled-label"),this.$beforeAfterDropdown.addClass("disabled"),this.relativeDateModal.enablePrimaryButton()):(this.$durationLabel.removeClass("disabled-label"),this.$beforeAfterDropdown.removeClass("disabled")),e?this.$el.find('label[for="duration-today"]').removeClass("disabled-label"):this.$el.find('label[for="duration-today"]').addClass("disabled-label")},generateString:function(){const e=this.isDatetime?"[!Datetime.now()]":"[!Datetime.today()]";let t;switch(this.$el.find('input[name="duration"]:checked').val()){case"today":t="0";break;case"beforeAfter":t=this.$durationValue.val(),"Before"===this.beforeAfterSelection&&(t="-"+t)}return`[!Datetime.daysAfter(${e},${t})]`},open:function(){this.relativeDateModal=new Magellan.Views.ConfirmationModal({header:"Insert Relative Date",contentElement:this.render().$el,primaryButtonText:"Insert",secondaryButtonText:"Cancel",isDatetime:this.isDatetime,onConfirmed:()=>this.onSelect(this.generateString())}),this.relativeDateModal.open(),this.$duration=this.$el.find('input[name="duration"]'),this.$durationValue=this.$el.find('input[name="duration-value"]'),this.$durationLabel=this.$el.find(".duration-label"),this.$beforeAfterDropdown=this.$el.find("#beforeAfterDropdown"),this.$el.find(".relative-date-modal-text").text("Use relative dates to specify a dynamic time reference in your workflow."),this.isComparison&&ld_initializeToolTip(this.$el.find(".comparison-tooltip"),{title:"Relative Date Comparison",body:"LeanData compares the dates of the selected fields (not date/time)."}),this.relativeDateModal.enablePrimaryButton(),this.toggleDisabledInputs(),this.$duration.on("input",()=>{this.toggleDisabledInputs()})}})}},function(e,t){e.exports=function(){return Backbone.View.extend({className:"variable-insert-button",initialize:function(e){if(this.name=e.name,this.nodeModel=e.nodeModel,this.typeahead=e.typeahead,this.typeahead){const e=this.typeahead.selection||this.typeahead.selections;this.selections=Array.isArray(e)?e:[]}this.onSelect=_.isFunction(e.onSelect)?e.onSelect:_.noop,this.fieldMetadataFilter=_.isFunction(e.fieldMetadataFilter)?e.fieldMetadataFilter:null,this.render(),this.hideAuditLogFullLink=e.hideAuditLogFullLink,this.typeahead&&(this.typeahead.onSelectPostCallback=(()=>{this.render()}));let t="variable-insert-button";e.openDropdownLeft&&(t+=" open-dropdown-left"),this.$el.prop("class",t)},getDropdownOptions:function(){if("Additional Fields"===this.name)return["Relative Date"];let e=["Variables"];return(this.selections&&this.selections.length>0&&this.selections[this.selections.length-1].type&&["DATE","DATETIME"].includes(this.selections[this.selections.length-1].type)||"Opportunity Name"===this.name||"Task Subject"===this.name)&&(e=e.concat(["Relative Date"])),e},onSelect:_.noop,fieldMetadataFilter:null,render:function(){const e=this.getDropdownOptions(),t=e=>{switch(e){case"Variables":let t=new Magellan.Views.MergeFieldSelector({nodeModel:this.nodeModel,onSelect:this.onSelect,hideAuditLogFullLink:this.hideAuditLogFullLink});t.fieldMetadataFilter=this.fieldMetadataFilter,t.open(),i.set(null);break;case"Relative Date":new Magellan.Views.RelativeDateModal({nodeModel:this.nodeModel,onSelect:this.onSelect,selections:this.selections,name:this.name,isDatetime:this.isDatetime}).open(),i.set(null);break;default:console.log("Invalid option:",e)}};var i=new Magellan.Views.LDDropdown({required:!1,options:e,placeholder:"Insert",size:"xtra-small",conditionalOpen:()=>"Meeting"===_LeanData.AppState.PrimarySObjectType&&(1===e.length&&(t(e[0]),!0)),optionTemplate:function(e){return _.template("<span><%-option%></span>")({option:e})},onChange:t});return this.$el.html(i.$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.ActivityBasedRouting.extend({render:function(){return Magellan.Views.ActivityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Backbone.View.extend({template:Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate,edgeSelectionMenuView:null,renderMatchSelectorComponent:Magellan.Views.NewNodeForm.prototype.renderMatchSelectorComponent,render:function(){return this.$el.html(this.template({showMatchSelector:"Account"!==this.model.nodeInfo.objectType,primaryObject:_LeanData.Util.getSObjectLabel(_LeanData.AppState.PrimarySObjectType)})),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,hideFieldValueColumn:this.model.nodeInfo.isValueComparison,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.renderMatchSelectorComponent(this.edgeSelectionMenuView.render.bind(this.edgeSelectionMenuView),this.edgeSelectionMenuView.validateCriteriaList.bind(this.edgeSelectionMenuView)),this}})}},function(e,t){e.exports=function(){return Magellan.Views.CreateOpportunity.extend({render:function(){return Magellan.Views.CreateOpportunity.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Magellan.Views.CreateTask.extend({})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.AccountRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!1,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({mainNodeFormView:null,advancedSettingsView:null,filerRulesView:null,edgeSelectionMenuView:null,hatTypeOptionView:null,matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.AccountRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(0)),render:function(){var e=this.template({pluralObjects:_LeanData.StringUtil.pluralizeString(this.matchedObjectName),singleObject:this.matchedObjectName,isDupeNode:"DupeA"===this.model.nodeInfo.objectType,elementOrderInNode:["RCM","RA"].includes(this.model.nodeInfo.objectType)?3:2});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),"RA"===this.model.nodeInfo.objectType&&(this.objectRadioOptions=new Magellan.Views.ObjectRadioOptions({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,parentView:this}),this.$el.find(".object-radio-options").html(this.objectRadioOptions.render().$el)),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.$(".filter-div").html(this.filterRulesView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.AccountRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({nodeFormHeaderText:this.getNodeFormHeaderText(),currentNode:this.model,currentName:this.currentName,showNoOwnerWarning:!1,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),this.$el.find("#node-partial-wrapper").html(this.mainNodeFormView.render().$el),this.mainNodeFormView.delegateEvents(),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this.$el.find("#node-name-char-count").text(this.currentName.length+"/200"),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.loadEnablementAccordion(),this.loadVariableSettersForNodeModel(),this}})}},function(e,t){e.exports=function(){return Magellan.Views.OpportunityBasedRouting.extend({render:function(){return Magellan.Views.OpportunityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t,i){e.exports=function(){var e=i(192);return Magellan.Views.ButtonHandler.extend({emailNotificationView:null,advancedSettingsView:null,initialize:function(e){this.objectType=e.objectType||this.objectType||_LeanData.AppState.PrimarySObjectType.toLowerCase()},template:_.template(e),render:function(){var e=this.template();return this.$el.html(e),_LeanData.FlowBuilderController.searchOwnerMappings("").then(function(e){var t=_.find(e,e=>this.model.nodeInfo["owner mapping"]===e.Name);this.vwOwnerMappingSelectableList=new Magellan.Views.LDSelectableList({data:e,itemTemplate:_.template("<span><%-Name%></span>"),notFoundTemplate:_.template('<span class="ld-text-danger"><%-notFound%></span>'),header:"Available Owner Mappings",selected:t||this.model.nodeInfo["owner mapping"],validate:function(t){var i=t.selected;return _.isNull(i)||_.isUndefined(i)?"Required":e.indexOf(i)<0?"This Owner Mapping rule no longer exists.":""}}),this.vwOwnerMappingSelectableList.render(),this.$(".account-owner-mapping-list-wrapper").html(this.vwOwnerMappingSelectableList.$el),this.listenTo(this.vwOwnerMappingSelectableList.model,"change:selected",this.updateSelectedAccountTeam)}.bind(this)),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.respectSchedulesView&&this.respectSchedulesView.remove(),this.respectSchedulesView=new Magellan.Views.RespectUserSchedules({model:this.model}),this.$el.find("#respect-schedules-wrapper").html(this.respectSchedulesView.render().$el),this},updateSelectedAccountTeam:function(){var e=this.vwOwnerMappingSelectableList.model.get("selected");this.model.nodeInfo["owner mapping"]=e?e.Name:null},remove:function(){this.vwOwnerMappingSelectableList&&(this.vwOwnerMappingSelectableList.remove(),this.vwOwnerMappingSelectableList=null),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TerritoryRouting.extend({})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){var e=i(193);return Magellan.Views.ButtonHandler.extend({advancedSettingsView:null,alternateFieldAssignmentView:null,initialize:function(e){this.objectType=e.objectType||this.objectType||_LeanData.AppState.PrimarySObjectType.toLowerCase()},template:_.template(e),render:function(){var e=this.template(),t=_LeanData._getOrganizationData().statuses.accountTeamsEnabled;this.$el.html(e),_LeanData.FlowBuilderController.searchAccountTeams("").then(function(e){var t=_.find(e,e=>this.model.nodeInfo["account team rule"]===e.Name.replace("Account Team: ",""));this.vwAccountTeamSelectableList=new Magellan.Views.LDSelectableList({data:e,itemTemplate:_.template('<span><%-Name.replace("Account Team: ", "")%></span>'),notFoundTemplate:_.template('<span class="ld-text-danger"><%-notFound%></span>'),header:"Available Account Team Rules",selected:t||this.model.nodeInfo["account team rule"],validate:function(t){var i=t.selected;return _.isNull(i)||_.isUndefined(i)?"Required":e.indexOf(i)<0?"This Account Team rule no longer exists.":""}}),this.vwAccountTeamSelectableList.render(),this.listenTo(this.vwAccountTeamSelectableList.model,"change:selected",this.updateSelectedAccountTeam),this.$(".account-team-rules-list-wrapper").html(this.vwAccountTeamSelectableList.$el)}.bind(this));var i=t?"":"Account Teams are disabled in this org. Please enable Account Teams to use this option.";return this.$el.find(".account-teams-error-message").html(i),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.respectSchedulesView&&this.respectSchedulesView.remove(),this.respectSchedulesView=new Magellan.Views.RespectUserSchedules({model:this.model}),this.$el.find("#respect-schedules-wrapper").html(this.respectSchedulesView.render().$el),this},updateSelectedAccountTeam:function(){var e=this.vwAccountTeamSelectableList.model.get("selected");this.model.nodeInfo["account team rule"]=e?e.Name.replace("Account Team: ",""):null},remove:function(){this.vwAccountTeamSelectableList&&(this.vwAccountTeamSelectableList.remove(),this.vwAccountTeamSelectableList=null),this.advancedSettingsView&&(this.advancedSettingsView.remove(),this.advancedSettingsView=null),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.AccountDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!0,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){var e=i(194);return Magellan.Views.ButtonHandler.extend({advancedSettingsView:null,initialize:function(e){this.objectType=e.objectType||this.objectType||_LeanData.AppState.PrimarySObjectType.toLowerCase()},template:_.template(e),render:function(){var e=this.template();this.$el.html(e),this.vwUserFieldSelector&&this.vwUserFieldSelector.remove();var t=_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Account",_LeanData.MetaDataController.getFieldMetaDataMap());return this.vwUserFieldSelector=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:"Account",data:fieldMetaData,size:"xtra-small",selection:t,onSelect:this.updateNodeInfoCustomUserField.bind(this),filter:_LeanData.Util.createUserFieldsFilter()}),this.$(".user-field-selector").html(this.vwUserFieldSelector.$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().delegateEvents().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.respectSchedulesView&&this.respectSchedulesView.remove(),this.respectSchedulesView=new Magellan.Views.RespectUserSchedules({model:this.model}),this.$el.find("#respect-schedules-wrapper").html(this.respectSchedulesView.render().$el),this},updateNodeInfoCustomUserField:function(){var e=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(this.vwUserFieldSelector.selection);this.model.nodeInfo["custom field"]=e||null},remove:function(){this.vwUserFieldSelector&&(this.vwUserFieldSelector.remove(),this.vwUserFieldSelector=null),Backbone.View.prototype.remove.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.ZoominfoEnrich.extend({initialize:function(){this.objectType="Account",Magellan.Views.ZoominfoEnrich.prototype.initialize.apply(this)}})}},function(e,t,i){e.exports=function(){var e=i(195);return Backbone.View.extend({template:_.template(e),events:{"click .delete-custom-row":"deleteRow"},initialize:function(e){this.includeInSave=!0,this.el=e.el,this.field=e.field,this.fieldData=e.fieldData,this.processedDefaultFields=e.processedDefaultFields,this.processedCustomFields=e.processedCustomFields,this.updateCustomBlacklist=e.updateCustomBlacklist,this.leadDropdown={},this.accountDropdown={},this.leadFieldSelection=null,this.accountFieldSelection=null,this.restrictedObjectType=null,this.restrictedObjectTypeParent="Lead",this.flattenedLeadFields={Lead:_.filter(_LeanData.MetaDataController.getFlattenedFieldsByObject("Lead"),function(e){return!_LeanData._blacklist.FIELD_BLACKLIST_MAP.LEAD_FIELDS.includes(e.name)})},this.flattenedAccountFields={Account:_.filter(_LeanData.MetaDataController.getFlattenedFieldsByObject("Account"),function(e){return!_LeanData._blacklist.FIELD_BLACKLIST_MAP.ACCOUNT_FIELDS.includes(e.name)})},this.enableSaveButton=e.enableSaveButton,this.field?(this.leadFieldSelection=this.field.leadField||null,this.accountFieldSelection=this.field.accountField||null,this.restrictedObjectType=this.leadFieldSelection?this.leadFieldSelection.type:null):this.enableSaveButton()},createLeadFieldsDropdown:function(e,t){this.field&&_.each(e.Lead,e=>{this.field.leadField&&e.name==this.field.leadField.name&&(this.field.leadField.type=e.type)});var i=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:t,data:e,placeholder:this.field&&this.field.oldLeadField?this.field.oldLeadField:null,selection:this.field&&this.field.leadField?[this.field.leadField]:[],onSelect:this.updateAccountDropdown.bind(this),classNames:["_lead-fields-dropdown"]});return i.validate(),i},updateAccountDropdown:function(e,t){var i=t.length;this.leadFieldSelection=t[i-1],(this.restrictedObjectType!=_LeanData._function.SFDC_TYPE_TO_GROUPING[this.leadFieldSelection.type]||this.leadFieldSelection.type)&&(this.restrictedObjectType=_LeanData._function.SFDC_TYPE_TO_GROUPING[this.leadFieldSelection.type]||this.leadFieldSelection.type,this.leadFieldSelection.parent[0]&&(this.restrictedObjectTypeParent=this.leadFieldSelection.parent[0]),this.accountDropdown.setSelection([]),this.accountDropdown.render(),this.accountDropdown.validate()),this.enableSaveButton()},createAccountFieldsDropdown:function(e,t){this.field&&_.each(e.Account,e=>{this.field.accountField&&e.name==this.field.accountField.name&&(this.field.accountField.type=e.type)});var i=new Magellan.Views.NestedTypeaheadSelector({required:!0,root:t,data:e,placeholder:this.field&&this.field.oldAccountField?this.field.oldAccountField:null,selection:this.field&&this.field.accountField?[this.field.accountField]:[],onSelect:this.updateLeadFilterItems.bind(this),filter:this.filterFields.bind(this),classNames:["_account-fields-dropdown"]});return i.validate(),i},updateLeadFilterItems:function(e,t){this.accountFieldSelection&&this.updateCustomBlacklist(null,this.accountFieldSelection.name);var i=t.length;this.accountFieldSelection=t[i-1],this.updateCustomBlacklist(this.accountFieldSelection.name,null),this.enableSaveButton()},filterFields:function(e){if(this.leadFieldSelection){if(this.leadFieldSelection.objectType=this.restrictedObjectTypeParent,null===this.restrictedObjectType)return e;e=_LeanData.Util.createMappingFlattenedFieldsFilter(this.leadFieldSelection)(e);return e=_.filter(e,e=>{var t=!_.some(this.processedDefaultFields,{accountField:{name:e.name}})&&!this.updateCustomBlacklist()[e.name];return this.accountFieldSelection&&(t=t||e.name===this.accountFieldSelection.name),t}),e=_.filter(e,function(e){return e.isUpdateable&&!e.isUnique})}},deleteRow:function(){this.accountFieldSelection&&this.updateCustomBlacklist(null,this.accountFieldSelection.name),this.enableSaveButton(),this.includeInSave=!1,Backbone.View.prototype.remove.apply(this,arguments)},render:function(){var e=this.template({});return this.setElement(e),this},renderDropdowns:function(){this.leadDropdown=this.createLeadFieldsDropdown(this.flattenedLeadFields,"Lead"),this.accountDropdown=this.createAccountFieldsDropdown(this.flattenedAccountFields,"Account"),this.$el.find(".lead-field-label").html(this.leadDropdown.$el),this.$el.find(".account-field-label").html(this.accountDropdown.$el)}})}},function(e,t,i){e.exports=function(){var e=i(196);return Backbone.View.extend({template:_.template(e),initialize:function(e){this.defaultFields=e.defaultFields},render:function(){var e=this.template({defaultFields:this.defaultFields});return this.setElement(e),this}})}},function(e,t,i){e.exports=function(){var e=i(197),t=i(91)(),a=i(90)();return Backbone.View.extend({className:"account-creation-container",template:_.template(e),events:{"click .add-new-row":"addRowToTable","click #save-mapping-button":"saveMapping"},initialize:function(e){this.allCustomRows=[],this.leadFieldDataMap={},this.accountFieldDataMap={},this.metaData=_.cloneDeep(e.metaData),this.defaultFields=e.defaultFields,this.customFields=e.customFields,this.processedDefaultFields=[],this.processedCustomFields=[],this.accountFieldBlacklist={},this.processData()},updateCustomBlacklist:function(e,t){return e&&(this.accountFieldBlacklist[e]=!0),t&&delete this.accountFieldBlacklist[t],this.accountFieldBlacklist},addRowToTable:function(e,t){var i=new a({field:t,fieldData:this.metaData,processedDefaultFields:this.processedDefaultFields,processedCustomFields:this.processedCustomFields,updateCustomBlacklist:this.updateCustomBlacklist.bind(this),enableSaveButton:this.enableSaveButton});this.$el.find("#account-creation-fields").append(i.render().$el),i.renderDropdowns(),this.allCustomRows.push(i)},saveMapping:function(e){e.preventDefault();var t=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Mapping...");this.validateForms().then(e=>{if(e)return _LeanData.Notification.showConfirmationDialog({header:"Missing Fields",message:"Ensure that all your fields are populated.",confirmButtonText:"Ok",showRejectButton:!1}),void t.resolve();var i={};_.each(this.allCustomRows,function(e){e.includeInSave&&(i[e.accountDropdown.selection[0].name]=e.leadDropdown.selection[0].name)});var a=_.assign(_.clone(this.defaultFields),i);_LeanData.RemotingRouter.setStringSetting("account from lead field map",JSON.stringify(a)).then(function(e){_LeanData.Notification.showConfirmationDialog({header:"Settings Saved",message:"Your settings have been successfully saved.",confirmButtonText:"Ok",showRejectButton:!1}),t.resolve()}),this.disableSaveButton()})},validateForms:async function(){return new Promise((e,t)=>{const i=[];this.allCustomRows.forEach(e=>{i.push(new Promise((t,i)=>{$.when(e.accountDropdown.validate(),e.leadDropdown.validate()).then(e=>t(!1)).fail(i=>e.includeInSave?t(!0):t(!1))}))}),Promise.all(i).then(t=>{e(t.some(e=>!0===e))})})},enableSaveButton:function(){$("#save-mapping-button").removeAttr("disabled")},disableSaveButton:function(){$("#save-mapping-button").attr("disabled",!0)},render:function(){this.disableSaveButton();var e=this.template({});this.$el.html(e);var i=new t({defaultFields:this.processedDefaultFields});return this.$el.find("#account-creation-fields").html(i.render().$el),_.each(this.processedCustomFields,e=>{this.addRowToTable(null,e)}),this},processData:function(){var e=this.metaData;_.each(e,function(t,i){e[i]=_.sortBy(e[i],"name")}),_.each(this.customFields,(e,t)=>{this.defaultFields[t]===this.customFields[t]&&delete this.customFields[t]}),_.each(e.Lead,e=>{this.leadFieldDataMap[e.name]=e}),_.each(e.Account,e=>{this.accountFieldDataMap[e.name]=e}),_.each(this.defaultFields,(e,t)=>{this.processedDefaultFields.push({leadField:this.leadFieldDataMap[e],accountField:this.accountFieldDataMap[t]})}),this.processedDefaultFields=_.sortBy(this.processedDefaultFields,function(e){return!!e.leadField&&e.leadField.label}),_.each(this.customFields,(e,t)=>{var i={leadField:this.leadFieldDataMap[e],accountField:this.accountFieldDataMap[t]};this.leadFieldDataMap[e]||(i.oldLeadField=e),this.accountFieldDataMap[t]?this.accountFieldBlacklist[this.accountFieldDataMap[t].name]=!0:i.oldAccountField=t,this.processedCustomFields.push(i)}),this.processedCustomFields=_.sortBy(this.processedCustomFields,function(e){return!!e.leadField&&e.leadField.label})}})}},function(e,t){e.exports=function(){return Magellan.Views.ActivityBasedRouting.extend({render:function(){return Magellan.Views.ActivityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Backbone.View.extend({template:Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate,edgeSelectionMenuView:null,renderMatchSelectorComponent:Magellan.Views.NewNodeForm.prototype.renderMatchSelectorComponent,render:function(){return this.$el.html(this.template({showMatchSelector:"Case"!==this.model.nodeInfo.objectType,primaryObject:_LeanData.Util.getSObjectLabel(_LeanData.AppState.PrimarySObjectType)})),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,hideFieldValueColumn:this.model.nodeInfo.isValueComparison,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.renderMatchSelectorComponent(this.edgeSelectionMenuView.render.bind(this.edgeSelectionMenuView),this.edgeSelectionMenuView.validateCriteriaList.bind(this.edgeSelectionMenuView)),this}})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.CaseRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!1,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({mainNodeFormView:null,advancedSettingsView:null,filerRulesView:null,edgeSelectionMenuView:null,hatTypeOptionView:null,matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.CaseRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(0)),render:function(){var e=this.template({pluralObjects:_LeanData.StringUtil.pluralizeString(this.matchedObjectName),singleObject:this.matchedObjectName,isDupeNode:!1,elementOrderInNode:["RCM","RA"].includes(this.model.nodeInfo.objectType)?3:2});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),"RA"===this.model.nodeInfo.objectType&&(this.objectRadioOptions=new Magellan.Views.ObjectRadioOptions({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,parentView:this}),this.$el.find(".object-radio-options").html(this.objectRadioOptions.render().$el)),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.$(".filter-div").html(this.filterRulesView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.CaseRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({nodeFormHeaderText:this.getNodeFormHeaderText(),currentNode:this.model,currentName:this.currentName,showNoOwnerWarning:!1,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),this.$("#node-partial-wrapper").html(this.mainNodeFormView.render().delegateEvents().$el),this.mainNodeFormView.delegateEvents(),this.$el.find("#node-name-char-count").text(this.currentName.length+"/200"),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this.loadEnablementAccordion(),this.loadVariableSettersForNodeModel(),this}})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.CaseDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!0,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.CreateOpportunity.extend({})}},function(e,t){e.exports=function(){return Magellan.Views.CreateTask.extend({})}},function(e,t){e.exports=function(){return Magellan.Views.ContactDecisionNode.extend({template:Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate,edgeSelectionMenuView:null,renderMatchSelectorComponent:Magellan.Views.NewNodeForm.prototype.renderMatchSelectorComponent,render:function(){return this.$el.html(this.template({showMatchSelector:"Contact"!==this.model.nodeInfo.objectType,primaryObject:_LeanData.Util.getSObjectLabel(_LeanData.AppState.PrimarySObjectType)})),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,hideFieldValueColumn:this.model.nodeInfo.isValueComparison,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.renderMatchSelectorComponent(this.edgeSelectionMenuView.render.bind(this.edgeSelectionMenuView),this.edgeSelectionMenuView.validateCriteriaList.bind(this.edgeSelectionMenuView)),this}})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.ContactRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.ContactDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({mainNodeFormView:null,advancedSettingsView:null,filerRulesView:null,edgeSelectionMenuView:null,hatTypeOptionView:null,matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.ContactRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(0)),render:function(){let e="CampaignMember"==this.matchedObjectName?"Campaign Member":this.matchedObjectName;var t=this.template({pluralObjects:_LeanData.StringUtil.pluralizeString(e),singleObject:e,isDupeNode:!1,elementOrderInNode:["RCM","RA"].includes(this.model.nodeInfo.objectType)?3:2});return this.$el.html(t),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),"RA"!==this.model.nodeInfo.objectType&&"RCM"!==this.model.nodeInfo.objectType||(this.objectRadioOptions=new Magellan.Views.ObjectRadioOptions({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,parentView:this}),this.$el.find(".object-radio-options").html(this.objectRadioOptions.render().$el)),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.$(".filter-div").html(this.filterRulesView.render().$el),this}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({template:_.template(i(9)),render:function(){return _LeanData.RemotingRouter.getMergeSettings().then(e=>{e.dedupeFromSameAccountOnly?this.$el.find(".info-row").html('Note: Current <a target="_blank" href="#routing/contact/merge_duplicates">merge settings</a> prevent Contacts from different Accounts to be merged.'):this.$el.find(".info-row").html('Note: Current <a target="_blank" href="#routing/contact/merge_duplicates">merge settings</a> allow Contacts from different Accounts to be merged.')}),this.$el.html(this.template({})),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.ContactRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({nodeFormHeaderText:this.getNodeFormHeaderText(),showNoOwnerWarning:!1,currentNode:this.model,currentName:this.currentName,optionRequired:!1,isC2aNode:"C2A"===this.model.nodeInfo.objectType,c2aEnabled:_LeanData.FeatureProvisioning.getFeatureProvisioningFromModelName("Match_C2A","Contact",_LeanData.AppState.isHandoffGraph?"handoff":"routing"),c2aErrMessage:_LeanData.FeatureProvisioning.getFeatureErrorMessage("c2a")});if(this.removeAllChildViews(),this.$el.html(e),this.$el.find("#node-partial-wrapper").html(this.mainNodeFormView.render().$el),this.mainNodeFormView.delegateEvents(),this.$el.find("#node-name-char-count").text(this.currentName.length+"/200"),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this.loadEnablementAccordion(),this.loadVariableSettersForNodeModel(),this}})}},function(e,t){e.exports=function(){return Magellan.Views.OutreachAddToSequence.extend({render:function(){_LeanData.RemotingRouter.outreach_validateProspectsScope().then(e=>{e||(this.$el.find(".reauth-warning").show(),this.$el.find(".ownership-checkbox-label").addClass("med-grey-1"),this.$el.find(".ownership-checkbox").prop("disabled",!0),this.$el.find(".ownership-checkbox").prop("checked",!1),this.$el.find(".update-owner-type").hide(),this.model.nodeInfo.updateOwnership=!1)});const e=this.template({authorized:_LeanData.MetaDataController.getPartnerAuthorization("outreach"),showOwnership:this.model.nodeInfo.updateOwnership});this.$el.html(e),this.model.nodeInfo.updateOwnership||this.$el.find(".update-owner-type").hide(),this.$el.find(".reauth-warning").hide();var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkSequenceRenaming().then(()=>{this.initializeSequencesTypeahead()}),this.checkUserRenaming().then(()=>{this.initializeUsersTypeahead(),this.initializeOwnersTypeahead()}),"specific"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.mailboxSelection&&this.$el.find("#outreach-user-field-typeahead-container").hide(),this.initializeCustomUserFieldTypeahead("Contact"),this.initializeCustomUserOwnerFieldTypeahead("Contact"),$(this.$el.find("#radio-record-owner")).LDRadioButton({label:"Contact Owner",checked:"owner"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").hide(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-specific-user")).LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-users-typeahead-container").show(),this.$el.find("#outreach-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-custom-user-field")).LDRadioButton({label:"User Field on Contact",checked:"customField"===this.model.nodeInfo.mailboxSelection,name:"mailbox-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.mailboxSelection=e,this.$el.find("#outreach-user-field-typeahead-container").show(),this.$el.find("#outreach-users-typeahead-container").hide()}}),"specific"!==this.model.nodeInfo.ownershipSelection&&this.$el.find("#outreach-owners-typeahead-container").hide(),"customField"!==this.model.nodeInfo.ownershipSelection&&this.$el.find("#outreach-owner-field-typeahead-container").hide(),$(this.$el.find("#radio-record-ownership")).LDRadioButton({label:"Lead Owner",checked:"owner"===this.model.nodeInfo.ownershipSelection,name:"ownership-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.ownershipSelection=e,this.$el.find("#outreach-owners-typeahead-container").hide(),this.$el.find("#outreach-owner-field-typeahead-container").hide()}}),$(this.$el.find("#radio-specific-owner")).LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.ownershipSelection,name:"ownership-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.ownershipSelection=e,this.$el.find("#outreach-owners-typeahead-container").show(),this.$el.find("#outreach-owner-field-typeahead-container").hide()}}),$(this.$el.find("#radio-custom-owner-field")).LDRadioButton({label:"User Field on Lead",checked:"customField"===this.model.nodeInfo.ownershipSelection,name:"ownership-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.ownershipSelection=e,this.$el.find("#outreach-owner-field-typeahead-container").show(),this.$el.find("#outreach-owners-typeahead-container").hide()}}),ld_initializeToolTip(this.$el.find(".mailbox-user-tooltip.ld-tooltip-hint"),{title:"Select Corresponding User",body:'Select the user who will communicate with the prospect and whose mailbox will send automated emails (if applicable). If the selected user does not exist in Outreach or does not have a default mailbox with sending enabled, the Add to Sequence action will fail.<br><br><i style="font-weight: inherit;">Note that queue ownership is not supported at this time.</i>'}),ld_initializeToolTip(this.$el.find(".owner-user-tooltip.ld-tooltip-hint"),{title:"Outreach Ownership Assignment",body:'The Outreach prospect`s owner will be updated to the corresponding user.<br><i style="font-weight: inherit;">Note this is not required to Add Prospect to a Sequence.</i>'}),this}})}},function(e,t){e.exports=function(){return Magellan.Views.AccountBasedRouting.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){Magellan.Views.AccountBasedRouting.prototype.initialize.apply(this,arguments),e.excludeGroups=!0},render:function(){return Magellan.Views.AccountBasedRouting.prototype.render.apply(this,arguments),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.ActivityBasedRouting.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){Magellan.Views.ActivityBasedRouting.prototype.initialize.apply(this,arguments),e.excludeGroups=!0},render:function(){return Magellan.Views.ActivityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t){e.exports=function(){return Magellan.Views.CampaignMemberBasedRouting.extend({})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,advancedSettingsView:null,alternateFieldAssignmentView:null,initialize:function(e){if(_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph){const e=["Next Node","Inactive User","Scheduling Configuration Error","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e)}},populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createOwnerToOwnerMappingFilter();this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Contact",required:!0,size:"xtra-small",attributes:{id:"matched-contact-custom-user-field"},filter:function(i){return i=e(i),i=t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Contact",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateUserCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el)},updateRoutingType:function(e){this.model.nodeInfo["routing type"]=$(e.currentTarget).data("routing-type")},updateUserCustomField:function(e){var t=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(this.customUserFieldDropdownView.selection);this.model.nodeInfo["custom field"]=t||null},additionalEvents:{"change .routing-type-radio":"updateRoutingType"},template:_.template(i(198)),render:function(){var e=this.template({model:this.model});return this.$el.html(e),this.populateDropdowns(),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$el.find(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$el.find("#update-account-owner").html(this.updateAccountOwner.render().$el),this.respectSchedulesView&&this.respectSchedulesView.remove(),this.respectSchedulesView=new Magellan.Views.RespectUserSchedules({model:this.model}),this.$el.find("#respect-schedules-wrapper").html(this.respectSchedulesView.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),this.schedulingView=new Magellan.Views.Scheduling({model:this.model}),this.$el.find("#scheduling-container").html(this.schedulingView.render().$el),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),this.renderlockRepSuggestion(),this}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,advancedSettingsView:null,alternateFieldAssignmentView:null,initialize:function(e){if(_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph){const e=["Next Node","Inactive Owner","Scheduling Configuration Error","Variable Not Found","Out of User Schedule"];this.model.nodeInfo.edges=_LeanData.Util.updateActionNodeEdgesForMeetings(this.model.nodeInfo.edges,null,e)}},updateRoutingType:function(e){this.model.nodeInfo["routing type"]=$(e.currentTarget).data("routing-type")},updateUserCustomField:function(e){var t=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(this.customUserFieldDropdownView.selection);this.model.nodeInfo["custom field"]=t||null},populateDropdowns:function(){var e=_LeanData.Util.createUserFieldsFilter(),t=_LeanData.Util.createOwnerToOwnerMappingFilter();this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:function(e=fieldMetaData,t=!1){return e},root:"Contact",required:!0,attributes:{id:"dupe-contact-custom-user-field"},filter:function(i){return i=e(i),i=t(i)},selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Contact",_LeanData.MetaDataController.getFieldMetaDataMap()),onSelect:this.updateUserCustomField.bind(this)}),this.$el.find(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el)},additionalEvents:{"change .routing-type-radio":"updateRoutingType"},template:_.template(i(199)),render:function(){return this.$el.html(this.template({model:this.model})),this.populateDropdowns(),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$el.find("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$el.find(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.respectSchedulesView&&this.respectSchedulesView.remove(),this.respectSchedulesView=new Magellan.Views.RespectUserSchedules({model:this.model}),this.$el.find("#respect-schedules-wrapper").html(this.respectSchedulesView.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),this.schedulingView=new Magellan.Views.Scheduling({model:this.model}),this.$el.find("#scheduling-container").html(this.schedulingView.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",isDupeAction:!0,variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),ld_initializeToolTip(this.$el.find(".main-host-tooltip"),{title:"What does being the Main Host mean? ",body:"The Main Host is a required attendee of the meeting and will receive a count for the meeting. If enabled for the Meeting Type, the Main Host will receive the confirmation email."}),this.renderlockRepSuggestion(),this}})}},function(e,t){e.exports=function(){return Magellan.Views.OpportunityBasedRouting.extend({advancedSettingsView:null,emailNotificationView:null,initialize:function(e){Magellan.Views.OpportunityBasedRouting.prototype.initialize.apply(this,arguments),e.excludeGroups=!0},render:function(){return Magellan.Views.OpportunityBasedRouting.prototype.render.apply(this,arguments),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.TerritoryRouting.extend({})}},function(e,t){e.exports=function(){return Magellan.Views.SalesloftAddToCadence.extend({render:function(){const e=this.template({authorized:_LeanData.MetaDataController.getPartnerAuthorization("salesloft")});this.$el.html(e);var t=new Magellan.Views.AdvancedSettings({model:this.model});return this.$el.find("#advanced-settings-wrapper").html(t.render().$el),this.checkCadenceRenaming().then(()=>{this.initializeCadencesTypeahead()}),this.initializeUsersTypeahead(),"specific"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-users-typeahead-container").hide(),"customField"!==this.model.nodeInfo.assigneeSelection&&this.$el.find("#salesloft-user-field-typeahead-container").hide(),this.initializeCustomUserFieldTypeahead("Contact"),$(this.$el.find("#radio-record-owner")).LDRadioButton({label:"Contact Owner",checked:"owner"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"owner",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").hide(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-specific-user")).LDRadioButton({label:"Specific User",checked:"specific"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"specific",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-users-typeahead-container").show(),this.$el.find("#salesloft-user-field-typeahead-container").hide()}}),$(this.$el.find("#radio-custom-user-field")).LDRadioButton({label:"User Field on Contact",checked:"customField"===this.model.nodeInfo.assigneeSelection,name:"assignee-selection",value:"customField",onSelectCallback:(e,t)=>{this.model.nodeInfo.assigneeSelection=e,this.$el.find("#salesloft-user-field-typeahead-container").show(),this.$el.find("#salesloft-users-typeahead-container").hide()}}),ld_initializeToolTip(this.$el.find(".assignee-user-tooltip.ld-tooltip-hint"),{title:"Select User as the Assignee and Owner",body:'The Assignee is the rep accountable for running the email, call, or other steps associated to those people in the cadence. In other words, whatever cadence step is due gets assigned to that rep and automated emails will come from the assignee selected.<br><br><i style="font-weight: inherit;">Note: The Assignee will also become the Owner of the cadence.</i>',width:"400px"}),_LeanData.FlowBuilderGraph.toggleNodePanelOverlay(!1,!0),this}})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.ZoominfoEnrich.extend({initialize:function(){this.objectType="Contact",Magellan.Views.ZoominfoEnrich.prototype.initialize.apply(this)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){e.objectType="contact",Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){e.objectType="contact",Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.ContactDecisionNode.extend({template:Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate,edgeSelectionMenuView:null,render:function(){return this.$el.html(this.template({showMatchSelector:"Meeting"!==this.model.nodeInfo.objectType,primaryObject:"Prospect"})),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({mainNodeFormView:null,advancedSettingsView:null,filerRulesView:null,edgeSelectionMenuView:null,hatTypeOptionView:null,matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.MeetingRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(0)),render:function(){var e=this.template({pluralObjects:_LeanData.StringUtil.pluralizeString(objectViewName),singleObject:this.matchedObjectName,isDupeNode:!1});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),this.$(".filter-div").html(this.filterRulesView.render().$el),this}})}},function(e,t){e.exports=function(){return Backbone.View.extend({template:Magellan.Views.NewNodeForm.prototype.decisionNodeTemplate,edgeSelectionMenuView:null,renderMatchSelectorComponent:Magellan.Views.NewNodeForm.prototype.renderMatchSelectorComponent,render:function(){return this.$el.html(this.template({showMatchSelector:"Opportunity"!==this.model.nodeInfo.objectType,primaryObject:_LeanData.Util.getSObjectLabel(_LeanData.AppState.PrimarySObjectType)})),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({model:this.model,objectType:this.model.nodeInfo.objectType,hideFieldValueColumn:this.model.nodeInfo.isValueComparison,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.renderMatchSelectorComponent(this.edgeSelectionMenuView.render.bind(this.edgeSelectionMenuView),this.edgeSelectionMenuView.validateCriteriaList.bind(this.edgeSelectionMenuView)),this}})}},function(e,t){e.exports=function(){return Magellan.Views.CreateOpportunity.extend({})}},function(e,t){e.exports=function(){return Magellan.Views.CreateTask.extend({})}},function(e,t){e.exports=function(){return Backbone.View.extend({matchedObjectName:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!1,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({matchedObjectName:null,edgeSelectionMenuView:null,filerRulesView:null,advancedSettingsView:null,initialize:function(){this.matchedObjectName=Magellan.Controllers.OpportunityRouter.getObjectNameFromHatType(this.model.nodeInfo.objectType)},template:_.template(i(0)),render:function(){var e=this.template({pluralObjects:_LeanData.StringUtil.pluralizeString(this.matchedObjectName),singleObject:this.matchedObjectName,isDupeNode:!1,elementOrderInNode:["RCM","RA"].includes(this.model.nodeInfo.objectType)?3:2});return this.$el.html(e),this.edgeSelectionMenuView&&this.edgeSelectionMenuView.remove(),this.edgeSelectionMenuView=new Magellan.Views.EdgeSelectionMenu({context:this.model,model:this.model.nodeInfo.tiebreakers,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$("#criteria-list-partial").html(this.edgeSelectionMenuView.render().$el),this.filerRulesView&&this.filterRulesView.remove(),this.filterRulesView=new Magellan.Views.FilterRules({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,matchedFieldColumnWidth:280,operatorColumnWidth:200,valueFieldColumnWidth:275}),this.$(".filter-div").html(this.filterRulesView.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.$("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el),"RA"===this.model.nodeInfo.objectType&&(this.objectRadioOptions=new Magellan.Views.ObjectRadioOptions({model:this.model.nodeInfo,node:this.model,objectType:this.model.nodeInfo.objectType,parentView:this}),this.$el.find(".object-radio-options").html(this.objectRadioOptions.render().$el)),this}})}},function(e,t){e.exports=function(){return Magellan.Views.NewNodeForm.extend({mainNodeFormView:null,initialize:function(){var e=Magellan.Controllers.OpportunityRouter.getNodeFormViewFromNodeModel(this.model);this.mainNodeFormView=new e({model:this.model}),Magellan.Views.NewNodeForm.prototype.initialize.apply(this,arguments)},render:function(){var e=this.template({nodeFormHeaderText:this.getNodeFormHeaderText(),currentNode:this.model,currentName:this.currentName,showNoOwnerWarning:!1,optionRequired:!1});if(this.removeAllChildViews(),this.$el.html(e),this.$el.find("#node-partial-wrapper").html(this.mainNodeFormView.render().$el),this.mainNodeFormView.delegateEvents(),this.$el.find("#node-name-char-count").text(this.currentName.length+"/200"),this.model.nodeInfo.name!==this.currentName&&this.$el.find("#node-name-input").val(this.currentName),this.$("#email-notification-wrapper").length>0){var t=new Magellan.Views.SendNotification({model:this.model});this.$el.find("#email-notification-wrapper").html(t.render().$el)}return this.loadEnablementAccordion(),this.loadVariableSettersForNodeModel(),this}})}},function(e,t){e.exports=function(){return Magellan.Views.AccountBasedRouting.extend({render:function(){return Magellan.Views.AccountBasedRouting.prototype.render.apply(this,arguments),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.ActivityBasedRouting.extend({render:function(){return Magellan.Views.ActivityBasedRouting.prototype.render.apply(this,arguments),this}})}},function(e,t,i){e.exports=function(){return Magellan.Views.ButtonHandler.extend({customUserFieldDropdownView:null,alternateFieldAssignmentView:null,emailNotificationView:null,advancedSettingsView:null,initialize:function(e){},additionalEvents:{"change .routing-type-radio":"updateRoutingType"},template:_.template(i(200)),updateRoutingType:function(e){this.model.nodeInfo["routing type"]=$(e.currentTarget).data("routing-type")},updateUserCustomField:function(e){var t=_LeanData.TypeaheadUtil.convertFieldSelectionArrayToString(this.customUserFieldDropdownView.selection);this.model.nodeInfo["custom field"]=t||null},render:function(){this.$el.html(this.template({model:this.model})),this.customUserFieldDropdownView&&this.customUserFieldDropdownView.remove(),this.customUserFieldDropdownView=new Magellan.Views.NestedTypeaheadSelector({data:fieldMetaData,root:"Contact",required:!0,size:"xtra-small",attributes:{id:"matched-contact-custom-user-field"},filter:_LeanData.Util.createUserFieldsFilter(),selection:_LeanData.Util.convertFieldSelectionStringToArray(this.model.nodeInfo["custom field"],"Contact",_LeanData.MetaDataController.getFieldMetaDataMap())}),this.$(".custom-user-field-selector").html(this.customUserFieldDropdownView.$el),this.customUserFieldDropdownView.$el.on("nestedTypeaheadSelector:select",this.updateUserCustomField.bind(this)),this.alternateFieldAssignmentView&&this.alternateFieldAssignmentView.remove(),this.alternateFieldAssignmentView=new Magellan.Views.AlternateFieldAssignment({model:this.model}),this.$(".alternate-field-assignment-container").html(this.alternateFieldAssignmentView.render().$el),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this.advancedSettingsView&&this.advancedSettingsView.remove(),this.advancedSettingsView=new Magellan.Views.AdvancedSettings({model:this.model}),this.advancedSettingsView.openPanel=this.openPanel,this.$el.find("#advanced-settings-wrapper").html(this.advancedSettingsView.render().$el);var e=new Magellan.Views.RespectUserSchedules({model:this.model});return this.$el.find("#respect-schedules-wrapper").html(e.render().$el),this.loadVariableSetter({variableType:"input",conditionals:null,selector:"contact-variable",variableSetterRowDataList:[{variableKey:"contactVariable",defaultVariable:"matched contact",placeholder:"Find and Select a Variable",disabled:!_LeanData.AppState.isLockedForEditing,sObjectTypes:["Contact"],doNotSave:!1}]}),this}})}},function(e,t){e.exports=function(){return Magellan.Views.OpportunityBasedRouting.extend({render:function(){return Magellan.Views.OpportunityBasedRouting.prototype.render.apply(this,arguments),this.updateAccountOwner&&this.updateAccountOwner.remove(),this.updateAccountOwner=new Magellan.Views.UpdatePrimaryAccountOwner({model:this.model}),this.$("#update-account-owner").html(this.updateAccountOwner.render().$el),this}})}},function(e,t){e.exports=function(){return Magellan.Views.TerritoryRouting.extend({})}},function(e,t){e.exports=function(){return Magellan.Views.SendNotification.extend({initialize:function(e){Magellan.Views.SendNotification.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TrueFalseNode.extend({initialize:function(e){Magellan.Views.OpportunityDecisionNode.prototype.initialize.apply(this,arguments),Magellan.Views.TrueFalseNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Magellan.Views.TriggerNode.extend({initialize:function(e){this.isUpdateTrigger=!0,Magellan.Views.TriggerNode.prototype.initialize.apply(this,arguments)}})}},function(e,t){e.exports=function(){return Backbone.Model.extend({defaults:{membersList:[],poolsData:{},pool:null,selectedPoolId:null,poolNameToPoolTypeMap:{},members:[],filteredUserList:[],cappingConfigurations:null,appliedRulesets:null,poolIdsWithWeightingChanged:new Set,managerMode:!1},initialize:function(e){this.showPoolList=e.showPoolList,this.poolsData=e.poolsData,this.poolIds=e.poolIds,this.pool=e.pool,this.rrpModel=e.rrpModel,this.isCalendaringRRPage=e.isCalendaringRRPage,this.selectedPoolId=e.selectedPoolId,this.poolNameToPoolTypeMap=e.poolNameToPoolTypeMap,this.poolIdToNextUpData=e.poolIdToNextUpData||{},this.userFilterMetaData=e.userFilterMetaData,this.ownerIdToWorkingHours=e.ownerIdToWorkingHours,this.idToOwner=e.idToOwner,this.cappingConfigurations=e.cappingConfigurations,this.appliedRulesets=e.appliedRulesets,this.poolIdsWithWeightingChanged=e.rrpModel?e.rrpModel.poolIdsWithWeightingChanged:new Set,this.getMeetingLogsCounter=e.getMeetingLogsCounter,this.translateMemberWeightingFromServer(),this.populateNextOwner(),this.rrpModel?this.poolIdToNextUpData[this.rrpModel.get("Id")]=["",""]:this.poolIds.forEach(e=>this.updatePoolConditionalMembersCount(e)),this.users=e.filteredUserList;let t=e.filteredUserList;Array.isArray(t)&&(t=t.filter(e=>!(null==e.Id||!e.Id.startsWith("005")))),this.filteredUserList=t,this.originalPoolsData=_.cloneDeep(e.poolsData),this.originalMembers=_.cloneDeep(e.members),this.originalMemberToValidIndex={},_.each(this.poolsData,(e,t)=>{this.originalMemberToValidIndex[t]={},_.each(e.members,(e,i)=>{this.originalMemberToValidIndex[t][e.attributes.OwnerId__c]=i}),this.poolIdToNextUpData[t]=["",""]}),this.onConfirm=e.onConfirm,this.managerIdToPoolIds=e.managerIdToPoolIds,this.poolIdToManagerIds=e.poolIdToManagerIds,this.idToRole=e.idToRole,this.idToProfile=e.idToProfile,this.managerMode=e.managerMode,this.enabledSalesforceLicenses=e.enabledSalesforceLicenses,this.advancedRRFeaturesEnabled=e.advancedRRFeaturesEnabled,this.creditBackQueue=e.creditBackQueue},showModalOverlay:function(e,t="loading",i=!0){let a;if("loading"===t){a=$(".round-robin-modal .modal-loading-overlay");const t={selector:".round-robin-modal .modal-loading-overlay",inputs:{message:e}};_LeanDataUtil.Backbone.loadAngularComponent({el:$("#magellan-modals")[0]},t)}else"disabled"===t&&(a=$(".round-robin-modal .modal-disabled-overlay"));a.css({display:"block"}),i&&$(".forward-button").attr("disabled",!0)},hideModalOverlay:function(e="loading",t=!0){let i;"loading"===e?i=$(".round-robin-modal .modal-loading-overlay"):"disabled"===e&&(i=$(".round-robin-modal .modal-disabled-overlay")),i.css("display","none"),t&&$(".forward-button").removeAttr("disabled")},buildManager(e,t,i,a){let n={};n.Id=e;let o=a.find(t=>t.Id===e),l=o.UserRoleId;n.Role=t[l]?t[l]:null;let s=o.ProfileId;return n.Profile=i[s]?i[s]:null,n.IsActive=!(!o||!o.IsActive)&&o.IsActive,n.Name=o.Name,n},translateMemberWeightingFromServer:function(){Object.keys(this.poolsData).forEach(e=>{this.poolsData[e].members.forEach(e=>{e.attributes.Weighting_Value__c=e.attributes.Weighting_Value__c/50})})},populateNextOwner(){Object.keys(this.poolsData).forEach(e=>{this.poolsData[e].members.forEach(t=>{const i=this.poolsData[e].members.filter(e=>e.isNextOwner);this.poolsData[e].nextOwnerId=i.length>0?i[0].attributes.OwnerId__c:""})})},originalPoolDataMemberWeightsHasChanged(){let e=[];const t={};return Object.keys(this.originalPoolsData).forEach(e=>{this.originalPoolsData[e].members.forEach(i=>{t[e+i.attributes.Id]=i.attributes.Weighting_Value__c})}),Object.keys(this.poolsData).forEach(i=>{let a=this.poolsData[i].attributes;!0===a.Weighting_Enabled__c&&"count-based"!==a.Distribution_Type__c&&this.poolsData[i].members.forEach(a=>{null!=t[i+a.attributes.Id]&&t[i+a.attributes.Id]!=a.attributes.Weighting_Value__c&&e.push(i)})}),e},omitAttributes:function(e){return _LeanData.Util.mapValuesDeep(e,e=>_.omit(e,"attributes"))},hasChanged:function(){let e=_.cloneDeep(this.poolsData);for(const t of Object.keys(e))e[t].members.forEach((e,t)=>{delete e.attributes.availabilityStatus,delete e.attributes.nextUpStatus}),this.originalPoolsData[t].members.forEach((e,t)=>{delete e.attributes.availabilityStatus,delete e.attributes.nextUpStatus});return!_.isEqual(this.omitAttributes(e),this.omitAttributes(this.originalPoolsData))},getFirstAvailableMember:function(e=this.selectedPoolId){const t=this.poolsData[e].members;for(let e=0;e<t.length;e++){const i=t[e].attributes;if("Unavailable"!==i.Status__c&&!(i.User_Owner__r&&!i.User_Owner__r.IsActive)&&"remove"!==i.conditionalStatus){return{memberIndex:e,memberName:this.getMemberName(t[e])}}}return{memberIndex:-1,memberName:null}},getWeightingToggleText:function(){const{memberName:e}=this.getFirstAvailableMember();return null===e?"There are currently no available pool members. Subsequent records will be assigned to your fallback edge until a member becomes available.":"Round Robin will restart at the top of the pool with "+_.escape(e)+" and distribute, regardless of previous distribution."},getWeightingDistributionResetText:function(e){const t={};_.each(e,e=>{const i=_.escape(this.poolsData[e].attributes.Grouping_Name__c),{memberName:a}=this.getFirstAvailableMember(e);t[i]=a});const i=Object.keys(t).length;let a=`Weighting changes detected for ${i} Pool${1===i?"":"s"}. `+'Round Robin will restart at the top of the Pool with the member listed below and distribute, regardless of previous distribution.\n<ul style="margin-top: 15px">';return _.each(t,(e,t)=>{a+=`<li>${t}: ${e?_.escape(e):"No members currently available"}</li>`}),a+"</ul>"},resetPoolAfterWeightingChange:function(e,t=this.selectedPoolId){this.setNextMember(null,t),this.poolIdsWithWeightingChanged.add(t);const i=this.poolsData[t];i.attributes.Weighting_Enabled__c=e,i.attributes.Current_Order_Position__c=null,i.members.forEach(function(e){e.attributes.Weighting_Next_Pointer__c=0}),this.populateMemberStatuses(i.members)},getPoolResult(e){return this.poolsData[e]},toggleConditionalMembership:function(e){const t=this.poolsData[e].attributes;t.Is_Conditional_Membership_Enabled__c=!t.Is_Conditional_Membership_Enabled__c,t.Weighting_Enabled__c=!1,t.Is_Conditional_Membership_Enabled__c||(this.removeConditionalMembers(e,"conditionalStatus","remove"),this.convertAllConditionalMembersToManual(),this.updatePoolSettings(e)),this.get("memberListView").render(),this.get("userListView").render()},syncPool:function(e,t){const i=this.isCalendaringRRPage,a=this.poolsData[e];let n=a.attributes.Soql_Condition__c;if(a.isLoading=!0,!a.members&&_.isEmpty(n))return;let o={};a.members.forEach(e=>{let t=e.attributes;o[t.OwnerId__c]=t});const{includeInactiveUsers:l,doNotError:s}=t,r={includeInactiveUsers:l,isMeetingPool:i,doNotError:s};return new Promise((t,l)=>_LeanData.RemotingRouter.syncRoundRobinMemberList(Object.keys(o),n,r).then(n=>{if(n.error)throw n.message;let o=n,l={},s={},r={};a.members.forEach(e=>{let t=e.attributes;"add"!==t.conditionalStatus&&(t.conditionalStatus=null),r[t.OwnerId__c]=t}),Object.keys(r).filter(e=>!(e in o)).forEach(e=>{let t=r[e];t.Is_Conditional__c&&"add"===t.conditionalStatus?t.conditionalStatus="remove add":t.Is_Conditional__c&&(t.conditionalStatus="remove",s[e]=t)}),this.removeConditionalMembers(e,"conditionalStatus","remove add"),o&&Object.keys(o).length>0?(Object.keys(o).forEach(e=>{let t=o[e];i&&(t.isAuthorized=!0),this.idToOwner[e]=t,r[e]?r[e].Is_Conditional__c?"add"!=r[e].conditionalStatus&&(r[e].conditionalStatus="keep"):r[e].conditionalStatus="meets":(t.conditionalStatus="add",l[e]=t)}),this.get("memberListView").addMembersToPool(e,Object.values(l),null,!0),a.attributes.Last_Membership_Saved_Date__c=(new Date).getTime()):this.updatePoolConditionalMembersCount(e);const d=this.get("userListView").conditionalView;d.updateSyncedUsersList(!0),d.render(),a.isLoading=!1,a.updateStatus={status:!0,bulkAddList:l,bulkRemoveList:s},t({bulkAddList:l,bulkRemoveList:s})}).catch(e=>{console.error("error with syncing pool: ",e),a.isLoading=!1,a.updateStatus={status:!1,errMessage:e},l(e)}))},updatePoolConditionalMembersCount:function(e){const t=this.poolsData[e];t.conditionalMembersCount||(t.conditionalMembersCount={}),t.conditionalMembersCount.add=0,t.conditionalMembersCount.remove=0,t.conditionalMembersCount.keep=0,t.conditionalMembersCount.meets=0,t.attributes.Is_Conditional_Membership_Enabled__c&&t.members.forEach(e=>{e.attributes.Is_Conditional__c&&t.conditionalMembersCount[e.attributes.conditionalStatus||"keep"]++})},updatePoolSettings:function(e){const t=this.poolsData[e],i=JSON.parse(t.attributes.Pool_Settings__c||null)||{};let a=!0;const n=t.attributes.Soql_Condition__c;if(n&&i.soqlBuilderConditions){const e=_LeanData.FunctionUtil.parseTokenLogic(i.soqlBuilderConditions.conditions.length,i.soqlBuilderConditions.logic);a=_LeanData.Util.constructSoql(e,i.soqlBuilderConditions.conditions).trim()!==n.trim()}a&&delete i.soqlBuilderConditions,_.isEmpty(i)?delete t.attributes.Pool_Settings__c:t.attributes.Pool_Settings__c=JSON.stringify(i)},saveToServer:function(e){e||(e=this.poolsData);let t=_LeanData._getOrganizationData();t.poolSaveChunkSize;return new Promise(i=>{const a=Date.now();Object.keys(e).forEach(t=>{let i=e[t],n=Object.keys(i.originalOwnersToWeightValues).length;(i.hasOwnProperty("membersToDelete")||i.members.length!=n)&&(i.hasMembershipChanged=!0),i.hasWeightingChanged=i.members.some(e=>{i.originalOwnersToWeightValues[e.attributes.Id]!=e.attributes.Weighting_Value__c&&(hasWeightingChanged=!0)}),i.attributes=_LeanData.Util.getPoolPayloadObject(i.attributes),i.attributes.Last_Membership_Saved_Date__c=a,i.members.forEach((e,t)=>{e.attributes.Owner_Order__c=t,e.attributes.Weighting_Value__c=i.attributes.Weighting_Enabled__c&&_.isNumber(e.attributes.Weighting_Value__c)?50*e.attributes.Weighting_Value__c:50})});let n=_LeanData.Util.splitArrayIntoSubArrays(Object.entries(e),t.poolSaveChunkSize),o=0,l=Object.keys(e).length,s=[],r=[],d=[];const c={round_robin_pool:[],pool_member:[],delete_pool_member:[]};let h=(e,t)=>{if(e.length<=0)return;let a=e.pop(),n={};for([id,poolData]of a)n[id]=poolData;let p=null;for(let e of Object.values(a)){let[t,i]=e;if(i.hasOwnProperty("managerIds")){let e={adminToAssign:[],adminToRevoke:[]};if(i.managerIds.forEach(i=>{e.adminToAssign.push({userId:i,roundRobinPoolId:t})}),_.difference(i.originalManagers,i.managerIds).forEach(i=>{e.adminToRevoke.push({userId:i,roundRobinPoolId:t})}),p){let t=p;t.adminToAssign.push(...e.adminToAssign),t.adminToRevoke.push(...e.adminToRevoke)}else p=e}}let u=0===e.length,m=Object.keys(n).length;o+=m;let g="";_LeanData.Notification.showLoadingOverlay("Saving Round Robin Pools ("+o+" of "+l+")");let f=this.managerMode?Promise.resolve():_LeanData.RemotingRouter.saveMultiplePoolData(JSON.stringify(n)),b=p?_LeanData.RemotingRouter.assignOrRevokeAdminsForRoundRobinPools(JSON.stringify(p)):Promise.resolve();$.when(f,b).then(i=>{let a;i&&i.savedPoolIds&&i.omittedPoolIds?(a=i.savedPoolIds,s.push(...a),r.push(...i.omittedPoolIds)):(a=Object.keys(n),s.push(a));const o=window._LeanData._getOrganizationData().orgId;for(let e of a){const t=n[e];if("count-based"===t.attributes.Distribution_Type__c){c.round_robin_pool.push({sfdc_pool_id:e,organization_id:o,pool_name:t.attributes.Grouping_Name__c,is_weighted:t.attributes.Weighting_Enabled__c});const i=t.members||[];for(let t of i)c.pool_member.push({pool_id:e,user_id:t.attributes.OwnerId__c,weighting:t.attributes.Weighting_Value__c,organization_id:o}),c.meeting_count?(c.meeting_count.userIds.add(t.attributes.OwnerId__c),c.meeting_count.poolIds.add(e)):c.meeting_count={userIds:new Set([t.attributes.OwnerId__c]),poolIds:new Set([e])};const a=t.membersToDelete||[];for(let t of a)c.delete_pool_member.push({pool_id:e,user_id:t.attributes.OwnerId__c,organization_id:o})}}h(e,t),_LeanData.Notification.hideLoadingOverlay()}).catch(e=>{d.push(...a),g=e}).always(()=>{if(u){if(d.length>0){if(t)return e=_LeanData.Util.splitArrayIntoSubArrays(d,1),d=[],g="",void h(e,!1);console.error("error saving pools: ",d),_LeanData.Notification.showConfirmationDialog({header:"Save Error",message:g,confirmButtonText:"Ok",showRejectButton:!1,onConfirm:this.onConfirm})}i({savedPools:s,failedPools:d,omittedPools:r,herokuPayload:c})}})};h(n,!0)})},syncSavedPools:function(e){return e.meeting_count&&(e.meeting_count.userIds=Array.from(e.meeting_count.userIds),e.meeting_count.poolIds=Array.from(e.meeting_count.poolIds)),_LeanData.RemotingRouter.syncPoolsAndMembers(JSON.stringify(e))},generateMemberAttributes:function(e,t){const i=_.isString(e)?_.find(this.filteredUserList,{Id:e}):e,a=(_.isString(e)?this.ownerIdToWorkingHours[e]:e)||{};let n=this.originalMembers.filter(e=>e.attributes.OwnerId__c===i.Id);return{Id:n.length>0&&n[0].Id||null,Name:i.Name,OwnerId__c:i.Id,User_Owner__r:"Queue"===i.type?null:{Id:i.Id,Name:i.Name,IsActive:i.IsActive},isAuthorized:!this.isCalendaringRRPage||void 0===i.isAuthorized||i.isAuthorized,Weighting_Value__c:1,Type:i.type,User_Owner__c:"Queue"===i.type?null:i.Id,WorkingHours:a.WorkingHours,WorkingHoursId:a.WorkingHoursId,WorkingHoursName:a.WorkingHoursName,ScheduleType:a.ScheduleType,isNextOwner:!1,productAccess:new Set(i.productAccess),Is_Conditional__c:t,conditionalStatus:i.conditionalStatus,Current_Cap_Value__c:n.length>0?n[0].attributes.Current_Cap_Value__c:0}},getMemberName:function(e){if(e.attributes.Name)return e.attributes.Name;if(e.attributes.User_Owner__r&&e.attributes.User_Owner__r.Name)return e.attributes.User_Owner__r.Name;const t=this.getOwnerById(e.attributes.OwnerId__c);if(t&&t.Name)return t.Name;const i=_.find(this.filteredUserList,{Id:e.attributes.Id});return i&&i.Name?i.Name:e.attributes.OwnerId__c},addNewMemberToMembersList:function(e,t,i,a){const n=this.generateMemberAttributes(t,a),o={Id:_.isObject(t)?t.Id:null,attributes:n};return _.isNumber(i)?e.splice(i,0,o):e.push(o),e},addNewManagerToManagersList:function(e,t){let i=this.buildManager(t,this.idToRole,this.idToProfile,this.filteredUserList),a=this.poolsData[e].managerIds,n=this.poolsData[e].managers;a.includes(t)||a.push(t),t in n||(n[t]=i),t in this.managerIdToPoolIds||(this.managerIdToPoolIds[t]=new Set),e in this.poolIdToManagerIds||(this.poolIdToManagerIds[e]=new Set),this.managerIdToPoolIds[t].add(e),this.poolIdToManagerIds[e].add(t)},updateUserList:function(){$.Deferred();const e=JSON.stringify({filterKey:this.userFilterKey,filterValue:this.userFilterValue&&this.userFilterValue.Id,queryString:this.userFilterQueryString,userFilterOption:this.userFilterOption,isCalendaringRRPage:this.isCalendaringRRPage,objectTypes:[this.selectedObjectType],limit:"100"}),t=this.showUsersInPool?null:this.poolsData[this.selectedPoolId].members.reduce((e,t)=>("remove"!==t.attributes.conditionalStatus&&e.push(t.attributes.OwnerId__c),e),[]);return this.pendingUserListPromise&&this.pendingUserListPromise.cancel(),this.pendingUserListPromise=_LeanData.Util.makeCancelablePromise(_LeanData.RemotingRouter.getFilteredRoundRobinOwnerList(e,t)),this.pendingUserListPromise.promise.then((e,t)=>{this.filteredUserList=[];const i=new Set;let a;this.ownerIdToWorkingHours=e.ownerIdToWorkingHours||{},a="Queues"===this.userFilterKey?e.Queues||{}:e.Users||{},Object.values(a).forEach(e=>{"Queue"===e.Type?(e.IsActive=!0,e.type="Queue"):e.type="User",this.filteredUserList.push(e),this.idToOwner[e.Id]&&("Queue"!==e.Type||this.idToOwner[e.Id].QueueSobjects)||(this.idToOwner[e.Id]=e),"User"===e.type&&i.add(e.Id)})}).catch(e=>{console.log("updateUserList warning: ",e)}).finally(()=>{this.pendingUserListPromise=null})},removeMember:function(e){const t=this.poolsData[this.selectedPoolId];let i;const a=t.members.filter(t=>t.attributes.OwnerId__c!==e||(i=t,!1));if(t.members=a,t.attributes.Is_Conditional_Membership_Enabled__c&&"meets"===i.attributes.conditionalStatus){new Magellan.Views.ConfirmationModal({header:"Manual Member Meets Conditions",message:`This Manual member also meets the conditions of the Pool. You have removed them as a Manual member, but they will be re-added to the Pool as a Conditional member the next time you sync the membership.<br /><br />To permanently remove them from the Pool, please add an exclusion condition for the user ID: <span class="semi-bold">${i.attributes.OwnerId__c}</span>`,primaryButtonText:"OK, Got it!",hideSecondaryButton:!0,innerModal:!0}).open()}t.membersToDelete||(t.membersToDelete=[]),t.membersToDelete.push(i),this.rrpModel&&(this.rrpModel.membersToDelete||(this.rrpModel.membersToDelete=[]),this.rrpModel.membersToDelete.push(i)),i.attributes.conditionalStatus=null,this.updatePoolConditionalMembersCount(this.selectedPoolId),this.updateOriginalMemberToValidIndex(t.members),this.populateMemberStatuses(t.members)},removeConditionalMembers(e,t,i){const a=this.poolsData[e],n=[];a.members.forEach(e=>{e.attributes.Is_Conditional__c&&e.attributes[t]===i?(a.membersToDelete||(a.membersToDelete=[]),a.membersToDelete.push(e),this.rrpModel&&(this.rrpModel.membersToDelete||(this.rrpModel.membersToDelete=[]),this.rrpModel.membersToDelete.push(e))):n.push(e)}),a.members=n,this.updatePoolConditionalMembersCount(e),this.updateOriginalMemberToValidIndex(a.members),this.populateMemberStatuses(a.members)},convertConditionalMemberToManual(e){let t;if(_.isString(e)){t=this.poolsData[this.selectedPoolId].members.find(t=>t.attributes.OwnerId__c===e)}else t=e;t.attributes.Is_Conditional__c=!1,t.attributes.conditionalStatus=null,this.updatePoolConditionalMembersCount(this.selectedPoolId)},convertAllConditionalMembersToManual(){this.poolsData[this.selectedPoolId].members.forEach(e=>{e.attributes.Is_Conditional__c=!1,e.attributes.conditionalStatus=null}),this.updatePoolConditionalMembersCount(this.selectedPoolId)},removeManager:function(e){_.pull(this.poolsData[this.selectedPoolId].managerIds,e),e in this.poolsData[this.selectedPoolId].managers&&delete this.poolsData[this.selectedPoolId].managers[e],this.managerIdToPoolIds[e].delete(this.selectedPoolId),this.poolIdToManagerIds[this.selectedPoolId].delete(e)},setNextMember:function(e,t=this.selectedPoolId||this.rrpModel.get("Id")){const i=this.poolsData[t].members;if(!e){const{memberIndex:t}=this.getFirstAvailableMember();e=t<0?null:i[t].attributes.OwnerId__c}this.poolsData[this.selectedPoolId].attributes.Manual_Next_OwnerId__c=e,this.poolsData[this.selectedPoolId].nextOwnerId=e,_.each(i,t=>{t.isNextOwner=t.attributes.OwnerId__c===e}),this.populateMemberStatuses(i)},updateOriginalMemberToValidIndex(e){const t=this.selectedPoolId;_.each(e,(e,i)=>{const a=this.originalMemberToValidIndex[t][e.attributes.OwnerId__c];Number.isInteger(a)&&(this.originalMemberToValidIndex[t][e.attributes.OwnerId__c]=i===a?a:null)})},populateMemberStatuses:function(e){const t=["Paused","On Vacation","On Holiday","Outside Working Hours"],{memberIndex:i}=this.getFirstAvailableMember(),a=this.selectedPoolId,n=this.rrpModel&&this.rrpModel.copyMode,o=this.poolIdsWithWeightingChanged.has(a)&&!this.poolsData[a].attributes.Manual_Next_OwnerId__c;let l=!1;const s=this.poolsData[a].attributes,r=s.Manual_Next_OwnerId__c,d=this.rrpModel?this.rrpModel.get("creditBackQueue"):_.isEmpty(s.Credit_Back_Queue__c)?[]:JSON.parse(s.Credit_Back_Queue__c),c=_.keyBy(e,"attributes.OwnerId__c"),h=d.filter(e=>null!=c[e.Id]).map(e=>c[e.Id].attributes.availabilityStatus),p=h.every(e=>["Paused","On Vacation","On Holiday","Outside Working Hours"].includes(e)),u=h.length>0&&!p;_.each(e,(e,a)=>{let s="";const d=new Set(e.attributes.Inactive_Reason__c?JSON.parse(e.attributes.Inactive_Reason__c):[]);_.each(t,e=>{if(d.has(e))return s=e,!1}),e.attributes.availabilityStatus=s;let h=!1;c[r]&&"Unavailable"!==c[r].attributes.Status__c?e.OwnerId__c===r&&(h=!0):h=(o||n)&&-1!==i?a===this.memberIndex:-1===i?0===a:e.attributes.isNextOwner;let p="";!l&&h&&e.attributes.receivedLastRecord?(p="LRT Next Up",l=!0,u&&(p="LRT Next After")):!l&&h?(p="Next Up",l=!0,u&&(p="Next Up After Credits")):e.attributes.receivedLastRecord&&(p="Last Routed To"),e.attributes.nextUpStatus=p,"LRT Next After"===p?e.attributes.nextUpTitle="This Member received the last record and will be next up once the credit queue is exhausted.":"LRT Next Up"===p?e.attributes.nextUpTitle="This Member received the last record and will be next up.":"Last Routed To"===p?e.attributes.nextUpTitle="This Member received the last record.":"Next Up"===p?e.attributes.nextUpTitle="This Member will be next up.":"Next Up After Credits"===p&&(e.attributes.nextUpTitle="This Member will be next up once the credit queue is exhausted.")})},poolNameAndObjectTypeExist:function(e){return!_.isUndefined(this.get("poolNameToPoolTypeMap")[e])&&!_.isUndefined(this.get("Object_Type__c"))&&this.get("poolNameToPoolTypeMap")[e]===this.get("Object_Type__c")&&this.get("original_Grouping_Name__c")!==e},validate:function(){var e=!0;if(e=(e=(e=(e=e&&!_.isEmpty(_.unescape(this.get("Grouping_Name__c"))))&&!this.poolNameAndObjectTypeExist(this.get("Grouping_Name__c")))&&!_.isEmpty(this.get("Pool_Type__c")))&&!_.isEmpty(this.get("Object_Type__c")),"Lead"!==this.get("Object_Type__c")&&"Case"!==this.get("Object_Type__c")&&(e=e&&!_.find(this.get("memberList"),{type:"Queue"})),_.isNull(this.get("Capping_Type__c"))||"conditional"===this.get("Capping_Type__c")||(e=e&&!!parseInt(this.get("Capping_Limit__c"))&&!_.isEmpty(this.get("Timezone__c"))),!_.isNull(this.get("Capping_Type__c"))&&"conditional"===this.get("Capping_Type__c")){var t=!1,i=new Set;this.appliedCappingRules&&(this.appliedCappingRules.forEach(function(e){i.has(e["config id"])?t=!0:i.add(e["config id"])}),e=e&&!t)}return e},hasValidNextUp(){return this.get("hasValidNextUp")},getOwnerById:function(e){return this.idToOwner[e]},isValidQueue:function(e,t){return this.idToOwner[e].QueueSobjects.some(e=>e.SobjectType===this.poolsData[t||"NewPool"].attributes.Object_Type__c)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(202)),initialize:function(e){this.model=e.model,this.soqlConditionValid=!1,this.includeInactiveUsers=!1,this.isPoolScheduled=!1,this.showSyncResults=!1,this.addedMembersFromSync=[],this.removedMembersFromSync=[],this.readOnly=e.readOnly,this.postSyncCallback=e.postSyncCallback&&"function"==typeof e.postSyncCallback?e.postSyncCallback:_.noop,this.postValidateCallback=e.postValidateCallback&&"function"==typeof e.postValidateCallback?e.postValidateCallback:_.noop},events:{"click .toggle-group-button":"handleConditionalMembershipChange","click .include-inactive-users":"handleInactiveUserFilterChange","click .is-scheduled-pool":"handleScheduledSync","click #sync-members-button":"handleConditionalMembershipSync","click #added-users-button":function(){this.handleUpdatedUsersShow("added")},"click #removed-users-button":function(){this.handleUpdatedUsersShow("removed")}},render:function(){const e=this.model.poolsData[this.model.selectedPoolId].attributes,t=new moment(e.Last_Membership_Saved_Date__c||e.Last_Saved_Date__c);this.createSoqlConditionCreatorInputs();const i=this.template({readOnly:this.readOnly,pool:e,conditionalMembershipEnabled:e.Is_Conditional_Membership_Enabled__c,includeInactiveUsers:this.includeInactiveUsers,isPoolScheduled:e.Is_Scheduled__c,showSyncResults:this.showSyncResults,lastMembershipSavedDate:t?t.tz(_LeanData.DateUtil.guessUserTimezone()).format("MM/DD/YYYY hh:mm A z"):null,addedMembersFromSync:this.addedMembersFromSync,removedMembersFromSync:this.removedMembersFromSync,getMemberName:this.model.getMemberName.bind(this.model),advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled});this.$el.html(i),this.renderConditionalMembershipTooltips(),this.renderConditionalMembershipToggle(),this.renderScheduledSyncSettings(),e.Is_Conditional_Membership_Enabled__c&&(_.defer(this.renderSoqlConditionCreator.bind(this)),this.renderSyncMembersButton(e.Soql_Condition__c))},renderConditionalMembershipTooltips:function(){ld_initializeToolTip(this.$el.find(".conditional-membership-tooltip.ld-tooltip-hint"),{title:"What is Conditional Membership?",body:"If you enable Conditional Membership, Pool Members will be added or removed based on the conditions set. Members added to the Pool prior to enabling conditional membership will remain as manual members. Queues are not supported in Conditional Membership.",fixedPosition:!0,fixedLeft:"185px"}),ld_initializeToolTip(this.$el.find(".conditional-changes-tooltip.ld-tooltip-hint"),{title:"View Conditional Membership Changes",body:"The users below will be added and/or removed from the Pool once you save. Please confirm the membership changes before saving the Pool.",fixedPosition:!0,fixedLeft:"225px"}),ld_initializeToolTip(this.$el.find(".scheduled-conditional-tooltip.ld-tooltip-hint"),{title:"Scheduled Sync Settings",body:"Enable this setting to apply specified frequency to this Conditional Pool and notify recipients via email of sync results. Scheduled sync frequency and email notification settings can be configured under Round Robin Settings.",fixedPosition:!0,fixedLeft:"135px"})},renderConditionalMembershipToggle:function(){const e=this.model.poolsData[this.model.selectedPoolId].attributes.Is_Conditional_Membership_Enabled__c;this.$el.find(".toggle-group-button").removeClass("active"),this.$el.find(`.toggle-group-button[data-type="${e?"on":"off"}"]`).addClass("active")},renderScheduledSyncSettings:function(){_LeanData.RemotingRouter.fetchCondtionalPoolsJobSetting().then(e=>{const t=_LeanData.Util.cronToFrequency(e.cron);let i=_LeanData.Util.cronToFrequencyString(e.cron);if("hourly"!==t.timeUnit){i+=` ${_LeanData.DateUtil.getShortFormattedTimezone(_LeanData._getOrganizationData().integrationUserTimeZone)}`}this.$el.find("#sync-frequency-string").text(i),this.$el.find("#conditional-sync-notification-icon").prop("title",e.notifications)})},renderSoqlConditionCreator:function(){const e=this.$el.find("ld-soql-condition-creator-angular");if(e.length>0&&e[0].ngElementStrategy.componentRef){const t=this.model.poolsData[this.model.selectedPoolId].attributes,i=e[0].ngElementStrategy;i.setInputValue("soqlCondition",this.soqlConditionCreatorInputs.soqlCondition),i.setInputValue("soqlBuilderConditions",this.soqlConditionCreatorInputs.soqlBuilderConditions),i.setInputValue("selectedSObjectType",this.soqlConditionCreatorInputs.selectedSObjectType),i.setInputValue("freeformEditingEnabled",this.soqlConditionCreatorInputs.freeformEditingEnabled),i.setInputValue("freeformSoqlPlaceholderText",this.soqlConditionCreatorInputs.freeformSoqlPlaceholderText),i.setInputValue("soqlButtonTexts",this.soqlConditionCreatorInputs.soqlButtonTexts),i.setInputValue("modalDescriptionText",this.soqlConditionCreatorInputs.modalDescriptionText),i.setInputValue("modalButtonTexts",this.soqlConditionCreatorInputs.modalButtonTexts),i.setInputValue("isCompacted",this.soqlConditionCreatorInputs.isCompacted),i.setInputValue("disabled",this.soqlConditionCreatorInputs.disabled||this.readOnly),i.setInputValue("zIndex",1150),i.getInputValue("onSwitch").subscribe(e=>{i.setInputValue("freeformEditingEnabled",e),this.soqlConditionCreatorInputs.freeformEditingEnabled=e}),i.getInputValue("onInput").subscribe(e=>{i.setInputValue("soqlCondition",e.soqlCondition),this.soqlConditionCreatorInputs.soqlCondition=e.soqlCondition,t.Soql_Condition__c=e.soqlCondition}),i.getInputValue("onModalOpen").subscribe(()=>{_.defer(()=>{const e=$(".round-robin-modal .modal-content-section").outerHeight(!0);$("ld-conditions-list > div").css("height",e-45)})}),i.getInputValue("onModalConfirm").subscribe(e=>{this.soqlConditionCreatorInputs.soqlCondition=e.soqlCondition,this.soqlConditionCreatorInputs.soqlBuilderConditions=e.soqlBuilderConditions;const i=JSON.parse(t.Pool_Settings__c||null)||{};i.soqlBuilderConditions=e.soqlBuilderConditions,t.Soql_Condition__c=e.soqlCondition,t.Pool_Settings__c=JSON.stringify(i),this.handleConditionalMembershipSync()}),i.getInputValue("onValidate").subscribe(e=>{if(e.isValidating)return this.soqlConditionValid=!1,this.renderSyncMembersButton(this.soqlConditionValid),void this.postValidateCallback(e);this.soqlConditionValid=!e.validationMessage,this.renderSyncMembersButton(this.soqlConditionValid),this.postValidateCallback(e)}),i.detectChanges()}},renderSyncMembersButton:function(e){$syncMembersButton=this.$el.find("#sync-members-button"),this.model.advancedRRFeaturesEnabled&&e?e&&$syncMembersButton.attr("disabled",!1):($syncMembersButton.toggleClass("lds-tertiary-x-small-button",!0),$syncMembersButton.attr("disabled",!0))},handleConditionalMembershipChange:function(){const e=this.model.poolsData[this.model.selectedPoolId].attributes;if(e.Is_Conditional_Membership_Enabled__c){new Magellan.Views.ConfirmationModal({header:"Disable Conditional Membership",message:'By disabling conditional membership, your pool\'s conditions will be lost and all existing conditional members will convert to <span class="italic">Manual</span> membership.<br /><br />Are you sure you want to disable conditional membership?',primaryButtonText:"Yes, Disable Conditional Membership",innerModal:!0,onConfirmed:()=>{this.changeConditionalMembership(e)}}).open()}else{if(e.Weighting_Enabled__c){return void new Magellan.Views.ConfirmationModal({header:"Turn Off Weighting to Continue",message:"Weighted Distribution is not supported with Conditional Membership.<br /><br />Please disable Weighted Distribution (uncheck the box) to proceed with Conditional Membership. Your weighting settings will not be saved.",primaryButtonText:"OK, Got it!",hideSecondaryButton:!0,innerModal:!0}).open()}this.changeConditionalMembership(e)}},handleInactiveUserFilterChange:function(e){this.includeInactiveUsers=this.$el.find(e.target).prop("checked")},handleScheduledSync:function(e){this.isPoolScheduled=this.$el.find(e.target).prop("checked"),this.model.poolsData[this.model.selectedPoolId].attributes.Is_Scheduled__c=this.isPoolScheduled},handleConditionalMembershipSync:function(e){e.preventDefault(),this.model.showModalOverlay("Syncing Pool Membership"),this.model.syncPool(this.model.selectedPoolId,{includeInactiveUsers:this.includeInactiveUsers}).catch(e=>{if(!e.includes("LIMIT_ERROR"))return e;_LeanData.Notification.showConfirmationDialog(_LeanData._app.POOL_LIMIT_MODAL_OPTIONS)}).finally(()=>{this.postSyncCallback(),this.model.hideModalOverlay("loading",!1)})},handleUpdatedUsersShow:function(e){const t=this.$el.find(`#${e}-users-button`),i=this.$el.find(`.${e}-users-list`);t.hasClass("open")?(t.removeClass("open"),i.css("display","none")):(t.addClass("open"),i.css("display","block"))},changeConditionalMembership(e){const t=e.Is_Conditional_Membership_Enabled__c?"Loading Manual Membership Experience":"Loading Conditional Membership Experience";this.model.showModalOverlay(t);let i=!1;if(!e.Is_Conditional_Membership_Enabled__c){let e=0;try{e=Number(window.localStorage.getItem("RR - Membership Types Modal"))}catch(e){console.warn("Can't read localStorage for modal display: ",e)}e<1&&(i=!0,this.model.showModalOverlay(null,"disabled",!1))}setTimeout(()=>{this.model.toggleConditionalMembership(this.model.selectedPoolId),this.createSoqlConditionCreatorInputs(),e.Is_Conditional_Membership_Enabled__c||this.updateSyncedUsersList(!1),this.model.hideModalOverlay("loading",!e.Is_Conditional_Membership_Enabled__c),i&&this.showMembershipTypesModal()},1500)},showMembershipTypesModal:function(){const e=$(".manual-col, .conditional-col");e.css({color:"black","font-weight":"var(--bold)"}),_LeanData.Notification.showConfirmationDialog({classes:"membership-types-modal",header:"Manual & Conditional Members",message:'With Conditional Membership enabled, there are two types of pool members:<br /><br /><div class="semi-bold">Manual</div>Members added manually remain in the Pool until you manually remove them. <span class="italic">These members are not affected by membership conditions.</span><br /><br /><div class="semi-bold">Conditional</div>Members added to the pool if they met the Pool\'s conditions at the last sync time. <span class="italic">Conditional membership will update when you click \'Sync Membership\'.</span><br /><br />If new members meet the conditions, they will be added to the pool. If existing conditional members no longer meet the conditions, they will be removed from the pool.',showConfirmButton:!1,cancelButtonText:"OK, got it!",onCancel:()=>{$("p-confirmdialog").insertBefore(".angela-main-content > p-messages"),e.css({color:"","font-weight":""}),this.model.hideModalOverlay("disabled",!1),window.localStorage.setItem("RR - Membership Types Modal",1)}}),_.defer(()=>{$(".p-widget-overlay.p-dialog-mask").css("display","none")}),$("p-confirmdialog").appendTo(".round-robin-modal .modal-dialog")},createSoqlConditionCreatorInputs:function(){const e=this.model.poolsData[this.model.selectedPoolId].attributes;if(!e.Is_Conditional_Membership_Enabled__c)return void(this.soqlConditionCreatorInputs=null);this.soqlConditionCreatorInputs={};const t=JSON.parse(e.Pool_Settings__c||null)||{};this.soqlConditionCreatorInputs.soqlCondition=e.Soql_Condition__c||"",this.soqlConditionCreatorInputs.soqlBuilderConditions=t.soqlBuilderConditions,this.soqlConditionCreatorInputs.selectedSObjectType="User",this.soqlConditionCreatorInputs.freeformEditingEnabled=e.Soql_Condition__c&&!t.soqlBuilderConditions,this.soqlConditionCreatorInputs.freeformSoqlPlaceholderText="Enter SOQL String\nSample Format: Country = 'United States' and Profile.Name = 'Sales Manager'",this.soqlConditionCreatorInputs.soqlButtonTexts={create:"Create Conditions",edit:"Edit Conditions"},this.soqlConditionCreatorInputs.modalDescriptionText="Create conditions to determine which users are included in this Round Robin Pool. Switch to Free-form to extend queries.",this.soqlConditionCreatorInputs.modalButtonTexts={create:"Apply Conditions",edit:"Apply Conditions",cancel:"Back"},this.soqlConditionCreatorInputs.isCompacted=!0,this.soqlConditionCreatorInputs.disabled=!this.model.advancedRRFeaturesEnabled},updateSyncedUsersList:function(e){const t=[],i=[];this.model.poolsData[this.model.selectedPoolId].members.forEach(e=>{"add"===e.attributes.conditionalStatus?t.push(e):"remove"===e.attributes.conditionalStatus&&i.push(e)}),this.addedMembersFromSync=t,this.removedMembersFromSync=i,this.showSyncResults=e,this.showSyncResults&&this.render()}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({userFilterMetaData:null,template:_.template(i(203)),initialize:function(e){this.showFilters=!0,this.model=e.model,this.isSelectAll=!0,this.disableDrag=e.disableDrag,this.debouncedSearch=_.debounce(e=>{this.model.updateUserList().then(()=>{this.render(),this.refreshDisabled()})},300)},events:{"click .user-to-add":"handleUserSelectionChange","click .user-card":"toggleUserCheckbox","click #add-users-button":function(e){return e.preventDefault(),this.addUsersToPool(!1)},"click .include-inactive-users":"toggleInactiveUserFilter","click .include-users-in-pool":"toggleUsersInPoolFilter","click .select-all":"selectAllUsers","click .show-filters":"toggleShowFilters","click .clear-search-filter-btn":"clearSearchFilter","input #search-filter-input":"handleSearchFilterInputKeyup"},render:function(){this.isSelectAll=!0;const e=this.template({users:this.model.filteredUserList,userFilterKey:this.model.userFilterKey,userFilterOption:this.model.userFilterOption,queryString:this.model.queryString,showFilters:this.showFilters,showUsersInPool:this.model.showUsersInPool,showPoolList:this.model.showPoolList,managerMode:this.model.managerMode,showTabs:!this.model.managerMode&&!this.model.showPoolList});if(this.$el.html(e),this.model.queryString&&this.model.queryString.length>0){let e=$(".search-users");e[0].selectionStart=this.model.queryString.length,e[0].selectionEnd=this.model.queryString.length,e.focus()}return this.$el.find(".user-list .user").hasClass("ui-draggable")&&$(this.$el.find(".user-list .user")).draggable("destroy"),this.disableDrag||$(this.$el.find(".user-list .user")).draggable({connectToSortable:".member-list",helper:"clone",revert:!0,revertDuration:0,start:function(e,t){$(t.helper).addClass("ui-helper")},stop:()=>{this.handleUserSelectionChange()}}),this.showFilters?$(".filters-container").show():$(".filters-container").hide(),this.$el.find(".user-filter-key-dropdown").html('<div style="height:30px">'),this.userFilterMetaData?initDropdowns.call(this):_LeanData.RemotingRouter.getUserFilterMetaData().then(e=>{this.userFilterMetaData=e,initDropdowns.call(this)}),this},toggleDraggable:function(e=!0){let t=e!==this.disableDrag;this.disableDrag=e,t&&this.render()},toggleShowFilters:function(e){this.showFilters=!this.showFilters,$(".show-filters").text((this.showFilters?"Hide":"Show")+" Filters"),this.showFilters?$(".filters-container").show():$(".filters-container").hide()},clearSearchFilter:function(e){$(".search-users").val(""),this.model.queryString=this.model.userFilterQueryString="",this.model.updateUserList().then(e=>{this.render(),this.refreshDisabled()})},handleUserSelectionChange:function(){let e=$(".user:not(.disabled) .user-to-add:checkbox:checked").length;$addUsersButton=$("#add-users-button"),$addUsersButton.attr("disabled",0===e);let t="";if(this.model.rrpModel)t="Add Users ("+e+")";else{t="Add "+(this.model.managerMode?"Managers":"Users")+(e>0?" ("+e+")"+(1===Object.keys(this.model.poolsData).length?"":" to Selected Pools ("+Object.keys(this.model.poolsData).length+")"):"")}$addUsersButton.text(t),this.isSelectAll=$(".user:not(.disabled) .user-to-add:checkbox:not(:checked)").length>0,$(".select-all").text(this.isSelectAll?"Select All":"Deselect All");let i=this.$el.find(".user-list .user:not(.hidden)").length>0;$(".select-all").toggleClass("disabled",!i),$(".no-users-message").toggleClass("hidden",i)},toggleUserCheckbox:function(e){$checkbox=$(e.currentTarget).find(".user-to-add"),$checkbox.prop("checked",!$checkbox.prop("checked")),this.handleUserSelectionChange()},selectAllUsers:function(){this.isSelectAll?$(".user:not(.disabled) .user-to-add").prop("checked",!0):$(".user-to-add").prop("checked",!1),this.handleUserSelectionChange()},addUsersToPool:function(){const e=[],t=this;$(".user-to-add:checkbox:checked").each(function(i){t.$el.find('li.user[data-id="'+$(this).data("id")+'"]').hasClass("disabled")||e.push($(this).data("id"))}),!this.model.managerMode&&this.model.poolsData[this.model.selectedPoolId].members.length+e.length>_LeanData._app.POOL_MEMBER_LIMIT?_LeanData.Notification.showConfirmationDialog(_LeanData._app.POOL_LIMIT_MODAL_OPTIONS):(this.model.get("memberListView").bulkAddMembers(e,this.model.userFilterKey,!1),this.model.showPoolList&&this.model.get("poolListView").generatePoolsList(),$(".user-to-add").prop("checked",!1),this.refreshDisabled(),this.handleUserSelectionChange())},refreshDisabled:function(){if(this.$el.find("li.user").toggleClass("disabled",!1).toggleClass("hidden",!1),this.model.poolsData)if(this.model.managerMode)for(let e of this.model.poolIdToManagerIds[this.model.selectedPoolId])this.$el.find(`li.user[data-id="${e}"]`).toggleClass("disabled",!0).toggleClass("hidden",!this.model.showUsersInPool);else if("Queues"===this.model.userFilterKey)Object.values(this.model.idToOwner).forEach(e=>{if("Queue"!==e.Type)return;const t=e;let i=!0;t.QueueSobjects&&Object.values(this.model.poolsData).forEach(e=>{!e.members.some(e=>e.attributes.OwnerId__c===t.Id)&&this.model.isValidQueue(t.Id,e.attributes.Id)&&(i=!1)}),i&&this.$el.find('li.user[data-id="'+t.Id+'"]').toggleClass("disabled",!0).toggleClass("hidden",!this.model.showUsersInPool)});else{const e=Object.keys(this.model.poolsData).length;let t={};Object.values(this.model.poolsData).forEach(i=>{i.members.forEach(i=>{if("remove"===i.attributes.conditionalStatus)return;let a=i.attributes.OwnerId__c;t.hasOwnProperty(a)?t[a]=t[a]+1:t[a]=1,t[a]===e&&this.$el.find('li.user[data-id="'+a+'"]').toggleClass("disabled",!0).toggleClass("hidden",!this.model.showUsersInPool)})})}},toggleInactiveUserFilter:function(e){this.model.userFilterOption=$(e.target).prop("checked")?"showInactive":null,this.debouncedSearch()},toggleUsersInPoolFilter:function(e){this.model.showUsersInPool=$(e.target).prop("checked"),this.debouncedSearch()},handleSearchFilterInputKeyup:function(e){const t=$(e.target).val();this.model.queryString=this.model.userFilterQueryString=t,this.debouncedSearch()}});function initDropdowns(){let e="Role"===this.model.userFilterKey?_LeanData.FlowBuilderController.searchUserRoles:_LeanData.FlowBuilderController.searchProfiles;this.userFilterValueTypeahead&&this.userFilterValueTypeahead.remove(),this.userFilterValueTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,placeholder:"Select "+this.model.userFilterKey,asyncServiceCall:e,onSelect:(e,t)=>{this.model.userFilterValue=t[0],this.debouncedSearch()}}),this.model.userFilterValue&&this.userFilterValueTypeahead.setSelection([this.model.userFilterValue]),this.$el.find(".user-filter-value-typeahead").html(this.userFilterValueTypeahead.$el);let t=this;const i=["Users","Profile","Role"];let a=!0;this.model.poolsData&&(this.model.selectedObjectType=this.model.poolsData[this.model.selectedPoolId].attributes.Object_Type__c,a=_LeanData.FBUtil.isObjectTypeQueueOwnable(this.model.selectedObjectType)),this.model.managerMode&&(a=!1),a&&i.splice(1,0,"Queues");const n=new Magellan.Views.LDDropdown({placeholder:"Users",value:this.model.userFilterKey,options:i,size:"small",optionTemplate:function(e){return _.template("<span><%-option%></span>")({option:e})},onChange:function(e){if(t.model.userFilterQueryString="","Users"===e)return t.model.userFilterKey=null,void t.debouncedSearch();if("Queues"===e)return t.model.userFilterKey="Queues",void t.debouncedSearch();if(_.isNull(e))return;t.userFilterMetaData[{Role:"userRoles",Profile:"profiles",Queues:"queues"}[e]];t.model.userFilterKey=e,t.model.userFilterValue=void 0,t.render()}});n.validate(),this.$el.find(".user-filter-key-dropdown").html(n.$el)}}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(204)),initialize:function(e){this.model=e.model,this.showConditionallyRemovedMembers=!0,this.convertingMembers=new Set,this.hideHeader=e.hideHeader,this.iconViewboxMap={"next-up":"0 0 33 20","next-up-after-credits":"0 0 28.41 13.92","lrt-next-up":"0 0 27.62 21.95","lrt-next-after":"0 0 27.62 27.12","last-routed-to":"0 0 29.04 13.82"},this.$el.find(".weighted-distribution-checkbox").prop("checked",this.model.hasOwnProperty("Weighting_Enabled__c")),this.onMemberAddCallback="function"==typeof e.onMemberAddCallback?e.onMemberAddCallback:_.noop,this.postDeleteCallBack="function"==typeof e.postDeleteCallBack?e.postDeleteCallBack:_.noop},events:{"click .reset-weights-button":"handleResetWeightsButtonClick","change .weighted-distribution-checkbox":"handleWeightedDistributionCheckboxChange","change .show-conditionally-removed-members-checkbox":"handleShowCondtionallyRemovedMembersCheckboxChange","click .delete-member-card-button":"handleDeleteButtonClick","click .convert-to-manual-button":"handleConvertToManualButtonClick"},handleResetWeightsButtonClick:function(e){new Magellan.Views.ConfirmationModal({header:"Confirm Weighting Reset",message:"Are you sure you want to reset this pool's weighting?",footer:"This will reset all of this pool's users' weighted distributions to 1.",innerModal:!0,hasExtraContent:!0,onConfirmed:function(){const e=this.model.poolsData[this.model.selectedPoolId].members;_.each(e,e=>{e.attributes.Weighting_Value__c=1}),this.renderWeightings()}.bind(this)}).open()},handleWeightedDistributionCheckboxChange:function(e){const t=$(e.target).is(":checked"),i=this.model.poolsData[this.model.selectedPoolId].attributes;if("NewPool"===this.model.selectedPoolId||"count-based"===_.get(i,"Distribution_Type__c"))return this.model.resetPoolAfterWeightingChange(t),void this.render();const a=t?"Enable":"Disable",n=this.model.getWeightingToggleText();new Magellan.Views.ConfirmationModal({header:a+" Round Robin Weighting",warningText:"Warning: Routing Distribution will Reset",message:n,footer:"Are you sure you want to "+a.toLowerCase()+" weighting?",innerModal:!0,onConfirmed:function(){this.model.resetPoolAfterWeightingChange(t),this.render()}.bind(this),onCancelled:function(){$(e.target).prop("checked",!t)}.bind(this)}).open()},handleShowCondtionallyRemovedMembersCheckboxChange:function(e){const t=$(e.target).is(":checked");this.showConditionallyRemovedMembers=t,this.render()},handleDeleteButtonClick:function(e){const t=$(e.currentTarget).closest(".member").data("ownerId");this.model.managerMode?this.model.removeManager(t):this.model.removeMember(t),this.model.updateUserList().then(e=>{const t=this.model.get("userListView").manualView;t.render(),t.handleUserSelectionChange()}),this.model.get("poolListView")&&this.model.get("poolListView").generatePoolsList();let i=this.model.get("userListView").conditionalView;i&&i.showSyncResults&&i.updateSyncedUsersList(i.showSyncResults),i.updateSyncedUsersList,this.renderAndPreserveScrollPosition(),this.postDeleteCallBack(e)},handleConvertToManualButtonClick:function(e){e.preventDefault();const t=$(e.currentTarget).closest(".member").data("ownerId");this.convertingMembers.add(t),this.model.convertConditionalMemberToManual(t),this.renderAndPreserveScrollPosition(),setTimeout(()=>{this.convertingMembers.delete(t),this.model.get("userListView").manualView.refreshDisabled(),$(`li.member[data-owner-id="${t}"] .converting-member`).remove()},1e3)},addMembersToPool:function(e,t,i,a){let n=this.model.poolsData[e];if(this.model.managerMode)for(let i of t)this.model.addNewManagerToManagersList(e,i);else{let o=n.members;t.forEach(t=>{if("Queues"!==i||this.model.isValidQueue(t.OwnerId__c||t,e))if(_.isObject(t))this.model.addNewMemberToMembersList(o,t,null,a);else{const e=o.filter(e=>e.attributes.OwnerId__c===t)[0];e?"remove"===e.attributes.conditionalStatus&&this.model.convertConditionalMemberToManual(e):this.model.addNewMemberToMembersList(o,t,null,a)}}),n.members=o,this.model.updatePoolConditionalMembersCount(e),this.onMemberAddCallback(n)}},bulkAddMembers:function(e,t,i){Object.keys(this.model.poolsData).forEach(a=>{this.model.poolsData[a];this.addMembersToPool(a,e,t,i)}),this.render()},getIcon:function(e){return e?e.toLowerCase().replace(/ /g,"-")+"-indicator":""},getIconViewbox:function(e){return this.iconViewboxMap[e.toLowerCase().replace(/ /g,"-")]||"0 0 0 0"},getIconHTMLForProduct(e,t){const i={"BookIt for Forms":_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BOOKIT"),"BookIt Handoff":_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BOOKIT_HANDOFF"),"BookIt Links":_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BOOKIT_LINKS")};return`<div class="${{"BookIt for Forms":"bookit-forms","BookIt Handoff":"bookit-handoff","BookIt Links":"bookit-links"}[e]}-icon product-icon ${t&&i[e]?"":"hidden"}" title="Live in ${e}"></div>`},getMemberToCreditsCount:function(e){const t={};for(let i of e){const e=i.Id;e in t||(t[e]=0),t[e]++}return t},render:function(){const e=this.model.poolsData[this.model.selectedPoolId],t=e.attributes;let i=e.members;if(this.model.managerMode){i=[];for(let t of e.managerIds)i.push(e.managers[t]);i.sort((e,t)=>e.Name.localeCompare(t.Name))}else this.model.populateMemberStatuses(i);if(this.model.managerMode){const e=this.template({hideHeader:this.hideHeader,isCalendaring:this.model.isCalendaringRRPage,poolName:_.get(t,"Grouping_Name__c",""),Is_Conditional_Membership_Enabled__c:_.get(t,"Is_Conditional_Membership_Enabled__c"),selectedPoolId:this.model.selectedPoolId,members:i,isCountBased:"count-based"===_.get(t,"Distribution_Type__c"),managerMode:this.model.managerMode,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled});this.$el.html(e),$(this.$el.find(".member-list")).sortable({placeholder:"member-sort-placeholder",handle:"",start:(e,t)=>{t.item.startPos=t.item.index()},over:(e,t)=>{this.$el.find(".empty-placeholder").hide()},out:(e,t)=>{this.$el.find(".empty-placeholder").show()},stop:(e,t)=>{if(this.$el.find(".empty-placeholder").remove(),$(t.item).hasClass("member")){const e=t.item.startPos,a=t.item.index(),n=i.splice(e,1)[0];i.splice(a,0,n)}this.render()},receive:(e,t)=>{const a=t.helper.data("id");_.some(i,e=>e.Id===a)||(this.model.addNewManagerToManagersList(this.model.selectedPoolId,a),this.render(),this.model.get("userListView").manualView.refreshDisabled(),this.model.get("poolListView")&&this.model.get("poolListView").generatePoolsList())}}),this.$el.find(".member-list").hasClass("ui-droppable")&&$(this.$el.find(".member-list")).droppable("destroy"),$(this.$el.find(".member-list")).droppable({}),$("#pool-member-count").text(i.length)}else{const e=this.model.poolsData[this.model.selectedPoolId],t=e.attributes,i=e.members,a=t.creditBackQueue?t.creditBackQueue:t.Credit_Back_Queue__c?JSON.parse(t.Credit_Back_Queue__c):[],n=this.getMemberToCreditsCount(a),o=_.keyBy(i,"attributes.OwnerId__c"),l=a.filter(e=>null!=o[e.Id]).length,s=e.conditionalMembersCount.add+e.conditionalMembersCount.keep,r=e.members.length-(e.conditionalMembersCount.remove+s);this.model.populateMemberStatuses(i);const d=this.template({hideHeader:this.hideHeader,isCalendaring:this.model.isCalendaringRRPage,showPoolList:this.model.showPoolList,poolName:_.get(t,"Grouping_Name__c",""),selectedPoolId:this.model.selectedPoolId,members:i,showConditionallyRemovedMembers:this.showConditionallyRemovedMembers,numManual:r,numConditional:s,convertingMembers:this.convertingMembers,getOwnerById:this.model.getOwnerById.bind(this.model),groupsMap:this.model.groupsMap,Capping_Limit__c:_.get(t,"Capping_Limit__c"),Capping_Type__c:_.get(t,"Capping_Type__c"),Object_Type__c:_.get(t,"Object_Type__c"),nextOwnerId:_.get(t,"nextOwnerId"),Weighting_Enabled__c:_.get(t,"Weighting_Enabled__c"),Is_Conditional_Membership_Enabled__c:_.get(t,"Is_Conditional_Membership_Enabled__c"),isCountBased:"count-based"===_.get(t,"Distribution_Type__c"),bookitFeatures:_LeanData._app.BOOKIT_PRODUCT_FEATURES,getIcon:this.getIcon,getIconViewbox:this.getIconViewbox,getIconHTMLForProduct:this.getIconHTMLForProduct,iconViewboxMap:this.iconViewboxMap,managerMode:this.model.managerMode,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled,creditCount:l,memberToCreditsCount:n});this.$el.html(d),_.get(t,"Weighting_Enabled__c")||this.$el.find(".reset-weights-button").addClass("hidden"),this.renderCreditsTooltip(),_.get(t,"Is_Conditional_Membership_Enabled__c")&&this.renderConditionalMembershipTooltips(),this.model.advancedRRFeaturesEnabled||_.defer(this.renderMessageBadge.bind(this)),this.$el.find(".member-list").hasClass("ui-sortable")&&$(this.$el.find(".member-list")).sortable("destroy"),$(this.$el.find(".slider")).slider({value:1,min:0,max:2,step:.25,range:"min",slide:(e,t)=>{const a=$(e.target).closest(".member").data("ownerId"),n=_.find(i,e=>e.attributes.OwnerId__c===a);n&&(n.attributes.Weighting_Value__c=t.value),this.renderWeightings()},stop:(e,t)=>{this.renderWeightings()}}),this.$el.find(".parts input").change(e=>{const t=$(e.target).closest(".member").data("ownerId"),a=_.find(i,e=>e.attributes.OwnerId__c===t);let n=parseFloat($(e.target).val());_.isNaN(n)?n=1:n>2?n=2:n<0&&(n=0),a.attributes.Weighting_Value__c=n,this.renderWeightings()}),$(this.$el.find(".member-list")).sortable({placeholder:"member-sort-placeholder",handle:".drag-handle",start:(e,t)=>{t.item.startPos=t.item.index()},over:(e,t)=>{this.$el.find(".empty-placeholder").hide()},out:(e,t)=>{this.$el.find(".empty-placeholder").show()},stop:(e,t)=>{if(this.$el.find(".empty-placeholder").remove(),$(t.item).hasClass("member")){const e=t.item.startPos,a=t.item.index(),n=i.splice(e,1)[0];i.splice(a,0,n)}this.model.updateOriginalMemberToValidIndex(i),this.model.populateMemberStatuses(i),this.renderAndPreserveScrollPosition()},receive:(e,t)=>{const a=t.helper.index(),n=t.helper.data("id"),o=i.find(e=>e.attributes.OwnerId__c===n);o?"remove"===o.attributes.conditionalStatus&&(this.model.convertConditionalMemberToManual(o),this.model.get("userListView").manualView.refreshDisabled()):(this.model.addNewMemberToMembersList(i,n,a),this.render(),this.model.get("userListView").manualView.refreshDisabled(),this.model.get("poolListView")&&this.model.get("poolListView").generatePoolsList(),this.onMemberAddCallback(this.model.poolsData[this.model.selectedPoolId]))}}),this.$el.find(".member-list").hasClass("ui-droppable")&&$(this.$el.find(".member-list")).droppable("destroy"),$(this.$el.find(".member-list")).droppable({});const c=this.model.advancedRRFeaturesEnabled&&t.Weighting_Enabled__c;this.$el.find(".weighting").toggleClass("disabled",!c),c?($(this.$el.find(".weighting .slider")).slider("enable"),this.$el.find(".weighting .parts input").removeAttr("disabled")):(this.$el.find(".weighting .parts input").prop("disabled","disabled"),$(this.$el.find(".weighting .slider")).slider("disable")),this.renderWeightings(),$("#pool-member-count").text(i.length-e.conditionalMembersCount.remove)}return this},renderAndPreserveScrollPosition:function(){const e=this.$el.find(".members-container").scrollTop();this.render(),this.$el.find(".members-container").scrollTop(e)},renderCreditsTooltip:function(){const e=this.$el.find(".credits-col-tooltip.ld-tooltip-hint");e&&ld_initializeToolTip(e,{title:"<span>Members with Credits</span>",body:"<p>If a credit is added for a Member, Pool Members with credits will be routed a record before routing resumes via the Pool order. The default order in which Members with credits will be routed is first in, first out. You may remove credits for Members or modify this order under the Manage Credits modal.</p>",fixedPosition:!0,fixedLeft:"245px"})},renderConditionalMembershipTooltips:function(){if(this.model.poolsData[this.model.selectedPoolId].attributes.Is_Conditional_Membership_Enabled__c&&(ld_initializeToolTip(this.$el.find(".manual-col-tooltip.ld-tooltip-hint"),{title:"Manual Members",body:'Members added manually will remain in the Pool until they are removed. All members added before conditional membership was enabled will remain as manual members.<br /><br /><div class="semi-bold">Manual Member who meets Conditions</div>Manual members can also meet the conditions of the Pool. If you remove them as a Manual member, they will be re-added to the Pool as a Conditional member the next time you sync and save. To permanently remove them from the Pool, please add an exclusion condition with their user ID.<br /><br /><div class="italic">Example (Builder): User ID <span class="med-grey-1">not equal to</span> 00530000003xqAb</div><div class="italic">Example (Free-form): id != \'00530000003xqAb\'</div>',fixedPosition:!0,fixedLeft:"290px"}),ld_initializeToolTip(this.$el.find(".conditional-col-tooltip.ld-tooltip-hint"),{title:"Conditional Members",body:"Members added if they met the Pool's conditions at the last sync and saved. When you Sync Membership, the Pool membership will update based on the user's conditions.<br /><br />If new members meet the conditions, they will be added to the pool. If existing conditional members no longer meet the conditions, they will be removed from the pool.",fixedPosition:!0,fixedLeft:"395px"}),this.model.showPoolList)){const e=this.$el.find(".pool-condition-tooltip.ld-tooltip-hint");ld_initializeToolTip(e,{title:"Membership Conditions",body:this.model.poolsData[this.model.selectedPoolId].attributes.Soql_Condition__c,renderOnLeft:!0}),e.css({width:"auto",height:"auto",background:"none"}),e.children().css({top:"20px",right:"0px"})}},renderWeightings:function(){const e=this.model.poolsData[this.model.selectedPoolId],t=e.attributes.Weighting_Enabled__c,i=e?e.members:this.model.members;let a=0;i&&(a=_.reduce(i,function(e,t){return e+(_.isNumber(t.attributes.Weighting_Value__c)&&!_.isNaN(t.attributes.Weighting_Value__c)?t.attributes.Weighting_Value__c:1)},0)),i.forEach(e=>{let i=1;t&&_.isNumber(e.attributes.Weighting_Value__c)&&!_.isNaN(e.attributes.Weighting_Value__c)&&(i=e.attributes.Weighting_Value__c);const n=0===a?0:_.round(i/a*100,1),o=this.$el.find('.member[data-owner-id="'+e.attributes.OwnerId__c+'"]');o.find(".parts input").val(i),$(o.find(".slider")).slider("value",i),o.find(".percentage").html(n+"%")})},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Weighting",message:"Upgrade to adjust the distribution of records to users in the same pool. Route more records to seasoned Sales Reps and less records to Reps ramping up.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360016462273","_blank","noopener,noreferrer")},top:15,left:-430,type:"settings",size:"large"}},events:{}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(205)),initialize:function(e){this.model=e.model,this.tableCol=e.tableCol,this.poolIdToDropdownView={},this.isCalendaringRRPage=e.model.isCalendaringRRPage,this.filter=e.filter&&"function"==typeof e.filter?e.filter:null,this.WEIGHTED_TEMPLATE='<div class="weighted-indicator">Â·</div>',this.LAST_RECEIVED_FALLBACK="-",this.EXPECTED_NEXT_UP_FALLBACK="-",this.EXPECTED_NEXT_UP_UNAVAILABLE_WEIGHTED="<em>Unavailable for weighted</em>",this.EXPECTED_NEXT_UP_UNAVAILABLE_COUNTBASED="<em>Unavailable for Count-based</em>",this.DROPDOWN_NOT_SELECTABLE_WEIGHTED="<em>Not selectable for weighted</em>",this.DROPDOWN_NOT_SELECTABLE_COUNTBASED="<em>Not selectable for Count-based</em>",this.NO_MEMBERS_TO_SELECT="<em>No members in pool</em>"},initializeTableView:function(){const e=[];let t=this.model.poolsData;this.filter&&(t=this.filter(t));const i=e=>{let t=this.model.getOwnerById(e.attributes.OwnerId__c);return t?"Queue"!==t.Type&&!0!==t.IsActive?" (INACTIVE)":this.isCalendaringRRPage&&!e.attributes.isAuthorized?" (UNAUTHORIZED)":"":" (INVALID)"};_.each(t,(t,a)=>{const n=[];let o,l,s,r="",d="";const c=this.model.poolIdToNextUpData[a][0]||this.LAST_RECEIVED_FALLBACK;let h,p,u,m=[];r=t.attributes.Grouping_Name__c,l=t.attributes.Distribution_Type__c||"order-based",o=t.attributes.Weighting_Enabled__c,s="count-based"===t.attributes.Distribution_Type__c,d=o?this.WEIGHTED_TEMPLATE:"",u=0==t.members.filter(e=>"Unavailable"!==e.attributes.Status__c).length,m=t.members.map(e=>({id:e.attributes.OwnerId__c,name:this.model.getMemberName(e)+i(e),conditionalStatus:e.attributes.conditionalStatus}));const g=this.model.poolIdToNextUpData[a][1];h=o?this.EXPECTED_NEXT_UP_UNAVAILABLE_WEIGHTED:s?this.EXPECTED_NEXT_UP_UNAVAILABLE_COUNTBASED:`<span title="${_.escape(g)}">${_.escape(g)}</span>`||this.EXPECTED_NEXT_UP_FALLBACK;const f=`<div class="distribution-type">${_.capitalize(l)}</div>`;if(p=o?this.DROPDOWN_NOT_SELECTABLE_WEIGHTED:s?this.DROPDOWN_NOT_SELECTABLE_COUNTBASED:0===m.length?this.NO_MEMBERS_TO_SELECT:`<div class="member-dropdown-container" id="pool-${a}-members"></div>`,n.push(r,f,d,c,h,p),e.push(n),!o&&!s&&m.length>0){const e=!["undefined","null","NewPool"].includes(a)&&!u&&!this.model.poolIdToNextUpData[a][1];e||m.unshift({id:null,name:"No Change"}),this.poolIdToDropdownView[a]=new Magellan.Views.LDDropdown({required:e,value:null,options:m.filter(e=>"remove"!==e.conditionalStatus),placeholder:e?"Select a User - required":"Select one (optional)",alwaysEnableDropdown:!0,optionTemplate:e=>_.template("<span class=\"<%- !member.id ? 'italic' : member.name.includes('(UNAUTHORIZED)') ? 'ld-red' : '' %>\"><%- member.name %></span>")({member:e}),onChange:(e,t)=>{this.validateNextUpDropdowns()},datumTokenizer:e=>[...Bloodhound.tokenizers.nonword(e.name),...Bloodhound.tokenizers.whitespace(e.id)],queryTokenizer:e=>[...Bloodhound.tokenizers.nonword(e),...Bloodhound.tokenizers.whitespace(e)]})}}),this.tableView=new Magellan.Views.LDTable({columns:this.tableCol,data:e,isInlineEditorEnabled:!1,datatableOptions:{disableRowHover:!0,bFilter:!1,rowId:"Id",ordering:!1,columnDefs:[{targets:0,width:"155px",orderable:!1,render:e=>`<span title="${e=_.escape(e)}">${e}</span>`},{targets:1,width:"125px",orderable:!1},{targets:2,width:"125px",orderable:!1},{targets:3,width:"175px",orderable:!1,render:e=>`<span title="${e=_.escape(e)}">${e}</span>`},{targets:4,width:"175px",orderable:!1},{targets:5,width:"175px",orderable:!1,createdCell:e=>{$(e).css("overflow","visible")}}]}})},renderNextUpDropdowns:function(){_.each(this.poolIdToDropdownView,(e,t)=>{this.tableView.$el.find(`#pool-${t}-members`).html(e.render().$el)})},validateNextUpDropdowns:function(){let e=!0;_.each(this.poolIdToDropdownView,t=>{t.model.get("required")&&!t.val()&&(e=!1)}),this.model.set("hasValidNextUp",e)},render:function(){const e=this.template({isBookItPool:this.isCalendaringRRPage});let t,i;return this.$el.html(e),this.initializeTableView(),this.tableView.setElement(".next-up-table-container").render(),this.renderNextUpDropdowns(),this.validateNextUpDropdowns(),_.each(this.tableView.$el.find(".dataTables_scrollHead th"),e=>{if("Expected 'Next Up'"===e.innerText||"Select 'Next Up'"===e.innerText){const a=$(e);a.append('<div class="ld-tooltip-hint" style="margin-left:5px;"></div>');const n=a.find(".ld-tooltip-hint");"Expected 'Next Up'"===e.innerText?t=n:i=n}}),ld_initializeToolTip(t,{title:"Expected Next Up Member",body:"LeanData determines the expected Next Up user based on who received the last record in the live Pool. If there are changes in the Pool order due to deleted or reordered users, you must select a new Next Up user."}),ld_initializeToolTip(i,{title:"Select Next Up Member",body:'For Weighted Pools, LeanData does not show the Expected Next Up User or provide the ability to select one as previous distributions will make the determination.  Read more about Weighted Pools <a href="https://leandatahelp.zendesk.com/hc/en-us/articles/360016462273-Routing-Round-Robin-Overview" target="_blank">here</a>.',clickableContent:!0}),this}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(206)),initialize:function(e){this.model=e.model,this.isCalendaringRRPage=e.isCalendaringRRPage,this.poolSelectCallback=e.poolSelectCallback&&"function"==typeof e.poolSelectCallback?e.poolSelectCallback:_.noop,this.getConditionalTableHeader=e.getConditionalTableHeader&&"function"==typeof e.getConditionalTableHeader?e.getConditionalTableHeader:()=>null,this.isBulkSync=e.isBulkSync,this.postDeletePoolCallback=e.postDeletePoolCallback&&"function"==typeof e.postDeletePoolCallback?e.postDeletePoolCallback:_.noop()},events:{"click .pool-row":"selectPool","click .remove-pool-btn":"removeFromSelectedPools"},render:function(){var e=this.template({isBulkSync:this.isBulkSync,poolIds:this.model.poolIds||[],poolInvalidHeaderText:this.getConditionalTableHeader(),isCalendaringRRPage:this.isCalendaringRRPage,managerMode:this.model.managerMode});return this.$el.html(e),this.generatePoolsList(),this},generatePoolsList:function(){let e="";const t=this.model.managerMode;let i=Object.values(this.model.poolsData);(i=_.sortBy(i,["attributes.Object_Type__c","attributes.Grouping_Name__c"])).forEach(a=>{const n=[];n.push(`<div\n              data-pool-id="${a.attributes.Id}"\n              class="pool-row ${a.attributes.Id===this.model.selectedPoolId?"selected":""}"\n            >`),a.isLoading?n.push('<div class="pool-status-col"><ld-loading-spinner style="height:10px; width:10px;top: -2px;left: -1.25px; position: relative;"></ld-loading-spinner></div>'):a.isLoading||!a.updateStatus||a.updateStatus.status?n.push('<div class="pool-status-col"></div>'):n.push('<div class="pool-status-col"> <div class="warning-icon" style="height:10px;width:10px;"> </div> </div>');let o=_.capitalize(a.attributes.Distribution_Type__c||"order-based"),l=this.isCalendaringRRPage?o:a.attributes.Object_Type__c;n.push(`<div class="first-pools-col">${_.escape(_LeanData.Util.truncateText(a.attributes.Grouping_Name__c,40))}</div>\n          <div class="pools-col" title="${l}">${l}</div>`),n.push(`<div class="pools-col weighted-col bold">${a.attributes.Weighting_Enabled__c?"â€¢":""}</div>`);let s='<div class="flexbox-container center-y">';if(s+=a.members.length,a.attributes.Is_Conditional_Membership_Enabled__c&&a.attributes.Is_Scheduled__c?s+='<div class="conditional-pool-icon-wrapper">\n                                <svg class="conditional-pool-icon-small" viewbox="0 0 18 15">\n                                  <use href="#scheduled-sync-pool-icon"></use>\n                                </svg>\n                              </div>':a.attributes.Is_Conditional_Membership_Enabled__c&&(s+='<div class="conditional-pool-icon-wrapper">\n                                <svg class="conditional-pool-icon-small" viewbox="0 0 15 15">\n                                  <use href="#conditional-pool-icon"></use>\n                                </svg>\n                              </div>'),s+="</div>",this.isBulkSync){let e="",t=a.updateStatus&&a.updateStatus.errMessage;if(a.updateStatus)if(a.updateStatus.status){e=`${Object.keys(a.updateStatus.bulkAddList).length} added, ${Object.keys(a.updateStatus.bulkRemoveList).length} removed`}else{e=a.updateStatus.errMessage.includes("LIMIT_ERROR")?"Members Limit (500) Exceeded After Sync":"Invalid Conditions"}n.push(`<div class="pools-col">${a.isLoading?"":s}</div>\n            <div class="pools-col updates-col ${t?"error-message":""}">${e}</div>`)}else t?n.push(`<div class="pools-col">${a.managerIds.length}</div>\n            <div class="pools-col">${s}</div>\n            <div class="pools-col" style="text-transform:capitalize">${a.attributes.Pool_Type__c||"Standard"}</div>`):n.push(`<div class="pools-col">${s}</div>\n            <div class="pools-col" style="text-transform:capitalize">${a.attributes.Pool_Type__c||"Standard"}</div>\n            <div class="pools-col" style="text-align:center">${a.attributes.Respect_User_Schedules__c?"&bull;":""}</div>`);n.push(`<div class="last-pools-col">\n          ${i.length>1?'<div class="ld-cross-icon-grey-small remove-pool-btn" style="margin:auto"></div>':""}\n        </div>`),n.push("</div>"),e+=n.join("")}),this.$el.find(".pool-rows").html(e)},selectPool:function(e,t){this.poolSelectCallback(e,t),this.generatePoolsList(),$(".pool-name-header").text(this.model.poolsData[this.model.selectedPoolId].attributes.Grouping_Name__c)},removeFromSelectedPools:function(e){e.stopPropagation();let t=$(e.currentTarget).closest(".pool-row").data("pool-id");delete this.model.poolsData[t],this.model.poolIds=this.model.poolIds.filter(e=>e!==t),this.model.selectedPoolId==t&&this.selectPool(null,Object.keys(this.model.poolsData)[0]),this.generatePoolsList(),this.render(),this.postDeletePoolCallback&&this.postDeletePoolCallback(e)}})}},function(e,t,i){e.exports=function(){const e={};return e.Manual=i(142)(),e.Conditional=i(141)(),Backbone.View.extend({userFilterMetaData:null,template:_.template(i(207)),initialize:function(t){this.model=t.model,this.options=t,this.manualView=new e.Manual(t),this.conditionalView=new e.Conditional(t),this.defaultTab=t.defaultTab,this.currentTab=this.getDefaultTab(this.defaultTab),this.tabNameToViewMap={manual:this.manualView,conditional:this.conditionalView}},events:{"click .ld-tab":"handleTabClick"},render:function(){const e=this.template({showTabs:!this.model.managerMode&&!this.model.showPoolList,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled});this.$el.html(e),this.model.advancedRRFeaturesEnabled||_.defer(this.renderMessageBadge.bind(this)),this.$el.find(`.${this.currentTab}`).addClass("active"),this.switchView(this.tabNameToViewMap[this.currentTab],!1),this.renderUserListTooltips()},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Conditional Pools",message:"Upgrade to add Users to Pools based on User Attributes.",buttonText:"Learn more about Conditional Pools",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360016462273-Routing-Round-Robin-Overview","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},renderUserListTooltips:function(){let e="<ul>";this.model.enabledSalesforceLicenses.forEach(t=>{e+=`<li>${t}</li>`}),e+="</ul>",ld_initializeToolTip(this.$el.find(".enabled-licenses-tooltip.ld-tooltip-hint"),{title:"Which users are available as Pool Members?",body:`Users with the following Salesforce License(s) can be viewed and selected in the user list:<br /><br />${e}`,fixedPosition:!0,fixedLeft:this.model.showPoolList?"90px":"140px"})},getDefaultTab:function(e){return this.defaultTab?this.defaultTab:this.model.managerMode||this.model.showPoolList?"manual":this.model.poolsData[this.model.selectedPoolId].attributes.Is_Conditional_Membership_Enabled__c?"conditional":"manual"},handleTabClick:function(e){const t=this,i=$(e.target);i.siblings(".ld-tab").removeClass("active"),i.addClass("active");["manual","conditional"].forEach(function(e){i.hasClass(e)&&t.switchTab(e)})},switchTab:function(e){this.currentTab=e,this.$el.find("#tab-content").empty(),this.tabNameToViewMap[e]&&this.switchView(this.tabNameToViewMap[e],!0)},switchView:function(e,t){const i=this.$el.find("#tab-content");i.empty(),e.delegateEvents(),i.append(e.$el),t&&e===this.tabNameToViewMap.manual?this.model.updateUserList().then(t=>{e.render()}):e.render()}})}},function(e,t,i){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),i(148)(),Magellan.Views.RoundRobinPoolsCreatorTabs.AdvancedSettings=Backbone.View.extend({template:_.template(i(208)),initialize:function(e){this.appliedRulesetsToDetailsMap=e.appliedRulesetsToDetailsMap,this.cappingConfigurationList=e.cappingConfigurationList,this.filteredCappingConfigurationList=null,this.listenTo(this.model,"change:Capping_Type__c change:Capping_Limit__c change:Timezone__c change:appliedCappingRules",()=>this.model.validateSync()),this.listenTo(this.model,"updateCappingRule",this.updateCappingRule),this.listenTo(this.model,"deleteCappingRule",this.deleteCappingRule),this.listenTo(this.model,"clearAndReloadAvailableCappingRulesBasedOnObjectType",this.clearAndReloadAvailableCappingRulesBasedOnObjectType),this.listenTo(this.model,"change:validationErr change:showErrorMsg change:showConditionalErr",this.updateError),this.model.get("appliedCappingRules")||this.clearAndReloadAvailableCappingRulesBasedOnObjectType()},events:{"click .ld-tab":"handleTabClick","change input[name=capping]":"handleCappingTypeChange","change input[name=time-based-capping]":"handleTimeBasedCappingChange","change .cap-limit-input":"handleCapLimitChange"},handleTimezoneChange:function(e,t){this.model.set({Timezone__c:t.selection[0].id}),this.renderCappingSettings()},handleCapLimitChange:function(e){var t=$(e.target).val();this.model.set("Capping_Limit__c",parseInt(t)),this.renderCappingSettings()},handleCappingTypeChange:function(e){var t=$(e.target).val();t=["conditional","time-based"].includes(t)?t:null,this.model.set("Capping_Type__c",t),t||this.deleteCappingRule(),this.render()},turnOffCappingAndDisableConditionalCapping:function(){$("#conditional-capping-section").css("pointer-events","none"),$("#conditional-capping-section").css("opacity","0.5"),$("#conditional-capping-tooltip").css("display","block")},handleTimeBasedCappingChange:function(e){var t=$(e.target).val();t=["hourly","daily","weekly"].includes(t)?t:null;var i=this.model.originalAttributes.Capping_Type__c,a=t=>{this.$el.find(".capping-section").removeClass("selected"),$(e.target).parents(".capping-section").addClass("selected"),this.model.set("Capping_Type__c",t),this.model.trigger("change"),this.renderCappingSettings()};if(_.isEmpty(i)||"none"===i||i===t)return a(t);_LeanData.Notification.showConfirmationDialog({header:"Confirm Capping Change",message:"Are you sure you want to change the capping model?<br><br>This will reset capping for all members.",confirmButtonText:"Confirm",onConfirm:()=>{a(t),this.model.get("memberList").forEach(e=>{e.Current_Cap_Value__c=0})},onCancel:()=>{var e=null===this.model.get("Capping_Type__c")?"none":this.model.get("Capping_Type__c");this.$el.find('input[name="time-based-capping"][value="'+e+'"]').prop("checked",!0)}})},updateError(){const e=this.model.get("validationErr"),t=this.model.get("showErrorMsg");this.$el.find(".rrp-error-msg").text(""),this.$el.find(".cap-limit-input, .tt-input").toggleClass("lds-field-invalid",!1),this.$el.find(".timezone").toggleClass("cap-tz-err",!1),this.$el.find(".cap-limit").toggleClass("cap-limit-input-err",!1),t&&(this.$el.find(".time-based-wrapper .rrp-error-msg").text(e.timeBased),e.cappingLimit?this.$el.find(".cap-limit-input-wrapper .rrp-error-msg").text(e.cappingLimit):e.cappingMin&&this.$el.find(".cap-limit-input-wrapper .rrp-error-msg").text(e.cappingMin),this.$el.find(".cap-limit").toggleClass("cap-limit-input-err",!(!e.cappingLimit&&!e.cappingMin)),this.$el.find(".cap-limit-input").toggleClass("lds-field-invalid",!(!e.cappingLimit&&!e.cappingMin)),this.$el.find(".timezone-dropdown-wrapper .rrp-error-msg").text(e.timezone),this.$el.find(".timezone").toggleClass("cap-tz-err",!!e.timezone),this.$el.find(".capping-timezone-dropdown .tt-input").toggleClass("input-invalid",!!e.timezone),e.duplicateRules?this.$el.find("#conditional-capping-section .rrp-error-msg").text(e.duplicateRules):e.noRule&&this.$el.find("#conditional-capping-section .rrp-error-msg").text(e.noRule))},render:function(){var e=this.template({Capping_Type__c:this.model.get("Capping_Type__c"),Capping_Limit__c:this.model.get("Capping_Limit__c"),isCalendaringRRPage:this.model.isCalendaringRRPage,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled});return this.$el.html(e),"live"!==this.model.get("Pool_Type__c")&&"api"!==this.model.get("Pool_Type__c")||this.turnOffCappingAndDisableConditionalCapping(),function initTooltips(){var e=this.model.isCalendaringRRPage?"Setting a cap on this pool will limit each Member to a certain number of records based on a time interval (Time-Based Capping). The cap number entered here will apply to all Members in this pool.":"Setting a cap on this pool will limit each Member to a certain number of records based on a set of conditions (Conditional Capping) or a time interval (Time-Based Capping). The cap number entered here will apply to all Members in this pool. \n\nFor Conditional Capping, the cap will be relaxed for a user when the amount of records they own (that meet the condition in the ruleset), is less than the Capping Amount. For Time-Based Capping, the capping limit will reset on the time interval you select (daily, weekly).";ld_initializeToolTip(this.$el.find(".capping.ld-tooltip-hint"),{title:"Capping",body:e}),ld_initializeToolTip($("#conditional-capping-tooltip"),{title:"Your Pool Settings are Incompatible with Conditional Capping",body:"Conditional Capping cannot be applied to API or Live Routing Pools. To enable Conditional Capping, create or copy this Pool and select the Standard Pool Type."})}.call(this),function initTimezoneDropdown(){var e=this,t=(this.model.get("Timezone__c"),_LeanData.DateUtil.guessUserTimezone(),function(){return _LeanData.DateUtil.createTimezoneTypeahead(e.model.get("Timezone__c"))});this.hourlyTimezoneDropdown&&this.hourlyTimezoneDropdown.remove();this.hourlyTimezoneDropdown=t(),this.hourlyTimezoneDropdown.validate(),this.$el.find(".hourly-timezone-dropdown").html(this.hourlyTimezoneDropdown.$el),this.hourlyTimezoneDropdown.$el.on("nestedTypeaheadSelector:select",this.handleTimezoneChange.bind(this)),this.dailyTimezoneDropdown&&this.dailyTimezoneDropdown.remove();this.dailyTimezoneDropdown=t(),this.dailyTimezoneDropdown.validate(),this.$el.find(".daily-timezone-dropdown").html(this.dailyTimezoneDropdown.$el),this.dailyTimezoneDropdown.$el.on("nestedTypeaheadSelector:select",this.handleTimezoneChange.bind(this)),this.weeklyTimezoneDropdown&&this.weeklyTimezoneDropdown.remove();this.weeklyTimezoneDropdown=t(),this.weeklyTimezoneDropdown.validate(),this.$el.find(".weekly-timezone-dropdown").html(this.weeklyTimezoneDropdown.$el),this.weeklyTimezoneDropdown.$el.on("nestedTypeaheadSelector:select",this.handleTimezoneChange.bind(this))}.call(this),this.renderCappingSettings(),this.model.isCalendaringRRPage||this.renderConditionalCappingTable(),this.model.advancedRRFeaturesEnabled||_.defer(this.renderMessageBadge.bind(this)),this.updateError(),this},renderCappingSettings:function(){var e;this.$el.find(".cap-limit-input").val(this.model.get("Capping_Limit__c"));var t=this.model.get("Timezone__c")?[_LeanData.DateUtil.getTimezonesMap()[this.model.get("Timezone__c")]]:[];[this.hourlyTimezoneDropdown,this.dailyTimezoneDropdown,this.weeklyTimezoneDropdown].forEach(function(e){e.model.set("value",this.model.get("Timezone__c")),e.setSelection(t)}.bind(this)),e=!_.isEmpty(this.model.get("Working_Hours__c")),$(".hourly-timezone-dropdown .nested-typeahead-selector, .daily-timezone-dropdown .nested-typeahead-selector, .weekly-timezone-dropdown .nested-typeahead-selector").toggleClass("disabled",e)},renderConditionalCappingTable:function(){this.ConditionalCappingRulesTable=new Magellan.Views.ConditionalCappingRulesTable({model:this.model,masterList:null===this.filteredCappingConfigurationList&&null!==this.model.get("Object_Type__c")?this.cappingConfigurationList:this.filteredCappingConfigurationList,appliedRulesetsToDetailsMap:this.appliedRulesetsToDetailsMap}),this.$el.find("#conditional-capping-table-wrapper").html(this.ConditionalCappingRulesTable.$el)},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Capping Models",message:"Upgrade to cap distribution based on rep capacity or time.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/4410982790171-Routing-Capping-Guide","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}},events:{}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},updateCappingRule:function(e,t){t>=0?this.appliedRulesetsToDetailsMap[t]=e:-1===t&&e["config id"]&&this.appliedRulesetsToDetailsMap.push(e),this.ConditionalCappingRulesTable.refreshCapping(),this.model.set("appliedCappingRules",this.appliedRulesetsToDetailsMap),this.model.trigger("change")},deleteCappingRule:function(e){_.isNumber(e)?this.appliedRulesetsToDetailsMap.splice(e,1):(this.appliedRulesetsToDetailsMap=[],this.renderConditionalCappingTable()),this.ConditionalCappingRulesTable.refreshCapping(),this.model.set("appliedCappingRules",this.appliedRulesetsToDetailsMap),this.model.trigger("change")},clearAndReloadAvailableCappingRulesBasedOnObjectType:function(){this.appliedRulesetsToDetailsMap=[],this.model.set("appliedCappingRules",[]),this.model.trigger("change");var e=this.model.get("Object_Type__c");this.filteredCappingConfigurationList=this.cappingConfigurationList.filter(t=>t.Object_Type__c===e),this.renderConditionalCappingTable(),this.ConditionalCappingRulesTable.refreshCapping()}})}},function(e,t,i){e.exports=function(){Magellan.Views.ConditionalCappingRulesTable=Backbone.View.extend({template:_.template(i(210)),initialize:function(e){this.model=e.model,this.masterList=e.masterList,this.appliedRulesetsToDetailsMap=e.appliedRulesetsToDetailsMap,this.render()},events:{"click #add-capping-rule-button":"addCappingRule","click .edit-capping-rule-button":"editCappingRule","click .delete-capping-rule-button":"deleteCappingRule"},addCappingRule:function(e){e.preventDefault(),this.CappingRuleEditRow=new Magellan.Views.CappingRuleEditRow({model:this.model,masterList:this.masterList,appliedRulesetsToDetailsMap:this.appliedRulesetsToDetailsMap,rowData:null,index:-1}),this.$el.find(".new-capping-rule-row").show(),this.$el.find(".new-capping-rule-row").replaceWith(this.CappingRuleEditRow.$el),this.$el.find("#add-capping-rule-button").attr("disabled",!0),this.$el.find(".edit-capping-rule-button").hide(),this.$el.find(".delete-capping-rule-button").hide()},editCappingRule:function(e){e.preventDefault();let t=$(e.currentTarget).data("index"),i=this.appliedRulesetsToDetailsMap[t];this.CappingRuleEditRow=new Magellan.Views.CappingRuleEditRow({model:this.model,masterList:this.masterList,appliedRulesetsToDetailsMap:this.appliedRulesetsToDetailsMap,rowData:i,index:t});let a=i["config id"];this.$el.find(".parent-row[data-id='"+a+"']").replaceWith(this.CappingRuleEditRow.$el),this.$el.find("#add-capping-rule-button").attr("disabled",!0),this.$el.find(".child-row[data-id='"+a+"']").hide(),this.$el.find(".edit-capping-rule-button").hide(),this.$el.find(".delete-capping-rule-button").hide()},deleteCappingRule:function(e){let t=$(e.currentTarget).data("index");this.model.trigger("deleteCappingRule",t)},refreshCapping:function(){this.CappingRuleEditRow&&this.CappingRuleEditRow.remove(),this.render()},render:function(){let e=this.appliedRulesetsToDetailsMap.map(e=>this.appliedRulesetsToDetailsMap.indexOf(e)+1).join(" AND ");var t=this.template({appliedRulesetsToDetailsMap:this.appliedRulesetsToDetailsMap,ruleLogicString:e});return this.$el.html(t),function initTooltips(){ld_initializeToolTip(this.$el.find(".capping-table-rule-logic.ld-tooltip-hint"),{title:"Capping Rule Logic",body:"When multiple Capping Rules are applied to a pool, inbound records will be analyzed with respect to the Rules. Only if the record meets the conditions will it be accepted by the Pool. In a scenario with multiple Capping Rules, if a Capping Rule has been met for a pool member, then the record will be evaluated for another pool member. This is the case even if the original pool memberâ€™s cap was not met for the rest of their Capping Rules."})}.call(this),this}}),Magellan.Views.CappingRuleEditRow=Backbone.View.extend({tagName:"tr",template:_.template(i(209)),initialize:function(e){this.model=e.model,this.masterList=e.masterList,this.rowData=_.cloneDeep(e.rowData)||{"capping amount":1,"config id":"",description:"",name:"","soql condition":{}},this.index=e.index,this.appliedRulesetsToDetailsMap=e.appliedRulesetsToDetailsMap,this.render()},events:{"click .capping-rule-cancel-btn":"cancelChanges","click .capping-rule-done-btn":"updateCappingRule","change .capping-rule-limit-input":"inputChangeHandler","keyup .capping-rule-limit-input":"inputChangeHandler"},inputChangeHandler:function(e){var t=$(e.target),i=parseInt(t.val());this.rowData["capping amount"]=i,this.toggleDoneButtonDisabled()},cancelChanges:function(e){e.preventDefault(),this.model.trigger("updateCappingRule",null,null)},updateCappingRule:function(e){e.preventDefault(),this.model.trigger("updateCappingRule",this.rowData,this.index)},toggleDoneButtonDisabled:function(){let e=this.cappingRuleDropdown.isValid()&&this.rowData["capping amount"]&&this.rowData["capping amount"]>0;this.$el.find(".capping-rule-done-btn").attr("disabled",!e)},render:function(){var e=this.template({description:this.rowData.description,cappingLimit:this.rowData["capping amount"]||""});this.$el.html(e);let t=this.masterList.map(e=>e.Name),i=this.appliedRulesetsToDetailsMap.map(e=>e.name),a=_.findIndex(this.masterList,e=>e.Name===this.rowData.name);return this.cappingRuleDropdown=new Magellan.Views.LDDropdown({required:!0,placeholder:"Select a Capping Rule",options:t,value:t[a],disableSelectedOptions:!0,selectedOptions:i,size:"small",onChange:function(e){let t=_.find(this.masterList,t=>t.Name===e);this.rowData.name=t.Name,this.rowData.description=t.Description__c,this.rowData["config id"]=t.Id,this.rowData["soql condition"]=this.extractSoqlStrings(t),this.render()}.bind(this)}),this.$el.find(".capping-rule-dropdown").html(this.cappingRuleDropdown.$el),this.toggleDoneButtonDisabled(),this},mapAppliedRulesetsToName:function(){var e=[];return this.appliedRulesetsToDetailsMap.forEach(function(t){e.push(t.name)}),e},extractSoqlStrings:e=>JSON.parse(e.Schedule_Data__c).soql})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(211)),initialize:function(e){this.model=e.model},renderDistributionTab:function(){let e=this.model;_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ld-heroku-distribution-tab-angular",inputs:{pool:e.originalAttributes.Id,poolName:e.originalAttributes.Grouping_Name__c,poolMemberCount:e.originalMemberList.length}})},render:function(){let e=this.model.get("memberList"),t=this.template({members:e});return this.$el.html(t),_.defer(this.renderDistributionTab.bind(this)),this}})}},function(e,t,i){var a=Backbone.View.extend({initialize:function(e){this.model=e.model,this.idToOwnerMap=e.idToOwnerMap},events:{"click .delete-icon":"handleDeleteIconClick"},handleDeleteIconClick:function(e){var t=$(e.target).closest(".manager-list-container").data("id");this.trigger("deleteManager",t)},render:function(){this.delegateEvents();var e=this.model.get("Managers__c").map(function(e){var t=this.idToOwnerMap[e]&&this.idToOwnerMap[e].IsActive?this.idToOwnerMap[e].Name:"(Inactive Manager)";return _.template('<div class="manager-list-container" data-id=<%- userId %>><div><%- name %></div><div><%- userId %></div><div class="ld-cross-icon-grey-small delete-icon"></div></div>')({name:t,userId:e})}.bind(this)).join("");return this.$el.html(e),this}});e.exports=function(){return Backbone.View.extend({template:_.template(i(212)),initialize:function(e){this.model=e.model,this.canCheckForms=!1,this.canCheckHandoff=!1,this.canCheckLinks=!1,this.atLeastOneChecked=!0,this.scheduleTypes=["Respect_Holiday_Schedule__c","Respect_Pausing_Schedule__c","Respect_Working_Hours_Schedule__c","Respect_Vacation_Schedule__c"],Promise.all([e.usageInfoPromise,e.fetchLinksDataPromise]).then(([e,t])=>{let i=e,n=JSON.parse(t).data;if(n){let e=!0;for(let t of n)if(t.link_data.selectedPool&&t.link_data.selectedPool.value===this.model.attributes.Id){this.canCheckLinks=!1,e=!1;break}e&&(this.canCheckLinks=!0)}if(i[this.model.attributes.Id]){let e=!0,t=!0;for(let a of i[this.model.attributes.Id])if("BookIt for Forms"===a.bookitType?e=!1:"BookIt Handoff"===a.bookitType&&(t=!1),!e&&!t)break;e&&(this.canCheckForms=!0),t&&(this.canCheckHandoff=!0)}else this.canCheckForms=!0,this.canCheckHandoff=!0;this.canCheckLinks?this.$el.find("#bl").prop("disabled",!1):this.$el.find("#bl").attr("disabled","disabled"),this.canCheckHandoff?this.$el.find("#bha").prop("disabled",!1):this.$el.find("#bha").attr("disabled","disabled"),this.canCheckForms?this.$el.find("#bff").prop("disabled",!1):this.$el.find("#bff").attr("disabled","disabled");const o=this.model.get("Id");this.initialManagerFetchDone=!o||0===this.model.get("Managers__c").length,this.idToOwnerMap={},this.managerListView=new a({model:this.model,idToOwnerMap:this.idToOwnerMap}),this.initialManagerFetchDone||this.createIdToOwnerMap(),this.listenTo(this.managerListView,"deleteManager",this.handleManagerDelete),setTimeout(()=>{$("#name-field").focus()},0),this.numScheduleTypes=0,this.scheduleTypes.forEach(e=>{this.model.get(e)&&this.numScheduleTypes++}),this.model.get("Respect_User_Schedules__c")&&0==this.numScheduleTypes&&this.scheduleTypes.forEach(e=>{this.model.set(e,!0),this.numScheduleTypes=4}),this.listenTo(this.model,"change:LD_Business_Unit__c change:Grouping_Name__c change:Object_Type__c",_.debounce(()=>this.model.validatePoolName(),500)),this.listenTo(this.model,"change:Object_Type__c change:Pool_Type__c change:LD_Business_Unit__c change:Description__c change:Product_Access__c",()=>this.model.validateSync()),this.listenTo(this.model,"change:validationErr change:showErrorMsg",this.updateError),this.render()})},_getOptions:function(){return Object.keys(this.idToOwnerMap).filter(function(e){return!this.model.get("Managers__c").includes(e)}.bind(this))},handleManagerDelete:function(e){_.pull(this.model.get("Managers__c"),e),this.render(),this.managerListView.render(),this.model.trigger("change")},events:{"keyup textarea.write-to-model":"handleInputChange","keyup input.write-to-model":"handleInputChange","change input.respect-user-schedules":"handleScheduleChange","click .product-access-checkbox":"handleProductAccessClick"},handleProductAccessClick:function(e){let t=e.target.id;this.handleProductAccessClickHelper(t)},handleProductAccessClickHelper(e){let t,i=JSON.parse(this.model.get("Product_Access__c"));"bff"===e?t="BookIt For Forms":"bha"===e?t="BookIt Handoff":"bl"===e&&(t="BookIt Links"),i.includes(t)?i.splice(i.indexOf(t),1):i.push(t),0===i.length?(this.atLeastOneChecked=!1,this.$el.find("#no-product-access").html("Please check at least one")):(this.atLeastOneChecked=!0,this.$el.find("#no-product-access").html("")),this.model.set("atLeastOneChecked",this.atLeastOneChecked),i.sort(),i=JSON.stringify(i),this.model.set("Product_Access__c",i)},createIdToOwnerMap:function(){this.initialManagerFetchDone&&this.toggleLoadingMessage(!0),_LeanData.FlowBuilderController.queryUsers(this.model.get("Managers__c")).then(function(e){_.each(e,e=>{this.idToOwnerMap[e.Id]=e}),this.toggleLoadingMessage(!1),this.initialManagerFetchDone=!0,this.managerListView.render()}.bind(this))},toggleLoadingMessage:function(e){let t=e?"none":"block",i=e?"block":"none";this.$el.find("#manager-list").css({display:t}),this.$el.find("#manager-loading").css({display:i})},updateError(){const e=this.model.get("validationErr"),t=this.model.get("showErrorMsg");this.$el.find(".rrp-error-msg:not(#no-product-access)").text(""),this.$el.find("#name-field").toggleClass("lds-field-invalid",!1),this.$el.find(".ld-dropdown, .tt-input").toggleClass("input-invalid",!1),t&&(this.$el.find(".name .rrp-error-msg").text(e.poolName),this.$el.find("#name-field").toggleClass("lds-field-invalid",!!e.poolName),this.$el.find(".pool-type .rrp-error-msg").text(e.poolType),this.$el.find("#pool-type-dropdown .ld-dropdown").toggleClass("input-invalid",!!e.poolType),this.$el.find(".business-unit .rrp-error-msg").text(e.bu),this.$el.find("#business-unit-dropdown .tt-input").toggleClass("input-invalid",!!e.bu),this.$el.find(".object-type .rrp-error-msg").text(e.objType),this.$el.find("#object-type-dropdown .ld-dropdown").toggleClass("input-invalid",!!e.objType),this.$el.find(".distribution-type .rrp-error-msg").text(e.distributionType),this.$el.find("#distribution-dropdown .ld-dropdown").toggleClass("input-invalid",!!e.distributionType),this.$el.find(".description-table-row .rrp-error-msg").text(e.description),this.$el.find("#description-field").toggleClass("lds-textarea-invalid",!!e.description))},handleInputChange:function(e){var t=$(e.target),i=t.val(),a=t.data("field-name");this.model.set(a,i)},handleScheduleChange:function(e){var t=$(e.target),i=t.data("field-name"),a=t.prop("checked");if("Respect_User_Schedules__c"===i){if(!a)return this.model.advancedRRFeaturesEnabled||this.$el.find(".respect-user-table-row label").addClass("disabled"),this.resetSchedules();this.$el.find(".schedule-type-table-row").prop("hidden",!1)}else if(a?this.numScheduleTypes++:this.numScheduleTypes--,this.numScheduleTypes<=0)return this.resetSchedules();this.model.set(i,a)},resetSchedules:function(){this.$el.find(".schedule-type-table-row").prop("hidden",!0),this.scheduleTypes.forEach(e=>{this.$el.find('input[type=checkbox][data-field-name="'+e+'"]').prop("checked",!0),this.model.set(e,!0)}),this.numScheduleTypes=4,this.$el.find('input[type=checkbox][data-field-name="Respect_User_Schedules__c"]').prop("checked",!1),this.model.set("Respect_User_Schedules__c",!1)},render:function(){let e=["BookIt For Forms","BookIt Handoff","BookIt Links"];this.model.get("Product_Access__c")&&(e=JSON.parse(this.model.get("Product_Access__c")));var t=this.template({isCalendaringRRPage:this.model.isCalendaringRRPage,initialManagerFetchDone:void 0===this.initialManagerFetchDone||this.initialManagerFetchDone,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled,Respect_User_Schedules__c:this.model.get("Respect_User_Schedules__c"),canCheckForms:this.canCheckForms,canCheckHandoff:this.canCheckHandoff,canCheckLinks:this.canCheckLinks,linksChecked:e.includes("BookIt Links"),handoffChecked:e.includes("BookIt Handoff"),formsChecked:e.includes("BookIt For Forms"),poolType:this.model.get("Distribution_Type__c")||"order-based"});return this.$el.html(t),this.$el.find(".schedule-type-table-row").prop("hidden",!this.model.get("Respect_User_Schedules__c")),function initializeUserDropdown(){this.managerListView&&this.$el.find("#manager-list").html(this.managerListView.$el);const e={selector:"ld-typeahead-angular#manager-dropdown",inputs:{required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchUsers,filter:_LeanData.Util.typeaheadDataFilter(this.model.get("Managers__c"),"Id"),placeholder:"Search",selections:[]},events:{onSelect:e=>{this.model.addManager(e[0].Id),this.model.set("value",void 0),this.model.set("options",this._getOptions()),this.render(),this.createIdToOwnerMap()}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}.call(this),this.model.isCalendaringRRPage?function initializeMeetingDropdowns(){const e=new Magellan.Views.LDDropdown({value:this.model.get("Distribution_Type__c")||"order-based",options:["count-based","order-based"],placeholder:"Select Distribution Type",size:"large",required:!0,onChange:e=>{if("count-based"===e){let e=JSON.stringify(["BookIt For Forms","BookIt Handoff","BookIt Links"]);this.model.set("Product_Access__c",e),this.canCheckForms=!0,this.model.set("Weighting_Enabled__c",!1)}else{this.canCheckForms=!1;let e=JSON.stringify(["BookIt For Forms"]);this.model.set("Product_Access__c",e)}this.model.set("Distribution_Type__c",e),this.render()},optionTemplate:e=>_.template("<span><%- name %></span>")({name:_.capitalize(e)})}).bind(this);this.model.has("Id")&&e.$el.toggleClass("disabled",!0);e.validate(),this.$el.find("#distribution-dropdown").html(e.$el)}.call(this):function initializeInfoDropdowns(){const e=_LeanData._getOrganizationData();let t=!e.hasReadWriteAccess&&e.hasBUAdminAccess?[]:["standard","api"];e.multigraphEnabled&&t.push("business units");let i=e.objectsEnabled||[];const a=_LeanData.FeatureProvisioning.getObjectsEnabledForRouting();var n=new Magellan.Views.LDDropdown({value:this.model.get("Pool_Type__c"),options:t,placeholder:"Select Pool Type",size:"large",disabledOptions:new Set(i).has(this.model.get("Object_Type__c"))?["business units"]:[],optionTemplate:function(e){return _.template("<span><%- name %></span>")({name:"business units"===e?"Business Units":_.capitalize(e)})},onChange:function(e){"live"===e||"api"===e?_LeanData.Notification.showConfirmationDialog({header:"Confirm Pool Type Change",message:"Are you sure you would like to change the Pool Type from Standard to "+_.capitalize(e)+"? Confirming this change will disable some settings within this pool, including Conditional Capping.",confirmButtonText:"Confirm",onConfirm:()=>{"api"===e?this.model.set("apiModeOn",!0):(this.model.copyMode&&"api"===this.model.get("Pool_Type__c")&&this.model.unset("Object_Type__c"),this.model.set("apiModeOn",!1)),this.model.set("Pool_Type__c",e),this.model.set("Capping_Type__c",null),this.model.set("LD_Business_Unit__c",null),this.model.set("selectedBU",null),this.model.trigger("change"),this.render()},onCancel:()=>{this.render()}}):(this.model.copyMode&&"api"===this.model.get("Pool_Type__c")&&this.model.unset("Object_Type__c"),"standard"===e&&(this.model.set("LD_Business_Unit__c",null),this.model.set("selectedBU",null)),this.model.set("Pool_Type__c",e),this.model.set("apiModeOn",!1),this.render())}.bind(this)});if(n.validate(),this.$el.find("#pool-type-dropdown").html(n.$el),this.model.get("apiModeOn")){const e=this.model.get("Object_Type__c")?[_LeanData.Util.convertStringToTypeaheadObject(this.model.get("Object_Type__c"))]:[],t={selector:"ld-typeahead-angular#object-type-dropdown-api",inputs:{required:!0,disableBreadcrumbs:!0,placeholder:"Search for Standard or Custom Objects",selections:e,searchFunction:_LeanData.FlowBuilderController.getMatchingSObjectsForAorrra},events:{onSelect:e=>{this.model.set("Object_Type__c",e[0].name)}}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)}else this.otd=new Magellan.Views.LDDropdown({required:!0,value:this.model.get("Object_Type__c"),options:a,disabledOptions:"business units"===this.model.get("Pool_Type__c")?i:[],optionTemplate:e=>_.template("<span><%- name %></span>")({name:_LeanData.MetaDataController.getObjectMetaDataObject(e,!0).label||e}),placeholder:"Select Object Type",size:"large",onChange:e=>{let t=_LeanData.MetaDataController.getObjectMetaDataObject(e).caseSensitiveName;this.model.set("Object_Type__c",t),this.model.trigger("clearAndReloadAvailableCappingRulesBasedOnObjectType"),this.render()}}),this.otd.validate(),this.$el.find("#object-type-dropdown").html(this.otd.$el);let o=!1;_.isEmpty(this.model.get("Id"))||this.model.copyMode?o="business units"!==this.model.get("Pool_Type__c"):(n.$el.toggleClass("disabled",!0),this.otd.$el.toggleClass("disabled",!0),o="business units"!==this.model.get("Pool_Type__c")||this.model.get("LD_Business_Unit__c"));const l={selector:"ld-typeahead-angular#business-unit-dropdown",inputs:{disableBreadcrumbs:!0,placeholder:"Select a Business Unit",disabled:o,selections:this.model.get("selectedBU")?[this.model.get("selectedBU")]:[],searchFunction:_LeanData.FlowBuilderController.searchBusinessUnits,filter:e=>e},events:{onSelect:e=>{this.model.set("selectedBU",e[0]),this.model.set("LD_Business_Unit__c",e[0].Id)}}};_LeanDataUtil.Backbone.loadAngularComponent(this,l),this.$el.find(".respect-user-schedules").prop({checked:this.model.get("Respect_User_Schedules__c")}),this.scheduleTypes.forEach(e=>{this.$el.find('input[type=checkbox][data-field-name="'+e+'"]').prop("checked",this.model.get(e))}),this.model.get("directedFromApiPoolsPage")&&n.$el.toggleClass("disabled",!0)}.call(this),function initializeTooltip(){ld_initializeToolTip(this.$el.find(".pool-field.ld-tooltip-hint"),{title:"Pool Type",body:"This is the type of Routing (Standard or API) the Pool will be used in. Create a new Pool or copy an existing Pool to change the Pool Type. The Pool Type cannot be changed after initial creation."}),ld_initializeToolTip(this.$el.find(".object-field.ld-tooltip-hint"),{title:"Object Type",body:"Choose the Salesforce object that this pool is associated with. Example: Only Lead pools will be available in Lead routing graphs. This setting cannot be changed later."}),ld_initializeToolTip(this.$el.find(".managers-field.ld-tooltip-hint"),{title:"Pool Managers",body:"Select the team Manager(s) for this pool that can edit the membership and settings of this pool. Note that Managers are not able to access or edit other sections of LeanData, such as routing graphs."}),ld_initializeToolTip(this.$el.find(".respect-user-schedules.ld-tooltip-hint"),{title:"Respect User Schedules",body:"When selected, LeanData will only route to available users based on their Schedule (User Schedule is determined by their Working Hours, Vacations, Holidays). If no one is available, LeanData will follow the â€œNo Round Robin Members Availableâ€ Edge in the graph.<br><br> When unchecked, LeanData will route to users 24/7."}),ld_initializeToolTip(this.$el.find(".bu-field.ld-tooltip-hint"),{title:"Business Unit",body:"Associate Pool(s) with a Business Unit.  This Pool will then become available in the respective Business Unit Graph.  This setting cannot be adjusted at a later time."}),ld_initializeToolTip(this.$el.find(".distribution-field.ld-tooltip-hint"),{title:"Distribution Type",body:"Choose the distribution type of the Round Robin pool. Order-based will schedule the meeting with the next up user determined by the order set. Count-based pools will schedule the meeting with the user with the lowest meeting count."})}.call(this),function populateInputs(){this.$el.find(".write-to-model").each(function(e,t){var i=$(t),a=i.data("fieldName"),n=_.unescape(this.model.get(a));i.val(n)}.bind(this))}.call(this),this.model.advancedRRFeaturesEnabled||_.defer(this.renderMessageBadge.bind(this)),this.updateError(),this},renderMessageBadge:function(){const e={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Respect User Schedule",message:"Upgrade to route records to available Round Robin users (in Working Hours, not on Holiday or Vacation) and expedite speed-to-lead.",buttonText:"Learn More",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/4408230679323-Route-by-User-Schedules","_blank","noopener,noreferrer")},top:0,left:63,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)}})}},function(e,t,i){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Views.AddUsersToPools=i(3)(),Magellan.Views.RoundRobinPoolsCreatorTabs.Members=Backbone.View.extend({template:_.template(i(213)),initialize:function(e){this.model=e.model,this.memberIdToCountersMap=e.memberIdToCountersMap,this.meetingLogStartDate=e.meetingLogStartDate,this.meetingLogResetDate=e.meetingLogResetDate,this.hasOpenedEditMembers=!1,this.iconViewboxMap={"next-up":"0 0 32 20","next-up-after-credits":"0 0 28.41 13.92","lrt-next-up":"0 0 27.62 21.95","lrt-next-after":"0 0 27.62 27.12","last-routed-to":"0 0 29.04 13.82"},this.orgData=_LeanData._getOrganizationData(),this.userTZ=this.orgData.userTimeZone,this.formattedIntegrationsUserTZ=_LeanData.DateUtil.getShortFormattedTimezone(this.orgData.integrationUserTimeZone),this.users=this.model.users,this.queues=this.model.queues,_LeanData.RemotingRouter.fetchCondtionalPoolsJobSetting().then(e=>{this.model.conditionalCron=_LeanData.Util.cronToFrequencyString(e.cron),this.model.conditionalNotifications=e.notifications}).finally(()=>{this.render()}),this.listenTo(this.model,"change:memberList",()=>{this.model.validateSync(),this.render();const e=new Set(this.model.get("memberList").map(e=>e.OwnerId__c)),t=_.cloneDeep(this.model.get("creditBackQueue"));let i=!1;_.remove(t,t=>(i=i||!e.has(t.Id),!e.has(t.Id))),i&&this.model.set("creditBackQueue",t)}),this.listenTo(this.model,"change:creditBackQueue",()=>{this.renderTable()}),this.listenTo(this.model,"change:Distribution_Type__c",this.handleDistributionChange),this.listenTo(this.model,"change:validationErr change:showErrorMsg",this.updateError),this.transformMemberList(),this.options={emptyTableText:'No members exist in the pool. Click "Add Members" to add new members to the pool.',rowReorder:!1,isRowReorderDisabled:()=>!0,columns:this.getColumns(),rowHeight:"27px"}},getColumns:function(){const e=this.model.get("Capping_Type__c"),t=this.model.get("Is_Conditional_Membership_Enabled__c"),i=this.model.get("memberList"),a=this.model.get("creditBackQueue").length,n=this.model.conditionalMembersCount.add+this.model.conditionalMembersCount.keep,o=i.length-(this.model.conditionalMembersCount.remove+n),l=_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BOOKIT"),s=_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BOOKIT_HANDOFF"),r=_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:BOOKIT_LINKS");return[...this.isCountBased?[]:[{label:"",type:"svg",width:"50px",svgField:"svgName1",viewBoxField:"viewBox1",svgTitleField:"svgIconTitle"}],{label:"Status",type:"pngicon",width:"50px"},{label:"User Name",field:"UserName",type:"link",wrapContent:!0,wrap:!0,linkHandler:e=>{window.open(`#people/users/${e.OwnerId__c}?tabName=pools`,"_blank","noopener,noreferrer")}},...this.model.isCalendaringRRPage?[{label:"Product Access",alignContent:"middle",width:"140px",render:(e,t)=>{if(t.productAccess&&0===t.productAccess.size)return"No Access";let i="",a=[];return l&&a.push("BookIt for Forms"),s&&a.push("BookIt Handoff"),r&&a.push("BookIt Links"),a.forEach(e=>{i+=this.getIconHTMLForProduct(e,t.productAccess&&t.productAccess.has(e))}),i}}]:[{label:a>0?`Credits (${a})`:"Credits",field:"Credits",alignContent:"middle",width:"120px",render:(e,t)=>0===t.Credits?"":t.Credits,columnHeaderAlign:!0,tooltipContent:{title:"Members with Credits",body:"If a credit is added for a Member, Pool Members with credits will be routed a record before routing\n             resumes via the Pool order. The default order in which Members with credits will be routed is first in, \n             first out. You may remove credits for Members or modify this order under the Manage Credits modal."}}],...t?[{label:`Manual (${o})`,field:"Manual",alignContent:"middle",width:"120px",centerContent:!0,render:(e,t)=>t.Manual?"â€¢":"",columnHeaderAlign:!0,tooltipContent:{title:"Manual Members",body:'Members added manually will remain in the Pool until they are removed.\n              All members added before conditional membership was enabled will remain as\n              manual members.<br /><br /><div class="semi-bold">Manual Member who meets\n              Conditions</div>Manual members can also meet the conditions of the Pool.\n              If you remove them as a Manual member, they will be re-added to the Pool\n              as a Conditional member the next time you sync and save. To permanently\n              remove them from the Pool, please add an exclusion condition with their\n              user ID.<br /><br /><div class="italic">Example (Builder): User ID <span\n              class="med-grey-1">not equal to</span> 00530000003xqAb</div><div class="italic">\n              Example (Free-form): id != \'00530000003xqAb\'</div>'}},{label:`Conditional (${n})`,field:"Conditional",alignContent:"middle",width:"120px",columnHeaderAlign:!0,tooltipContent:{title:"Conditional Members",body:"Members added if they met the Pool's conditions at the last sync and saved.\n              When you Sync Membership, the Pool membership will update based on the user's\n              conditions.<br /><br />If new members meet the conditions, they will be added\n              to the pool. If existing conditional members no longer meet the conditions,\n              they will be removed from the pool."}}]:[],...this.isCountBased||!this.model.advancedRRFeaturesEnabled&&!e?[]:[{label:"Capping",field:"Capping",width:"120px",columnHeaderAlign:!0,alignContent:"middle",tooltipContent:{title:"Members with Capping Rules",body:"Capping Rules allow you to define conditions or a time frame\n            to control how many records a user can own.<br /><br />\n            Note: If a Member has Capping Rules set up and is routed\n            a record through Credits, this will not count toward the Member's capping limit."}}],{label:"Meeting"===this.model.get("Object_Type__c")?"BookIt Working Hours":"Working Hours",field:"WorkingHours",type:"link",width:this.isCountBased?"190px":"120px",linkHandler:e=>{window.open(`#people/users/${e.OwnerId__c}?tabName=schedule`,"_blank","noopener,noreferrer")},unescaped:!0,getClassNames:()=>["break-line"]},...this.isCountBased?[]:[{type:"button-group",customColumnPadding:"10px",width:this.model.get("Weighting_Enabled__c")?"210px":"160px",buttons:[...this.model.advancedRRFeaturesEnabled&&!this.model.isCalendaringRRPage?[{text:"Add Credit",classes:e=>{const t=new Set(["lds-tertiary-x-small-button","btn-hidden-by-default"]);return e.isQueue&&t.add("disabled"),t},buttonClickHandler:(e,t)=>{this.handleAddCreditClick(t)},getTitle:e=>e.isQueue?"Only individual Users are eligible to receive a credit back":""}]:[],{text:this.model.get("Weighting_Enabled__c")?"Assign Next Record":"Start Here",classes:()=>new Set(["lds-tertiary-x-small-button","btn-hidden-by-default","ml10"]),buttonClickHandler:(e,t)=>{this.handleStartHereClick(t)}}]}]]},events:{"click .edit-members-btn:not([disabled])":"handleEditMembersClick","click .manage-credits-btn:not([disabled])":"handleManageCreditsClick"},handleManageCreditsClick:function(e){e.preventDefault(),this.renderModal()},handleEditMembersClick(e){e.preventDefault(),new Magellan.Views.AddUsersToPools({isCalendaringRRPage:this.model.isCalendaringRRPage,enabledSalesforceLicenses:this.model.enabledSalesforceLicenses,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled,memberIdToCountersMap:this.memberIdToCountersMap}).openSingle({rrpModel:this.model,onConfirm:()=>{$(".modal-backdrop").remove()}})},getIcon:function(e){return e?e.toLowerCase().replace(/ /g,"-")+"-indicator":""},getIconViewbox:function(e){return this.iconViewboxMap[e.toLowerCase().replace(/ /g,"-")]||"0 0 0 0"},getIconHTMLForProduct:(e,t)=>`<div class="${{"BookIt for Forms":"bookit-forms","BookIt Handoff":"bookit-handoff","BookIt Links":"bookit-links"}[e]}-icon product-icon ${t?"":"hidden"}" title="${t?"Live in "+e:""}"></div>`,render:function(){const e=this.model.get("memberList"),t=_.keyBy(e,"OwnerId__c");this.model.get("creditBackQueue").some(e=>null==t[e.Id])&&this.model.set("creditBackQueue",_.cloneDeep(this.model.get("creditBackQueue")).filter(e=>null!=t[e.Id]));const i=this.model.conditionalMembersCount.add+this.model.conditionalMembersCount.keep,a=e.length-(this.model.conditionalMembersCount.remove+i);this.model.isCalendaringRRPage&&(this.startDate=_LeanData.DateUtil.formatDate(this.meetingLogStartDate,"MM/DD/YYYY",this.userTZ),this.endDate=_LeanData.DateUtil.formatDate((new Date).toISOString(),"MM/DD/YYYY",this.userTZ),this.resetDate=_LeanData.DateUtil.formatDate(this.meetingLogResetDate,"MM/DD/YYYY",this.userTZ));const n=isNaN(this.model.get("Last_Sync_Date__c"))?null:this.model.get("Last_Sync_Date__c"),o=isNaN(this.model.get("Last_Membership_Saved_Date__c"))?null:this.model.get("Last_Membership_Saved_Date__c"),l=null==n&&null==o?null:_LeanData.DateUtil.formatDate(new Date(Math.max(n,o)),"MM/DD/YYYY hh:mm A z");this.isCountBased="count-based"===this.model.get("Distribution_Type__c");var s=this.template({conditionalMembershipEnabled:this.model.get("Is_Conditional_Membership_Enabled__c"),isScheduledConditionalPool:this.model.attributes.Is_Scheduled__c,lastMemberUpdate:l,conditionalCron:this.model.conditionalCron,conditionalNotifications:this.model.conditionalNotifications,formattedIntegrationsUserTZ:this.model.formattedIntegrationsUserTZ,members:e,disableMemberEdit:_.isEmpty(this.model.get("Object_Type__c")),isBookitPool:this.model.isCalendaringRRPage,numManual:a,numConditional:i,isCopy:Magellan.Models.roundRobinPoolCopyMode,isCountBased:this.isCountBased,advancedRRFeaturesEnabled:this.model.advancedRRFeaturesEnabled,startDate:this.startDate,endDate:this.endDate,resetDate:this.resetDate});return this.$el.html(s),this.renderMembersTableTooltips(),this.updateError(),Angela.Navigation.queryParams.openEditMembers&&(this.hasOpenedEditMembers||(this.hasOpenedEditMembers=!0,this.handleEditMembersClick())),this.transformMemberList(),this.options={emptyTableText:'No members exist in the pool. Click "Add Members" to add new members to the pool.',rowReorder:!1,isRowReorderDisabled:()=>!0,columns:this.getColumns(),rowHeight:"27px"},this.renderTable(),this},handleAddCreditClick:function(e){const t=this.model.get("memberList")[e].OwnerId__c;this.model.addCredit(t),this.renderTable()},handleStartHereClick:function(e){const t=this.model.get("Weighting_Enabled__c")?"Assign Next Record":"Start Here",i=this.model.get("creditBackQueue"),a=i.length,n=this.model.get("memberList")[e],o=this.getName(n),l=_.keyBy(this.model.get("memberList"),"OwnerId__c"),s=i.filter(e=>null!=l[e.Id]).map(e=>l[e.Id].availabilityStatus).every(e=>["Paused","On Vacation","On Holiday","Outside Working Hours"].includes(e)),r=1===a?"credit":"credits";s?(this.model.setNextMember(n.OwnerId__c),this.renderTable()):_LeanData.Notification.showConfirmationDialog({header:t,message:`The pool currently has an active credit queue with <strong>${a}</strong> ${r} remaining.\n          <br /><br />\n          <strong>${o}</strong> will be next up once the credit queue is exhausted.`,confirmButtonText:t,onConfirm:()=>{this.model.setNextMember(n.OwnerId__c),this.renderTable()}})},renderMembersTableTooltips:function(){this.model.get("Is_Conditional_Membership_Enabled__c")&&(ld_initializeToolTip(this.$el.find(".manual-col-tooltip.ld-tooltip-hint"),{title:"Manual Members",body:'Members added manually will remain in the Pool until they are removed. All members added before conditional membership was enabled will remain as manual members.<br /><br /><div class="semi-bold">Manual Member who meets Conditions</div>Manual members can also meet the conditions of the Pool. If you remove them as a Manual member, they will be re-added to the Pool as a Conditional member the next time you sync and save. To permanently remove them from the Pool, please add an exclusion condition with their user ID.<br /><br /><div class="italic">Example (Builder): User ID <span class="med-grey-1">not equal to</span> 00530000003xqAb</div><div class="italic">Example (Free-form): id != \'00530000003xqAb\'</div>'}),ld_initializeToolTip(this.$el.find(".conditional-col-tooltip.ld-tooltip-hint"),{title:"Conditional Members",body:"Members added if they met the Pool's conditions at the last sync and saved. When you Sync Membership, the Pool membership will update based on the user's conditions.<br /><br />If new members meet the conditions, they will be added to the pool. If existing conditional members no longer meet the conditions, they will be removed from the pool."}))},handleDistributionChange:function(e){this.render()},getWorkingHoursText:function(e){let t="",i=this.model.filteredUserList.length>0?this.model.filteredUserList.filter(t=>t.OwnerId===e.OwnerId__c||t.hasOwnProperty("QueueOwnerName")&&t.Id===e.OwnerId__c)[0]:e;return i&&i.hasOwnProperty("QueueOwnerName")&&(i.ScheduleType=i.workingHourScheduleType,i.WorkingHoursId=i.workingHourId,i.WorkingHoursName=i.workingHourName),t=void 0===i?"Error":"Meeting"===this.model.get("Object_Type__c")?i.isAuthorized?void 0===i.BookItWorkingHoursName?`Default (<i>${_.escape(this.model.defaultWorkingHourName)}</i>)`:i.BookItWorkingHoursId&&i.BookItWorkingHoursId.startsWith(i.BookItWorkingHoursName)?"Custom":_.escape(i.BookItWorkingHoursName):"N/A":void 0===i.WorkingHoursId?`Default (<i>${_.escape(this.model.defaultWorkingHourName)}</i>)`:i.WorkingHoursId&&i.WorkingHoursId.startsWith(i.WorkingHoursName)?"Custom":_.escape(i.WorkingHoursName)},transformMemberList:function(){const e=this.model.get("memberList");this.model.populateMemberStatuses(e);const t=this.model.get("Capping_Limit__c"),i=this.model.get("Capping_Type__c"),a=this.model.getMemberToCreditsCount();this.data=e.map((e,n)=>{const o=!e.Is_Conditional__c,l=e.OwnerId__c,s=i?e.Current_Cap_Value__c:"0",r=`${"conditional"===i?"Conditional":(s||"0")+(t&&i?" / "+t:"")+" - "+_.startCase(i||"None")}`,d=this.users[e.OwnerId__c]?this.users[e.OwnerId__c]:this.queues[e.OwnerId__c],c="User"!==e.Type||!d||d.IsActive,h=!this.model.isCalendaringRRPage||e.isAuthorized;let p={},u={};e.nextUpStatus&&e.nextUpStatus.length>0&&(p.svgName1=this.getIcon(e.nextUpStatus),p.viewBox1=this.getIconViewbox(e.nextUpStatus),p.svgIconTitle=e.nextUpTitle||e.nextUpStatus),e.availabilityStatus&&e.availabilityStatus.length>0?(u.iconClass=this.getIcon(e.availabilityStatus),u.pngIconTitle=e.availabilityStatus):this.model.isCalendaringRRPage&&e.onVacation&&(u.iconClass=this.getIcon("On Vacation"),u.pngIconTitle="On Vacation");let m="";d?c?h||(m=" (UNAUTHORIZED)"):m=" (INACTIVE)":m=" (DELETED)";const g={Id:e.Id,UserName:this.getName(e)+m,Credits:a[e.OwnerId__c]||0,Manual:o?"â€¢":"",Conditional:e.Is_Conditional__c?"remove"===e.conditionalStatus?"Removed":"â€¢":"",Capping:r,WorkingHours:this.getWorkingHoursText(e),OwnerId__c:l,invalid:!(c&&h&&d),isQueue:this.isQueue(e),productAccess:e.productAccess};return _.isEmpty(p)||Object.assign(g,p),_.isEmpty(u)||Object.assign(g,u),g})},isQueue:function(e){return e.OwnerId__c in this.queues},getName:function(e){if(!e)return"";let t=e.OwnerId__c,i=t.startsWith("00G")?"QUEUE":"USER",a=this.users[t]?this.users[t]:this.queues[t];return a?a.Name:`INVALID ${i}`},renderTable:function(){if(this.transformMemberList(),this.options.columns=this.getColumns(),!this.model.isCalendaringRRPage){const e=this.model.get("creditBackQueue").length,t=this.$el.find(".manage-credits-btn-text"),i=this.$el.find(".manage-credits-btn");e>0?(t.text(`Manage Credits (${e})`),i.removeAttr("disabled")):(t.text("Manage Credits"),i.attr("disabled",!0)),this.model.advancedRRFeaturesEnabled||0!==e?(this.hideCreditsBadge(),this.renderDot()):(this.renderCreditsBadge(),this.renderDot())}const e={selector:"ldc-data-table-angular",inputs:{options:_.cloneDeep(this.options),data:_.cloneDeep(this.data)}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},renderModal:function(){const e={selector:"ld-manage-credits-modal-angular",inputs:{visible:!0,model:this.model}};_LeanDataUtil.Backbone.loadAngularComponent(this,e)},updateError(){const e=this.model.get("validationErr"),t=this.model.get("showErrorMsg");this.$el.find(".members-table .rrp-error-msg").text(t?e.members:"")},getMeetingLogsCounter(e,t){return this.memberIdToCountersMap&&this.memberIdToCountersMap[e]&&this.memberIdToCountersMap[e][t]||0},hideCreditsBadge:function(){const e=this.$el.find("ldc-message-badge-angular");e&&(e.css("margin-left","0"),e.css("display","none"))},renderCreditsBadge:function(){this.$el.find(".manage-credits-btn-tooltip").css("display","none");const e=this.$el.find("ldc-message-badge-angular");e.css("display","block"),e.css("margin-left","10px");const t={selector:"ldc-message-badge-angular",inputs:{data:{badgeText:"UPGRADE",header:"Credits",message:"Upgrade to adjust the distribution of records to users in the same pool. Route more records to seasoned Sales Reps and less records to Reps ramping up.",buttonText:"Learn More about Credits",hideUpgradeButton:!1,onClick:()=>{window.open("https://leandatahelp.zendesk.com/hc/en-us/articles/360016462273","_blank","noopener,noreferrer")},top:0,left:50,type:"settings",size:"large"}}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)},renderDot:function(){const e=this.model.get("creditBackQueue"),t=this.$el.find("#next-credit-section");if(0===e.length)t.hide();else{const i=this.$el.find(".next-credit-dot"),a=this.$el.find("#next-up-text");let n=e[0];const o=_.keyBy(this.model.get("memberList"),"OwnerId__c"),l=e.map(e=>o[e.Id].availabilityStatus);let s={};if(l.every(e=>["Paused","On Vacation","On Holiday","Outside Working Hours"].includes(e)))s=o[n.Id];else{let t=l.findIndex(e=>!["Paused","On Vacation","On Holiday","Outside Working Hours"].includes(e));s=o[e[t].Id]}let r=this.getName(s);["On Vacation","Paused","On Holiday","Outside Working Hours"].includes(s.availabilityStatus)?t.hide():($(i).css("background-color","var(--ld-green)"),$(i).css("box-shadow","0 0 10px 2px #85d3b0"),$(i).show(),a.text(r),t.show())}}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinPoolData=Backbone.Model.extend({initialize:function(e,t,i){this.enabledSalesforceLicenses=t.enabledSalesforceLicenses||[],this.advancedRRFeaturesEnabled=t.advancedRRFeaturesEnabled,this.originalAppliedRulesetsToDetailsMap=[],this.poolIdsWithWeightingChanged=new Set,this.conditionalMembersCount={add:0,remove:0,keep:0,meets:0},this.existing=t.existing,this.defaultWorkingHourName=t.defaultWorkingHour?t.defaultWorkingHour.Name:"24/7",Magellan.Models.roundRobinPoolCopyMode&&(this.copyMode=!0,Magellan.Models.roundRobinPoolCopyMode=!1),this.isCalendaringRRPage=t.isCalendaringRRPage;var a=this.isCalendaringRRPage?"count-based":"order-based";if(this.existing||this.copyMode){this.set(t.pool.attributes),this.originalPoolAttrs=_.cloneDeep(t.pool.attributes),this.hasUnprovisionedFeatures=!this.advancedRRFeaturesEnabled&&_LeanData.Util.hasAdvancedRoundRobinFeatures(t.pool.attributes),this.nextOwnerId=null;var n=_.map(t.members,e=>(e.attributes.Is_Conditional__c&&this.conditionalMembersCount.keep++,e.attributes.isNextOwner=e.isNextOwner||!1,e.isNextOwner&&(this.nextOwnerId=e.attributes.OwnerId__c),e.attributes));n=_.sortBy(n,function(e){return e.Owner_Order__c}),_.each(n,function(e){e.Type=e.hasOwnProperty("User_Owner__c")?"User":"Queue"}),this.set("memberList",n),this.originalAppliedRulesetsToDetailsMap=_.cloneDeep(i),this.set("appliedCappingRules",_.cloneDeep(this.originalAppliedRulesetsToDetailsMap))}if(this.existing||this.set("Distribution_Type__c",a),this.copyMode){this.set("Id",null),this.set("Grouping_Name__c","[COPY] "+this.get("Grouping_Name__c")),this.set("Manual_Next_OwnerId__c",null),this.set("Distribution_Type__c",this.get("Distribution_Type__c")||"order-based"),t.selectedBU&&t.selectedBU.Is_Deleted__c&&(t.selectedBU=null,this.set("LD_Business_Unit__c",null));const e=this.getFirstAvailableMemberIndex(),i=this.get("memberList");_.each(i,(t,i)=>{t.Id=null,t.isNextOwner=e===i})}this.set("atLeastOneChecked",!0),this.set("Capping_Type__c",this.get("Capping_Type__c")||null),this.set("Timezone__c",this.get("Timezone__c")||""),this.set("Pool_Type__c",this.get("Pool_Type__c")||"standard"),!dashboardController.viewObject.statuses.hasReadWriteAccess&&_.isEmpty(this.get("Id"))&&this.set("Pool_Type__c","business units");let o="";if(this.isCalendaringRRPage&&(o='["BookIt For Forms","BookIt Handoff","BookIt Links"]'),this.set("Product_Access__c",this.has("Product_Access__c")?this.get("Product_Access__c"):o),this.isCalendaringRRPage||(this.set("Respect_User_Schedules__c",this.has("Respect_User_Schedules__c")?this.get("Respect_User_Schedules__c"):this.advancedRRFeaturesEnabled),this.set("Respect_Holiday_Schedule__c",this.has("Respect_Holiday_Schedule__c")?this.get("Respect_Holiday_Schedule__c"):this.advancedRRFeaturesEnabled),this.set("Respect_Vacation_Schedule__c",this.has("Respect_Vacation_Schedule__c")?this.get("Respect_Vacation_Schedule__c"):this.advancedRRFeaturesEnabled),this.set("Respect_Working_Hours_Schedule__c",this.has("Respect_Working_Hours_Schedule__c")?this.get("Respect_Working_Hours_Schedule__c"):this.advancedRRFeaturesEnabled),this.set("Respect_Pausing_Schedule__c",this.has("Respect_Pausing_Schedule__c")?this.get("Respect_Pausing_Schedule__c"):this.advancedRRFeaturesEnabled)),t.pool&&t.pool.managerIds){var l=_.cloneDeep(t.pool.managerIds);this.set("Managers__c",l)}else this.set("Managers__c",[]);this.set("memberList",this.get("memberList")||[]),this.userFilterMetaData=t.userFilterMetaData||[],this.filteredUserList=t.filteredUserList||[],this.filteredUserList=_.filter(t.filteredUserList||[],e=>!("Queue"===e.Type&&!_LeanData.FBUtil.isObjectTypeQueueOwnable(this.get("Object_Type__c")))&&e),this.users=t.users,this.queues=t.queues,this.set("creditBackQueue",this.copyMode?[]:t.creditBackQueue),this.originalCreditBackQueue=_.cloneDeep(this.get("creditBackQueue")),this.set("selectedBU",t.selectedBU),this.set("LD_Business_Unit__c",this.get("LD_Business_Unit__c")||(t.selectedBU?t.selectedBU.Id:null)),this.copyMode?this.set("original_Grouping_Name__c",""):this.set("original_Grouping_Name__c",this.get("Grouping_Name__c")||""),this.isCalendaringRRPage&&(this.set("Object_Type__c","Meeting"),this.set("Pool_Type__c","standard")),this.attributes.Grouping_Name__c=this.get("Grouping_Name__c")||"",this.attributes.Description__c=this.get("Description__c")||"",this.originalAttributes=_.cloneDeep(this.attributes),this.originalAttributes.appliedCappingRules=this.get("appliedCappingRules")||[],this.originalMemberList=_.cloneDeep(this.get("memberList")),this.populateMemberStatuses(n),this.set("validationErr",{}),this.set("showErrorBanner",!1),this.set("showErrorMsg",!1)},addCredit:function(e){const t=_.cloneDeep(this.get("creditBackQueue"));t.push({Id:e,LastModifiedDate:""}),this.set("creditBackQueue",t)},reorder:function(e){this.set("creditBackQueue",e)},getMemberToCreditsCount:function(){const e=this.get("creditBackQueue"),t={};for(let i of e){const e=i.Id;e in t||(t[e]=0),t[e]++}return t},addManager:function(e){this.has("Managers__c")||this.set("Managers__c",[]),this.get("Managers__c").push(e)},populateMemberStatuses:function(e){const t=["Paused","On Vacation","On Holiday","Outside Working Hours"],i=this.getFirstAvailableMemberIndex();let a=!1;const n=this.get("creditBackQueue")||[],o=_.keyBy(e,"OwnerId__c"),l=n.filter(e=>null!=o[e.Id]).map(e=>o[e.Id].availabilityStatus),s=l.every(e=>["Paused","On Vacation","On Holiday","Outside Working Hours"].includes(e)),r=l.length>0&&!s;_.each(e,(e,n)=>{let l="";const s=new Set(e.Inactive_Reason__c?JSON.parse(e.Inactive_Reason__c):[]);_.each(t,e=>{if(s.has(e))return l=e,!1}),e.availabilityStatus=l;let d=!1;o[this.get("Manual_Next_OwnerId__c")]&&"Unavailable"!==o[this.get("Manual_Next_OwnerId__c")].Status__c?e.OwnerId__c===this.get("Manual_Next_OwnerId__c")&&(d=!0):d=this.copyMode?n===i:-1===i?0===n:e.isNextOwner;let c="";!a&&d&&e.receivedLastRecord?(c="LRT Next Up",a=!0,r&&(c="LRT Next After")):!a&&d?(c="Next Up",a=!0,r&&(c="Next Up After Credits")):e.receivedLastRecord&&(c="Last Routed To"),e.nextUpStatus=c,"LRT Next After"===c?e.nextUpTitle="This Member received the last record and will be next up once the credit queue is exhausted.":"LRT Next Up"===c?e.nextUpTitle="This Member received the last record and will be next up.":"Last Routed To"===c?e.nextUpTitle="This Member received the last record.":"Next Up"===c?e.nextUpTitle="This Member will be next up.":"Next Up After Credits"===c&&(e.nextUpTitle="This Member will be next up once the credit queue is exhausted.")})},getFirstAvailableMemberIndex:function(){const e=this.get("memberList");for(let t=0;t<e.length;t++){const i=e[t];if("Unavailable"!==i.Status__c&&(!i.User_Owner__r||i.User_Owner__r&&i.User_Owner__r.IsActive)&&"remove"!==i.conditionalStatus)return t}return-1},setNextMember:function(e){this.existing&&this.set("Manual_Next_OwnerId__c",e),this.nextOwnerId=e;const t=this.get("memberList");_.each(t,e=>{e.isNextOwner=e.OwnerId__c===this.nextOwnerId}),this.populateMemberStatuses(t),this.set("memberList",t)},hasChanged:function(){let e=_.cloneDeep(this.attributes);delete e.showErrorBanner,delete e.showErrorMsg,delete e.validationErr,delete e.modelHasChanged,this.get("memberList").forEach((e,t)=>{delete e.availabilityStatus,delete e.nextUpStatus,delete e.nextUpTitle}),e.memberList.forEach((e,t)=>{delete e.availabilityStatus,delete e.nextUpStatus,delete e.nextUpTitle});const t=!_.isEqual(e,this.originalAttributes)||!_.isEqual(this.get("memberList"),this.originalMemberList)||this.hoursCreatorData&&this.hoursCreatorData.model.checkHasChanged()||!_.isEqual(this.originalAppliedRulesetsToDetailsMap,this.get("appliedCappingRules"));return this.set("modelHasChanged",t),t},createSinglePoolManagerPayload:function(e){let t={adminToAssign:[],adminToRevoke:[]};return this.get("Managers__c").forEach(function(i){t.adminToAssign.push({userId:i,roundRobinPoolId:e})}.bind(this)),_.difference(this.originalAttributes.Managers__c,this.get("Managers__c")).forEach(i=>{t.adminToRevoke.push({userId:i,roundRobinPoolId:e})}),JSON.stringify({adminToAssign:t.adminToAssign,adminToRevoke:t.adminToRevoke})},saveToServer:function(){let e=!this.get("Id");const t={round_robin_pool:[],pool_member:[],delete_pool_member:[]},i=[];let a,n;return new Promise((e,t)=>{_.isEmpty(this.hoursCreatorData)||_.isEmpty(this.get("Working_Hours__c"))?e():this.hoursCreatorData.model.saveToServer().then(t=>{this.set("Working_Hours__c",t),e()})}).then(()=>{a="count-based"===this.get("Distribution_Type__c"),n=_LeanData.Util.getPoolPayloadObject(this.attributes);const t={};if(_.each(this.get("memberList"),(e,a)=>{_.isString(e.Id)&&(t[e.Id]=e);const n={action:"upsert",attributes:{Id:e.Id||null,User_Owner__c:e.User_Owner__c,OwnerId__c:e.OwnerId__c,Owner_Order__c:a,Is_Conditional__c:e.Is_Conditional__c,Current_Cap_Value__c:e.Current_Cap_Value__c}};this.get("Weighting_Enabled__c")&&_.isNumber(e.Weighting_Value__c)?n.attributes.Weighting_Value__c=e.Weighting_Value__c:n.attributes.Weighting_Value__c=50,i.push(n)}),this.originalOwnersToWeightValues){let e=Object.keys(this.originalOwnersToWeightValues).length;(this.hasOwnProperty("membersToDelete")||i.length!=e)&&(this.hasMembershipChanged=!0),this.hasWeightingChanged=i.some(e=>{let t=this.originalOwnersToWeightValues[e.attributes.Id];return t&&t!=e.attributes.Weighting_Value__c})}let o=e?null:_LeanData.RemotingRouter.assignOrRevokeAdminsForRoundRobinPools(this.createSinglePoolManagerPayload(this.get("Id")));const l=JSON.stringify(this.get("creditBackQueue")),s=this.whoGotCreditAdded();let r={};return r[n.Id||"new"]={attributes:n,members:i,"applied capping rules":this.get("appliedCappingRules"),hasWeightingChanged:this.hasWeightingChanged,hasMembershipChanged:this.hasMembershipChanged,membersToDelete:this.membersToDelete,"credit back queue":{finalOrder:l,whoGotCreditAdded:s}},Promise.all([_LeanData.RemotingRouter.saveMultiplePoolData(JSON.stringify(r)),o])}).then(async([o])=>{let l=o.savedPoolIds[0]||o.omittedPoolIds[0];if(o.omittedPoolIds&&o.omittedPoolIds.length){let e="Save Error",t="Outdated data: Another user has updated this pool recently. Please refresh the page and try again.";_LeanData.Notification.showConfirmationDialog({header:e,message:t,confirmButtonText:"OK",showRejectButton:!1})}else e&&await _LeanData.RemotingRouter.assignOrRevokeAdminsForRoundRobinPools(this.createSinglePoolManagerPayload(l));let s=(await _LeanData.RemotingRouter.getRoundRobinPoolConfiguration([l])).pools;if(savedPool=Object.values(s)[0],this.set("finalPoolId",l),this.isCalendaringRRPage&&a){if(t.round_robin_pool.push({organization_id:window._LeanData._getOrganizationData().orgId,sfdc_pool_id:l,pool_name:n.Grouping_Name__c,product_access:n.Product_Access__c,is_weighted:n.Weighting_Enabled__c}),this.membersToDelete)for(let e of this.membersToDelete)t.delete_pool_member.push({pool_id:l,user_id:e.attributes.OwnerId__c,organization_id:window._LeanData._getOrganizationData().orgId});for(let e of i)t.pool_member.push({pool_id:l,user_id:e.attributes.OwnerId__c,organization_id:window._LeanData._getOrganizationData().orgId,weighting:e.attributes.Weighting_Value__c}),t.meeting_count?(t.meeting_count.userIds.push(e.attributes.OwnerId__c),t.meeting_count.poolIds.push(l)):t.meeting_count={userIds:[e.attributes.OwnerId__c],poolIds:[l]};return _LeanData.RemotingRouter.syncPoolsAndMembers(JSON.stringify(t))}return Promise.resolve("No Callout Needed")}).then(e=>(_LeanData.Util.log(e),savedPool))},whoGotCreditAdded:function(){const e=this.originalCreditBackQueue,t=this.get("creditBackQueue"),i={},a={};for(let e of t)e.Id in a||(a[e.Id]=0),a[e.Id]++;for(let t of e)t.Id in i||(i[t.Id]=0),i[t.Id]++;const n=[];for(let e in a)e in i?a[e]>i[e]&&n.push(e):n.push(e);return n},poolNameBUAndObjectTypeExist:function(e,t){if(t=t.trim(),this.get("original_Grouping_Name__c")===e+t)return!1;let i=this.get("poolNameAndBUToPoolTypeMap"),a=this.get("Object_Type__c");return Object.keys(i).reduce((n,o)=>n||(e+t).toUpperCase()===o.toUpperCase()&&i[o].includes(a),!1)||!_.isUndefined(this.get("poolNameAndBUToPoolTypeMap")[e+t])&&!_.isUndefined(this.get("Object_Type__c"))&&this.get("poolNameAndBUToPoolTypeMap")[e+t].includes(this.get("Object_Type__c"))},queueInMemberList:function(){return _.find(this.get("memberList"),{type:"Queue"})},isValidQueueMember:function(e){return!!this.groupsMap.hasOwnProperty(e.OwnerId__c)&&(!this.groupsMap[e.OwnerId__c].hasOwnProperty("objectType")||this.get("Object_Type__c")===this.groupsMap[e.OwnerId__c].objectType)},validatePoolName(){return this.validatePoolNamePending=!0,_LeanData.RemotingRouter.poolNameValidation(this.get("LD_Business_Unit__c")||"",this.get("Grouping_Name__c")||null,this.get("Object_Type__c")||null).then(e=>{this.validatePoolNamePending=!1;const t=Object.assign({},this.get("validationErr"));delete t.poolName;const i=this.get("original_Grouping_Name__c")?this.get("original_Grouping_Name__c").toLowerCase().trim():"",a=this.get("Grouping_Name__c")?this.get("Grouping_Name__c").toLowerCase().trim():"";return a?!e&a.length>255?t.poolName="Pool Name must be at most 255 characters long":!e&&this.get("Object_Type__c")&&i!==a?t.poolName="This Pool Name is already in use. Please try another.":e&&a.includes("|")&&(t.poolName="Pool Names cannot contain a vertical bar ( | )."):t.poolName="Pool Name is Required",this.set("validationErr",t),_.isEmpty(t)&&this.set("showErrorBanner",!1),t})},validateSync(){const e={};if(this.existing||this.copyMode){const t=_LeanData.Util.getAdvancedRoundRobinFeatures(this.originalPoolAttrs),i=_LeanData.Util.getAdvancedRoundRobinFeatures(this.attributes);let a=!1;for(const e in i)this.advancedRRFeaturesEnabled||!i[e]||t[e]||(a=!0);a&&(e.provisioningError="Unprovisioned pool has enabled an advanced feature that was originally disabled")}const t=this.get("validationErr").poolName;t&&(e.poolName=t),this.get("Object_Type__c")||(e.objType="Object Type is Required");let i=!0;if(this.get("memberList").filter(e=>"Queue"===e.type).forEach(e=>{this.isValidQueueMember(e)||(i=!1)}),i?!_LeanData.FBUtil.isObjectTypeQueueOwnable(this.get("Object_Type__c"))&&this.queueInMemberList()&&(e.members=`The pool includes queues, which is not compatible with the object type "${this.get("Object_Type__c")}". Please remove queues to save.`):e.members=`The pool includes queues which are not compatible with the current pool object type "${this.get("Object_Type__c")}". Please remove these queues to save.`,this.get("Pool_Type__c")||(e.poolType="Pool Type is Required"),"business units"===this.get("Pool_Type__c")&&(this.get("LD_Business_Unit__c")||(e.bu="Business Unit is Required")),this.isCalendaringRRPage&&!this.get("atLeastOneChecked")&&(e.productAccess="Please check at least one"),this.get("Description__c").length>255&&(e.description="Description must be at most 255 characters long"),"count-based"!==this.get("Distribution_Type__c"))switch(this.get("Capping_Type__c")){case"conditional":let t=new Set;const i=this.get("appliedCappingRules");if(i&&0!==i.length)for(const a of i){if(t.has(a["config id"])){e.duplicateRules="Duplicate rules applied";break}t.add(a["config id"])}else e.noRule="At least one rule is required";break;case"time-based":e.timeBased="Please select a capping type";break;case"hourly":case"daily":case"weekly":this.get("Capping_Limit__c")?parseInt(this.get("Capping_Limit__c"))<=0?e.cappingMin="Cap limit should be greater than 0":parseInt(this.get("Capping_Limit__c"))||(e.cappingLimit="Please enter a number"):e.cappingLimit="Cap number is required",this.get("Timezone__c")||(e.timezone="Timezone is required")}return this.set("validationErr",e),!this.validatePoolNamePending&&_.isEmpty(e)&&(this.set("showErrorBanner",!1),this.set("showErrorMsg",!1)),e},validateAll(){return this.validateSync(),this.validatePoolName()}})}},function(e,t,i){e.exports=function(){return Backbone.View.extend({template:_.template(i(214)),initialize:function(e){this.cappingConfigurationList=_.cloneDeep(e.cappingConfigurations),this.appliedRulesetsToDetailsMap=this.initializeAppliedRulesetsToDetailsMap(e.appliedRulesets),this.rrTableFilters=e.rrFilters,window.rrpoolmodel=this.model=new Magellan.Models.RoundRobinPoolData(null,e,this.appliedRulesetsToDetailsMap),this.infoView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Info({model:this.model,usageInfoPromise:e.usageInfoPromise,fetchLinksDataPromise:e.fetchLinksDataPromise}),this.membersView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Members({model:this.model,groupsMap:e.groupsMap,meetingLogStartDate:e.meetingLogStartDate,meetingLogResetDate:e.meetingLogResetDate}),this.distributionView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Distribution({model:this.model}),this.advancedSettingsView=new Magellan.Views.RoundRobinPoolsCreatorTabs.AdvancedSettings({model:this.model,appliedRulesetsToDetailsMap:this.appliedRulesetsToDetailsMap,cappingConfigurationList:this.cappingConfigurationList}),this.usageView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Usage({model:this.model,usageInfoPromise:e.usageInfoPromise,fetchLinksDataPromise:e.fetchLinksDataPromise,fetchBookitURLPromise:e.fetchBookitURLPromise}),this.distributionView=new Magellan.Views.RoundRobinPoolsCreatorTabs.Distribution({model:this.model}),this.defaultTab=Angela.Navigation.queryParams.openEditMembers||"members"==Angela.Navigation.queryParams.tabName?"members":Angela.Navigation.queryParams.openUsage?"usage":"info","distribution"===Angela.Navigation.queryParams.tabName&&(this.defaultTab="distribution"),this.tabNameToViewMap={info:this.infoView,members:this.membersView,distribution:this.distributionView,"advanced-settings":this.advancedSettingsView,usage:this.usageView,distribution:this.distributionView},this.listenTo(this.model,"change",this.handleModelChange),this.listenTo(this.model,"change:validationErr change:showErrorMsg change:showErrorBanner",this.updateError)},events:{"click .clear-search-filter-btn":"clearInput","click .ld-tab":"handleTabClick","click .close-pool-editor":"handleCancelClick","click .save-pool":"handleSaveClick","click .parent-row":"handleParentRowClick","click .close-error-bar":"handleErrorBarCloseClick"},handleErrorBarCloseClick(e){e.preventDefault(),this.$el.find(".error-bar-wrapper").slideUp(300,()=>this.model.set("showErrorBanner",!1))},updateError(){const e=this.model.get("validationErr"),t=this.model.get("showErrorMsg"),i=this.model.get("showErrorBanner");this.$el.find(".dot-indicator").hide(),t&&(i?this.$el.find(".error-bar-wrapper").slideDown(300):this.$el.find(".error-bar-wrapper").slideUp(300,()=>this.model.set("showErrorBanner",!1)),(e.poolName||e.poolType||e.bu||e.objType||e.description||e.productAccess)&&this.$el.find(".ld-tab.info .dot-indicator").show(),e.members&&this.$el.find(".ld-tab.members .dot-indicator").show(),(e.timeBased||e.cappingLimit||e.cappingMin||e.timezone||e.duplicateRules||e.noRule)&&this.$el.find(".ld-tab.advanced-settings .dot-indicator").show())},handleSaveClick:_.debounce(function(e){e.preventDefault();var t=Magellan.Controllers.GUI.appWaitingScreen.show("Validating Pool...");this.model.validateAll().then(e=>{if(_.isEmpty(e))this.model.attributes.Id&&this.model.attributes.Grouping_Name__c!==this.model.attributes.original_Grouping_Name__c?_LeanData.RemotingRouter.doesRoundRobinPoolAffectTerritories(this.model.attributes.Id).then(e=>{e?_LeanData.Notification.showConfirmationDialog({header:"Pool is Referenced in Territory Management",message:"This Round Robin Pool is being referenced by Territory Management with previous name: "+this.model.originalAttributes.Grouping_Name__c+". By changing this pool name, this may cause some of the Territory Segments to stop routing to this pool.",confirmButtonText:"Confirm",onConfirm:()=>{this.save()},onCancel:()=>{this.render()}}):this.save()}):this.save();else{const e=this.model.get("validationErr");_.isEmpty(e)||(this.model.set("showErrorBanner",!0),this.model.set("showErrorMsg",!0))}t.resolve()})},500),save:function(){_LeanData.Notification.showLoadingOverlay("Saving Pool"),this.model.saveToServer().then(()=>{_LeanData.Notification.hideLoadingOverlay(),Magellan.Navigation.promptAreYouSure=!1,poolId=this.model.get("finalPoolId"),this.$el.find(".lds-header").text(this.model.get("Grouping_Name__c")),this.$el.find(".save-pool").attr("disabled",!0),window.sessionStorage.setItem("rrTableFilterState",JSON.stringify({tableFilters:this.rrTableFilters,isCalendaring:this.model.isCalendaringRRPage})),_LeanData.Navigation.navigateByUrl("",{skipLocationChange:!0}).then(()=>{var e=this.model.isCalendaringRRPage?"calendaring/round_robin_pools/creator/":"routing/round_robin_pools/creator/";_LeanData.Navigation.navigateByUrl(e+poolId,{skipLocationChange:!1})})})},handleCancelClick:function(e){e.preventDefault(),this.model.hasChanged()?_LeanData.Notification.showConfirmationDialog({header:"Unapplied Changes",message:"You have unapplied changes that will be lost if you leave this page.",confirmButtonText:"Leave without Changes",cancelButtonText:"Stay on Page",onConfirm:()=>{Magellan.Navigation.promptAreYouSure=!1,this.routeBackToPoolsOrApi()}}):this.routeBackToPoolsOrApi()},routeBackToPoolsOrApi:function(){if(window.sessionStorage.setItem("rrTableFilterState",JSON.stringify({tableFilters:this.rrTableFilters,isCalendaring:this.model.isCalendaringRRPage})),this.model.get("directedFromApiPoolsPage"))Angela.Navigation.queryParams.rrApiTabName?_LeanData.Navigation.navigateByUrl("api/round_robin_routing?rrApiTabName=Pools"):_LeanData.Navigation.navigateByUrl("api/round_robin_routing");else{var e=this.model.isCalendaringRRPage?"calendaring/round_robin_pools":"routing/round_robin_pools";_LeanData.Navigation.navigateByUrl(e)}},handleModelChange:function(e){const t=this.model.hasUnprovisionedFeatures;let i;if(this.model.hasUnprovisionedFeatures=!this.model.advancedRRFeaturesEnabled&&_LeanData.Util.hasAdvancedRoundRobinFeatures(this.model.attributes),t!==this.model.hasUnprovisionedFeatures&&this.setProvisioningMessageBar(),i=!!this.model.attributes.atLeastOneChecked&&this.model.hasChanged(),Magellan.Navigation.promptAreYouSure=i,this.$el.find(".save-pool").attr("disabled",!this.model.copyMode&&!i),e&&e.changed.hasOwnProperty("Distribution_Type__c")){const t=e.changed.Distribution_Type__c;this.$el.find("#advanced-settings").toggleClass("disabled","count-based"===t)}},handleTabClick:function(e){var t=this,i=$(e.target);i.siblings(".ld-tab").removeClass("active"),i.addClass("active");["info","members","distribution","advanced-settings","usage"].forEach(function(e){i.hasClass(e)&&t.switchTab(e)})},switchTab:function(e){this.$el.find("#tab-content").empty(),this.tabNameToViewMap[e]&&this.switchView(this.tabNameToViewMap[e])},switchView:function(e){var t=this.$el.find("#tab-content");t.empty(),e.delegateEvents(),t.append(e.$el),e.render(),e.managerListView&&e.managerListView.render()},handleParentRowClick:function(e){var t=$(e.target).closest("tr").data("id"),i=$(e.target).closest("tr");i.toggleClass("collapsed");var a=i.siblings('.child-row[data-id="'+t+'"]');a.children("td, th").children().first().is("div")||a.children("td, th").wrapInner('<div style="display:none" />');i.is(".collapsed")?a.slideUp(100).children("td, th").children().slideUp(100):a.slideDown(100).children("td, th").children().slideDown(100)},initializeAppliedRulesetsToDetailsMap(e){var t=[];return e.forEach(e=>{var i=this.cappingConfigurationList.find(function(t){return t.Id===e.JSON_Configuration__c}),a=JSON.parse(i.Schedule_Data__c),n={};n["config id"]=i.Id,n["soql condition"]=a.soql,n.name=i.Name,n.description=i.Description__c,n["capping amount"]=e.Capping_Limit_Override__c,t.push(n)}),t},setProvisioningMessageBar:function(){if(!this.model.hasUnprovisionedFeatures)return void _LeanData.Notification.closeMessage("mainMessageBar");const e=_LeanData.Util.createUnprovisionedRoundRobinFeaturesString(this.model.attributes);_LeanData.Notification.showMessage({type:"warn",header:" ",message:`This Pool contains ${e} setting(s) unavailable in your current package. Upgrade or remove setting to use this pool in your graph. <a class="lds-link" href="http://leandata.com/pricing" target="_blank">Learn more</a>.`,classes:"light-warning",closable:!1})},render:function(){let e=this.model.get("Last_Saved_Date__c")===this.model.get("Last_Sync_Date__c")?{Name:"System Changes"}:this.model.get("Last_Saved_By__r"),t=new moment(this.model.get("Last_Saved_Date__c"));var i=this.template({Grouping_Name__c:this.model.get("Grouping_Name__c"),isCountBased:"count-based"===this.model.get("Distribution_Type__c"),lastSavedBy:e?e.Name:null,lastSavedDate:t?t.tz(_LeanData.DateUtil.guessUserTimezone()).format("MM/DD/YYYY hh:mm A z"):null});return this.$el.html(i),this.$el.find(`.${this.defaultTab}`).addClass("active"),this.switchView(this.tabNameToViewMap[this.defaultTab]),"count-based"===this.model.get("Distribution_Type__c")&&this.$el.find("#advanced-settings").addClass("disabled"),this.model.copyMode&&this.$el.find(".save-pool").attr("disabled",!1),!this.model.existing&&this.model.isCalendaringRRPage&&this.$el.find("#distribution").addClass("disabled"),this.model.hasUnprovisionedFeatures&&this.setProvisioningMessageBar(),this.updateError(),this}})}},function(e,t,i){e.exports=function(){Magellan.Views.RoundRobinPoolsCreatorTabs.Usage=Backbone.View.extend({template:_.template(i(215)),initialize:function(e){this.model=e.model,this.usage={},this.links=[],this.bookitUrl="",this.render(),$(this.$el).LoadingOverlay("show"),Promise.all([e.usageInfoPromise,e.fetchLinksDataPromise,e.fetchBookitURLPromise]).then(([e,t,i])=>{this.bookitUrl=i;const a=JSON.parse(t);a&&Array.isArray(a.data)&&(this.links=a.data),this.usage=e[this.model.attributes.Id]||{},this.render(),$(this.$el).LoadingOverlay("hide")})},render:function(){var e=this.template({tableDataRows:this.generateUsageRows()});return this.$el.html(e),this},generateUsageRows:function(){const e=[];_.forEach(this.usage,t=>{let i=t.businessUnitId?t.businessUnitId:"",a=`#${"BookIt Handoff"===t.bookitType?"handoff_assistant":"routing"}/flowbuilder/viewer/${t.objectType.toLowerCase()}/${t.graphId}`;""!==i&&(a+=`/BU/${i}`);let n=t.segmentId?`#territory_segments/assignments/${t.segmentId}`:{};e.push({graphName:_.escape(t.graphName),nodeName:_.escape(t.nodeName),graphURL:a,segmentName:_.escape(t.segmentName)||"â€”",segmentURL:n,datatableName:t.datasetName||"â€”",datatableURL:t.datasetId?`#data_tables/${t.datasetId}/versions`:null,isLive:t.deploymentType,isLinks:!1,linkURL:""})});for(let t of this.links)if(t.link_data.selectedPool.value===this.model.attributes.Id){let i=t.user_info;e.push({graphName:"Bookit Link: "+_.escape(t.link_data.name)+" - Owner: "+_.escape(i.FirstName)+" "+_.escape(i.LastName),nodeName:"â€”",graphURL:"",segmentName:"â€”",segmentURL:"",datatableName:"â€”",datatableURL:"",isLive:"Live",isLinks:!0,linkURL:this.bookitUrl+"/l/"+t.id+"/"+t.link_data.linkUrlSlug})}return e}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.RoundRobinPoolsData=Backbone.Model.extend({initialize:function(e,t){this.collections=null,t.data&&this.initializeCollectionsFromRemote(t.data)},initializeCollectionsFromRemote:function(e){this.collections={}},getCollection:function(e){return this.collections[e]}})}},function(e,t,i){function initializeTable(){var e=[{name:'<label class="cb-container-small"><input type="checkbox" class="all-pools-checkbox"/><span class="checkmark" ></span></label>'},{name:"Pool Name"}];this.isCalendaringRRPage?e.push({name:"Distribution Type"}):this.ldMultigraphEnabled&&e.push({name:"Business Unit (BU)"}),e.push({name:"Weighted"}),e.push({name:"Members",id:"members",type:"any-number"}),this.isCalendaringRRPage||(e.push({name:"24/7"}),(this.advancedRRFeaturesEnabled||this.aggregatePoolResults.cappingEnabled)&&e.push({name:"Capping"})),e.push({name:"Pool Manager"}),this.isCalendaringRRPage&&e.push({name:"Product Access"}),this.poolUsageInfo?e.push({name:"Usage",id:"usage"}):e.push({name:'<div class="header-with-spinner"><div class="column-header-text">Usage</div> <div class="progress-spinner"></div></div>',id:"usage"}),e.push({name:"Modified",id:"modifiedDate"}),e.push({name:""});let t=0,i=0,a=0;e.forEach((e,n)=>{switch(e.id){case"members":t=n;break;case"usage":i=n;break;case"modifiedDate":a=n}});var n=new Magellan.Views.LDTable({columns:e,data:this.tableData,isInlineEditorEnabled:!1,datatableOptions:{bFilter:!1,language:{emptyTable:getEmptyTableText.call(this),searchPlaceholder:"Search Pools"},rowId:"Id",scrollY:"auto",order:[[a,"desc"]],columnDefs:this.isCalendaringRRPage?function buildColumnDefsForBookIt(e,t,i){return[{orderSequence:["desc","asc"],targets:[e,t,i]},{targets:0,orderable:!1,width:"15px",className:"pool-checkbox-col"},{targets:1,width:"285px"},{targets:2,width:"100px"},{targets:3,width:"60px"},{targets:4,width:"75px"},{targets:5,width:"110px"},{targets:6,width:"100px"},{targets:7,width:"55px",orderable:!1},{targets:8,width:"55px"},{targets:9,orderable:!1,width:"60px"}]}.call(this,t,i,a):this.ldMultigraphEnabled?function buildColumnDefsForMultiGraphCase(e,t,i){const a=!(!this.advancedRRFeaturesEnabled&&!this.aggregatePoolResults.cappingEnabled);return[{orderSequence:["desc","asc"],targets:[e,t,i]},{targets:0,orderable:!1,width:"15px",className:"pool-checkbox-col"},{targets:1,width:a?"225px":"305px"},!1,!1,{targets:2,width:"150px"},{targets:3,width:"60px"},{targets:e,width:"70px"},{targets:a?-6:-5,width:"30px"},a&&{targets:-5,width:"65px"},{targets:-4,width:"115px"},{targets:t,width:"55px",orderable:!1},{targets:i,width:"55px"},{targets:-1,orderable:!1,width:"60px"}]}.call(this,t,i,a):function buildColumnDefsForSingleGraphCase(e,t,i){const a=!(!this.advancedRRFeaturesEnabled&&!this.aggregatePoolResults.cappingEnabled);return[{orderSequence:["desc","asc"],targets:[e,t,i]},{targets:0,orderable:!1,width:"15px",className:"pool-checkbox-col"},{targets:1,width:a?"390px":"470px"},!1,!1,!1,{targets:2,width:"60px"},{targets:e,width:"70px"},{targets:a?-6:-5,width:"30px"},a&&{targets:-5,width:"65px"},{targets:-4,width:"125px"},{targets:t,width:"55px",orderable:!1},{targets:i,width:"55px"},{targets:-1,orderable:!1,width:"60px"}]}.call(this,t,i,a),paginate:this.tableData.length>this.tableRowCount,pageLength:this.tableRowCount}});return n.setElement(this.$el.find(".pools-table-container")),n.render(),n.table.on("page.dt",this.handlePageChange.bind(this)),n}function compareTableFilterNoSearch(){if(this.tableFilterStateSnapshot)for(const[e,t]of Object.entries(this.tableFilterState))if("Search_Value__c"!=e){if(!Array.isArray(t)&&!_.isEqual(t,this.tableFilterStateSnapshot[e]))return!1;if(_.xor(t,this.tableFilterStateSnapshot[e]).length>0)return!1}return!0}function getEmptyTableText(){return this.tableFilterState&&!compareTableFilterNoSearch.call(this)?'<span>Filtering produced no results. Try reducing or clearing your filters.</span> <span style="pointer-events: all;" class="lds-link" id="clear-filter-link">Clear Filters</span>':this.tableFilterState&&compareTableFilterNoSearch.call(this)&&""!=this.tableFilterState.Search_Value__c?'<span>Your search produced no results.</span> <span style="pointer-events: all;" class="lds-link" id="clear-search-link">Clear Search</span>':this.hasAdminPermissions?`<span>No pools have been created. Click "Create Round Robin Pool" to add members${this.advancedRRFeaturesEnabled?" and set weighting, capping, and schedule preferences":""}.</span>`:"<span>Pools do not exist or are inaccessible with your permissions.</span>"}function getSObjectTypeLabel(e){return _LeanData.MetaDataController.getObjectMetaDataObject(e,!0).label||e}e.exports=function(){return Backbone.View.extend({tableData:[],poolData:[],linkData:[],allPoolData:[],poolIdToPoolMap:{},poolIdToLinkCount:{},poolMembersData:[],sObjectSearchOptions:[],poolTypeToDeploymentMap:{},createPoolRowData:null,deletedPoolIds:new Set,savedTableOrder:[],scheduledConditionalPoolSettings:{},bulkSyncModalInitialized:!1,template:_.template(i(216)),initialize:function(e){this.ldOrgData=_LeanData._getOrganizationData(),this.ldAdmin=this.ldOrgData.statuses.hasReadWriteAccess,this.bookitManager=this.ldOrgData.statuses.hasBookItManagerAccess,this.ldBUAdmin=this.ldOrgData.statuses.hasBUAdminAccess,this.ldMultigraphEnabled=this.ldOrgData.statuses.multigraphEnabled,this.hasAdminPermissions=this.ldAdmin||this.bookitManager||this.ldBUAdmin&&this.ldMultigraphEnabled,window.rrpoolsview&&window.rrpoolsview.close(),window.rrpoolsview=this,this.tableRowCount=25,this.buOptions=["Single Graph"],this.isCalendaringRRPage=e.isCalendaringRRPage,this.bookitCountingMethod=this.ldOrgData.bookitCountingMethod,this.advancedRRFeaturesEnabled=this.isCalendaringRRPage||_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:ADVANCED_ROUND_ROBIN"),this.aggregatePoolResults={},this.fetchingPoolUsageData=!1,this.tableFilterState=e.tableFilterState,this.toggleConditionalPool=!!(e.tableFilterState&&"toggleConditionalPool"in e.tableFilterState)&&e.tableFilterState.toggleConditionalPool,this.deletedPoolIds=new Set([]),this.fetchAndInitTable(),this.selectedPoolsIds=new Set([])},fetchData:function(){return _LeanData.Notification.showLoadingOverlay("Loading Round Robin Pools"),new Promise((e,t)=>{const i=_LeanData.FlowBuilderController.getPoolUsageInfo();let a=[_LeanData.RemotingRouter.getRoundRobinPools(this.isCalendaringRRPage),_LeanData.FlowBuilderController.getAllBusinessUnits()];this.isCalendaringRRPage&&a.push(_LeanData.RemotingRouter.retrieveSchedulingLinks()),Promise.all(a).then(([t,a,n])=>{if(this.isCalendaringRRPage&&(this.linkData=JSON.parse(n),this.linkData.data))for(let e of this.linkData.data){let t=e.link_data.selectedPool.value;this.poolIdToLinkCount[t]?this.poolIdToLinkCount[t]++:this.poolIdToLinkCount[t]=1}const o={},l=new Set([]);a.forEach(e=>{e.buName=e.Name,o[e.Id]=e,l.add(e.Id)});let s=t.pools,r=Object.values(s),d=t.members,c=t.aggregatePoolResults;for(let e of r)e.attributes.LD_Business_Unit__c&&(o[e.attributes.LD_Business_Unit__c]&&(e.attributes.buDeleted=o[e.attributes.LD_Business_Unit__c].Is_Deleted__c,e.attributes.buName=o[e.attributes.LD_Business_Unit__c].buName),l.has(e.attributes.LD_Business_Unit__c)&&(e.attributes.isAdmin=!0));e({poolData:r,poolMembersData:d,poolIdToPoolMap:s,allPoolsCount:r.length,aggregatePoolResults:c}),this.fetchingPoolUsageData=!0,i.then(e=>{this.fetchingPoolUsageData=!1,this.poolUsageInfo=e;for(let t of this.poolData){const i=this.processPoolUsageData(e[t.attributes.Id]);i.linkCount=this.poolIdToLinkCount[t.attributes.Id]||0,t.usageSummary=i,t.liveRRCount=i.liveRRCount,t.liveTSCount=i.liveTSCount,t.scheduledRRCount=i.scheduledRRCount,t.linkCount=this.poolIdToLinkCount[t.attributes.Id]||0,t.scheduledTSCount=i.scheduledTSCount,t.liveDatatableCount=i.liveDatatableCount,t.scheduledDatatableCount=i.scheduledDatatableCount}this.initTableData(),this.applyTableFilters(),this.tableView=initializeTable.call(this)})}).finally(()=>{_LeanData.Notification.hideLoadingOverlay()})})},initBulkSyncModal:function(){_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ld-round-robin-sync-modal",events:{onConfirm:e=>{const t={key:"mainToast",type:"success",position:"top-right"};let i=[];e.successPools[0].pools.forEach(e=>i.push(e.attributes.Id)),_LeanData.RemotingRouter.setConditionalPoolsForScheduling(i,e.value).then(()=>{const a=i.length>1?"s have ":" has ";t.message=i.length+(e.value?" Conditional Pool"+a+"been scheduled to sync!":" Scheduled Conditional Pool"+a+"been removed from scheduled sync."),_LeanData.Notification.showMessage(t)}).then(()=>{this.selectedPoolsIds.clear(),this.fetchAndInitTable()})}}}),scheduledConditionalPoolSettings={},_LeanData.RemotingRouter.fetchCondtionalPoolsJobSetting().then(e=>{scheduledConditionalPoolSettings.frequency=_LeanData.Util.cronToFrequencyString(e.cron),scheduledConditionalPoolSettings.notifications=e.notifications})},fetchAndInitTable:function(){this.buOptions=["Single Graph"],this.sObjectSearchOptions=[],this.fetchData().then(e=>{this.poolData=e.poolData.filter(e=>{const t=e.attributes.Pool_Type__c;return null===t||t&&"live"!==t.toLowerCase()}),this.allPoolData=e.poolData,this.allPoolsCount=e.allPoolsCount,this.poolIdToPoolMap=e.poolIdToPoolMap,this.poolMembersData=e.poolMembersData,this.aggregatePoolResults=e.aggregatePoolResults,this.createPoolRowData=function _initializeCreatePoolRowDataFunction(e){const t={api:"API","business units":"Business Units"};let i='<div class="pool-name" title="<%- poolName %>"> <% if (hasUnprovisionedFeatures) { %> <ldc-message-badge-angular class="angular-component-in-magellan" data-id="<%- poolId %>"></ldc-message-badge-angular> <% } %> <%-poolName%> </div>';e.isCalendaringRRPage||(i+='<span class="round-robin-sub"><%-objType%> | <%-poolType%></span>');const a=_.template(i);var n=[function(){return'<label class="cb-container-small" style="padding: 0px;"><input type="checkbox" class="pool-row-checkbox"/><span class="checkmark" ></span></label>'},function(e){return a({poolName:e.attributes.Grouping_Name__c||"",poolId:e.attributes.Id,objType:getSObjectTypeLabel(e.attributes.Object_Type__c),poolType:_.isEmpty(e.attributes.Pool_Type__c)?"Standard":t[e.attributes.Pool_Type__c]?t[e.attributes.Pool_Type__c]:_.capitalize(e.attributes.Pool_Type__c),hasUnprovisionedFeatures:e.hasUnprovisionedFeatures})}];e.isCalendaringRRPage?n.push(function(e){let t=_.capitalize(e.attributes.Distribution_Type__c||"order-based");return`<div class="distribution-type" title="${t}">${t}</div>`}):e.ldMultigraphEnabled&&n.push(function(e){let t="Single Graph";return"business units"===e.attributes.Pool_Type__c&&(t=e.attributes.LD_Business_Unit__c?e.attributes.buDeleted?"<i>Deleted BU</i>":_.escape(e.attributes.buName):"BU Not Found",e.attributes.LD_Business_Unit__c||(t="<i>"+t+'</i><div class="alert-icon" style="margin-left: 5px;"></div>')),`<div class="bu-name" title="${t}">${t}</div>`});n.push(function(e){return e.attributes.Weighting_Enabled__c?'<div style="text-align: center; font-size: 16px; margin-right: 25px;">â€¢</div>':""}),n.push(function(e){var t='<div class="flexbox-container center-y">';return t+=e.memberCount||"0",e.attributes.Is_Scheduled__c&&e.attributes.Is_Conditional_Membership_Enabled__c?t+='<div class="conditional-pool-icon-wrapper">\n                            <svg class="conditional-pool-icon-large" viewbox="0 0 17 15">\n                              <use href="#scheduled-sync-pool-icon"></use>\n                            </svg>\n                            <div class="conditional-pool-icon-content">Conditional Membership and Scheduled Sync are enabled.</div>\n                          </div>':e.attributes.Is_Conditional_Membership_Enabled__c&&(t+='<div class="conditional-pool-icon-wrapper">\n                            <svg class="conditional-pool-icon-large" viewbox="0 0 15 15">\n                              <use href="#conditional-pool-icon"></use>\n                            </svg>\n                            <div class="conditional-pool-icon-content">Conditional Membership is enabled.</div>\n                          </div>'),e.hasInvalidMembers&&(t+='<div class="alert-icon-wrapper">\n                            <div class="alert-icon" style="margin-left: 5px;"></div>\n                            <div class="alert-icon-content">This Pool contains invalid or inactive users.</div>\n                          </div>'),t+="</div>"}),e.isCalendaringRRPage||(n.push(function(e){return e.attributes.Respect_User_Schedules__c?"":'<div style="text-align: center; font-size: 16px; margin-right: 25px;">â€¢</div>'}),(e.advancedRRFeaturesEnabled||e.aggregatePoolResults.cappingEnabled)&&n.push(function(e){return _.isEmpty(e.attributes.Capping_Type__c)?"":_.capitalize(e.attributes.Capping_Type__c)}));n.push(function(t){let i=t.managerIds||[],a=[];for(let t of i){let i=e.poolMembersData[t];i?a.push(i.attributes.Name):a.push(t)}return _LeanData.Util.createUserListOverflow(a,70,"pool-manager-column")}),e.isCalendaringRRPage&&n.push(function(e){let t;if(!e.attributes.Product_Access__c)return'<div>\n          <div class="bookit-forms-icon hidden" style="margin-right: 10px"></div>\n          <div class="bookit-handoff-icon hidden" style="margin-right: 10px></div>\n          <div class="bookit-links-icon hidden"></div>\n          </div>';let i="<div>";return(t=JSON.parse(e.attributes.Product_Access__c)).includes("BookIt For Forms")?i+='<div class="bookit-forms-icon" style="margin-right: 10px"></div>':i+='<div class="bookit-forms-icon hidden" style="margin-right: 10px"></div>',t.includes("BookIt Handoff")?i+='<div class="bookit-handoff-icon" style="margin-right: 10px"></div>':i+='<div class="bookit-handoff-icon hidden" style="margin-right: 10px"></div>',t.includes("BookIt Links")?i+='<div class="bookit-links-icon"></div>':i+='<div class="bookit-links-icon hidden"></div>',i+="</div>"});return n.push(function(t){if(!t.usageSummary)return t.Usage="Draft","â€”";let i=t.liveRRCount+t.liveTSCount+t.liveDatatableCount+t.linkCount,a=t.scheduledRRCount+t.scheduledTSCount+t.scheduledDatatableCount;if(i+a>0){let n='<div type="button" class="pool-usage lds-link">';i>0&&a>0?(n+="Live & Scheduled",t.Usage="Live & Scheduled"):i>0?(n+="Live",t.Usage="Live"):a>0&&(n+="Scheduled",t.Usage="Scheduled");let o=`${i} Live`,l=[`${t.liveRRCount} Live Round Robin ${1!==t.liveRRCount?_LeanData.StringUtil.pluralizeString("Node"):"Node"}`,`${t.liveTSCount} Live Territory ${1!==t.liveTSCount?_LeanData.StringUtil.pluralizeString("Segment"):"Segment"}`,`${t.liveDatatableCount} Live ${1!==t.liveDatatableCount?_LeanData.StringUtil.pluralizeString("Data Table"):"Data Table"}`,`${t.linkCount} Live ${1!==t.linkCount?_LeanData.StringUtil.pluralizeString("Round Robin Availability Link"):"Round Robin Availability Link"}`];return e.isCalendaringRRPage||(o+=` & ${a} Scheduled`,l.push(`${t.scheduledRRCount} Scheduled Round Robin ${1!==t.scheduledRRCount?_LeanData.StringUtil.pluralizeString("Node"):"Node"}`,`${t.scheduledTSCount} Scheduled Territory ${1!==t.scheduledTSCount?_LeanData.StringUtil.pluralizeString("Segment"):"Segment"}`,`${t.scheduledDatatableCount} Scheduled ${1!==t.scheduledDatatableCount?_LeanData.StringUtil.pluralizeString("Data Table"):"Data Table"}`)),n+=`<div class="usage-tooltip">\n                      <div class="summary-text">${o}</div>\n                      ${l.join("<br>")}\n                    </div>`,n+="</div>"}return""}),n.push(function(e){return _LeanData.DateUtil.formatDate3(e.attributes.LastModifiedDate)}),n.push(function(t){let i='<div class="segment-action">Actions<div class="ld-select-dropdown"><div class="view-pool-metrics-action">View Pool Metrics</div>';return(e.ldAdmin||e.bookitManager)&&(i+='<div class="copy-action">Copy</div>',t.liveRRCount>0||t.liveTSCount>0||t.scheduledRRCount>0||t.scheduledTSCount>0||t.liveDatatableCount>0||t.scheduledDatatableCount>0||t.linkCount>0?i+='<div title="Unable to delete Pools that are used in Live or Scheduled Graphs" class="disabled">Delete</div>':i+='<div class="delete-action">Delete</div>'),i+="</div></div>"}),function(e){return n.map(function(t){return t(e)})}}(this);let t=new Set,i=[],a=[];e.poolData.forEach(e=>{if(e.attributes.Object_Type__c&&t.add(e.attributes.Object_Type__c),"business units"===e.attributes.Pool_Type__c){const t=e.attributes.LD_Business_Unit__c?e.attributes.buDeleted?"Deleted BU":e.attributes.buName:"BU Not Found";"Deleted BU"===t||"BU Not Found"===t?a.includes(t)||a.push(t):i.includes(t)||i.push(t)}e.hasUnprovisionedFeatures=!this.advancedRRFeaturesEnabled&&_LeanData.Util.hasAdvancedRoundRobinFeatures(e.attributes)}),this.buOptions=this.buOptions.concat(i.sort()).concat(a.sort()),t.forEach(e=>{this.sObjectSearchOptions.push({label:getSObjectTypeLabel(e),value:e})}),this.sObjectSearchOptions.sort((e,t)=>e.label>t.label?1:-1),_.isEmpty(this.tableFilterState)&&(this.tableFilterState={Distribution:["count-based","order-based"],Usage:["Draft","Live"],Object_Type__c:Array.from(t),Pool_Type__c:["Standard","Business Units","Api"],Search_Value__c:"",LD_Business_Unit__c:this.buOptions,toggleConditionalPool:this.toggleConditionalPool},this.isCalendaringRRPage||this.tableFilterState.Usage.push("Scheduled","Live & Scheduled")),this.tableFilterStateSnapshot={Distribution:["count-based","order-based"],Usage:["Draft","Live"],Object_Type__c:Array.from(t),Pool_Type__c:["Standard","Business Units","Api"],Search_Value__c:"",LD_Business_Unit__c:this.buOptions,toggleConditionalPool:!1},this.isCalendaringRRPage||this.tableFilterStateSnapshot.Usage.push("Scheduled","Live & Scheduled"),this.initializePoolSearchTypeahead(),function initializeMultiselects(){var e=["Standard","Api"];this.ldMultigraphEnabled&&e.push("Business Units");e=e.map(function(e){return"Api"===e?{label:"API",value:"Api"}:{label:e,value:e}});var t=["25","50","75","100","All"];t=t.filter(e=>"All"===e||parseInt(e)<this.allPoolData.length,this),this.numLimitDropdown=new Magellan.Views.LDDropdown({required:!1,value:this.tableFilterState.poolsPerPage||t[0],options:t,customSelectedOptionTemplate:function(e){return _.template('<span class="placeholder-text">Display: <span class="semi-bold"><%-option%></span></span>')({option:e})},size:"small",placeholder:"Display: "+t[0],onChange:e=>{this.tableFilterState.poolsPerPage=e,this.initTableData(),this.tableRowCount="All"===e?this.tableData.length:parseInt(e),this.tableView=initializeTable.call(this)}}),$(this.$el.find(".pool-num-limit")).html(this.numLimitDropdown.$el);let i=new Set(this.tableFilterState.Usage);if(this.usageDropDown=new Magellan.Views.MultiSelectDropdown({selectAll:i.size===this.tableFilterStateSnapshot.Usage.length,hasAdaptiveDropdownWidth:!1,dropDownType:"Usage",options:this.tableFilterStateSnapshot.Usage.map(e=>({label:e,value:e})),selectedOptions:i,onChange:(e,t)=>{this.tableFilterState.Usage=t,this.applyTableFilters()},generatePlaceholder:function(e,t,i,a){return t.length===a?'Usage: <span class="semi-bold">All</span>':0===t.length?'Usage: <span class="semi-bold">None</span>':1===t.length?'Usage: <span class="semi-bold">'+t[0]+"</span>":'Usage: <span class="semi-bold">'+t.length+"</span>"}}),$(this.$el.find(".usage-type-multiselect")).html(this.usageDropDown.$el),this.isCalendaringRRPage){const e=new Set(this.tableFilterState.Distribution);return this.distributionDropDown=new Magellan.Views.MultiSelectDropdown({selectAll:this.tableFilterStateSnapshot.Distribution.length===this.tableFilterState.Distribution.length,hasAdaptiveDropdownWidth:!1,dropDownType:"Distribution",options:this.tableFilterStateSnapshot.Distribution.map(e=>({label:_.capitalize(e),value:e})),selectedOptions:e,onChange:(e,t)=>{this.tableFilterState.Distribution=t,this.applyTableFilters()},generatePlaceholder:function(e,t,i,a){return t.length===a?'Distribution: <span class="semi-bold">All</span>':0===t.length?'Distribution: <span class="semi-bold">None</span>':1===t.length?'Distribution: <span class="semi-bold">'+_.capitalize(t[0])+"</span>":'Distribution: <span class="semi-bold">'+t.length+"</span>"}}),void $(this.$el.find(".distribution-type-multiselect")).html(this.distributionDropDown.$el)}let a=new Set(this.tableFilterState.Pool_Type__c),n=new Set(this.tableFilterState.Object_Type__c),o=new Set(this.tableFilterState.LD_Business_Unit__c);this.poolsDropdown=new Magellan.Views.MultiSelectDropdown({selectAll:a.size===e.length,hasAdaptiveDropdownWidth:!0,dropdownType:"Pool Type",options:e,selectedOptions:a,onChange:(e,t)=>{for(let e=0;e<t.length;e++)if("API"===t[e]){t[e]="Api";break}this.tableFilterState.Pool_Type__c=t,this.applyTableFilters()},generatePlaceholder:function(e,t,i,a){return t.length===a?'Pool Type: <span class="semi-bold">All</span>':0===t.length?'Pool Type: <span class="semi-bold">None</span>':1===t.length?'Pool Type: <span class="semi-bold">'+t[0]+"</span>":'Pool Type: <span class="semi-bold">'+t.length+" Types</span>"}}),$(this.$el.find(".pool-type-multiselect")).html(this.poolsDropdown.$el),this.objectsDropdown=new Magellan.Views.MultiSelectDropdown({selectAll:n.size===this.sObjectSearchOptions.length,hasAdaptiveDropdownWidth:!1,dropdownWidth:300,dropdownType:"Object",options:this.sObjectSearchOptions,selectedOptions:n,onChange:(e,t)=>{this.tableFilterState.Object_Type__c=t,this.applyTableFilters()},generatePlaceholder:function(e,t,i,a){return t.length===a?'Object: <span class="semi-bold"">All</span>':0===t.length?'Object: <span class="semi-bold">None</span>':1===t.length?'Object: <span class="semi-bold">'+getSObjectTypeLabel(t[0])+"</span>":'Object: <span class="semi-bold">'+t.length+" Types</span>"}}),$(this.$el.find(".object-type-multiselect")).html(this.objectsDropdown.$el),this.businessUnitsDropdown=new Magellan.Views.MultiSelectDropdown({selectAll:o.size===this.buOptions.map(function(e){return{label:e,value:e}}).length,hasAdaptiveDropdownWidth:!0,dropdownType:"Business Unit",options:this.buOptions.map(function(e){return{label:e,value:e}}),selectedOptions:o,onChange:function(e,t){this.tableFilterState.LD_Business_Unit__c=t,this.applyTableFilters()}.bind(this),generatePlaceholder:function(e,t,i,a){return t.length===a?'Business Unit: <span class="semi-bold">All</span>':0===t.length?'Business Unit: <span class="semi-bold">None</span>':1===t.length?'Business Unit: <span class="semi-bold">'+t[0]+"</span>":'Business Unit: <span class="semi-bold">'+t.length+"</span>"}}),$(this.$el.find(".bu-multiselect")).html(this.businessUnitsDropdown.$el)}.call(this),this.initTableData(),this.applyTableFilters(),this.tableView=initializeTable.call(this),this.renderCheckboxes()}).then(()=>{this.bulkSyncModalInitialized||(this.bulkSyncModalInitialized=!0,this.initBulkSyncModal())})},processPoolUsageData:function(e){const t={liveRRCount:0,liveTSCount:0,scheduledRRCount:0,scheduledTSCount:0,liveDatatableCount:0,scheduledDatatableCount:0};return e?(e.forEach(e=>{"round robin"===e.nodeType&&"Live"===e.deploymentType?t.liveRRCount++:"round robin"===e.nodeType&&"Scheduled"===e.deploymentType?t.scheduledRRCount++:"territory segment"===e.nodeType&&"Live"===e.deploymentType?t.liveTSCount++:"territory segment"===e.nodeType&&"Scheduled"===e.deploymentType?t.scheduledTSCount++:"datatable"===e.nodeType&&("Live"===e.deploymentType?t.liveDatatableCount++:"Scheduled"===e.deploymentType&&t.scheduledDatatableCount++)}),t):t},processSearchTypeaheadData:function(){let e=[],t={},i={},a=[];for(let e in this.poolMembersData){let a=this.poolMembersData[e],n=a.attributes;a.membershipPoolIds&&(t[n.Id]={name:n.Name+"mmbr",label:n.Name,id:n.Id+"mmbr",userId:n.Id,pools:a.membershipPoolIds,objectType:"Member"}),a.managedPoolIds&&(i[n.Id]={name:n.Name+"mgmt",label:n.Name,id:n.Id+"mgmt",userId:n.Id,pools:a.managedPoolIds,objectType:"Manager"})}return this.poolData.forEach(e=>{let t=e.attributes;a.push({name:`${t.Grouping_Name__c}(${t.Id})`,label:`${t.Grouping_Name__c} (${t.Object_Type__c})`,id:t.Id,objectType:"Pool"})}),e=e.concat(a),Object.keys(t).forEach(i=>{e.push(t[i])}),Object.keys(i).forEach(t=>{e.push(i[t])}),e},initializePoolSearchTypeahead:function(){this.poolSearchTypeahead&&this.poolSearchTypeahead.remove();const e=(()=>this.tableFilterState.Search_Value__c?"string"==typeof this.tableFilterState.Search_Value__c?this.tableFilterState.Search_Value__c:this.tableFilterState.Search_Value__c.label:"")();e&&$(".clear-search-filter-btn").show(),this.poolSearchTypeahead=new Magellan.Views.NestedTypeaheadSelector({required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,disableEmptySearchString:!0,disableDownArrow:!0,placeholder:"Search for Pools, Members, and Managers",selection:[],currentTextValue:e,root:"root",filter:e=>{const t={Pool:[],Member:[],Manager:[]};e.forEach(e=>(("Pool"!==e.objectType||this.deletedPoolIds.has(e.id))&&(!e.objectType||1===e.pools.length&&this.deletedPoolIds.has(e.pools[0]))||t[e.objectType].push(e),!0));const i=[];return t.Pool.length>0&&(i.push({label:"Pools",isCategoryLabel:!0}),i.push(...t.Pool)),t.Member.length>0&&(i.push({label:"Pool Members",isCategoryLabel:!0}),i.push(...t.Member)),t.Manager.length>0&&(i.push({label:"Pool Managers",isCategoryLabel:!0}),i.push(...t.Manager)),i},data:{root:this.processSearchTypeaheadData()},onSelect:(e,t)=>{this.tableFilterState.Search_Value__c=t[0],this.applyTableFilters(),$(".clear-search-filter-btn").show()},customOnBlurTypeahead:e=>{"string"==typeof this.tableFilterState.Search_Value__c&&$(e.target).typeahead("val",this.tableFilterState.Search_Value__c)}}),$(".search-filter").html(this.poolSearchTypeahead.$el),this.$el.find(".search-filter").on("keyup",".typeahead-input",e=>{let t=$(e.target).val();!t||t.length<1?(this.tableFilterState.Search_Value__c="",this.applyTableFilters(),$(".clear-search-filter-btn").hide()):13===e.keyCode&&(this.tableFilterState.Search_Value__c=t,this.applyTableFilters(),$(".clear-search-filter-btn").show())})},events:{"click .ld-tab":"handleTabClick","click #add-pool-button":"handleAddPoolClick","click #import-pools-button":"handleImportButtonClick","change #uploadPools":"importFile","click .pools-table-container tr":"handlePoolRowClick","click .conditional-filter-checkbox":"toggleConditionalPoolFilter","click #clear-filter-link":"clearFilter","click #clear-search-link":"clearInput","click #roundrobin-pools .ld-table td, #roundrobin-pools .ld-table th":function(e){var t=$(e.target).find('input[type="checkbox"]');t.length>0&&(e.stopPropagation(),t.trigger("click"))},"draw.dt .pools-table-container":"renderCheckboxes","page.dt .pools-table-container":"handlePageChange","click #selected-pools-button":"handleSelectedPoolsButtonClick","click .pool-checkbox-col":"handlePoolRowCheckboxClick","click .all-pools-checkbox":"handleAllPoolsCheckboxClick","click .pools-table-container .segment-action":"handlePoolSegmentActionClick","click .view-pool-metrics-action":"handlePoolMetricsLinkClick","click .copy-action":"handleCopyActionClick","click .delete-action":"handleDeleteRowClick","click .pool-usage":"handlePoolUsageClick","mouseenter .pools-table-container tr":"handlePoolRowMouseenter","click .clear-search-filter-btn":"clearInput","keyup #rr-members-search-filter-input":"handleInputChange"},handlePageChange:function(){this.renderCheckboxes()},clearFilter:function(e){e.stopPropagation(),e.preventDefault();let t=this.tableFilterState.Search_Value__c;this.tableFilterState=_.cloneDeep(this.tableFilterStateSnapshot),this.tableFilterState.Search_Value__c=t,this.$el.find(".conditional-filter-checkbox").prop("checked",!1),this.usageDropDown.checkAllOptions(this),this.isCalendaringRRPage?this.distributionDropDown.checkAllOptions(this):(this.objectsDropdown.checkAllOptions(this),this.poolsDropdown.checkAllOptions(this),this.businessUnitsDropdown.checkAllOptions(this)),this.applyTableFilters()},clearInput:function(e){e.stopPropagation(),e.preventDefault(),$(".clear-search-filter-btn").hide(),this.poolSearchTypeahead.selection=[],this.poolSearchTypeahead.render(),this.tableFilterState.Search_Value__c="",this.applyTableFilters(),$("#round-robin-table-filter .typeahead.tt-input").val("")},handleCopyActionClick:function(e){e.stopPropagation();var t=$(e.target).closest("tr").prop("id");Magellan.Models.roundRobinPoolCopyMode=!0,this.close();var i=this.isCalendaringRRPage?"calendaring/round_robin_pools/creator/":"routing/round_robin_pools/creator/";window.sessionStorage.setItem("rrTableFilterState",JSON.stringify({tableFilters:this.tableFilterState,isCalendaring:this.isCalendaringRRPage})),_LeanData.Navigation.navigateByUrl(i+t)},handlePoolRowMouseenter:function(e){this.$el.find(".segment-action").removeClass("active")},handlePoolSegmentActionClick:function(e){e.stopPropagation();var t=$(e.target);t.closest("tr").prop("id");this.$el.find(".segment-action").removeClass("active"),t.closest(".segment-action").toggleClass("active",!0)},handlePoolUsageClick:function(e){e.stopPropagation();var t=$(e.target).closest("tr").prop("id");if(t){const e=`${this.isCalendaringRRPage?"calendaring":"routing"}/round_robin_pools/creator/${t}?openUsage=true`;_LeanData.Navigation.navigateByUrl(e)}},handleDeleteRowClick:function(e){e.stopPropagation();var t=$(e.target).closest("tr").prop("id");_LeanData.Notification.showLoadingOverlay("Fetching updated usage data"),_LeanData.FlowBuilderController.getPoolUsageInfo().then(e=>{e[t]?_LeanData.Notification.showConfirmationDialog({header:"Live or Scheduled Pools cannot be deleted",message:"Please remove this Round Robin Pool from your deployed or scheduled routing graphs then delete it."}):this.displayDeletePoolModal(t)}).finally(function(){_LeanData.Notification.hideLoadingOverlay()})},displayDeletePoolModal:function(e){_LeanData.Notification.showConfirmationDialog({header:"Delete Round Robin Pool",message:`Are you sure you want to delete this Round Robin Pool? ${this.isCalendaringRRPage&&"poolAndCategory"===this.bookitCountingMethod?"\nAll related meeting counts for these pool members will be deleted and cannot be recovered.":""}`,confirmButtonText:"Yes, Delete Round Robin Pool",onConfirm:()=>{_LeanData.Notification.showLoadingOverlay("Deleting Pool(s)"),_LeanData.RemotingRouter.deleteRoundRobinPools(JSON.stringify({settingsToDelete:[e]})).then(t=>{if("Success"===t){const t=this.tableView.table.page();this.tableView.table.row("[id="+e+"]").remove().draw(),this.deletedPoolIds.add(e),this.selectedPoolsIds.delete(e),this.renderCheckboxes(),this.tableView.table.page(Math.min(t,this.tableView.table.page.info().pages-1)).draw(!1),$(this.$el.find(".dataTables_empty")).html(getEmptyTableText.call(this));const i={delete_round_robin_pool:[{sfdc_pool_id:e,organization_id:window._LeanData._getOrganizationData().orgId}],delete_meeting_count:{poolIds:[e]}};return this.isCalendaringRRPage?_LeanData.RemotingRouter.syncPoolsAndMembers(JSON.stringify(i)):Promise.resolve("Pool Deletion Success")}return Promise.resolve("Pool Deletion Failure")}).then(e=>{_LeanData.Util.log(e)}).finally(function(){_LeanData.Notification.hideLoadingOverlay()})}})},handleSelectedPoolsButtonClick:function(e){let t=$(e.target);"Show Selected Only"===t.text()?(t.text("Return to Search and Filters"),this.numLimitDropdown.onChangeCallback("All"),this.$el.find(".right-col").css("visibility","hidden"),this.poolData=[],this.selectedPoolsIds.forEach(e=>{this.poolData.push(this.allPoolData.find(t=>t.attributes.Id===e))}),this.savedTableOrder=this.tableView.table.order(),this.tableView.table.order([]),this.initTableData(),this.tableView.table.clear(),this.tableView.table.rows.add(this.tableData),this.tableView.table.draw(),this.renderCheckboxes()):(t.text("Show Selected Only"),this.$el.find(".right-col").css("visibility",""),this.savedTableOrder&&this.tableView.table.order(this.savedTableOrder),this.applyTableFilters(),this.numLimitDropdown.onChangeCallback(this.numLimitDropdown.model.attributes.value),this.renderCheckboxes(),this.savedTableOrder=[])},handleAllPoolsCheckboxClick:function(e){var t=$(e.target),i=this.tableView.table.rows().data(),a=this.tableView.table.page(),n=Math.min(i.length,(a+1)*this.tableRowCount);if(t.is(":checked")||t.is(":indeterminate"))for(var o=a*this.tableRowCount;o<n;o++)this.selectedPoolsIds.add(i[o].Id);else for(o=a*this.tableRowCount;o<n;o++)this.selectedPoolsIds.delete(i[o].Id);0===this.selectedPoolsIds.size&&(this.applyTableFilters(),this.numLimitDropdown.onChangeCallback(this.numLimitDropdown.model.attributes.value),this.$el.find(".right-col").css("visibility",""),this.$el.find("#selected-pools-button").text("Show Selected Only")),this.dropdownRender(),this.renderCheckboxes()},handlePoolRowCheckboxClick:function(e){e.stopPropagation();const t=$(e.currentTarget),i=t.find(".pool-row-checkbox");if(t.hasClass("checkmark"))return;const a=t.closest("tr").prop("id");i.is(":checked")?this.selectedPoolsIds.add(a):this.selectedPoolsIds.delete(a),this.dropdownRender(),this.renderCheckboxes()},handlePoolRowClick:function(e){var t=$(e.target);if(!t.is(".checkmark")&&!t.is(".pool-usage")){var i=t.closest("tr").prop("id");if(i){var a=this.isCalendaringRRPage?"calendaring/round_robin_pools/creator/":"routing/round_robin_pools/creator/";window.sessionStorage.setItem("rrTableFilterState",JSON.stringify({tableFilters:this.tableFilterState,isCalendaring:this.isCalendaringRRPage})),_LeanData.Navigation.navigateByUrl(a+i+"?tabName=members")}}},handlePoolMetricsLinkClick:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target).closest("tr").prop("id");t&&window.open((this.isCalendaringRRPage?"#calendaring/round_robin_pools/":"#routing/round_robin_pools/")+t+"/metrics","_blank","noopener,noreferrer")},close:function(){this.undelegateEvents(),this.unbind()},initTableData:function(){this.tableData=[],_.each(this.poolData,e=>{if(!this.deletedPoolIds.has(e.attributes.Id)&&(this.ldMultigraphEnabled||"business units"!==e.attributes.Pool_Type__c)){var t=this.createPoolRowData(e);t.Id=e.attributes.Id,this.tableData.push(t)}})},handleAddPoolClick:function(e){e.preventDefault(),this.close();var t=this.isCalendaringRRPage?"calendaring/round_robin_pools/creator":"routing/round_robin_pools/creator";window.sessionStorage.setItem("rrTableFilterState",JSON.stringify({tableFilters:this.rrTableFilters,isCalendaring:this.isCalendaringRRPage})),_LeanData.Navigation.navigateByUrl(t)},dropdownRender:function(){let e=this.isConditionalPoolSelected(!0),t=this.isConditionalPoolSelected(!1),i=e||t,a=[{label:"Edit Members",command:()=>{this.addUsers(!1)}},{label:"Edit Managers",command:()=>{this.addUsers(!0)}},{label:"Conditional Pools",items:[{label:"Sync Membership",command:()=>{this.addUsers(!1,"sync")}}],disabled:!i,title:i?"":"There are currently no conditional pools selected"},{label:"Export",command:()=>{this.exportPools()}},{label:"Delete",command:()=>{this.deletePools()}}];a[2].items.push({label:"Enable Scheduled Sync",command:()=>{this.scheduleSelectedConditionalPools(!0)},disabled:!t,title:t?"":"Select at least 1 non-scheduled conditional pool"},{label:"Disable Scheduled Sync",command:()=>{this.scheduleSelectedConditionalPools(!1)},disabled:!e,title:e?"":"Select at least 1 scheduled conditional pool"}),_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ldc-tiered-dropdown-angular",inputs:{menuItems:a,disabled:0===this.selectedPoolsIds.size}})},isConditionalPoolSelected:function(e){return[...this.selectedPoolsIds].reduce((t,i)=>t||this.poolIdToPoolMap[i].attributes.Is_Conditional_Membership_Enabled__c&&this.poolIdToPoolMap[i].attributes.Is_Scheduled__c==e,!1)},scheduleSelectedConditionalPools:function(e){let t=[],i=[],a=[];this.selectedPoolsIds.forEach(e=>{1==this.poolIdToPoolMap[e].attributes.Is_Conditional_Membership_Enabled__c?(t.push(e),i.push(this.poolIdToPoolMap[e])):a.push(this.poolIdToPoolMap[e])});let n={description:e?"Set the following conditional pools to be scheduled sync with these settings:":"Scheduled sync will be removed for the following Pools:",tooltipContent:e?{title:"Scheduled Sync Settings",body:"Apply scheduled sync frequency and email notification settings configured under Round Robin Settings to indicate which Conditional Pools should be scheduled to sync and which recipients should be emailed of sync results."}:null,syncSettings:e?scheduledConditionalPoolSettings:null,conditionalPools:!0,successHighlightLabel:(e?"":"Scheduled ")+"Conditional Pool",successHighlightMessage:e?"will be scheduled to sync!":"will be removed from scheduled sync.",successPools:[{header:"Conditional Pools "+(e?"Scheduled to":"Removed from")+" Sync",pools:i}],warningHighlightLabel:"Pool",warningHighlightMessage:e?"will not be eligible for scheduled sync.":"will not be changed.",warningPools:[{header:"Non-Conditional Pools Selected",pools:a}],showCancelButton:!0,value:e};_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ld-round-robin-sync-modal",inputs:{header:(e?"Enable":"Disable")+" Scheduled Sync",options:n,confirmationButtonText:(e?"Enable":"Disable")+" Scheduled Sync",isVisible:!0}})},render:function(){var e=this.template({isCalendaringRRPage:this.isCalendaringRRPage,headerText:this.isCalendaringRRPage?"BookIt":"Round Robin",subheaderText:this.isCalendaringRRPage?"Round Robin":"Pools",hasAdminPermissions:this.hasAdminPermissions,multigraphEnabled:this.ldMultigraphEnabled,selectedPoolsIds:this.selectedPoolsIds,toggleLivePool:this.toggleLivePool,toggleConditionalPool:this.toggleConditionalPool});return this.$el.html(e),this.tableView=initializeTable.call(this),this.dropdownRender(),this.$el.find('#roundrobin-pools .pools-table-container input[type="search"]').css("top",""),$(".clear-search-filter-btn").hide(),this.renderCheckboxes(),this},renderMessageBadges:function(){const e=this.$el.find("ldc-message-badge-angular");e.length>0&&e.each((e,t)=>{if(!t.ngElementStrategy.componentRef)return;const i=t.dataset.id,a=this.poolIdToPoolMap[i],n=_LeanData.Util.createUnprovisionedRoundRobinFeaturesString(a.attributes),o=t.ngElementStrategy;o.setInputValue("data",{badgeText:"UPGRADE",header:"Unavailable Round Robin Pool Settings",message:`This Pool contains ${n} setting(s) unavailable in your current package. You will not be able to deploy changes with this Pool selected.`,type:"settings",size:"large"}),o.detectChanges()})},renderCheckboxes:function(){this.$el.find('.ld-table tr input[type="checkbox"]').prop("checked",!1),this.selectedPoolsIds.forEach(e=>{this.$el.find(".ld-table tr[id="+e+'] input[type="checkbox"]').prop("checked",!0)}),this.$el.find("#import-pools-button").attr("disabled",!this.ldBUAdmin&&!this.ldAdmin&&!this.bookitManager);var e=this.checkCurrentPageCheckboxesStatus();"none"===e?(this.$el.find(".all-pools-checkbox").prop("checked",!1),this.$el.find(".all-pools-checkbox").prop("indeterminate",!1)):"all"===e?(this.$el.find(".all-pools-checkbox").prop("checked",!0),this.$el.find(".all-pools-checkbox").prop("indeterminate",!1)):this.$el.find(".all-pools-checkbox").prop("indeterminate",!0),this.selectedPoolsIds.size>0?this.$el.find(".show-selected-pools-button").show():this.$el.find(".show-selected-pools-button").hide(),this.$el.find("#selected-pools-count").text(this.selectedPoolsIds.size)},checkCurrentPageCheckboxesStatus:function(){if(!this.tableView)return;let e=this.tableView.table.page(),t=this.tableView.table.rows().data().splice(e*this.tableRowCount,(e+1)*this.tableRowCount);return 0===this.selectedPoolsIds.size?"none":this.poolData.length>0&&t.every(e=>this.selectedPoolsIds.has(e.Id))?"all":"some"},checkSearchValue:function(e){if("string"==typeof this.tableFilterState.Search_Value__c&&this.tableFilterState.Search_Value__c.length>0)return e.attributes.Grouping_Name__c.toLowerCase().indexOf(this.tableFilterState.Search_Value__c.toLowerCase())>-1;switch(this.tableFilterState.Search_Value__c.objectType){case"Pool":return e.attributes.Id===this.tableFilterState.Search_Value__c.id;case"Manager":case"Member":return this.tableFilterState.Search_Value__c.pools.includes(e.attributes.Id);default:return!0}},applyTableFilters:function(){var e=this.tableView.table;let t=new Set;this.poolData=_.filter(this.allPoolData,(e,i)=>{if(this.fetchingPoolUsageData)return!0;if(this.tableFilterState.toggleConditionalPool&&!e.attributes.Is_Conditional_Membership_Enabled__c)return!1;if(this.poolUsageInfo&&!this.tableFilterState.Usage.includes(e.Usage))return!1;if(this.deletedPoolIds.has(e.attributes.Id))return t.add(i),!1;let a="Single Graph";"business units"===e.attributes.Pool_Type__c&&(a=e.attributes.LD_Business_Unit__c?e.attributes.buDeleted?"Deleted BU":e.attributes.buName:"BU Not Found");let n="business units"===e.attributes.Pool_Type__c?"Business Units":_.capitalize(e.attributes.Pool_Type__c||"Standard"),o=e.attributes.Distribution_Type__c||"order-based";return this.tableFilterState.Distribution.includes(o)&&this.tableFilterState.Usage.includes(e.Usage)&&this.tableFilterState.Object_Type__c.includes(e.attributes.Object_Type__c)&&this.tableFilterState.Pool_Type__c.includes(n)&&this.checkSearchValue(e)&&this.tableFilterState.LD_Business_Unit__c.includes(a)&&!this.deletedPoolIds.has(e.attributes.Id)}),this.allPoolData=_.filter(this.allPoolData,(e,i)=>!t.has(i)),this.initTableData(),e.clear(),e.rows.add(this.tableData),e.draw(),_.defer(this.renderMessageBadges.bind(this)),$(this.$el.find(".dataTables_empty")).html(getEmptyTableText.call(this)),this.renderCheckboxes()},exportPools:function(){$(this.$el).LoadingOverlay("show"),_LeanData.RemotingRouter.exportRoundRobinPools(Array.from(this.selectedPoolsIds)).then(e=>{var t="data:text/plain;charset=utf-8,"+encodeURI(JSON.stringify(e));download(t,"round-robin-pools.txt","text/plain"),this.selectedPoolsIds=new Set([]),this.renderCheckboxes()}).catch(e=>{this.openErrorModal("Failed to Export Round Robin settings")}).finally(()=>{$(this.$el).LoadingOverlay("hide")})},addUsers:function(e,t){if("sync"===t){let e=[];Array.from(this.selectedPoolsIds).forEach(t=>{this.poolIdToPoolMap[t].attributes.Is_Conditional_Membership_Enabled__c&&e.push(t)}),this.selectedPoolsIds=e}new Magellan.Views.AddUsersToPools({isCalendaringRRPage:this.isCalendaringRRPage,enabledSalesforceLicenses:this.ldOrgData.enabledSalesforceLicenses||[],advancedRRFeaturesEnabled:this.advancedRRFeaturesEnabled,mode:t}).open({poolIds:Array.from(this.selectedPoolsIds),mode:t,onConfirm:()=>{$(".modal-backdrop").remove(),this.fetchAndInitTable(),this.render(),this.selectedPoolsIds.clear()},managerMode:e}),this.selectedPoolsIds=new Set([]),this.renderCheckboxes()},deletePools:function(){let e=this.allPoolData.filter(e=>this.selectedPoolsIds.has(e.attributes.Id)&&this.poolUsageInfo[e.attributes.Id]);if(e.length>0){let t=`<div  style="align-items: left">\n                <p class="warning-note light-warning pool-delete-warning-note"><b>${e.length} Round Robin Pools</b> are currently deployed in live and/or scheduled graphs.<br>Please deselect them to continue bulk delete action.</p>\n                <p class="ld-body-medium-bold">Live / Scheduled Round Robin Pools (${e.length})</p><ul>`;e.forEach(e=>{t+=`<li>${_.escape(e.attributes.Grouping_Name__c)} (${this.poolUsageInfo[e.attributes.Id][0].objectType})`,t+=this.poolUsageInfo[e.attributes.Id][0].businessUnitId?` (${e.attributes.buName})`:"",t+="</li>"}),t+="</ul></div>",_LeanData.Notification.showConfirmationDialog({header:"Delete Round Robin Pool",message:t,confirmButtonText:"Ok, I Understand",showRejectButton:!1,onConfirm:()=>{}})}else _LeanData.Notification.showConfirmationDialog({header:"Delete Round Robin Pool",message:`Are you sure you want to delete these Round Robin Pool(s) (${this.selectedPoolsIds.size})?`,confirmButtonText:"Yes, Delete Round Robin Pool(s)",cancelButtonText:"Cancel",onConfirm:()=>{_LeanData.Notification.showLoadingOverlay("Loading Round Robin Pools"),_LeanData.RemotingRouter.deleteRoundRobinPools(JSON.stringify({settingsToDelete:Array.from(this.selectedPoolsIds)})).then(()=>{if(this.isCalendaringRRPage){window._LeanData._getOrganizationData().orgId;const e={delete_round_robin_pool:[]};for(let t of this.selectedPoolsIds.values())e.delete_round_robin_pool.push({sfdc_pool_id:t,organization_id:window._LeanData._getOrganizationData().orgId}),e.delete_meeting_count?e.delete_meeting_count.poolIds.push(t):e.delete_meeting_count={poolIds:[t]};return _LeanData.RemotingRouter.syncPoolsAndMembers(JSON.stringify(e))}return Promise.resolve("No Callout Needed")}).then(e=>{_LeanData.Util.log(e)}).catch(e=>{console.error("Error: ",e)}).finally(()=>{this.selectedPoolsIds.clear(),this.renderCheckboxes(),this.fetchAndInitTable()})},onCancel:()=>{this.renderCheckboxes()}})},handleImportButtonClick:function(e){e.preventDefault(),this.$el.find("#uploadPools").click()},getPoolString:function(e){return e>1?"Pools":"Pool"},importFile:function(e){var t=this.$el.find("#uploadPools")[0];if(""!==t.value){var i=new FileReader;i.onload=(e=>{var t=e.target.result;this.processUploadedFile(t),this.$el.find("#uploadPools")[0].value=null}),i.readAsText(t.files[0])}else this.openErrorModal("Please select a file to import")},processUploadedFile:function(e){var t={},i=JSON.parse(e);if(null!==i&&0!==Object.keys(i).length){var a=new Set(["versionSettings","rrScheduleSettings","LDMembers","allPools"]);for(let e of Object.keys(i))(e.includes("RR")||a.has(e))&&(t[e]=i[e]);var n=[],o=!1,l=!1,s=[],r=[];$(this.$el).LoadingOverlay("show"),_LeanData.DashboardAdminController.validateRRSettings(t).then(e=>{null!==e&&(e.hasOwnProperty("overlappingRoundRobinPools")&&(n=e.overlappingRoundRobinPools).forEach((e,t)=>{n[t]=e.replace(/\) \(/g,"/")}),e.hasOwnProperty("versionValidated")&&e.versionValidated.length>0&&(o="true"===e.versionValidated[0]),e.hasOwnProperty("overlappingPoolsWithNonExistentBU")&&(s=e.overlappingPoolsWithNonExistentBU).forEach((e,t)=>{s[t]=e.replace(/\) \(/g,"/")}),e.hasOwnProperty("buAdminHasAccessToImportedPools")&&(l="true"===e.buAdminHasAccessToImportedPools),e.hasOwnProperty("deprecatedLivePools")&&(r=e.deprecatedLivePools).forEach((e,t)=>{r[t]=e.replace(/\) \(/g,"/")}),this.performImport(t,o,n,s,l,r))}).finally(()=>{$(this.$el).LoadingOverlay("hide")})}else this.openErrorModal("No settings detected in the selected file. Please make sure the selected settings are populated with at least 1 setting.")},performImport:function(e,t,i,a,n,o){if(t)if(n)if(i.length>0||a.length>0){let t="";i.length>0&&(t+=`<div class="existing-pools-count"> ${(i=i.map(e=>_.escape(e))).length} Existing Round Robin ${this.getPoolString(i.length)} </div>\n            <div class="warning-note">\n              ${i.length} Round Robin ${this.getPoolString(i.length)} in this import already exist in this instance. If you continue importing, the existing <i>Pool Settings</i> and <i>Members</i> will be <b>overwritten</b> with the imported version. `,o.length>0&&(t+=`The detected Live Routing ${this.getPoolString(o.length)} will not be imported as Live Routing is no longer supported in this version of LeanData.`),t+=`</div>\n            <ul class="pool-list">\n              <li class="pool-list-item">${i.join('</li><li class="pool-list-item">')}</li>\n            </ul>`),a.length>0&&(t+=`<div class="existing-pools-count">${(a=a.map(e=>_.escape(e))).length} ${this.getPoolString(a.length)} with Missing Business Units</div>\n            <div class="warning-note">\n              ${a.length} Round Robin ${this.getPoolString(a.length)} in this import are associated with Business Units that do not exist in this org. We recommend creating the Business Units prior to importing their associated ${this.getPoolString(a.length)}. Otherwise, manual association will be required. `,o.length>0&&(t+=`The detected Live Routing ${this.getPoolString(o.length)} will not be imported as Live Routing is no longer supported in this version of LeanData.`),t+=`</div>\n            <ul class="pool-list">\n              <li class="pool-list-item">${a.join('</li><li class="pool-list-item">')}</li>\n            </ul>`),t+='<div class="footer-note">Do you want to continue the import and overwrite the existing Pool Members & Settings with the imported versions?<br><i>This action cannot be undone </i></div>',_LeanData.Notification.showConfirmationDialog({header:`Detected Round Robin ${this.getPoolString(i.length||a.length)} with Conflicts`,message:t,confirmButtonText:"Yes, Continue Import",onConfirm:()=>{this.importRRPools(e)}})}else o.length>0?_LeanData.Notification.showConfirmationDialog({header:`Live Routing ${this.getPoolString(o.length)} Not Supported`,message:`We detected Live Routing ${this.getPoolString(o.length)} in your import file. These were not imported as Live Routing is not supported in this version of LeanData.`,confirmButtonText:"OK",onConfirm:()=>{this.importRRPools(e)}}):this.importRRPools(e);else _LeanData.Notification.showConfirmationDialog({header:"Imported Pools must belong to your Business Unit",message:"LeanData detected that Pools in your import do not belong to your Business Unit.  BU Admins may only import Pools belonging to their Business Unit.  Please remove the other Pools and try again.",confirmButtonText:"Ok",showRejectButton:!1});else _LeanData.Notification.showConfirmationDialog({header:"Incompatible Version Detected",message:'This Salesforce org is on a LeanData version incompatible with the org that created the export. <br>          Please contact <a href="mailto: support@leandatainc.com">support@leandatainc.com</a> with the Org IDs used for import and export and request an upgrade. Once upgraded, try again.',confirmButtonText:"Ok",showRejectButton:!1})},toggleConditionalPoolFilter:function(e){this.tableFilterState.toggleConditionalPool=$(e.target).prop("checked"),this.applyTableFilters()},importRRPools:function(e){delete e.versionSettings,$(this.$el).LoadingOverlay("show"),_LeanData.RemotingRouter.importRoundRobinSettings(e,[]).then(e=>{if($(this.$el).LoadingOverlay("hide"),""===e.errors){let t={};return e.round_robin_pool&&(t.round_robin_pool=e.round_robin_pool),e.pool_member&&(t.pool_member=e.pool_member),e.delete_pool_member&&(t.delete_pool_member=e.delete_pool_member),e.meeting_count&&(t.meeting_count=e.meeting_count),_.isEmpty(t)?Promise.resolve(""):_LeanData.RemotingRouter.syncPoolsAndMembers(JSON.stringify(t))}return errorMsgs}).then(e=>{["","Heroku Sync Success","No Actions Taken"].includes(e)?_LeanData.Notification.showConfirmationDialog({header:"Success",message:"The import is complete.  LeanData Round Robin Pool Settings are now updated.",confirmButtonText:"Ok",showRejectButton:!1,onConfirm:()=>{_LeanData.Navigation.navigateByUrl("",{skipLocationChange:!0}).then(()=>{var e=this.isCalendaringRRPage?"calendaring/round_robin_pools":"routing/round_robin_pools";_LeanData.Navigation.navigateByUrl(e,{skipLocationChange:!1})})}}):this.openErrorModal("The following error(s) occured while importing settings: "+e)}).finally(()=>{$(this.$el).LoadingOverlay("hide")})},openErrorModal:function(e){_LeanData.Notification.showConfirmationDialog({header:"Error Ocurred",message:e,confirmButtonText:"Ok",showRejectButton:!1})}})}},function(e,t){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Models&&(Magellan.Models={}),void 0===Magellan.Collections&&(Magellan.Collections={}),Magellan.Models.Territory=Backbone.Model.extend({initialize:function(e){this.set(e),this.set({_cid:this.cid})}}),Magellan.Models.Territories=Backbone.Collection.extend({model:Magellan.Models.Territory,initialize:function(e){this.segmentId=e.segmentId,this.isDraft=e.isDraft,this.fetchRemoteData()},fetchRemoteData:function(){const e=this,t=$.Deferred();return _LeanData.TerritoryRouting.getOwnerIdToName(this.segmentId,this.isDraft).then(function(t){return e.ownerIdToNameMap=null!=e.ownerIdToNameMap?Object.assign(e.ownerIdToNameMap,t["name map"]):t["name map"],e.inactiveOwnerMap=null!=e.inactiveOwnerMap?e.inactiveOwnerMap:{},e.buIdsToRRNamesMap=null!=e.buIdsToRRNamesMap?Object.assign(e.buIdsToRRNamesMap,t.buIdsToRRNames):t.buIdsToRRNames,e.unprovisionedPools=new Set(t.unprovisionedPools),Object.keys(e.ownerIdToNameMap).forEach(function(i){t.inactiveUsers.includes(i)&&(e.inactiveOwnerMap[i]=e.ownerIdToNameMap[i])}),_LeanData.TerritoryRouting.getAllOwnerDataRemote("",!0)}).then(function(t){return e.ownerIdToNameMap=null!=e.ownerIdToNameMap?Object.assign(e.ownerIdToNameMap,JSON.parse(t["name map"])):JSON.parse(t["name map"]),e.owners=JSON.parse(t.owners),e.inactiveOwnerMap=null!=e.inactiveOwnerMap?e.inactiveOwnerMap:{},e.owners.forEach(function(t){!t.hasOwnProperty("IsActive")||t.IsActive||t.hasOwnProperty(ns+"Grouping_Name__c")||(e.inactiveOwnerMap[t.Id]=t.Name)}),_LeanData.TerritoryRouting.getTerritoryRoutingObjects(e.segmentId,e.isDraft)}).then(function(i){i&&i.territoryList&&0!==i.territoryList.length||_LeanData.Navigation.navigateByUrl("territory_segments");const a=[],n=new Set;i.territoryList.forEach(function(t){t[ns+"Original_Owner__c"]=t[ns+"Owner__c"],t.OwnerName=e.ownerIdToNameMap[t[ns+"Owner__c"]];const i=new Magellan.Models.Territory(t);a.push(i),e.unprovisionedPools.has(t.OwnerName)&&n.add(t.Id)}),e.unprovisionedTerritories=n,e.reset(a),e.segmentManagers=i.segmentManagers||[],e.segmentName=i.segmentName,e.buName=i.buName,e.buId=i.buId||null,1==e.isDraft&&(e.segmentName+=" - Draft"),e.ownerToTerritoriesMap=i.ownerToTerritoriesMap,e.ownerIds=_.keys(e.ownerToTerritoriesMap),hideLoadingOverlay(),t.resolve()}),t},createSingleTerritoryManagerPayload:function(e,t,i){const a={adminToAssign:[],adminToRevoke:[]};return t.forEach(t=>{a.adminToAssign.push({userId:t,territorySegmentId:e})}),(i||[]).filter(e=>!t.includes(e)).forEach(t=>{a.adminToRevoke.push({userId:t,territorySegmentId:e})}),JSON.stringify({adminToAssign:a.adminToAssign,adminToRevoke:a.adminToRevoke})},assignTerritorySegmentManager:function(e,t,i){const a=this.createSingleTerritoryManagerPayload(e,t,i);return _LeanData.RemotingRouter.assignOrRevokeAdminsForTerritorySegments(a).catch(e=>{console.error("Error during manager assignment:",e),_LeanData.Notification.showConfirmationDialog({header:"Error",message:"Territory Segment Managers can only be removed by LeanData admins with LeanData Custom Objects Full Access. Please reach out to your admin to remove a Territory Segment Manager from this Territory Segment",confirmButtonText:"OK",showRejectButton:!1})})},destroyChanges:function(){this.each(function(e){const t={};t[ns+"Owner__c"]=e.get(ns+"Original_Owner__c"),e.set(t)})},getChangeSet:function(){const e=[];return this.each(function(t){t.get("Id");t.get(ns+"Original_Owner__c")!==t.get(ns+"Owner__c")&&e.push({territoryId:t.get("Id"),newOwnerId:t.get(ns+"Owner__c")})}),e},submitChanges:function(){const e=this.getChangeSet();return 0===e.length?$.Deferred().resolve().promise():_LeanData.TerritoryRouting.handleApplyTerritoryReassignment(e,this.segmentId,this.isDraft)},hasChanges:function(){return this.getChangeSet().length>0}})}},function(e,t,i){const a=i(4);function setActiveTab(e){void 0!==e&&($(".ld-tabs-div .ld-tab").toggleClass("active",!1),$(".ld-tab."+e).toggleClass("active",!0))}function populateAssignmentDropdown(e,t){if(e.find(".assign-owner-dropdown").text()!==t){var i='<button type="button" style="background-image: url(\''+resourceURL+'/images/Down_Arrow_Icon.png\'); border-color: var(--ld-green);" class="assign-owner-dropdown lds-secondary-small-button dk-grey-1 bg-white">'+_.escape(t)+"</button>";e.replaceWith(i)}}function resetAssignmentDropdown(e){if("Select a new owner"!==e.find(".assign-owner-dropdown").text()){var t='<button type="button" style="background-image: url(\''+resourceURL+'/images/Down_Arrow_Icon.png\'); border-color: var(--lt-grey-2);" class="assign-owner-dropdown lds-secondary-small-button dk-grey-1 bg-white">Select a new owner</button>';e.replaceWith(t)}}e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={});let{asyncServiceCallHelper:e}=i(8),{requestModalResponse:t,createBUTypeahead:n,createIdToOwnerMap:o,createTerritoryToolTip:l,hasDuplicateName:s,createExistingPoolNames:r}=i(7);Magellan.Views.TerritorySegmentAssignments=Backbone.View.extend({template:_.template(i(219)),initialize:function(e){var t=this;return this.idToOwnerMap={},this.searchVal=window.Angela.Navigation.queryParams.query||"",this.onFirstRender=!0,this.isCalendaringTMPage=e.isCalendaringTMPage,_LeanData.Notification.showLoadingOverlay(),this.collection=new Magellan.Models.Territories({segmentId:Magellan.Navigation.selectedSegmentId,isDraft:1==e.isDraft}),this.buOptions=[],this.modalTypeMap={edit:{name:"#editTerritoryInput",typeahead:"#territory-bu-typeahead-edit",button:"#territory-create-button-2",warning:"#nameWarningDiv"}},this.listenTo(this.collection,"change",()=>{this.redrawAssignmentDropdowns()}),this.collection.fetchRemoteData().then(function(){t.render(),_LeanData.Notification.hideLoadingOverlay(),t.collection.trigger("change"),t.collection.segmentURL=1==e.isDraft?"draft/"+t.collection.segmentId:t.collection.segmentId}),this},handleManagerDelete:function(e){_.pull(this.managerListView.manager,e),this.managerListView.render()},events:{"click #segments-breadcrumb":"handleSegmentsBreadcrumbClick","click #manage-segment-button":"handleManageSegmentClick","click #edit-segment-button":"handleEditSegmentClick","click .segment-assignment-btn.save":"handleSaveChangesClick","click .segment-assignment-btn.cancel":"handleCancelChangesClick","click .ld-tab.owners":"switchTabToOwners","click .ld-tab.territories":"switchTabToTerritories","click tr.owner-row td:nth-child(-n+2)":"toggleOwnerRow","click .assign-owner-dropdown":"handleReassignDropdownClick","nestedTypeaheadSelector:select .ownerListTypeahead":"setNewOwner","keyup #segments-assignments-search-filter-input":"searchSegments","click .clear-search-filter-btn":"clearSearchInput"},searchSegments:_.debounce(function(){this.render(),this.$el.find("#segments-assignments-search-filter-input").focus()},500),clearSearchInput:function(e){e.stopPropagation(),e.preventDefault(),this.$el.find("#segments-assignments-search-filter-input").val(""),this.render()},handleManageSegmentClick:function(){var e=this.isCalendaringTMPage?"calendaring/territory_segments/editor/":"territory_segments/editor/";_LeanData.Navigation.navigateByUrl(e+this.collection.segmentURL)},handleEditSegmentClick:function(e){e.preventDefault();let i=this.collection.segmentName||"";$("#editTerritoryInput").val(i),this.selectedBU={value:this.collection.buId,label:this.collection.buName};const s=n({isCalendaringTMPage:this.isCalendaringTMPage,selectedBU:this.selectedBU});let r;$("#territory-bu-typeahead-edit").html(s.$el),function initializeManagerDropdown(e,t,i){this.managerListView&&(this.stopListening(this.managerListView),this.managerListView.remove(),this.managerListView=null);this.manager=[...this.collection.segmentManagers],this.idToOwnerMap={},t({idToOwnerMap:this.idToOwnerMap,manager:this.manager,initialManagerFetchDone:this.initialManagerFetchDone}).then(t=>{this.idToOwnerMap=t,this.managerListView=new a({manager:this.manager,idToOwnerMap:this.idToOwnerMap}),_.defer(i.bind(this,e)),$(".manager-list").html(this.managerListView.$el),$(`#${e}-modal .manager-list`).html(this.managerListView.$el),this.managerListView.render(),this.listenTo(this.managerListView,"deleteManager",this.handleManagerDelete)}).catch(e=>{console.error("Error in createIdToOwnerMap",e)});const n={selector:"ld-typeahead-angular#manager-dropdown",inputs:{required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchUsers,filter:_LeanData.Util.typeaheadDataFilter(this.manager,"Id"),placeholder:"Select territory segment manager(s)",selections:[]},events:{onSelect:e=>{const i=e[0];this.idToOwnerMap[i.Id]=i,this.manager.includes(i.Id)||this.manager.push(i.Id),this.managerListView.render(),t({idToOwnerMap:this.idToOwnerMap,manager:this.manager,initialManagerFetchDone:this.initialManagerFetchDone}),this.toggleLoadingMessage(!1),this.initialManagerFetchDone=!0,this.managerListView.render()}}};try{_LeanDataUtil.Backbone.loadAngularComponent({el:document},n)}catch(e){console.error("Error loading angular component:",e)}}.call(this,"territory-edit",o,l),s.disableTypeahead(!0),_.defer(l.bind(this,"territory-edit")),t("territory-edit").then(e=>{_LeanData.Notification.showLoadingOverlay("Saving Segment");const t=this.managerListView.manager;r=$("#editTerritoryInput").val(),_LeanData.TerritoryRouting.saveSegmentNameById(this.collection.segmentId,r,null),this.collection.assignTerritorySegmentManager(this.collection.segmentId,t,this.collection.segmentManagers),this.collection.segmentName=r}).then(()=>{_LeanData.Notification.hideLoadingOverlay(),this.selectedBU=this.defaultBU,this.collection.segmentName=r,$("#editTerritoryInput").val(""),this.collection.fetchRemoteData().then(()=>{this.render()})}),this.validate("edit")},handleSegmentsBreadcrumbClick:function(){var e=this.isCalendaringTMPage?"calendaring/territory_segments":"territory_segments";_LeanData.Navigation.navigateByUrl(e)},toggleLoadingMessage:function(e){let t=e?"none":"block";this.$el.find(".manager-list").css({display:t})},validate:function(e){e=e||"create";let t=($(this.modalTypeMap[e].name).val()||"").trim();const i=this.selectedBU?this.selectedBU.Id:null,a=s({inputName:t,buId:i,existingPoolNames:this.existingPoolNames});i||_LeanData._getOrganizationData().hasReadWriteAccess||!_LeanData._getOrganizationData().hasBUAdminAccess?a||t.length<1||t.length>30?($(this.modalTypeMap[e].button).toggleClass("disabled",!0),a?($(this.modalTypeMap[e].warning).text("This Territory Name is already in use. Please try another."),$(this.modalTypeMap[e].warning).show()):t.length>30?($(this.modalTypeMap[e].warning).text("This Territory Name has exceeded the character limit. Please try another."),$(this.modalTypeMap[e].warning).show()):($(this.modalTypeMap[e].warning).text(""),$(this.modalTypeMap[e].warning).hide())):($(this.modalTypeMap[e].button).toggleClass("disabled",!1),$(this.modalTypeMap[e].warning).hide()):$(this.modalTypeMap[e].button).toggleClass("disabled",!0)},getTooltipContent:function(){return this.collection.segmentManagers.map(e=>{const t=this.idToOwnerMap[e],i=t&&t.IsActive?t.Name:"(Inactive Manager)";return _.escape(i)+"<br/>"}).join("")},handleSaveChangesClick:function(e){e.preventDefault(),this.waitingScreen=Magellan.Controllers.GUI.appWaitingScreen.show("Saving Data..."),this.collection.submitChanges().then(e=>{"Success"!==e?(this.waitingScreen.resolve(),_LeanData.Notification.showConfirmationDialog({header:"Save Failure",message:"An error occurred while saving your changes",showRejectButton:!1})):this.$el.find(".dirty-bar").slideUp(500,()=>{Magellan.Navigation.promptAreYouSure=!1,this.collection.fetchRemoteData().then(()=>{this.waitingScreen.resolve(),this.collection.trigger("change"),this.render()})})})},handleCancelChangesClick:function(e){e.preventDefault(),_LeanData.Notification.showConfirmationDialog({header:"Undo Changes",message:"Are you sure you want to undo the changes you've made?",confirmButtonText:"Undo",onConfirm:()=>{this.$el.find(".dirty-bar").slideUp(500,()=>{this.collection.fetchRemoteData().then(()=>{this.render(),this.collection.trigger("change")})})}})},handleReassignDropdownClick:function(t){t.preventDefault();$(t.target).parent();var i=$(t.target).closest("tr"),a=i.data("ownerid"),n=i.is(".owner-row"),o=i.is(".owner-pivot-row"),l=n?null:i.data("territoryid"),s=n||o?a:$(t.target).closest("td").prev()[0].id,r=this.collection.ownerIdToNameMap[s]||s,d=$('<div class="ownerListTypeahead data-ownerid="'+(n?a:l)+'"></div>');$(t.target).replaceWith(d);var c=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:[],asyncServiceCall:async t=>await e(t,s,r,"view"),onSelect:(e,t)=>{(l?[l]:this.collection.models.reduce((e,t)=>(t.attributes.OwnerName===r&&e.push(t.attributes.Id),e),[])).forEach(e=>{this.collection.unprovisionedTerritories.delete(e)}),this.setProvisioningMessageBar()},filter:e=>e.filter(e=>(e[ns+"LD_Business_Unit__c"]=e[ns+"LD_Business_Unit__c"]||null,!e[ns+"Grouping_Name__c"]||e[ns+"LD_Business_Unit__c"]===this.collection.buId)),customObjectSuggestionTemplate:e=>e.attributes.type===ns+"Round_Robin_Pool__c"&&this.collection.unprovisionedPools.has(e.label)?'<div title="<%- title %>" class="pools-suggestion disabled"><p class="med-grey-1"><%- suggestion.label %> (UPGRADE) </p><p class="lt-grey-2"><%= suggestion.categories %></p></div>':'<div title="<%- title %>" class="pools-suggestion"><p><%- suggestion.label %></p><p><%= suggestion.categories %></p></div>'});i.find(".ownerListTypeahead").html(c.$el),c.$el.on("nestedTypeaheadSelector:select",this.setNewOwner.bind(this)),c.$el.find(".typeahead").focus()},setNewOwner:function(e,t){var i=$(e.target).closest("tr"),a=i.data("ownerid"),n=i.is(".owner-row"),o=n?null:i.data("territoryid"),l=[];if(n){var s={};s[ns+"Original_Owner__c"]=a,l=this.collection.where(s)}else l.push(this.collection.findWhere({Id:o}));this.collection.ownerIdToNameMap[t.selection[0][ns+"Grouping_Name__c"]||t.selection[0].Id]=t.selection[0].label,this.collection.ownerIds[this.collection.ownerIds.indexOf(a)]=t.selection[0].Id,l.forEach(e=>{e.set({[ns+"Owner__c"]:t.selection[0][ns+"Grouping_Name__c"]||t.selection[0].Id},{silent:!0})}),this.collection.trigger("change")},handleValidAutocompleteChange:function(e,t,i,a,n){var o=[];if(a){var l={};l[ns+"Original_Owner__c"]=i,o=this.collection.where(l)}else o.push(this.collection.findWhere({Id:n}));o.forEach(function(e){var i={};i[ns+"Owner__c"]=t,e.set(i)})},handleInvalidAutocompleteChange:function(e,t){resetAssignmentDropdown(e)},switchTabToOwners:function(){this.$el.find("#pivotByTerritory").hide(),this.$el.find("#pivotByOwner").show(),setActiveTab("owners")},switchTabToTerritories:function(){this.$el.find("#pivotByTerritory").show(),this.$el.find("#pivotByOwner").hide(),setActiveTab("territories")},toggleOwnerRow:function(e){const t=$(e.target).closest("tr").data("ownerid"),i=$(e.target).closest("tr");i.toggleClass("collapsed"),i.siblings('.owner-pivot-row[data-ownerid="'+t+'"]').css("display",i.is(".collapsed")?"none":"table-row")},redrawAssignmentDropdowns:function(){if(this.collection.ownerIds&&this.collection.models){var e=this;e.collection.ownerIds.forEach(function(t){var i=_.escape(t);e.$el.find(".owner-row[data-ownerid='"+i+"'] .pivot-table-dropdown-container").each(function(i){var a={};a[ns+"Original_Owner__c"]=t;var n=e.collection.where(a),o=n[0].get(ns+"Owner__c");!function hasSameOwner(e){var t=e[0].get(ns+"Owner__c");return e.filter(function(e){return e.get(ns+"Owner__c")===t}).length===e.length}(n)||o===t?resetAssignmentDropdown($(this).children()):populateAssignmentDropdown($(this).children(),e.collection.ownerIdToNameMap[o])})}),e.collection.models.forEach(function(t){var i=t.get(ns+"Owner__c"),a=t.get(ns+"Original_Owner__c");e.$el.find(".owner-pivot-row[data-territoryid='"+_.escape(t.get("Id"))+"'] .pivot-table-dropdown-container").each(function(t){i!==a?populateAssignmentDropdown($(this).children(),e.collection.ownerIdToNameMap[i]):resetAssignmentDropdown($(this).children())}),e.$el.find(".territory-row[data-territoryid="+t.get("Id").trim().split(" ").join("_")+"] .pivot-table-dropdown-container").each(function(t){i!==a?populateAssignmentDropdown($(this).children(),e.collection.ownerIdToNameMap[i]):resetAssignmentDropdown($(this).children())})}),e.collection.hasChanges()?(e.$el.find(".dirty-bar").slideDown(500),Magellan.Navigation.promptAreYouSure=!0):(e.$el.find(".dirty-bar").slideUp(500),Magellan.Navigation.promptAreYouSure=!1)}},renderManagersIcon:function(){const e=this.collection.segmentManagers||[],t={selector:"ldc-tooltip-angular#managers-tooltip",inputs:{tooltipZIndex:"3",content:{title:"Segment Managers",body:e.length>0?e.map(e=>{const t=this.collection.ownerIdToNameMap[e];return _.escape(t)+"<br/>"}).join("\n"):"None"},showOnHover:!0,tooltipWidth:"150px",maxHeight:"200px",iconName:"people"}};_LeanDataUtil.Backbone.loadAngularComponent(this,t)},render:function(){var e=this,t=this.$el.find(".ld-tab.territories").hasClass("active"),i=e=>e,a=e=>e,n=e=>e;this.onFirstRender?(e.searchVal=window.Angela.Navigation.queryParams.query,this.onFirstRender=!1):e.searchVal=j$("#segments-assignments-search-filter-input").val(),r({existingPoolNames:this.existingPoolNames,collection:this.collection}),_.defer(this.renderManagersIcon.bind(this)),_.isEmpty(this.searchVal)||(i=(e=>!_.isEmpty(e.territoryOwners)&&e.territoryOwners.some(e=>!_.isEmpty(e)&&-1!==e.toLowerCase().indexOf(this.searchVal.toLowerCase()))||!_.isEmpty(e.territoryNames)&&e.territoryNames.some(e=>!_.isEmpty(e)&&-1!==e.toLowerCase().indexOf(this.searchVal.toLowerCase()))),a=(t=>{let i;return e.collection.ownerIdToNameMap.hasOwnProperty(t)?i=e.collection.ownerIdToNameMap[t]:e.collection.ownerIdToNameMap.hasOwnProperty(t.toLowerCase())&&(i=e.collection.ownerIdToNameMap[t.toLowerCase()]),i&&-1!==i.toLowerCase().indexOf(e.searchVal.toLowerCase())}),n=(e=>!_.isEmpty(e.attributes.OwnerName)&&-1!==e.attributes.OwnerName.toLowerCase().indexOf(this.searchVal.toLowerCase()))),hideLoadingOverlay();var o=this.template({collection:e.collection,territories:e.collection.toJSON().filter(i),ownerIds:e.collection.ownerIds.filter(a),territoryModels:e.collection.models.filter(n),getOwnerName:e.getOwnerName});return this.$el.html(o),t?this.switchTabToTerritories():this.switchTabToOwners(),this.$el.find("#segments-assignments-search-filter-input").val(e.searchVal),this.setProvisioningMessageBar(),this},setProvisioningMessageBar:function(){0!==this.collection.unprovisionedTerritories.size?_LeanData.Notification.showMessage({type:"warn",header:" ",message:"This Segment contains Pools with Advanced Round Robin setting(s) unavailable in your current package. Upgrade or remove pools with unsupported settings to use this segment.",classes:"light-warning",closable:!1}):_LeanData.Notification.closeMessage("mainMessageBar")},getOwnerName:function(e){var t=this.collection.buId||null,i=this.collection.buIdsToRRNamesMap[t],a=this.collection.ownerIdToNameMap[e]||this.collection.ownerIdToNameMap[e.toLowerCase()];if(!a||this.collection.inactiveOwnerMap[e])return this.collection.inactiveOwnerMap[e]?"[error] "+this.collection.inactiveOwnerMap[e]+" (INACTIVE)":"005"===e.toString().substring(0,3)||"00G"===e.toString().substring(0,3)||15!==e.toString().replace(" ","").length&&18!==e.toString().replace(" ","").length?"[error] "+e+" (Owner Id not found)":"[error]"+e+"(Invalid Owner ID)";if(a!==e||i&&(i.includes(a)||i.includes(a.toLowerCase()))){const e=this.collection.ownerToTerritoriesMap[a]||[];return e.length>0&&this.collection.unprovisionedTerritories.has(e[0].Id)?"[error] "+a+" (UPGRADE)":a}return"[error] "+a+" (Round Robin Pools Not in Assigned BU)"}})}},function(e,t,i){e.exports=function(){"undefined"==typeof Magellan&&(Magellan={}),void 0===Magellan.Views&&(Magellan.Views={}),Magellan.Views.TerritorySegmentEditor=Backbone.View.extend({template:_.template(i(220)),initialize:function(e){var t=this;return this.isCalendaringTMPage=e.isCalendaringTMPage,this.colIdxToAttribute=[null,"Territory_Name",ns+"Owner__c",ns+"PostalCode__c",ns+"City__c",ns+"State__c",ns+"Country__c",ns+"Custom_Field__c",null],this.waitingScreen=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data..."),this.unprovisionedTerritoryGeos=new Set,this.collection=new Magellan.Models.TerritoryGeos(null,{segmentId:Magellan.Navigation.selectedSegmentId,isDraft:1==e.isDraft}),this.collection.fetchRemoteData().then(function(){t.render(),t.waitingScreen.resolve()}),this.collection.segmentURL=1==e.isDraft?"draft/"+t.collection.segmentId:t.collection.segmentId,this.listenTo(this.collection,"change",this.updateCellBorders),this.listenTo(this.collection,"change",this.updateValidationCell),this.listenTo(this.collection,"change",this.updateDirtyBar),this.listenTo(this.collection,"remove",this.updateDirtyBar),this},events:{"click #segments-breadcrumb":"handleSegmentsBreadcrumbClick","click #assignments-breadcrumb":"handleAssignmentsBreadcrumbClick","click #add-territory-buttton":"handleAddTerritoryClick","change #territory-routing-editor .territorySegmentsTableBody input":"handleDatatablesInputChange","click .deleteButton":"handleDeleteButtonClick","click .segment-edit-btn.cancel":"handleCancelButtonClick","click .segment-edit-btn.save":"handleSaveButtonClick","click #rename-button":"handleRenameButtonClick","keyup #territory-segment-editor-search-filter-input":"handleInputChange","click .clear-search-filter-btn":"clearSearchInput","nestedTypeaheadSelector:select .ownerListTypeahead":"setNewOwner"},handleSegmentsBreadcrumbClick:function(){var e=this.isCalendaringTMPage?"calendaring/territory_segments":"territory_segments";_LeanData.Navigation.navigateByUrl(e)},handleAssignmentsBreadcrumbClick:function(){var e=this.isCalendaringTMPage?"calendaring/territory_segments/assignments/":"territory_segments/assignments/";_LeanData.Navigation.navigateByUrl(e+this.collection.segmentURL)},handleRenameButtonClick:function(e){var t=this,i=this.collection.segmentName;this.$el.find("#editorSubHeader2").html('<input id="segment-name-editor">'),this.$el.find("#segment-name-editor").val(i).focus().keypress(function(e){13==e.which&&function submitName(e){if(""===e.trim())return;if(t.$el.find("#segment-name-editor").addClass("saving"),e.trim()===t.collection.segmentName)return void t.$el.find("#editorSubHeader2").html(_.escape(e));_LeanData.TerritoryRouting.saveSegmentNameById(t.collection.segmentId,e,t.collection.buId||null).then(function(i){if("Success"===i){t.collection.segmentName=e,t.$el.find("#editorSubHeader2").html(_.escape(e));var a=this.isCalendaringTMPage?"Dashboard#calendaring/territory_segments/editor/":"Dashboard#territory_segments/editor/";window.history.pushState("","",a+e.replace(/\//g,"%2f"))}else _LeanData.Notification.showConfirmationDialog({header:"Failed to rename segment",message:i,showRejectButton:!1})})}($(this).val())}).blur(function(e){t.$el.find("#editorSubHeader2").html(_.escape(i))})},handleCancelButtonClick:function(e){e.preventDefault(),_LeanData.Notification.showConfirmationDialog({header:"Undo Changes",message:"Are you sure you want to undo the changes you've made?",confirmButtonText:"Undo",onConfirm:()=>{var e=[];_.each(this.collection.models,t=>{this.collection.originalGeoAttributes.hasOwnProperty(t.cid)||e.push(t.cid)}),e.forEach(e=>this.collection.remove(e)),_.each(this.collection.originalGeoAttributes,(e,t)=>{if(this.collection._byId[t])this.collection.get(t).set(e);else{var i=new Magellan.Models.TerritoryGeo(e,{collection:this.collection});this.collection.add(i)}}),this.collection.modelsToDelete.clear(),this.$el.find(".dirty-bar").slideUp(500,()=>{this.render()}),delete this.collection.saveErrorsMap}})},handleSaveButtonClick:function(e){e.preventDefault();this.$el.find(".dirty-bar").slideUp(500);var t=Magellan.Controllers.GUI.appWaitingScreen.show("Loading Data...");this.collection.submitChanges().then(e=>{if(t.resolve(),"Success"!==e)_LeanData.Notification.showConfirmationDialog({header:"Save Failure",message:"The Territory name length cannot exceed 80 characters. If you have duplicate Territory names, LeanData may be auto-appending the owner name to prevent duplicates.<br/><br/>Please correct all rows highlighted in red to save.",showRejectButton:!1,onConfirm:()=>{this.updateDirtyBar();let t={};this.collection.modelsToChange.forEach(i=>{let a=i.newGeoId||i.attributes.Id;e[a]&&(t[i.cid]=e[a])}),this.collection.saveErrorsMap=t,this.datatable.draw()}});else{Magellan.Navigation.promptAreYouSure=!1;var i=this.isCalendaringTMPage?"calendaring/territory_segments/assignments/":"territory_segments/assignments/";_LeanData.Navigation.navigateByUrl(i+this.collection.segmentURL)}})},handleDeleteButtonClick:function(e){_LeanData.Notification.showConfirmationDialog({header:"Delete Territory",message:"Warning: Are you sure you want to delete this Territory?",confirmButtonText:"Yes, Delete Territory",onConfirm:()=>{var t=$(e.target).closest("tr"),i=t[0].id,a=this.collection.get(i),n=Boolean(t.data("isnewrow"));this.datatable.row(t).remove().draw(!1),this.collection.remove(i),n||(this.unprovisionedTerritoryGeos.delete(a.get("Id")),this.setProvisioningMessageBar(),this.collection.modelsToDelete.add(a),this.collection.trigger("remove",a))}})},handleDatatablesInputChange:function(e){var t=this,i=$(e.target).closest("tr"),a=i[0].id,n=this.collection.get(a),o={};i.children("td").each(function(e){var i=$(this).find("input").val(),a=t.colIdxToAttribute[e];null!==a&&a!==ns+"Owner__c"&&(o[a]=i)}),n.set(o)},updateValidationCell:function(e){var t=this.$el.find("tr[id="+e.cid+"]").find("td:first-child"),i=e.getValidationStatus();if(e.hasChanged()){if(i.errorMessages.length>0){t.html("");var a=$('<img src="'+resourceURL+'/images/Triangle_Error_Icon_node.png">').appendTo(t),n=$('<div class="error-messages">').appendTo(t);n.html(i.errorMessages.join(",<br> ")),a.on("mouseenter",function(){n.show()}).on("mouseout",function(){n.hide()})}else t.html('<img src="'+resourceURL+'/images/Checkmark_Icon_selected.svg">');this.collection.saveErrorsMap&&delete this.collection.saveErrorsMap[e.cid]}else t.html("")},updateCellBorders:function(e){var t=this,i=this.$el.find("tr[id="+e.cid+"]"),a=e.getValidationStatus();i.children().find("input").css("border","1px solid var(--lt-grey-2)"),e.fieldsChanged().forEach(function(e){var a=t.colIdxToAttribute.indexOf(e);2===a&&i.children(":nth-child("+(a+1)+")").find(".ownerListTypeahead").removeClass("input-invalid"),-1!==a&&7!==a&&i.children(":nth-child("+(a+1)+")").find("input").css("border","1px solid var(--ld-blue)")}),a.invalidFields.forEach(function(e){var a=t.colIdxToAttribute.indexOf(e);-1!==a&&7!==a&&i.children(":nth-child("+(a+1)+")").find("input").css("border","1px solid var(--ld-red")})},updateDirtyBar:function(e){this.collection.modelsToChange.size>0||this.collection.modelsToDelete.size>0?(this.$el.find(".dirty-bar").slideDown(500),this.$el.find(".dirty-bar .segment-edit-btn.save").attr("disabled",this.collection.invalidModels.size>0),Magellan.Navigation.promptAreYouSure=!0):(this.$el.find(".dirty-bar").slideUp(500),Magellan.Navigation.promptAreYouSure=!1)},handleAddTerritoryClick:function(e){e.preventDefault();var t=new Magellan.Models.TerritoryGeo(null,{isNewTerritory:!0,collection:this.collection});this.collection.newGeoId++,this.collection.add(t);var i=$('<tr data-isnewrow="true" id="'+t.cid+'">');i.append($("<td></td>"));for(var a=0;a<7;a++)i.append($('<td class="_modified-td"></td>'));i.append($('<td><div class="deleteButton ld-cross-icon-large"></div></td>')),this.datatable.row.add(i).draw();var n=this.colIdxToAttribute.indexOf(ns+"Owner__c");i.find("td:nth-child("+(n+1)+") input");this.datatable.order([1,"asc"]).draw(),i.find("td:nth-child(2) input").focus(),this.collection.invalidModels.add(t),this.collection.modelsToChange.add(t),this.collection.trigger("change",t)},setNewOwner:function(e,t){$(e.target);var i=$(e.target).closest("tr"),a=$(e.target).closest("td"),n=i[0].id,o=this.collection.get(n);a.addClass("_modified-td");var l=t.selection[0][ns+"Grouping_Name__c"]||t.selection[0].Id;if(l in this.collection.ownerIdToNameMap||(this.collection.ownerIdToNameMap[l]=t.selection[0][ns+"Grouping_Name__c"]||t.selection[0].Name),l in this.collection.ownerIdToNameMap){this.collection.ownerIdToNameMap[l];var s={};s[ns+"Owner__c"]=l,o.set(s)}},handleInputChange:function(e){let t=$(e.currentTarget).val();this.datatable.search(t).draw()},clearSearchInput:function(e){e.stopPropagation(),e.preventDefault(),this.$el.find("#territory-segment-editor-search-filter-input").val(""),this.datatable.search("").draw()},render:function(){hideLoadingOverlay();var e=this.template({collection:this.collection,ownerIdToNameMap:this.collection.ownerIdToNameMap});return this.$el.html(e),this.datatable=function initializeDataTablesEditor(){let{asyncServiceCallHelper:e}=i(8);window.alert=function(){var e=window.alert;return function(t){window.alert=e,0===t.indexOf("DataTables warning")?console.warn(t):e(t)}}();var t=this;$.fn.dataTable.ext.order["dom-text"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return"ownerListTypeahead"===e.firstElementChild.className?$("pre",e).html():$("input",e).val()})};var a=[],n=0;return _.each(this.collection.models,function(e){const i=e.get(ns+"Owner__c");a.push(["",e.get("Territory_Name"),_LeanData.Util.isUserQueueId(i)?t.collection.ownerIdToNameMap[i]:t.collection.ownerIdToNameMap[i.toLowerCase()],e.get(ns+"PostalCode__c"),e.get(ns+"City__c"),e.get(ns+"State__c"),e.get(ns+"Country__c"),e.get(ns+"Custom_Field__c"),'<div class="deleteButton ld-cross-icon-large"></div>',e.cid]),a[n]["data-cid"]=e.cid,n++}),$("#territoryGeosTable").DataTable({columnDefs:[{targets:[0,8],width:"20px",orderable:!1},{targets:[1,2,3,4,5,6,7],orderDataType:"dom-text",type:"string",orderable:!0,render:(e,t)=>"display"===t?`<input value="${_.escape(e)}">`:e},{targets:[2],width:"200px"},{targets:[1,3,4,5,6,7],width:"100%"}],data:a,order:[[1,"asc"]],paginate:!0,pageLength:10,scrollInfinite:!0,scrollCollapse:!1,searchDelay:0,deferRender:!1,dom:"frtp",select:!0,rowId:"data-cid",drawCallback:function(i){var a=t.colIdxToAttribute.indexOf(ns+"Owner__c");if($("#territoryGeosTable .territorySegmentsTableBody tr td:nth-child("+(a+1)+") > input, #territoryGeosTable .territorySegmentsTableBody tr td:nth-child("+(a+1)+")._modified-td > .ownerListTypeahead").each(function(i,a){var n=$(a),o=n.closest("tr");n.closest("td").removeClass("_modified-td");var l,s=o[0].id,r=t.collection.get(s),d=r.get("Id"),c=r.get(ns+"Owner__c"),h=t.collection.ownerIdToNameMap[c]||c;c&&h&&(l={Id:c,name:h,label:h});var p=$('<div class="ownerListTypeahead"></div>');n.replaceWith(p),t.collection.unprovisionedPools.has(h)&&t.unprovisionedTerritoryGeos.add(d);var u=new Magellan.Views.NestedTypeaheadSelector({required:!0,disableBreadcrumbs:!0,requireSelectionFromData:!0,selection:_.isEmpty(l)?[]:[l],asyncServiceCall:async t=>await e(t,c,h,"editor"),onSelect:()=>{t.unprovisionedTerritoryGeos.delete(d),t.setProvisioningMessageBar()},filter:function(e){return e.filter(e=>(e[ns+"LD_Business_Unit__c"]=e[ns+"LD_Business_Unit__c"]||null,!e[ns+"Grouping_Name__c"]||e[ns+"LD_Business_Unit__c"]===t.collection.buId))},customObjectSuggestionTemplate:e=>e.attributes.type===ns+"Round_Robin_Pool__c"&&t.collection.unprovisionedPools.has(h)?'<div title="<%- title %>" class="pools-suggestion disabled"><p class="med-grey-1"><%- suggestion.label %> (UPGRADE) </p><p class="lt-grey-2"><%= suggestion.categories %></p></div>':'<div title="<%- title %>" class="pools-suggestion"><p><%- suggestion.label %></p><p><%= suggestion.categories %></p></div>',customValidationFunction:e=>{const i=e.selection[0];return!!i&&(!t.unprovisionedTerritoryGeos.has(d)&&(!(t.inactiveOwnerMap&&t.inactiveOwnerMap[i.Id])||t.collection.ownerIdToNameMap[i[ns+"Grouping_Name__c"]]))}});p.html(u.$el),u.$el.on("nestedTypeaheadSelector:select",t.setNewOwner.bind(t));var m=r.originalAttributes[ns+"Owner__c"],g=t.collection.ownerIdToNameMap[m]||m;let f;if(l){if(_LeanData.Util.isUserQueueId(c)?f=l.Id:(f=l.Id.toLowerCase(),c=c.toLowerCase()),l.Id!=m&&l.name!=g)return;l&&null==t.collection.inactiveOwnerMap[f]&&null!=t.collection.ownerIdToNameMap[f]&&(c!==h||t.collection.buIdsToRRNamesMap[t.collection.buId]&&t.collection.buIdsToRRNamesMap[t.collection.buId].includes(c))||p.addClass("input-invalid")}}),t.collection.saveErrorsMap){$rows=t.$el.find("tr");for(var n=1;n<$rows.length;n++){let e=$rows[n].id;if(t.collection.saveErrorsMap[e]){let i=t.$el.find("tr[id="+e+"]"),a=i.find("td:first-child");a.html("");let n=$('<img src="'+resourceURL+'/images/Triangle_Error_Icon_node.png">').appendTo(a),o=$('<div class="error-messages">').appendTo(a);o.html("The Territory name length cannot exceed 80 characters. If you have duplicate Territory names, LeanData may be auto-appending the owner name to prevent duplicates.<br/><br/>Please correct all rows highlighted in red to save. "),n.on("mouseenter",function(){o.show()}).on("mouseout",function(){o.hide()}),i.children(":nth-child(3)").find("input").css("border","1px solid var(--ld-red")}}}}})}.call(this),this.collection.segmentName.endsWith(" - Draft")&&$("#rename-button").hide(),this.setProvisioningMessageBar(),this},setProvisioningMessageBar:function(){0!==this.unprovisionedTerritoryGeos.size?_LeanData.Notification.showMessage({type:"warn",header:" ",message:"This Segment contains Pools with Advanced Round Robin setting(s) unavailable in your current package. Upgrade or remove pools with unsupported settings to use this segment.",classes:"light-warning",closable:!1}):_LeanData.Notification.closeMessage("mainMessageBar")}})}},function(e,t,i){const a=i(4);function bUHandler(e,t){return function(i,a){var n=a.selection;e.selectedBU=n[0],e.validate(t)}}function createInputHandler(e,t){return function(i){e.validate(t)}}function initializeManagerDropdown(e,t,i,n){this.managerListView&&(this.stopListening(this.managerListView),this.managerListView.remove(),this.managerListView=null),this.manager=n||[];const o=()=>{"territory-add"===e&&(0===this.manager.length?$(this.modalTypeMap.add.button).attr("disabled",!0):$(this.modalTypeMap.add.button).attr("disabled",!1))};this.idToOwnerMap={},t({idToOwnerMap:this.idToOwnerMap,manager:this.manager,initialManagerFetchDone:this.initialManagerFetchDone}).then(t=>{this.idToOwnerMap=t,this.managerListView=new a({manager:this.manager,idToOwnerMap:this.idToOwnerMap}),_.defer(i.bind(this,e)),$(`#${e}-modal .manager-list`).html(this.managerListView.$el),this.managerListView.render(),this.listenTo(this.managerListView,"deleteManager",e=>{this.handleManagerDelete(e),o()})}).catch(e=>{console.error("Error in createIdToOwnerMap",e)}),o();const l={selector:"ld-typeahead-angular#manager-dropdown",inputs:{required:!1,disableBreadcrumbs:!0,requireSelectionFromData:!0,searchFunction:_LeanData.FlowBuilderController.searchUsers,filter:_LeanData.Util.typeaheadDataFilter(this.manager,"Id"),placeholder:"Select territory segment manager(s)",selections:[]},events:{onSelect:e=>{const i=e[0];this.idToOwnerMap[i.Id]=i,this.manager.includes(i.Id)||this.manager.push(i.Id),this.managerListView.render(),t({idToOwnerMap:this.idToOwnerMap,manager:this.manager,initialManagerFetchDone:this.initialManagerFetchDone}),o()}}};try{_LeanDataUtil.Backbone.loadAngularComponent({el:document},l)}catch(e){console.error("Error loading angular component:",e)}}e.exports=function(){i(6)();let{requestModalResponse:e,createBUTypeahead:t,createIdToOwnerMap:a,createTerritoryToolTip:n,hasDuplicateName:o,createExistingPoolNames:l}=i(7);return Backbone.View.extend({template:_.template(i(222)),tableTemplate:_.template(i(221)),initialize:function(e){this.existingPoolNames={},this.manager=e.managers||[],this.idToOwnerMap={},this.initialManagerFetchDone=0===this.manager.length,this.initializeModals(),this.delegateEvents(),this.collection=new Magellan.Models.TerritorySegments,this.buOptions=[],this.tableFilterBUs=this.buOptions,this.checkedBoxes=new Set([]),this.collection.on("all",this.renderTable,this),this.hasInitUpload=!1,this.searchVal="",this.isCalendaringTMPage=e.isCalendaringTMPage,this.pageTitle="Territory Management",this.isLoading=!0,this.loadedSegmentCount=0,this.isCalendaringTMPage&&(this.pageTitle="BookIt",e.defaultBU={Id:null,label:"Single Graph",value:null,name:null}),this.defaultBU=e.defaultBU,this.selectedBU=e.defaultBU,this.filteredSegments=[],_LeanData._getOrganizationData().statuses.multigraphEnabled||$(".territory-business-unit-modal").toggleClass("hidden",!0),this.modalTypeMap={create:{name:"#createTerritoryInput",typeahead:"#territory-bu-typeahead-create",button:"#territory-create-button-2",warning:"#nameWarningDiv"},add:{button:"#territory-add-button-2",warning:"#nameWarningDiv"},copy:{name:"#copyTerritoryInput",typeahead:"#territory-copy-bu-typeahead",button:"#territory-copy-button-2",warning:"#copyNameWarningDiv"},rename:{name:"#renameTerritoryInput",button:"#territory-rename-button-2",warning:"#renameNameWarningDiv"},edit:{name:"#editTerritoryInput",typeahead:"#territory-bu-typeahead-edit",button:"#territory-create-button-2",warning:"#nameWarningDiv"}},this.segmentsWithUnprovisionedPools={},_LeanData.FeatureProvisioning.isFeatureEnabled("FEATURE:ADVANCED_ROUND_ROBIN")||_LeanData.FlowBuilderController.getTerritorySegmentsWithUnprovisionedPools().then(e=>{this.segmentsWithUnprovisionedPools=e,this.renderTable()}).catch(e=>{console.error("Error retrieving territory segments with unprovisioned pools in territory-segments:",e)}),this.render(),this.pollingSegments=new Set([])},_getOptions:function(){return Object.keys(this.idToOwnerMap).filter(e=>!this.manager.includes(e))},handleManagerDelete:function(e){_.pull(this.managerListView.manager,e),this.managerListView.render()},events:{"click .ld-table td, .ld-table th":function(e){var t=$(e.target).find('input[type="checkbox"]');t.length>0&&(e.stopPropagation(),t.trigger("click"))},"click .ld-table tbody .checkbox-action-cell":"handlePoolTerritoryCheckboxClick","click #all-territory-segments-checkbox":"handleAllTerritoryCheckboxClick","click .deploy-action":"handleDeploySegmentClick","click .copy-action":"handleCopySegmentClick","click .export-action":"handleExportSegmentClick","click .upload-action":"handleUploadSegmentClick","click .replace-action":"handleReplaceSegmentClick","click .rename-action":"handleRenameSegmentClick","click .delete-action":"handleSegmentRowDeleteClick","click .edit-action":"handleSegmentRowEditClick","click .manage-action":"handleSegmentRowManageClick","click #csv-upload-instructions":"showInstructions","click #add-new-modal":"showAddNewModal","click #create-segment":"handleCreateSegmentClick","click #export-segments":"handleExportClick","click #territorySegmentTable tr":"handleSegmentRowClick","mouseenter #territorySegmentTable tr .errorIcon":"handleErrorMouseEnter","mouseout #territorySegmentTable tr .errorIcon":"handleErrorMouseOut","click #territorySegmentTable tr .segment-action":"handleSegmentRowActionClick","mouseenter #territorySegmentTable tr":"handleSegmentRowMouseEnter","keyup #territory-segments-search-filter-input":"searchSegments","click .clear-search-filter-btn":"clearSearchInput","click #hide-territory-modal":"hideTerritoryModal"},searchSegments:_.debounce(function(){this.renderTable(),this.$el.find("#territory-segments-search-filter-input").focus()},500),clearSearchInput:function(e){e.stopPropagation(),e.preventDefault(),this.$el.find("#territory-segments-search-filter-input").val(""),this.renderTable()},toggleLoadingMessage:function(e){let t=e?"none":"block";this.$el.find(".manager-list").css({display:t})},render:function(){return this.buOptions=[],_LeanData._getOrganizationData().hasReadWriteAccess&&this.buOptions.push("Single Graph"),this.tableFilterBUs=this.buOptions,this.collection.fetchRemoteData().then(e=>{var t=this.template({initialManagerFetchDone:void 0===this.initialManagerFetchDone||this.initialManagerFetchDone,segments:this.collection.toJSON().filter(e=>{const t=e[ns+"LD_Business_Unit__c"]?e[ns+"LD_Business_Unit__r"][ns+"Is_Deleted__c"]?"Deleted BU":e[ns+"LD_Business_Unit__r"].Name:"Single Graph";return this.buOptions.includes(t)||this.buOptions.push(t),this.tableFilterBUs.includes(t)}),pageTitle:this.pageTitle});l({existingPoolNames:this.existingPoolNames,collection:this.collection}),this.$el.html(t),this.initializeMultiselect(),this.isLoading=Boolean(this.collection.models.length),this.renderTable(),this.dropdownRender();let i=this,a={};this.loadedSegmentCount=i.collection.models.length;const n=_LeanData.RemotingRouter.getIdToNodeNamesPresenceMap();i.collection.models.forEach((e,t)=>{let o=e.attributes;const l="draft"===o.segmentType;a[o.Id+(l?"draft":"")]=t,Promise.all([n,_LeanData.TerritoryRouting.validateTerritorySegment(o.Id,o[ns+"Version__c"],l)]).then(([e,t])=>{const n=t.segmentUniqueId;if(!a.hasOwnProperty(n))return;const o=i.collection.models[a[n]].attributes;o.incorrectBUPool=t.isIncorrectBU,o.inactiveOwner=t.isInvalidSegment,o.segmentCount=t.segmentCount||0,o.isDeployed=e.hasOwnProperty(o.Id),o.territoryOwners=[],o.territoryNames=[],o.territoryOwners=t.segmentOwners,this.loadedSegmentCount--,this.loadedSegmentCount<=0&&(this.isLoading=!1)}).finally(()=>{this.renderTable()})})}),this},hideExistingErrorMessages:function(){this.errorMessageTimeout&&clearInterval(this.errorMessageTimeout),this.$el.find(".error-messages").hide()},handleErrorMouseEnter:function(e){e.stopImmediatePropagation(),this.hideExistingErrorMessages(),$(e.target).siblings(".error-messages").show()},handleErrorMouseOut:function(e){e.stopImmediatePropagation(),this.errorMessageTimeout=setTimeout(()=>{$(e.target).siblings(".error-messages").hide()},5e3)},handleAllTerritoryCheckboxClick:function(e){var t=$(e.target);const i=this.filteredSegments.filter(e=>"draft"!==e.segmentType);if(t.is(":checked")||t.is(":indeterminate"))for(let e of i)this.checkedBoxes.add(e._cid);else for(let e of i)this.checkedBoxes.delete(e._cid);this.dropdownRender(),this.renderCheckBoxStates()},handlePoolTerritoryCheckboxClick:function(e){e.stopPropagation();const t=$(e.currentTarget),i=t.find("#checkSegment");if(t.hasClass("checkmark"))return;const a=t.closest("tr").data("cid");i.is(":checked")?this.checkedBoxes.add(a):this.checkedBoxes.delete(a),this.dropdownRender(),this.renderCheckBoxStates()},handleDeploySegmentClick:function(e){var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),a=this.collection.get(i);_LeanData.Notification.showConfirmationDialog({header:"Deploy Draft Version",message:"Are you sure you want to overwrite your deployed territory data with this draft version?",onConfirm:()=>{showLoadingOverlay(),a.deploy().then(function(e){_LeanData.Notification.showConfirmationDialog({header:"New Territory Data has been deployed."===e?"Deploy Successful":"Deploy Failure",message:"New Territory Data has been deployed."===e?"Your Draft Territory Segment was successfully deployed. This Segment has overwritten the Live version.":"Your Segment failed to deploy.",showRejectButton:!1}),t.render(),$("#upload").val("")})}})},handleCopySegmentClick:function(i){i.stopImmediatePropagation();var a=this.$el.find(i.currentTarget).closest("tr").data("cid"),o=this.collection.get(a);const l=o.get(ns+"LD_Business_Unit__c")?o.get(ns+"LD_Business_Unit__r").Name:null;this.selectedBU={Id:o.get(ns+"LD_Business_Unit__c"),label:l||"Single Graph",value:l,name:l};const s=this.getUniqueName(o.get(ns+"Name__c"),o.get(ns+"LD_Business_Unit__c"));$("#copyTerritoryInput").val(s);const r=t({isCalendaringTMPage:this.isCalendaringTMPage,selectedBU:this.selectedBU});$("#territory-copy-bu-typeahead").html(r.$el),(this.defaultBU&&!this.isCalendaringTMPage||this.isCalendaringTMPage&&"Single Graph"===this.selectedBU.label)&&r.disableTypeahead(!0),_.defer(n.bind(this,"territory-copy")),e("territory-copy").then(e=>{showLoadingOverlay("Copying Segment");var t=$("#copyTerritoryInput").val();o.duplicate(t,this.selectedBU?this.selectedBU.Id:null).then(e=>{"Segment Not Found"===e?(hideLoadingOverlay(),_LeanData.Notification.showConfirmationDialog({header:"Failed to Copy Segment",message:error,showRejectButton:!1})):this.collection.fetchRemoteData().then(()=>{this.render()}),this.selectedBU=this.defaultBU})}),this.validate("copy")},handleExportSegmentClick:function(e){e.stopImmediatePropagation();var t=$(e.currentTarget).closest("tr").data("cid");this.collection.get(t).exportCSV()},handleUploadSegmentClick:function(e){this.hasInitUpload||(initUpload(!1,!0),this.hasInitUpload=!0);var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),a=this.collection.get(i);window.operation="territoryGeo",window.confirmTerritorySegmentReplacement=!1,window.uploadCompletedCallback=function(){t.render(),$("#upload").val("")},window.getParams=function(){return{operation,segment:a.get("Id")}},$(".selectFile").show(),$("#selectCSVModal").modal("show")},handleReplaceSegmentClick:function(e){this.hasInitUpload||(initUpload(!1,!0),this.hasInitUpload=!0);var t=this;e.stopImmediatePropagation();var i=$(e.currentTarget).closest("tr").data("cid"),a=this.collection.get(i);_LeanData.Notification.showConfirmationDialog({header:"Replace Territory Segment",message:"Warning: Uploading another CSV will overwrite and replace this one. Are you sure you want to overwrite this Segment?",confirmButtonText:"Yes, Replace Territory Segment",onConfirm:()=>{window.operation="territoryGeo",window.confirmTerritorySegmentReplacement=!0,window.uploadCompletedCallback=function(){t.render(),$("#upload").val("")},window.getParams=function(){return{operation,segment:a.get("Id")}},$(".selectFile").show(),$("#selectCSVModal").modal("show")}})},handleRenameSegmentClick:function(t){t.stopImmediatePropagation();let i=this;var a=this.$el.find(t.currentTarget).closest("tr").data("cid"),n=this.collection.get(a);this.selectedBU={Id:n.get(ns+"LD_Business_Unit__c")},e("territory-rename").then(e=>{showLoadingOverlay();var t=$("#renameTerritoryInput").val();n.rename(t).then(()=>{i.render()})}),$("#renameTerritoryInput").val(n.get(ns+"Name__c")),this.validate("rename")},handleSegmentRowMouseEnter:function(e){j$(".segment-action").toggleClass("active",!1)},handleSegmentRowActionClick:function(e){e.stopPropagation(),j$(e.target).toggleClass("active")},handleSegmentRowDeleteClick:function(e){e.stopImmediatePropagation();var t=this.$el.find(e.currentTarget).closest("tr").data("cid"),i=this.collection.get(t),a=this;_LeanData.Notification.showConfirmationDialog({header:"Delete Territory Segment",message:"Warning: Are you sure you want to delete this Segment?",confirmButtonText:"Yes, Delete Territory Segment",onConfirm:()=>{_LeanData.Notification.showLoadingOverlay("Deleting Territory Segment"),i.remove().then(function(){a.collection.fetchRemoteData().then(()=>{_LeanData.Notification.hideLoadingOverlay(),a.render()})}).catch(e=>{_LeanData.Notification.showConfirmationDialog({header:"Failed to Delete Territory Segment",message:e,showRejectButton:!1})})}})},handleSegmentRowEditClick:function(i){var o=this.$el.find(i.currentTarget).closest("tr").data("cid"),l=this.collection.get(o);let s=l.attributes[ns+"Name__c"]||"";_LeanData.TerritoryRouting.getTerritoryRoutingObjects(l.attributes.Id,!1).then(i=>{let o=i.segmentManagers||[];this.originalManagers=[...o],$("#editTerritoryInput").val(s),this.selectedBU={value:null,label:l.attributes.buName};const r=t({isCalendaringTMPage:this.isCalendaringTMPage,selectedBU:this.selectedBU});let d;$("#territory-bu-typeahead-edit").html(r.$el),initializeManagerDropdown.call(this,"territory-edit",a,n,o),r.disableTypeahead(!0),_.defer(n.bind(this,"territory-edit")),e("territory-edit").then(e=>{_LeanData.Notification.showLoadingOverlay("Saving Segment");const t=this.managerListView.manager;d=$("#editTerritoryInput").val(),_LeanData.TerritoryRouting.saveSegmentNameById(l.attributes.Id,d,null),this.collection.assignTerritorySegmentManager(l.attributes.Id,t,this.originalManagers),this.collection.segmentName=d}).then(()=>{_LeanData.Notification.hideLoadingOverlay(),this.selectedBU=this.defaultBU,this.segmentName=d,$("#editTerritoryInput").val(""),this.collection.fetchRemoteData().then(()=>{this.render()})}),this.validate("edit")})},handleSegmentRowManageClick:function(e){var t=this.$el.find(e.currentTarget).closest("tr").data("cid"),i=this.collection.get(t);const a="draft"===i.get("segmentType");var n=this.isCalendaringTMPage?"calendaring/territory_segments/editor/":"territory_segments/editor/";const o=a?"draft/"+i.get("Id"):i.get("Id");_LeanData.Navigation.navigateByUrl(n+o)},handleAddManagersClick:function(){this.selectedBU=this.defaultBU;let t=[];if($("#segmentsNumber").html(this.checkedBoxes.size),$("#selected-territories-list").empty(),this.checkedBoxes.size>0){let e='<ul style="list-style-type: disc; padding-left: 40px" id="user-names-container">';this.checkedBoxes.forEach(i=>{const a=this.collection.models.find(e=>e.cid===i),n=a?a.attributes[ns+"Name__c"]:"Unknown Segment",o=a?a.attributes.Id:null;o&&t.push(o),e+=`<li class="mb5">${n}</li>`}),e+="</ul>",$("#selected-territories-list").html(e)}else $("#selected-territories-list").html("<p>No territories selected.</p>");initializeManagerDropdown.call(this,"territory-add",a,n),$(this.modalTypeMap.add.button).toggleClass("disabled",!0),_.defer(n.bind(this,"territory-add")),e("territory-add").then(e=>{_LeanData.Notification.showLoadingOverlay("Saving Segment");const i=this.managerListView.manager;let a=[];for(var n=0;n<t.length;n++){let e=t[n],o=this.collection.assignTerritorySegmentManager(e,i,[]);a.push(o)}Promise.all(a).then(e=>(_LeanData.Notification.hideLoadingOverlay(),this.selectedBU=this.defaultBU,this.collection.fetchRemoteData())).then(()=>{this.render()}).catch(e=>{console.error("Error assigning managers:",e),_LeanData.Notification.hideLoadingOverlay()})})},dropdownRender:function(){this.checkedBoxes.size;let e=[{label:"Add Managers",command:()=>{this.handleAddManagersClick()}},{label:"Export CSV",command:()=>{this.handleExportClick()}}];_LeanDataUtil.Backbone.loadAngularComponent(this,{selector:"ldc-tiered-dropdown-angular",inputs:{menuItems:e,disabled:0===this.checkedBoxes.size}})},handleSegmentRowClick:function(e){if(!this.$el.find(e.target).is("th,#all-territory-segments-checkbox,.checkmark,.deleteIcon,.segment-action,.disabled,.no-click,.error-messages")){var t=j$("#territory-segments-search-filter-input").val(),i=this.$el.find(e.currentTarget).closest("tr").data("cid"),a=this.collection.get(i);if(a){var n=a.get("Id");if(a.attributes.hasOwnProperty(ns+"FileName__c")&&"Success"===a.get("uploadStatus")&&"draft"!==a.get("segmentType")||a.get("segmentCount")>0){var o=(this.isCalendaringTMPage?"calendaring/territory_segments/assignments/":"territory_segments/assignments/")+("draft"==a.get("segmentType")?"draft/":"")+n+(_.isEmpty(t)?"":"?query="+t);_LeanData.Navigation.navigateByUrl(o)}else if("draft"!==a.get("segmentType")){this.hasInitUpload||(initUpload(!1,!0),this.hasInitUpload=!0);var l=this;window.operation="territoryGeo",window.confirmTerritorySegmentReplacement=!1,window.uploadCompletedCallback=function(){l.render(),$("#upload").val("")},window.getParams=function(){return{operation,segment:a.get("Id")}},$(".selectFile").show(),$("#selectCSVModal").modal("show")}}}},handleCreateSegmentClick:function(i){i.preventDefault(),this.selectedBU=this.defaultBU;const o=t({isCalendaringTMPage:this.isCalendaringTMPage,selectedBU:this.selectedBU});$("#territory-bu-typeahead-create").html(o.$el),initializeManagerDropdown.call(this,"territory-create",a,n),this.isCalendaringTMPage&&o.disableTypeahead(!0),_.defer(n.bind(this,"territory-create")),e("territory-create").then(e=>{_LeanData.Notification.showLoadingOverlay("Saving Segment");var t=$("#createTerritoryInput").val();const i=this.managerListView.manager;_LeanData.TerritoryRouting.createTerritorySegment(t,this.selectedBU?this.selectedBU.Id:null).then(e=>this.collection.assignTerritorySegmentManager(e,i,[])).then(e=>{_LeanData.Notification.hideLoadingOverlay(),this.selectedBU=this.defaultBU,segment=t,$("#createTerritoryInput").val(""),this.collection.fetchRemoteData().then(()=>{this.render()})})}),this.validate("create")},handleExportClick:function(e){e&&e.preventDefault();var t=0;this.checkedBoxes.forEach(function(e){var i=this.collection.get(e);setTimeout(()=>{i.exportCSV()},250*++t)}.bind(this)),this.checkedBoxes.clear(),this.renderCheckBoxStates()},hideTerritoryModal:function(){j$("#selectCSVModal").modal("hide")},showInstructions:function(){j$(".selectFile").hide(),j$("#selectCSVModal").modal("show")},showAddNewModal:function(){j$(".selectFile").show(),j$("#createModal").modal("show"),j$("#createTerritoryInput").val("")},initializeModals:function(){j$("#modalDiv").append(createModal("edit","Edit Segment",'<div>Edit existing Segment name</div><input style="margin-left:100px; margin-right:80px;width:250px;height:24px" maxlength="30" type="text" id="editInput"/>',"Cancel","OK",null,"saveSegmentNameById()")),j$("#modalDiv").append(createModal("selectCSV",'<span class="subheader subheader-light">Creating a Segment</span>',_.template(i(218))(),null,null,null,null,null,300)),j$("#modalDiv").append(createModal("uploadFile","File Uploading",'<div id="uploadFileMessage">Upload in progress...</div>',null,"OK",null,null)),j$("#modalDiv").append(createModal("delete","Delete Territory Segment","Warning: Are you sure you want to delete this Segment? It will no longer be available in FlowBuilder.","Cancel","Delete",null,"deleteTerritorySegment(deleteId)")),j$("#modalDiv").append(createModal("replaceCSV","Replace Territory Segment","Warning: Uploading another CSV will overwrite and replace this one. Are you sure you want to overwrite this Segment?","Cancel","Replace",null,"handleConfirmReplace()")),j$("#modalDiv").append(createModal("deploy","Deploy Draft Version","Are you sure you want to overwrite your deployed territory data with this draft version?","Cancel","OK",null,"handleConfirmDeploy()")),j$("#modalDiv").append(createModal("undo","Undo Changes","Are you sure you want to undo the changes you've made?","Cancel","Undo",null,"undoAction()")),j$("#modalDiv").append(createModal("deploySuccess","Deploy Successful","Your Draft Territory Segment was successfully deployed. This Segment has overwritten the Live version.",null,"OK",null,null)),j$("#modalDiv").append(createModal("deployFailure","Deploy Failure","Your Segment failed to deploy.",null,"OK",null,null)),j$("#modalDiv").append(createModal("copyDupe","Copy Error","A copied territory segment already exists. Please rename your existing copy before trying to copy again.",null,"OK",null,null)),j$("#copyDupeModalText").css("color","red"),j$("#selectCSVModal .section").off(),j$("#selectCSVModal .section").on("click",function(e){j$(this).toggleClass("collapsed"),j$(this).next(".section-body").slideToggle()}),j$("#selectCSVModal #selectFile").on("click",function(e){j$("#selectCSVModal #upload").click()}),j$("#createModalText").css("height","110px"),j$("#createButtonDiv").append('<span class="modal-button-blue" style="opacity:0.3;display:none;" data-bs-dismiss="none" id="createButton3">Create<span class="nameHover">Duplicate, Blank, or Too Long</span></span>'),j$("#territory-create-extra").remove()},recursivePoll:function(){var e=this;0!=e.pollingSegments.size&&_LeanData.TerritoryRouting.getSegmentsStatuses(Array.from(this.pollingSegments)).then(t=>{if(t.hasOwnProperty("Finished")){for(var i=0;i<t.Finished.length;i++)e.pollingSegments.delete(t.Finished[i]);if(e.collection.fetchRemoteData().then(function(){e.render()}),0==e.pollingSegments.size)return}setTimeout(()=>{e.recursivePoll()},5e3)})},uploadStatusPoll:function(e){if(0!=e.length){for(var t=0;t<e.length;t++){let i='tr[data-id="'+e[t].substring(0,18)+'"]';e[t].endsWith("draft")&&(i+='[data-segmenttype="draft"]'),j$(i).LoadingOverlay("show",{image:"",text:"Upload In Progress",textColor:"#ffffff",textResizeFactor:"0.75",background:"rgba(53,189,224, 0.9)"}),j$(".loadingoverlay").css("z-index",1)}var i=this;0==i.pollingSegments.size&&setTimeout(()=>{i.recursivePoll()},5e3),e.forEach(e=>{i.pollingSegments.add(-1!=e.indexOf(".")?e.substring(0,e.indexOf(".")):e)})}},deleteStatusPoll:function(e){if(0!=e.length){for(var t=0;t<e.length;t++)j$('tr[data-id="'+e[t]+'"]').LoadingOverlay("show",{image:"",text:"Delete In Progress",textColor:"black",textResizeFactor:"0.75",background:"var(--lt-yellow-1)"}),j$(".loadingoverlay").css("z-index",1);var i=this;0==i.pollingSegments.size&&setTimeout(()=>{i.recursivePoll()},5e3),e.forEach(e=>{i.pollingSegments.add(-1!=e.indexOf(".")?e.substring(0,e.indexOf(".")):e)})}},renderTable:function(){hideLoadingOverlay(),this.searchVal=j$("#territory-segments-search-filter-input").val();var e=e=>e;_.isEmpty(this.searchVal)||(e=(e=>!_.isEmpty(e.territoryOwners)&&e.territoryOwners.some(e=>!_.isEmpty(e)&&-1!==e.toLowerCase().indexOf(this.searchVal.toLowerCase()))));var t=this.collection.toJSON().filter(e=>{const t=e[ns+"LD_Business_Unit__c"]?e[ns+"LD_Business_Unit__r"][ns+"Is_Deleted__c"]?"Deleted BU":e[ns+"LD_Business_Unit__r"].Name:"Single Graph";return this.tableFilterBUs.includes(t)}).filter(e),i=this.tableTemplate({segments:t,segmentsWithUnprovisionedPools:this.segmentsWithUnprovisionedPools,allOwners:t.allOwners,territoryList:t.territoryList,inactiveOwners:t.inactiveOwners,formatMomentDate:_LeanData.DateUtil.formatMomentDate,emptyTableText:function getEmptyTableText(e){if(!_.isEmpty(this.searchVal)&&0===e)return"No territory results found.";return'No territory segments exist. Click "Create Segment" then upload a CSV file with segment information and owners.'}.call(this,t.length),isLoading:this.isLoading,segmentToManagers:this.collection.segmentToManagers});this.$el.find("#territory-segments-search-filter-input").val(this.searchVal),this.$el.find("#territorySegmentTable").html(i);for(let e of Object.keys(this.modalTypeMap))$(this.modalTypeMap[e].name).off(),$(this.modalTypeMap[e].name).on("input",createInputHandler(this,e)),this.modalTypeMap[e].typeahead&&($(this.modalTypeMap[e].typeahead).off(),$(this.modalTypeMap[e].typeahead).on("nestedTypeaheadSelector:select",bUHandler(this,e))),"copy"!==e&&$(this.modalTypeMap[e].button).attr("disabled",!0);const a="BookIt"===this.pageTitle?"Territory Segments ":"Segments ";this.$el.find("#segmentSubheader").text(a+"("+t.length+")"),j$("#createTerritoryInput").off(),j$("#createTerritoryInput").on("input",createInputHandler(this)),j$("#territory-create-button-2").attr("disabled"),j$("#territory-add-button-2").addClass("disabled"),this.filteredSegments=t,this.refreshCheckboxList(),this.renderCheckBoxStates();var n=this.collection?this.collection.filter(e=>"draft"!=(e=e.attributes).segmentType&&e.hasOwnProperty(ns+"Upload_Status__c")&&0==e[ns+"Upload_Status__c"].indexOf("Processing")||"draft"==e.segmentType&&e.hasOwnProperty(ns+"Draft_Upload_Status__c")&&0==e[ns+"Draft_Upload_Status__c"].indexOf("Processing")).map(e=>"draft"!=e.attributes.segmentType?e.attributes.Id:e.attributes.Id+".draft"):[],o=this.collection?this.collection.filter(e=>"draft"!=(e=e.attributes).segmentType&&e.hasOwnProperty(ns+"Upload_Status__c")&&0==e[ns+"Upload_Status__c"].indexOf("Deleting")||"draft"==e.segmentType&&e.hasOwnProperty(ns+"Draft_Upload_Status__c")&&0==e[ns+"Draft_Upload_Status__c"].indexOf("Deleting")).map(e=>"draft"!=e.attributes.segmentType?e.attributes.Id:e.attributes.Id+".draft"):[];return this.uploadStatusPoll(n),this.deleteStatusPoll(o),this},renderCheckBoxStates:function(){this.$el.find('.ld-table tr input[type="checkbox"]').prop("checked",!1),this.checkedBoxes.forEach(function(e){this.$el.find(".ld-table tr[data-cid="+e+'] input[type="checkbox"]').prop("checked",!0)}.bind(this));const e=this.filteredSegments.filter(e=>"draft"!==e.segmentType).length;this.$el.find("#export-segments").attr("disabled",0===this.checkedBoxes.size),0===this.checkedBoxes.size?(this.$el.find("#all-territory-segments-checkbox").prop("checked",!1),this.$el.find("#all-territory-segments-checkbox").prop("indeterminate",!1)):this.checkedBoxes.size===e?(this.$el.find("#all-territory-segments-checkbox").prop("checked",!0),this.$el.find("#all-territory-segments-checkbox").prop("indeterminate",!1)):this.$el.find("#all-territory-segments-checkbox").prop("indeterminate",!0)},close:function(){this.unbind(),this.collection.unbind("all",this.renderTable)},refreshCheckboxList:function(){const e=new Set(this.filteredSegments.map(e=>e._cid));[...this.checkedBoxes].forEach(t=>{e.has(t)||this.checkedBoxes.delete(t)})},getUniqueName:function(e,t){let i="[COPY] "+e;for(;o({newName:i,buId:t,existingPoolNames:this.existingPoolNames});)i="[COPY] "+i;return i},validate:function(e){e=e||"create";let t=$(this.modalTypeMap[e].name).val().trim();const i=this.selectedBU?this.selectedBU.Id:null,a=o({inputName:t,buId:i,existingPoolNames:this.existingPoolNames});i||_LeanData._getOrganizationData().hasReadWriteAccess||!_LeanData._getOrganizationData().hasBUAdminAccess?a||t.length<1||t.length>30?($(this.modalTypeMap[e].button).attr("disabled",!0),a?($(this.modalTypeMap[e].warning).text("This Territory Name is already in use. Please try another."),$(this.modalTypeMap[e].warning).show()):t.length>30?($(this.modalTypeMap[e].warning).text("This Territory Name has exceeded the character limit. Please try another."),$(this.modalTypeMap[e].warning).show()):($(this.modalTypeMap[e].warning).text(""),$(this.modalTypeMap[e].warning).hide())):($(this.modalTypeMap[e].button).removeAttr("disabled"),$(this.modalTypeMap[e].warning).hide()):$(this.modalTypeMap[e].button).attr("disabled",!0)},initializeMultiselect:function(){$(".bu-multiselect").MultiSelectDropdown({selectAll:!0,dropdownType:"Business Unit",hasAdaptiveDropdownWidth:!0,options:this.buOptions.map(e=>({label:e,value:e})),onChange:(e,t)=>{this.tableFilterBUs=t,this.renderTable()},generatePlaceholder:(e,t,i,a)=>t.length===a?'Business Unit: <span class="semi-bold">All</span>':0===t.length?'Business Unit: <span class="semi-bold">None</span>':1===t.length?'Business Unit: <span class="semi-bold">'+t[0]+"</span>":'Business Unit: <span class="semi-bold">'+t.length+" Types</span>"})}})}},function(e,t,i){window.Magellan=window.Magellan||{Initializers:{},Models:{},Views:{},Controllers:{},Navigation:{},Validation:{}},window.initializeNewViews=i(48),window.initializeMagellanValidation=i(49),window.initializePendingDetail=i(38),window.initializePendingDetailView=i(41),window.initializePendingDetailTable=i(39),window.initializePendingDetailTableRow=i(40),window.initializePendingDetailModels=i(42),window.initializeAdvancedSettingsAccountCreationModule=i(33),window.accountRouterModule=i(32),window.caseRouterModule=i(34),window.contactRouterModule=i(35),window.opportunityRouterModule=i(37),window.initializeTerritorySegments=i(47),window.initializeTerritorySegmentAssignments=i(45),window.initializeTerritorySegmentEditor=i(46),window.initializeRoundRobinPools=i(44),window.initializeRoundRobinPoolsCreator=i(43),window.meetingRouterModule=i(36),i(26)(),i(12)(),i(25)(),i(17)(),i(21)(),i(16)(),i(10)(),i(24)(),i(23)(),i(20)(),i(31)(),i(18)(),i(28)(),i(27)(),i(14)(),i(13)(),i(11)(),i(22)(),i(19)(),i(15)(),i(30)(),i(29)(),window.modal_template=i(50),window.territory_rename=i(55),window.territory_create=i(53),window.territory_edit=i(54),window.territory_add=i(51),window.territory_copy=i(52),window.ld_initializeToolTip=function(e,t){var a=_.template(i(56))({title:t.title,body:t.body}),n=$(a).appendTo(e);t.fixedPosition?(n.css("position","fixed"),t.fixedLeft&&n.css("left",t.fixedLeft),t.fixedTop&&n.css("top",t.fixedTop)):t.renderOnLeft?(n.css("right","25px"),n.css("left","unset")):(n.css("right","unset"),n.css("left","25px")),t.width&&n.css("width",t.width),e.off(),e.click(function(e){e.stopPropagation(),t.clickableContent||e.preventDefault(),$(".page-content .ld-tooltip").not(n).fadeOut(100),$(e.target).hasClass("ld-tooltip-close-icon")||n.fadeIn(100)}),n.find(".ld-tooltip-close-icon").click(function(e){n.fadeOut(100)}),$(".page-content").off(),$(".page-content").click(function(e){$(e.target).closest(".ld-tooltip-hint").length||$(".ld-tooltip").fadeOut(100)})}},function(e,t){e.exports='<div> <div class="primary-action dropdown-button"><%- primaryAction.label %></div> <div class="dropdown-button expand-menu"> <div class=ld-caret-dark></div> </div> </div> <ul class=actions-menu></ul> '},function(e,t){e.exports="<div class=ld-body-medium> <div class=chatter-recipients-header-row> <div class=\"header-font flex align-center\" style=line-height:12px> <span>Recipient(s)</span> <span class=\"ld-tooltip-hint chatter-recipient-tooltip small-tooltip\" style=margin-left:5px></span> </div> <button type=button class=\"lds-secondary-small-button <%- classes['edit-recipients-button'] %>\"><%- recipientCards.length > 0 ? 'Edit' : 'Add' %> Recipients</button> </div> <div class=\"<%- classes['chatter-recipients-wrapper'] %>\"> <% _.each(recipientCards, function(card) { %> <div class=\"<%- card.valid ? 'recipient-card' : 'error-message recipient-card' %>\"><%- card.name %></div> <% }) %> <div class=\"<%- classes['empty-recipients-message'] %>\" style=margin-bottom:10px>No Recipients</div> </div> <div class=\"<%- classes['chatter-recipients-editor'] %>\"> <div class=\"recipient-editor-row <%- classes['next-owner-row'] %>\"> <label class=cb-container-small> <div class=\"owner-label <%- !hasOwnerField ? 'no-owner-field' : '' %>\">New Owner</div> <input <%- !hasOwnerField ? 'disabled' : '' %> type=checkbox name=next-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyPostOwner <%- recipientData.notifyPostOwner ? 'checked' : '' %> /> <span class=\"checkmark notif-owner-checkbox\"></span> </label> </div> <div class=\"recipient-editor-row <%- classes['previous-owner-row'] %>\"> <label class=cb-container-small> <div class=\"owner-label <%- !hasOwnerField ? 'no-owner-field' : '' %> \">Previous Owner</div> <input <%- !hasOwnerField ? 'disabled' : '' %> type=checkbox name=previous-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyPreOwner <%- recipientData.notifyPreOwner ? 'checked' : '' %> /> <span class=\"checkmark notif-owner-checkbox\"></span> </label> </div> <div class=\"recipient-editor-row <%- classes['additional-recipients-row'] %>\"> <label class=cb-container-small style=height:fit-content;display:inline-block> <div class=\"flex align-center\"> <span><%- _LeanData.AppState.PrimarySObjectType === \"Meeting\" ? \"Recipients \" : \"Additional Recipients\" %></span> <span class=\"ld-tooltip-hint additional-object-recipient-tooltip small-tooltip\" style=margin-left:5px></span> </div> <input type=checkbox name=additional-recipients-toggle class=\"subcontent-toggle additional-recipients-toggle\" <%- hasAdditionalObjectData ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent additional-recipients-content <%- hasAdditionalObjectData ? '' : 'hidden' %>\"></div> </div> <% _.each(additionalOptions, function(checked, name) {%> <div class=\"recipient-editor-row <%- classes['additional-recipients-row'] %>\"> <label class=cb-container-small style=height:fit-content;display:inline-block> <div style=display:flex;align-items:center> <%- name %> </div> <input type=checkbox name=\"<%- name %>\" class=additional-options-checkbox data-owner-type=\"<%- name %>\" <%= recipientData.additionalOptions[name] ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <% })%> <div class=\"recipient-editor-row <%- classes['user-row'] %>\"> <label class=cb-container-small style=height:fit-content;display:inline-block> <div style=display:flex;align-items:center>Chatter User(s)</div> <input type=checkbox name=user-toggle class=\"subcontent-toggle user-toggle\" <%- hasChatterUsers ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent chatter-user-recipients-content <%- hasChatterUsers ? '' : 'hidden' %> \"></div> </div> <div class=\"recipient-editor-row <%- classes['group-row'] %>\"> <label class=cb-container-small style=height:fit-content;display:inline-block> <div style=display:flex;align-items:center>Chatter Group(s)</div> <input type=checkbox name=group-toggle class=\"subcontent-toggle group-toggle\" <%- hasChatterGroups ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent chatter-group-recipients-content <%- hasChatterGroups ? '' : 'hidden' %> \"></div> </div> <button type=button class=\"lds-secondary-small-button save-receipients-button\">Done</button> </div> <div class=\"error-message chatter-recipients-error-messages\" style=font-size:10px;font-style:italic></div> </div> "},function(e,t){e.exports="<div class=\"modal fade confirmation-modal <%- largeModal ? 'large-modal' : ''%> <%- innerModal ? 'inner-modal' : ''%>\" style=\"<%- verticallyResizable ? 'padding-bottom: 100px' : ''%>\"> <div class=modal-dialog style=width:fit-content> <div class=modal-content style=height:initial> <% if (verticallyResizable) { %> <div style=text-align:center;padding-right:80px> <div class=\"bottom-handle vertical-drag-handle-img\" style=position:absolute;cursor:s-resize> </div> </div> <% } %> <div class=dg_inner-wrapper-header style=display:flex;justify-content:center;align-items:center;padding-top:10px;width:auto;margin-left:auto> <%=header%> </div> <% if (warningText) { %> <div class=\"ld-announcement-body modal-warning-message\"><%=warningText%></div> <% } %> <div class=modal-content-section style=\"height:initial;<%- noContentPadding ? 'padding:0px;' : '' %> \"> <div class=modal-content-text style=height:initial><%=message%></div> <% if (hasExtraContent) { %> <div class=modal-content-extra><%=footer%></div> <% } %> <% if (showTypeahead) { %> <div class=modal-nested-typeahead-selector style=overflow:visible></div> <% } %> </div> <div class=modal-button-section style=\" <%- verticallyResizable ?  'padding-bottom:30px !important;' : ''%> height:initial\"> <% if(!hideSecondaryButton) { %> <button type=button class=\"lds-tertiary-large-button cancel-button\"><%=secondaryButtonText%></button> <% } %> <button type=button class=\"lds-primary-large-button confirm-button\" style=margin-left:5px><%=primaryButtonText%></button> </div> </div> </div> </div> "},function(e,t){e.exports='<div class=add-additional-recipient-row> <div class=additional-recipient-typeahead style=flex:1></div> </div> <% _.each(additionalObjectsLabels, function(label, idx) { %> <div class=additional-recipient-row> <% if(!additionalObjectsValidity[idx]) { %> <div class=alert-icon-wrapper> <div class="validation-error-icon validation-error-icon-xtra-small"></div> <div class=alert-icon-content>This variable no longer exists or is not a valid user field.</div> </div> <% } %> <div class="additional-recip-col1 <%- additionalObjectsValidity[idx] ? \'\' : \'error-message\' %>"><%- label %></div> <div class=additional-recip-col2 style=justify-content:flex-end> <div class="remove-additional-recipient-row ld-cross-icon-grey-large" data-index="<%- idx %>"></div> </div> </div> <% }) %> '},function(e,t){e.exports="<div class=ld-body-medium> <div class=email-recipients-header-row> <div class=header-font style=line-height:12px>Recipient(s)</div> <button type=button class=\"lds-secondary-small-button <%- classes['edit-recipients-button'] %>\"><%- recipientCards.length > 0 ? 'Edit' : 'Add' %> Recipients</button> </div> <div class=\"<%- classes['email-recipients-wrapper'] %>\"> <% _.each(recipientCards, function(recipient) { %> <div class=\"recipient-card <%- !recipient.valid ? 'error-message' : '' %>\"><%- recipient.name %></div> <% }) %> <div class=\"<%- classes['empty-recipients-message'] %>\" style=margin-bottom:10px>No Recipients</div> </div> <div class=\"<%- classes['email-recipients-editor'] %>\"> <div class=\"recipient-editor-row <%- classes['next-owner-row'] %>\"> <label class=cb-container-small> <div class=\"owner-label <%- !hasOwnerField ? 'no-owner-field' : '' %>\">New Owner</div> <input <%- !hasOwnerField ? 'disabled' : '' %> type=checkbox name=next-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyPostOwner <%- recipientData.notifyPostOwner ? 'checked' : '' %> /> <span class=\"checkmark notif-owner-checkbox\"></span> </label> </div> <div class=\"recipient-editor-row <%- classes['previous-owner-row'] %>\"> <label class=cb-container-small> <div class=\"owner-label <%- !hasOwnerField ? 'no-owner-field' : '' %> \">Previous Owner</div> <input <%- !hasOwnerField ? 'disabled' : '' %> type=checkbox name=previous-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyPreOwner <%- recipientData.notifyPreOwner ? 'checked' : '' %> /> <span class=\"checkmark notif-owner-checkbox\"></span> </label> </div> <div class=\"recipient-editor-row new-object-owner-row <%- classes['new-object-owner-row'] %>\"> <label class=cb-container-small> <div>Created Object Owner</div> <input type=checkbox name=new-object-owner-checkbox class=notif-owner-checkbox data-owner-type=notifyNewObjectOwner <%- recipientData.notifyNewObjectOwner ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <div class=\"recipient-editor-row <%- classes['additional-recipients-row'] %> flex align-center\"> <label class=cb-container-small style=height:fit-content;display:inline-block> <div style=display:flex;align-items:center> <%- _LeanData.AppState.PrimarySObjectType === \"Meeting\" ? \"Recipients \" : \"Additional Recipients\" %> </div> <input type=checkbox name=additional-recipients-toggle class=\"subcontent-toggle additional-recipients-toggle\" <%- hasAdditionalObjectData ? 'checked' : '' %> /> <span class=checkmark></span> </label> <span class=\"ld-tooltip-hint additional-object-recipient-tooltip small-tooltip\"></span> <div class=\"recipient-editor-subcontent additional-recipients-content <%- hasAdditionalObjectData ? '' : 'hidden' %>\"></div> </div> <% _.each(additionalOptions, function(checked, name) {%> <div class=\"recipient-editor-row <%- classes['additional-recipients-row'] %>\"> <label class=cb-container-small style=height:fit-content;display:inline-block> <div style=display:flex;align-items:center> <%- name %> </div> <input type=checkbox name=\"<%- name %>\" class=additional-options-checkbox data-owner-type=\"<%- name %>\" <%= recipientData.additionalOptions[name] ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <% })%> <div class=recipient-editor-row> <label class=cb-container-small> <div>Email Addresses</div> <input type=checkbox name=emails-toggle class=\"subcontent-toggle emails-toggle\" <%- !_.isEmpty(recipientData.emails) ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"recipient-editor-subcontent <%- !_.isEmpty(recipientData.emails) ? '' : 'hidden' %> \"> <textarea rows=2 class=\"lds-textarea-large emails-text-area\" placeholder=\"e.g. bob@company.com, tim@company.com\"><%- !_.isEmpty(recipientData.emails) ? recipientData.emails.join(', ') : '' %></textarea> </div> </div> <button type=button class=\"lds-secondary-small-button save-receipients-button\">Done</button> </div> <div class=\"error-message email-recipients-error-messages\" style=font-size:10px;font-style:italic></div> </div> "},function(e,t){e.exports='<div class=ld-body-medium> <div class=email-template-row> <div class=email-template-selector></div> <span class="lds-link view-email-template-link">View Template</span> </div> <div class="error-message hidden email-template-error-message"></div> </div>'},function(e,t){e.exports="<label class=card-filter-card-container> <input type=radio style=display:none name=\"<%- name %>\" value=\"<%- value %>\" <%- checked ? 'checked' : '' %> > <div class=card-filter-card> <% if (icon) { %> <span class=card-filter-icon><%= icon %></span> <% } %> <span class=card-filter-label><%- label %></span> </div> </label> "},function(e,t){e.exports='<div class=ld-dropdown-toggle> <span class=ld-dropdown-value>Select One</span> </div> <ul class="dropdown-menu <%-menuAlignClass%>"> <li class=ld-dropdown-search-filter-container> <input type=text class=ld-dropdown-search-filter-input value="" placeholder=Search /> </li> </ul> '},function(e,t){e.exports='<input class=ld-input /> <span class=ld-input-label style="display:inline-flex;align-items:flex-start; <%-style ? style : \'\'%>"> <div style=display:flex> <label class=label-text></label> <img class=edit-icon src="<%-editIconURL%>"/> </div> <span class=ld-input-error></span> </span> '},function(e,t){e.exports="<div class=multiselect-dropdown-toggle><span class=placeholder-text><%- selectAll ? allSelectedPlaceholder : placeholder %></span></div> <ul class=multiselect-dropdown-menu style=width:200px> <li class=multiselect-toggle-all-list-item> <div class=multiselect-dropdown-option> <label class=\"<%- checkboxClass %>\"> <span class=toggleText><%- selectAll ? 'Deselect All' : 'Select All' %></span> <input type=checkbox disabled=disabled /> <span class=checkmark></span> </label> </div> </li> </ul> "},function(e,t){e.exports='<li class=multiselect-dropdown-option-list-item> <div class=multiselect-dropdown-option> <label class="<%- checkboxClass %>"><%- label %> <input type=checkbox data-value="<%- value %>" data-label="<%- label %>" disabled=disabled /> <span class=checkmark></span> </label> </div> </li>'},function(e,t){e.exports='<div class=control-group> <label class="control control--radio"> <div class=radio-labels> <span><%- label %></span> <br/> <span class=radio-sublabel><%- sublabel %></span> </div> <input type=radio class=default-radio-option name="<%- name %>" value="<%- value %>" <%- checked ? \'checked\' : \'\'%> /> <div class=control__indicator></div> </label> </div> '},function(e,t){e.exports="<div class=\"ld-selectable-list header <% _.isEmpty(header) ? 'hidden' : ''%>\"> <%-header%> </div> <ul class=ld-selectable-list style=height:250px;overflow:auto> <%_.each(model.get('data'), function(item, idx) {%> <li class=ld-selectable-list-item> <%=itemContentTemplate(item)%> </li> <%});%> </ul> <div class=\"ld-selectable-list footer\"> <span class=label-selected>Selected:&nbsp;&nbsp;</span> <span class=selected></span> <div class=\"error-message ld-text-danger\"></div> </div> "},function(e,t){e.exports="<table class=ld-table> <thead> <tr class=header-row> </tr> </thead> <tbody> </tbody> </table>"},function(e,t){e.exports='<div class=ld-body-medium> <div class=custom-message-wrapper> <% if (messageType === \'email\' || messageType === \'outreachCreateTask\') { %> <% if (messageType !== \'outreachCreateTask\') { %> <div class=ld-body-medium-bold style="padding:10px 5px 0;font-size:11px!important">Subject</div> <div class=custom-message-subject> <input placeholder="Enter Subject" class="lds-field-small subject-input" style=margin:0;width:96% value="<%- subject %>"/> </div> <% } %> <div class=ld-body-medium-bold style="padding:10px 5px 0;font-size:11px!important">Message</div> <% } %> <div class=custom-message-dropdowns> <div class=field-typeahead style=width:160px> <ld-typeahead-angular class=angular-component-in-magellan id=field-typeahead> </ld-typeahead-angular> </div> <% if (messageType === \'chatter\') { %> <div class=user-dropdown></div> <% } else { %> <button type=button class="lds-tertiary-small-button relative-date-btn">Insert Relative Date</button> <% } %> <% if (messageType === \'outreachCreateTask\') { %> <div class=restore-default-wrapper> <a class="lds-link restore-default <%= disabled?\'disabled\':\'\'%>"> Restore Default </a> </div> <% } %> </div> <div class=custom-message-text-area> <% if (messageType === \'chatter\') { %> <textarea placeholder="Add a message, insert fields, and post on User Chatter Feeds by adding them as a Recipient." rows=4 class="lds-textarea-large message-text-area" style=margin:0;width:96%><%- message %></textarea> <% } else { %> <textarea placeholder="Add a Message and Insert Variables" rows=4 class="lds-textarea-large message-text-area" style=margin:0;width:96%><%- message %></textarea> <% } %> </div> </div> <div class="error-message custom-error-message"></div> </div> '},function(e,t){e.exports='<span class=typeahead-input-container> <input class="typeahead typeahead-input" data-main-input=true type=text placeholder="<%-placeholder%>"> <%= disableDownArrow ? \'\' : \'<span class="ld-caret"></span>\' %> </span> '},function(e,t){e.exports='<div class=nts-selected-field> <span class="root nts-selected-node nts-parent-node"><%-root%></span> <span class=separator>&raquo;</span> <% _.each(selection, function(field) { %> <% if (hasChildren(field)) { %> <span <%-"title=\'"+field.name+"\'"%> class="nts-selected-node nts-parent-node"><%-field.label.replace(\' ID\', \'\')%></span> <span class=separator>&raquo;</span> <% } else { %> <span <%-"title=\'"+field.name+"\'"%> class="nts-selected-node nts-leaf-node"><%-field.label%></span> <% } %> <% }); %> </div>'},function(e,t){e.exports='<div class=multiselect-dropdown-option style=padding:0> <label class=cb-container-small style=height:auto;padding-left:35px> <div style=font-size:10px;line-height:30px><%- suggestion.label %></div> <% var check = false;\n    for (var i = 0; i < this.selection.length; i++){\n      if (suggestion.label === this.selection[i].label){\n        check = true; break;\n      }\n    }\n    if (check){ %> <input type=checkbox checked=checked name=multi-nestedtypeahead-checkbox class=multi-nestedtypeahead-checkbox data-label="<%- suggestion.label %>"/> <% } else {%> <input type=checkbox name=multi-nestedtypeahead-checkbox class=multi-nestedtypeahead-checkbox data-label="<%- suggestion.label %>"/> <% } %> <span class=checkmark style="margin:8px 0 0 10px"></span> </label> </div> '},function(e,t){e.exports="<div class=mnts-selected-list> <% _.each(selection, function(field) { %> <%\n        var lastIndex = selection.length - 1;\n        var punct = type === 'PICKLIST' ? ', ' : '; ';\n        var label = field.label;\n        if (selection[0].label == field.label){ %> <span class=mnts-node><%-label%></span> <% } else { %> <span class=mnts-node><%-punct + label%></span> <% } %> <% }); %> </div> "},function(e,t){e.exports="<div class=\"modal fade confirmation-modal <%- largeModal ? 'large-modal' : ''%> <%- innerModal ? 'inner-modal' : ''%> <%- modalClasses %>\" style=\"<%- verticallyResizable ? 'padding-bottom: 100px' : ''%>\"> <div class=modal-dialog style=width:fit-content> <div class=modal-content style=height:initial> <div class=paginated-modal-header-wrapper> <%=header%> </div> <% if (warningText) { %> <div class=\"ld-announcement-body modal-warning-message\"><%=warningText%></div> <% } %> <div class=modal-content-section style=\"height:initial;<%- noContentPadding ? 'padding:0px;' : '' %>\"> <div class=modal-content-text style=height:initial><%=message%></div> <% if (hasExtraContent) { %> <div class=modal-content-extra><%=footer%></div> <% } %> </div> <div class=modal-button-section style=height:initial> <button type=button class=\"lds-tertiary-large-button cancel-button\"><%=cancelButtonText%></button> <div class=pagination-button-container> <button type=button class=\"lds-tertiary-large-button back-button\"><%=backButtonText%></button> <button type=button class=\"lds-primary-large-button forward-button\"><%=forwardButtonText%></button> </div> </div> <% if (verticallyResizable) { %> <div style=text-align:center> <div class=\"bottom-handle vertical-drag-handle-img\" style=position:absolute;cursor:s-resize> </div> </div> <% } %> </div> </div> </div> "},function(e,t){e.exports='<div class=add-additional-recipient-row> <div class=additional-recipient-typeahead style=flex:1></div> </div> <% _.each(additionalObjectsLabels, function(label, idx) { %> <div class=additional-recipient-row> <div class=additional-recip-col1><%- label %></div> <div class=additional-recip-col2 style=justify-content:flex-end> <div class="remove-additional-recipient-row ld-cross-icon-grey-large" data-index="<%- idx %>"></div> </div> </div> <% }) %> '},function(e,t){e.exports=" <div class=header-font><%- editable ? 'Update ' + (objectLabelData.label || model.get('object') ) + ' Fields' : 'Additional Parameters' %></div> <div class=sofu-note-container> <div class=note-text><%- editable ? 'Specify ' + (objectLabelData.label || model.get('object') ) + ' fields and values to update.': 'Specify your additional parameter(s)' %></div> <% if(editable === true) { %> <div class=\"short-tooltip ld-tooltip-hint sofu-note-tooltip\"></div> <% } %> </div> <div class=\"update-header row\" style=margin-top:10px> <div class=\"update-field-column header-font col col-xs-3\" style=\"<%- editable ? \"width:24%\" : \"width:21.5%\" %> \"><%- editable ? 'Field' : 'Parameter' %></div> <div class=\"update-value-column header-font col col-xs-6\"><%- editable ? 'Value' : 'Parameter Value' %></div> </div> <div style=display:inline-grid class=sofu-field-updates-list> </div> <% if(editable == true) { %> <div class=\"add-rule-container row\" style=margin-top:10px;clear:both> <div class=\"add-rule-row-item col-xs-12\"> <div class=add-rule-div></div> <div class=header-font>Add field</div> <div class=empty-row-space></div> </div> </div> <% } %>"},function(e,t){e.exports='<div class=update-row-container> <div class="update-row row"> <div title="<%- update.get(\'field\') %>" class="update-field-column sofu-field-selector col col-xs-4"> </div> <div class="update-value-column col col-xs-6"> <div class=ld-input-group style=width:100%;height:32px;display:flex;align-items:flex-start;height:fit-content> <div class=ld-input-group-control style=width:220px;margin-top:1px;margin-right:2px> <input type=text style=width:212px;padding-left:8px;height:32px class="sofu-update-value sofu-date width-fill" placeholder="Enter Value" value="<%- update.get(\'value\') %>"/> <textarea class="sofu-update-value sofu-input lds-textarea-small vertical-resize-only" placeholder="Enter Value" style=width:190px;height:17px;line-height:1.5><%- _LeanData.Util.truncateText(update.get(\'value\'), 30) %></textarea> <div class="sofu-ld-dropdown hidden"></div> <div class="sofu-ld-typeahead hidden"></div> </div> <div class="ld-input-group-addon merge-field-insert-button-container"></div> </div> </div> <% if (!hideDeleteButton) { %> <div class="col col-xs-2"> <div class=sofu-delete-column></div> </div> <% } %> </div> <div class="sofu-error-feedback error-message"></div> </div> '},function(e,t){e.exports=' <div class=tuple-condition data-rule-index="<%- idx %>"> <div class=tuple-condition-num><%- idx + 1 %></div> <div class=tuple-condition-field></div> <div class=tuple-condition-operator></div> <div class=tuple-condition-operand> <input class="tuple-condition-operand-input lds-field-small <%- _.isEmpty(this.condition.operand) ? \'lds-field-invalid\' : \'\' %>" placeholder="<%- customPlaceholderText %>"/> <div class=tuple-condition-operand-dropdown></div> </div> <% if (!hideToggleColumn) { %> <div class=tuple-condition-radio> <% var groupId = \'tuple-condition-radio-group-\' + idx %> <% var fieldOptionId = groupId + \'-field\' %> <% var valueOptionId = groupId + \'-value\' %> <fieldset id="<%- groupId %>" class=tuple-fieldset-radiogroup> <input type=radio value=field id="<%- fieldOptionId %>" name="<%- groupId %>"> <label for="<%- fieldOptionId %>">Field</label> <input type=radio value=value id="<%- valueOptionId %>" name="<%- groupId %>"> <label for="<%- valueOptionId %>">Value</label> </fieldset> </div> <% } %> <div class=tuple-condition-delete style=margin-top:9px></div> </div> <div class=error-message></div> <%= showSeparatorPerRow ? "<hr class=\\"tuple-rule-separator\\">" : "" %> '},function(e,t){e.exports='<div class="tuple-conditions-header-row lds-column-header"> <div class=condition-num-column></div> <div class=condition-field-column><%- fieldObjectType %> Field</div> <div class=condition-operator-column>Operator</div> <div class=condition-operand-column><%- operandHeader %></div> <div class=condition-radio-column></div> <div class=condition-delete-column></div> </div> <div class=tuple-conditions-body> <div class=tuple-conditions-row></div> <%= showSeparatorPerRow ? "" : "<hr class=\\"tuple-rule-separator\\">" %> <button type=button class="add-tuple-condition-btn lds-secondary-small-button">Add Condition</button> <div class=rule-logic-container style="<%=(showRpnContent ? \'visibility: visible;\' : \'visibility: hidden;\')%>"> <div class=rule-logic-row> <div class=ld-field-label-small style=white-space:normal>Rule Logic</div> <input class="tuple-rule-logic-input lds-field-small <%- rpnLogicIsValid ? \'\' : \'lds-field-invalid\' %>" value="<%- logic %>"/> <div class=reset-tuple-rule-logic>Reset</div> </div> <div class=rule-logic-error-row></div> </div> </div> '},function(e,t){e.exports='<p class=ld-body-large>Select a field from the dropdown below.</p> <div class="field-selector-container ld-body-medium" style=width:95%;position:absolute;display:flex;align-items:center;justify-content:center> <label style=margin-right:10px>User Field </label> <div class=field-selector></div> </div>'},function(e,t){e.exports='<p class=ld-body-large>Select a field from the dropdown below.</p> <div class="field-selector-container ld-body-medium" style=width:95%;position:absolute;display:flex;align-items:center;justify-content:center> <label style=margin-right:10px>Chatter User</label> <div class=field-selector></div> </div>'},function(e,t){e.exports='<p class=ld-body-large>Select a variable from the dropdown below.</p> <div class="field-selector-container ld-body-medium" style=width:95%;position:absolute;display:flex;align-items:center;justify-content:center> <label style=margin-right:10px>Insert Variable</label> <div class=field-selector></div> </div>'},function(e,t){e.exports="<div style=display:flex> <div class=relative-date-modal-text></div> <% if (isComparison) { %> <div class=\"ld-tooltip-hint comparison-tooltip\" style=margin-left:5px;margin-bottom:-5px></div> <% } %> </div> <div class=relative-date-flex-container> <div class=relative-date-radio-container> <div> <input type=radio id=duration-today name=duration value=today checked=checked> <label for=duration-today> <div class=duration-today-label>Today <%- isDatetime == true ? '(Now)' : '' %></div> </label> </div> <div> <div style=float:left;margin-top:5px;height:50px> <input type=radio id=duration-num name=duration value=beforeAfter> <label for=duration-num> <input type=number id=duration-value name=duration-value style=margin-top:-5px;height:30px value=1 step=1 min=1> <div class=duration-label style=display:flex;align-items:center;margin-top:-5px> Day(s) <div class=ld-dropdown-small id=beforeAfterDropdown style=\"margin:0 5px;width:80px\"></div> Today <%- isDatetime == true ? '(Now)' : '' %> </div> </label> </div> </div> </div> </div>"},function(e,t){e.exports='<div class="waiting-message-wrapper text-center"></div> <div class=waiting-animation> <div class=sk-circle> <div class="sk-circle1 sk-child"></div> <div class="sk-circle2 sk-child"></div> <div class="sk-circle3 sk-child"></div> <div class="sk-circle4 sk-child"></div> <div class="sk-circle5 sk-child"></div> <div class="sk-circle6 sk-child"></div> <div class="sk-circle7 sk-child"></div> <div class="sk-circle8 sk-child"></div> <div class="sk-circle9 sk-child"></div> <div class="sk-circle10 sk-child"></div> <div class="sk-circle11 sk-child"></div> <div class="sk-circle12 sk-child"></div> </div> </div>'},function(e,t){e.exports='<div class=row> <div class="col col-xs-9 col-xs-offset-1"> <div class=account-owner-mapping-list-wrapper></div> </div> </div> <div id=respect-schedules-wrapper style=display:inline-block></div> <hr class=horizontal-line-separator> <div class="alternate-field-assignment-container offset-inline"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports='<div class="error-message account-teams-error-message"> </div> <div class=row> <div class="col col-xs-9 col-xs-offset-1"> <div class=account-team-rules-list-wrapper></div> </div> </div> <div id=respect-schedules-wrapper style=display:inline-block></div> <hr class=horizontal-line-separator> <div class="alternate-field-assignment-container offset-inline"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports="<div id=account-custom-field> Select account's custom user field: </div> <div id=account-custom-field-dropdown> <div class=user-field-selector></div> </div> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div>"},function(e,t){e.exports="<tr class=custom-field-row> <td class=lead-field-label>Lead Field</td> <td class=account-field-label>Account Field</td> <td class=delete-custom-row></td> </tr>"},function(e,t){e.exports="<% _.each(defaultFields, function(field) { %> <tr> <td class=default-row-col><%- field.leadField.label %></td> <td class=default-row-col><%- field.accountField.label %></td> <td></td> </tr> <% }); %>"},function(e,t){e.exports='<div class="ld-header-wrapper ld-header-wrapper-margins"> <div class="lds-header ld-header-bottom-margin">Advanced Settings</div> <div class="lds-subheader ld-header-bottom-margin">Account Creation</div> <div class=match-settings-header-info>Set field mapping preferences for the â€œCreate Accountâ€ action in FlowBuilder. These mappings apply when creating an Account without Lead conversion.<br> <i>Note: If creating an Account with Lead conversion, Salesforce will apply native Lead to Account field mappings.</i></div> </div> <div class=dg_inner-wrapper-secondaryheader> Set preferences for New Account Creation router action. Change lead-to-account field mappings, add new fields, and remove existing fields. </div> <div class=dg_inner-wrapper-content> <div class=dg_details-table-div> <table> <thead> <tr> <th style=width:45%>Lead Field</th> <th style=width:45%>Account Field</th> <th style=width:10%>Delete</th> </tr> </thead> <tbody id=account-creation-fields> </tbody> </table> <div class=add-container> <span class=add-new-row>Create New</span> </div> </div> </div> <div class=dg_inner-wrapper-footer> <div class=buttons-container> <button type=button id=save-mapping-button class="lds-primary-large-button ok requiresReadWrite">Save</button> </div> </div>'},function(e,t){e.exports="<div> <ld-variable-setter-angular id=contact-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title=\"Action â€“ Assign to Matched Opportunity Owner\"> <div id=main-div> <% if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class=\"ld-tooltip-hint main-host-tooltip small-tooltip\" style=margin-left:5px></span></div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } else {%> <span class=header-font>Contact Ownership</span> <% } %> <div class=\"horizontal-tabbing-option-div control-group\" class=routing-type-radio-control style=\"<%- _LeanData.AppState.isHandoffGraph ? 'margin-left: 20px !important' : '' %>\"> <label class=\"control control--radio <%- model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%>\">Matched Contact Owner <input type=radio class=\"default-radio-option routing-type-radio\" name=radio data-routing-type=\"contact owner\" <%- model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <label class=\"control control--radio <%- model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> \">Matched Contact Custom User Field <input type=radio name=radio class=routing-type-radio data-routing-type=\"custom field\" <%- model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=\"dropdown-label horizontal-tabbing-radio-option-sub-div\">Select the user field to assign the contact to</div> <div class=col style=width:50%;margin-left:10px><div class=custom-user-field-selector></div></div> </div> </div> </div> </div> <% if (!_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> "},function(e,t){e.exports="<div> <ld-variable-setter-angular id=contact-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title=\"Action â€“ Assign to Duplicate Contact Owner\"> <div id=main-div> <% if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class=\"ld-tooltip-hint main-host-tooltip small-tooltip\" style=margin-left:5px></span></div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } else {%> <span class=header-font>Contact Ownership</span> <% } %> <div class=\"horizontal-tabbing-option-div control-group\" class=routing-type-radio-control style=\"<%- _LeanData.AppState.isHandoffGraph ? 'margin-left: 20px !important' : '' %>\"> <label class=\"control control--radio <%- model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%>\">Duplicate Contact Owner <input type=radio class=\"default-radio-option routing-type-radio\" name=radio data-routing-type=\"contact owner\" <%- model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <label class=\"control control--radio <%- model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> \">Duplicate Contact Custom User Field <input type=radio name=radio class=routing-type-radio data-routing-type=\"custom field\" <%- model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=\"dropdown-label horizontal-tabbing-radio-option-sub-div\">Select the user field to assign the contact to</div> <div class=col style=width:50%;margin-left:10px><div class=custom-user-field-selector></div></div> </div> </div> </div> </div> <% if (!_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> "},function(e,t){e.exports="<div> <ld-variable-setter-angular id=contact-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title=\"Action â€“ Assign to Matched Opportunity Owner\"> <div id=main-div> <span class=header-font>Contact Ownership</span> <div class=\"horizontal-tabbing-option-div control-group\" class=routing-type-radio-control> <label class=\"control control--radio <%- model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%>\">Matched Contact Owner <input type=radio class=\"default-radio-option routing-type-radio\" name=radio data-routing-type=\"contact owner\" <%- model.nodeInfo['routing type'] === 'contact owner' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <label class=\"control control--radio <%- model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> \">Matched Contact Custom User Field <input type=radio name=radio class=routing-type-radio data-routing-type=\"custom field\" <%- model.nodeInfo['routing type'] === 'custom field' ? 'checked' : ''%> /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=\"dropdown-label horizontal-tabbing-radio-option-sub-div\"> Select the user field to assign the contact to </div> <div class=\"custom-user-field-selector horizontal-tabbing-dropdown-input\"></div> </div> </div> </div> </div> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> "},function(e,t){e.exports='<div class=modal-disabled-overlay style=display:none></div> <ldc-loading-overlay-angular class="angular-component-in-magellan modal-loading-overlay" style=display:none></ldc-loading-overlay-angular> <div class=members-tab> <div class=flexbox-container style=height:100%> <div class=users-col></div> <div class=members-col> <% if (showPoolList) { %><div class=pools-list style="margin:20px 0 0"></div><% } %> <div class="members-pane <%- !showPoolList ? \'members-pane-only\' : \'members-pane-and-pools\' %>"></div> </div> <div class="next-up-pane hidden"></div> </div> </div>'},function(e,t){e.exports='<% if (!readOnly) { %> <div class="conditional-toggle-pane flexbox-container center-y"> <div class="flexbox-container center-y"> <span class=ld-body-medium-bold>Conditional Membership</span> <span class="conditional-membership-tooltip ld-tooltip-hint small-tooltip"></span> </div> <div class="ld-toggle-group-small <%- advancedRRFeaturesEnabled || conditionalMembershipEnabled ? \'\' : \'disabled\' %>"> <div class="toggle-group-button off" data-type=off>Off</div> <div class=toggle-group-button data-type=on>On</div> </div> </div> <% } else { %> <div class=lds-section-header-small style="padding:5px 0 20px"> <%- pool.Grouping_Name__c %> </div> <% } %> <% if (conditionalMembershipEnabled) { %> <div class=conditional-sync-pane style=margin-bottom:10px> <div class="flexbox-container center-y"> <span class=ld-body-medium-bold>Scheduled Sync</span> <span class="scheduled-conditional-tooltip ld-tooltip-hint small-tooltip"></span> </div> <div class="scheduled-cb-container flexbox-container center-y" style=margin-top:10px> <label class=cb-container-small <%- readOnly ? \'disabled\' : \'\' %>> <input type=checkbox class=is-scheduled-pool <%- isPoolScheduled ? \'checked\' : \'\' %> <%- readOnly || !advancedRRFeaturesEnabled ? \'disabled\' : \'\' %> /> <span class=checkmark></span> </label> <span id=sync-frequency-string class=ld-body-medium></span> <div id=conditional-sync-notification-icon class=sync-notification-icon-wrapper style=margin-left:5px> <svg class=email-notification-content style=width:15px viewbox="0 0 12.5 10"> <use href=#mail-notification-icon></use> </svg> </div> </div> </div> <div class=ld-body-medium-bold style="padding-bottom:2px;border-bottom:.5px solid var(--med-grey-1)">Conditions</div> <ld-soql-condition-creator-angular class="angular-component-in-magellan soql-creator"> </ld-soql-condition-creator-angular> <div class="conditional-tab-filters filter-box-container <%- readOnly ? \'read-only\' : \'\' %>"> <div class=inactive-users-wrapper> <label class="cb-container-small <%- readOnly ? \'read-only\' : \'\' %>"> Include Inactive Users <input type=checkbox class=include-inactive-users <%- includeInactiveUsers ? \'checked\' : \'\' %> <%- readOnly ? \'disabled\' : \'\' %> /> <span class=checkmark></span> </label> </div> </div> <div class="main-button-wrapper sync-button-wrapper"> <button type=button id=sync-members-button class=lds-secondary-x-small-button style="<%- readOnly ? \'visibility:hidden;\' : \'\' %>"> Sync Membership</button> </div> <% if (showSyncResults) { %> <div class=conditional-membership-changes-section> <div class="flexbox-container center-y"> <span class=ld-body-medium-bold>Conditional Membership Changes</span> <span class="conditional-changes-tooltip ld-tooltip-hint small-tooltip"></span> </div> <% if (addedMembersFromSync.length) { %> <div id=added-users-button> <svg viewBox="0 0 10 10"> <use href=#Accordion-Icon></use> </svg> <span>Added (<%- addedMembersFromSync.length %>)</span> </div> <ul class=added-users-list style=display:none> <% addedMembersFromSync.forEach((member) => { %> <li><%- getMemberName(member) %></li> <% }) %> </ul> <% } %> <% if (removedMembersFromSync.length) { %> <div id=removed-users-button> <svg viewBox="0 0 10 10"> <use href=#Accordion-Icon></use> </svg> <span>Removed (<%- removedMembersFromSync.length %>)</span> </div> <ul class=removed-users-list style=display:none> <% removedMembersFromSync.forEach((member) => { %> <li><%- getMemberName(member) %></li> <% }) %> </ul> <% } %> <% if (addedMembersFromSync.length + removedMembersFromSync.length === 0) { %> <div>Sync produced no changes to the Pool Membership.</div> <% } %> </div> <% } %> <% } else { %> <div class=conditional-description-text> <div style=margin-bottom:10px>Determine pool membership based on the pool\'s membership conditions. <a class=lds-link href=https://leandatahelp.zendesk.com/hc/en-us/articles/360016462273 target=_blank>Learn More</a></div> <div>To begin, enable Conditional Membership and click \'Create Conditions\' or switch to free-form SOQL editor and edit the SOQL string.</div> </div> <% } %> '},function(e,t){e.exports="<div class=users-pane> <div class=header-container> <div class=\"lds-section-header-small flexbox-container center-y\"> <span>Users</span> <% if (showPoolList) { %> <span class=\"enabled-licenses-tooltip ld-tooltip-hint medium-tooltip\"></span> <% } %> </div> <div class=\"show-filters lds-link\"> <%- showFilters ? 'Hide' : 'Show' %> Filters</div> </div> <div class=filters-container> <div class=filter-box-container> <div class=filter-box-text>Include</div> <div class=inactive-users-wrapper> <label class=cb-container-small> Inactive Users <input type=checkbox class=include-inactive-users <%- userFilterOption === 'showInactive' ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <% if (!managerMode) { %> <div class=users-in-pool-wrapper> <label class=cb-container-small> Users Already in Pools <input type=checkbox class=include-users-in-pool <%- showUsersInPool ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <% } %> </div> <div class=flexbox-container style=margin-bottom:5px> <div style=margin-right:10px class=user-filter-key-dropdown></div> <div style=flex-grow:1;max-width:180px class=\"<%- userFilterKey && userFilterKey !== 'Queues' ? '' : 'hidden' %> user-filter-value-typeahead\"></div> </div> </div> <div class=search-filter style=display:flex;align-items:center></div> </div> <div class=flexbox-container style=align-items:baseline> <div style=flex:1;font-size:12px class=\"select-all lds-link <%-users.length === 0 ? 'disabled' : ''%>\">Select All</div> <div class=search-filter> <input style=flex:3 class=search-users id=search-filter-input placeholder=\"Find a User\" value=\"<%- queryString %>\" autocomplete=off /> <button class=\"clear-search-filter-btn <%- (typeof queryString != 'undefined' && queryString.length > 0) ? '' : 'hidden' %>\" type=button></button> </div> </div> <div class=users-container> <ul class=user-list style=padding-left:0;margin-bottom:0> <% Object.values(users).forEach(function(user, idx) { %> <% let isActive = user.IsActive || user.Type === 'Queue' || user.type === 'Queue'; %> <li data-id=\"<%- user.Id %>\" class=user> <div class=\"card user-card\"> <label class=cb-container-small> <input data-id=\"<%- user.Id %>\" type=checkbox class=user-to-add /> <span class=checkmark style=margin-top:3px></span> </label> <span class=\"name <%- isActive ? '' : 'ld-red' %>\" style=font-size:11px><%- user.Name %> <%- isActive ? '' : '(INACTIVE)' %></span> <span class=ld-hint-small> - <%- user.Id %></span> </div> </li> <% }) %> <div class=\"no-users-message hidden\">No users found.</div> </ul> </div> <div class=main-button-wrapper> <button type=button id=add-users-button disabled=true class=lds-secondary-small-button>Add <%- managerMode ? 'Managers' : 'Users' %></button> </div> "},function(e,t){e.exports=" <div class=members-pane-table-header-row style=margin-top:15px> <div class=lds-section-header-small> <div class=\"pool-name-header truncate-with-ellipsis\"> <%- poolName %> </div> <div>&nbsp;<%- managerMode ? 'Managers' : 'Members' %> (<span id=pool-member-count><%- members.length %></span>) </div> </div> <% if (!managerMode && !hideHeader) { %> <% if (Is_Conditional_Membership_Enabled__c) { %> <% if (showPoolList) { %> <div class=\"flexbox-container center-y\"> <span class=\"pool-condition-tooltip ld-tooltip-hint lds-link ld-body-medium\">Membership Conditions</span> </div> <% } else { %> <div class=distribution-checkbox-container> <label class=\"cb-container-small ld-field-label-small\"> <span>Show Members Removed By Conditions</span> <input class=show-conditionally-removed-members-checkbox type=checkbox <%- showConditionallyRemovedMembers ? 'checked' : '' %> /> <span class=checkmark></span> </label> </div> <% } %> <% } else { %> <div class=distribution-checkbox-container> <label class=\"cb-container-small ld-field-label-small <%- advancedRRFeaturesEnabled || Weighting_Enabled__c ? '' : 'disabled' %>\"> <span>Weighted Distribution</span> <input class=weighted-distribution-checkbox type=checkbox <%- Weighting_Enabled__c ? 'checked' : '' %> /> <span class=checkmark></span> </label> <% if (advancedRRFeaturesEnabled) { %> <div style=margin-left:20px class=\"reset-weights-button ld-text-navigation\">Reset</div> <% } else { %> <ldc-message-badge-angular class=angular-component-in-magellan style=text-align:initial;display:inline-block;margin-left:2px></ldc-message-badge-angular> <% } %> </div> <% } %> <% } %> </div> <div class=members-faux-table> <% if (managerMode) { %> <div class=members-faux-table-headers style=display:flex> <div class=next-up-col style=width:42px></div> <% } else { %> <div class=members-faux-table-headers> <div class=drag-handle-col></div> <% if (!isCountBased) { %> <div class=next-up-col></div> <% } %> <% } %> <% if (managerMode) { %> <div class=profile-col>Profile</div> <div class=role-col>Role</div> <% } %> <% if (!managerMode && !isCalendaring) { %> <div class=status-col>Status</div> <% } %> <div class=\"name-col <%- (!managerMode && Weighting_Enabled__c) ? '' : 'weighting-hidden' %> <%- Is_Conditional_Membership_Enabled__c ? 'conditional-view' : '' %>\">User Name</div> <% if (!managerMode) { %> <% if (!isCalendaring) { %> <div class=credits-col> Credits (<%-creditCount%>) <span class=\"credits-col-tooltip ld-tooltip-hint small-tooltip\"></span> </div> <% } else {%> <div class=product-access-col>Product Access</div> <% } %> <% if (Is_Conditional_Membership_Enabled__c) { %> <div class=manual-col>Manual (<%- numManual %>)<span class=\"manual-col-tooltip ld-tooltip-hint small-tooltip\"></span></div> <div class=conditional-col>Conditional (<%- numConditional %>)<span class=\"conditional-col-tooltip ld-tooltip-hint small-tooltip\"></span></div> <% } %> <% if (!isCountBased) { %> <% if (advancedRRFeaturesEnabled || Capping_Type__c) { %> <div class=capping-col>Capping</div> <% } %> <% } %> <div class=\"weighting-col <%- Weighting_Enabled__c ? '' : 'hidden' %>\">Weighted Distribution</div> <% } %> <div class=delete-col></div> </div> <div class=members-container> <ul class=member-list> <% if(members.length === 0 || (!managerMode && !showConditionallyRemovedMembers && numManual + numConditional === 0)) { %> <li class=empty-placeholder>Add a user here to begin.</li> <% } %> <% if (managerMode) { %> <% members.forEach(function(member, idx) { %> <li class=member data-owner-id=\"<%- member.Id %>\"> <div class=\"card ld-body-medium flexbox-container\"> <div class=next-up-col></div> <div class=profile-col> <span><%- member.Profile %></span> </div> <div class=role-col> <span><%- member.Role %></span> </div> <div class=\"name-col <%- member.IsActive ? '' : 'ld-red' %>\"> <%-(member.Name || member.Id) %> <%- member.IsActive ? '' : '(Inactive Manager)' %> </div> <div class=\"delete-member-card-button delete-col ld-cross-icon-large\"></div> </div> </li> <% }) %> <% } else { %> <% members.forEach(function(member, idx) { %> <%\n              let owner = getOwnerById(member.attributes.OwnerId__c);\n              let isActive = owner && (owner.IsActive || (owner.Type === 'Queue'));\n              let isAuthorized = !isCalendaring || member.attributes.isAuthorized;\n              let isQueue = member.attributes.OwnerId__c.startsWith('00G');\n              let inactiveReasons = member.attributes.Inactive_Reason__c ? JSON.parse(member.attributes.Inactive_Reason__c) :[];\n              let isConditional = member.attributes.Is_Conditional__c;\n              let conditionalStatus = member.attributes.conditionalStatus;\n              let isConvertingToManual = convertingMembers.has(member.attributes.OwnerId__c);\n              let userProductAccess = member.attributes.productAccess;\n              let italicize = false;\n\n              let userNameSuffix = '';\n              if (!isActive) {\n                userNaemSuffix = isQueue ? '(INVALID QUEUE)' : '(INACTIVE)';\n              } else if (!isAuthorized) {\n                userNameSuffix = '(UNAUTHORIZED)';\n              }\n          %> <li class=member data-owner-id=\"<%- member.attributes.OwnerId__c %>\"> <div class=\"card ld-body-medium flexbox-container <%-member.attributes.type === 'Queue' && !_.includes(['Lead', 'Case'], Object_Type__c) ? 'input-invalid' : ''%> <%- (conditionalStatus === 'add' ? 'conditional-add'  : '') || (conditionalStatus === 'remove' ? 'conditional-remove' : '') %> <%- showConditionallyRemovedMembers ? '' : 'hide-conditional-remove' %>\"> <% if (isConvertingToManual) { %> <div class=converting-member> <span class=tm-progress-spinner></span> <span class=italic>Adding User...</span> </div> <% } %> <div class=\"drag-handle drag-handle-col\" style=\"<%- conditionalStatus === 'remove' || isCountBased ? 'visibility: hidden;' : '' %>\"> <div class=vertical-drag-handle-img></div> </div> <% if (!isCountBased) { %> <div class=next-up-col> <% if (member.attributes.nextUpStatus) { %> <div class=status-icon title=\"<%- member.attributes.nextUpTitle || member.attributes.nextUpStatus %>\"> <svg viewBox=\"<%- getIconViewbox(member.attributes.nextUpStatus) %>\"><use href=\"#<%- getIcon(member.attributes.nextUpStatus) %>\"/></svg> </div> <% } %> </div> <% } %> <% if (!isCalendaring) { %> <div class=status-col> <div class=\"status-icon <%- getIcon(member.attributes.availabilityStatus) %>\" title=\"<%- member.attributes.availabilityStatus %>\"></div> </div> <% } %> <div class=\"name-col <%- Weighting_Enabled__c ? '' : 'weighting-hidden' %> <%- Is_Conditional_Membership_Enabled__c ? 'conditional-view' : '' %> <%- isActive && isAuthorized ? '' : 'ld-red' %>\"> <span> <%- (owner && owner.Name) || member.attributes.Name || member.attributes.OwnerId__c %> <%- userNameSuffix %> </span> </div> <% if (!managerMode) { %> <% if (!isCalendaring) { %> <div class=credits-col> <%- memberToCreditsCount[member.attributes.OwnerId__c] || '' %> </div> <% } else { %> <div class=product-access-col> <% if (userProductAccess && userProductAccess.size > 0) { %> <% bookitFeatures.forEach(function(product) { %> <%= getIconHTMLForProduct(product, userProductAccess.has(product)) %> <% }) %> <% } else { %> No Access <% } %> </div> <% } %> <% } %> <% if (Is_Conditional_Membership_Enabled__c) { %> <div class=manual-col> <% if (!isConditional) { %><span>â€¢</span> <% } %> </div> <div class=conditional-col> <% if (!isConditional && conditionalStatus === 'meets') { %> <span class=italic>Meets</span> <% } else if (isConditional) { %> <span><%- conditionalStatus === 'remove' ? 'Removed' : 'â€¢' %></span> <% } %> </div> <% } %> <% if (!isCountBased) { \n                  if (advancedRRFeaturesEnabled || Capping_Type__c) {\n                    let cappingDenom = (Capping_Limit__c && Capping_Type__c) ? ' / ' + Capping_Limit__c : '';\n                    let capValue = Capping_Type__c ? member.attributes.Current_Cap_Value__c : '0';\n                  %> <div class=\"capping-col <%- Weighting_Enabled__c ? '' : 'weighting-hidden' %> <%- Is_Conditional_Membership_Enabled__c ? 'conditional-view' : '' %>\"><%- (Capping_Type__c === 'conditional' ? 'Conditional' : (capValue || '0') + cappingDenom + ' - ' + _.startCase(Capping_Type__c || 'None')) %></div> <% } %> <% } %> <div class=\"weighting flexbox-container weighting-col <%- Weighting_Enabled__c ? '' : 'hidden' %>\"> <div class=slider></div> <div class=parts><input value=1.0 /></div> <div class=percentage>20%</div> </div> <div class=delete-col> <% if (conditionalStatus === 'remove') { %> <button type=button class=\"convert-to-manual-button on-dark lds-primary-x-small-button\">Add User</button> <% } else { %> <div class=\"delete-member-card-button ld-cross-icon-grey-large\"></div> <% } %> </div> </div> </li> <% }) %> <% } %> </ul> </div> </div> </div>"},function(e,t){e.exports="<div class=next-up-container> <div class=lds-section-header>Select 'Next Up'</div> <% if ( !isBookItPool ) { %> <p style=margin-bottom:20px>If there are credits in the Pool, LeanData will route to the Member(s) with credits before the Member assigned as Next Up.</p> <% } %> <div class=next-up-table-container></div> </div>"},function(e,t){e.exports='<div class=lds-section-header-small style="flex:1 50%"> Selected Pools (<%-poolIds.length%>) </div>  <div class=pool-list-table style=display:flex;flex-direction:column;height:188px> <% if ( isBulkSync ) { %> <div style="font-size:12px;font-weight:400;margin:5px 0" class=section-header> Only valid, conditional Round Robin pools will be synced. Weighted pools are not displayed. </div> <% } %> <% if ( poolInvalidHeaderText ) { %> <div style=display:inline-flex;align-items:center> <div class=warning-icon style=margin-right:5px></div> <div style=font-size:12px;font-weight:400 class=error-message> <%- poolInvalidHeaderText %> </div> </div> <% } else { %> <div style=padding-top:10px></div> <% } %> <div class=pools-header> <div class=pool-status-col style=margin-right:3px> </div> <div class=first-pools-col>Pool Name</div> <div class=pools-col><%- isCalendaringRRPage ? \'Distribution\' : \'Object\'%> Type</div> <div class="pools-col weighted-col">Weighted</div> <% if (managerMode) { %> <div class=pools-col>Managers</div> <% } %> <div class=pools-col>Members</div> <% if (!isBulkSync) { %> <div class=pools-col>Pool Type</div> <% } %> <% if (!managerMode && !isBulkSync) { %> <div class=pools-col>Respect Schedules</div> <% } %> <% if (isBulkSync) { %> <div class="pools-col updates-col">Updates</div> <% } %> <div class=last-pools-col></div> </div> <div class=pool-rows></div> </div>'},function(e,t){e.exports='<% if (showTabs) { %> <div id=tab-header> <div class="add-members-header flexbox-container center-y lds-section-header-small"> <span>Add Members</span> <span class="enabled-licenses-tooltip ld-tooltip-hint medium-tooltip"></span> </div> <div class="user-list-tabs ld-tabs-div-small"> <div class="ld-tab manual">Manual</div> <div class="ld-tab conditional">Conditional</div> <% if (!advancedRRFeaturesEnabled) { %> <ldc-message-badge-angular class=angular-component-in-magellan style="margin:5px 0 0 -30px"></ldc-message-badge-angular> <% } %> </div> </div> <% } %> <div id=tab-content class=user-list-tab-content></div>'},function(e,t){e.exports="<div class=advanced-tab id=pools-advanced-tab> <div class=setting-header> <div class=\"flexbox-container center-y\"> <span class=lds-section-header>Capping Models</span> <div class=\"ld-tooltip-hint capping\"></div> <% if (!advancedRRFeaturesEnabled) { %> <ldc-message-badge-angular class=angular-component-in-magellan style=\"margin:1px 0 0 10px\"></ldc-message-badge-angular> <% } %> </div> <div class=ld-body-medium style=clear:both;margin-top:10px> Select a Capping Type based on your business need. This cap will apply to all members within this Round Robin pool. </div> </div> <div class=capping-menu> <div class=\"capping-section off-container <%- advancedRRFeaturesEnabled || Capping_Type__c ? '' : 'disabled' %>\"> <div> <input type=radio name=capping id=capping-none value=none <%- Capping_Type__c === null ? 'checked' : '' %> > <label for=capping-none>Off</label> </div> </div> <div class=\"capping-section time-based-container <%- Capping_Type__c === 'time-based' || Capping_Type__c === 'hourly'\n      || Capping_Type__c === 'daily' || Capping_Type__c === 'weekly' ? 'selected' : '' %> <%- advancedRRFeaturesEnabled ? '' : 'disabled' %>\"> <div class=time-based-wrapper> <input type=radio name=capping id=capping-time-based value=time-based <%- Capping_Type__c === 'time-based' || Capping_Type__c === 'hourly' || Capping_Type__c === 'daily'\n          || Capping_Type__c === 'weekly' ? 'checked' : '' %> > <label for=capping-time-based>Time-Based</label> <span class=\"rrp-error-msg time-based-err\"></span> </div> <div class=capping-section-detail> <div class=capping-menu> <div class=\"capping-section capping-section-time-based <%- Capping_Type__c === 'hourly' ? 'selected' : '' %>\"> <div> <input type=radio name=time-based-capping id=capping-hourly value=hourly <%- Capping_Type__c === 'hourly' ? 'checked' : '' %> > <label for=capping-hourly style=padding-top:4px;padding-left:25px>Hourly Cap</label> </div> <div class=capping-section-detail> <div class=cap-limit> <span class=cap-text>Hourly Cap (per member):</span> <div class=cap-limit-input-wrapper> <input class=\"lds-field-small cap-limit-input\" value=\"<%- Capping_Limit__c %>\" placeholder=\"Enter #\"> <div class=\"rrp-error-msg cap-number-err\"></div> </div> </div> <div class=timezone> <div class=cap-text>Timezone:</div> <div class=timezone-dropdown-wrapper> <div class=\"capping-timezone-dropdown hourly-timezone-dropdown\"></div> <div class=\"rrp-error-msg timezone-err\"></div> </div> </div> </div> </div> <div class=\"capping-section capping-section-time-based <%- Capping_Type__c === 'daily' ? 'selected' : '' %>\"> <div> <input type=radio name=time-based-capping id=capping-daily value=daily <%- Capping_Type__c === 'daily' ? 'checked' : '' %> > <label for=capping-daily style=padding-top:4px;padding-left:25px>Daily Cap</label> </div> <div class=capping-section-detail> <div class=cap-limit> <span class=cap-text>Daily Cap (per member):</span> <div class=cap-limit-input-wrapper> <input class=\"lds-field-small cap-limit-input\" value=\"<%- Capping_Limit__c %>\" placeholder=\"Enter #\"> <div class=\"rrp-error-msg cap-number-err\"></div> </div> </div> <div class=timezone> <div class=cap-text>Timezone:</div> <div class=timezone-dropdown-wrapper> <div class=\"capping-timezone-dropdown daily-timezone-dropdown\"></div> <div class=\"rrp-error-msg timezone-err\"></div> </div> </div> </div> </div> <div class=\"capping-section capping-section-time-based <%- Capping_Type__c === 'weekly' ? 'selected' : '' %>\"> <div> <input type=radio name=time-based-capping id=capping-weekly value=weekly <%- Capping_Type__c === 'weekly' ? 'checked' : '' %> > <label for=capping-weekly style=padding-top:4px;padding-left:25px>Weekly Cap</label> </div> <div class=capping-section-detail> <div class=cap-limit> <span class=cap-text>Weekly Cap (per member):</span> <div class=cap-limit-input-wrapper> <input class=\"lds-field-small cap-limit-input\" value=\"<%- Capping_Limit__c %>\" placeholder=\"Enter #\"> <div class=\"rrp-error-msg cap-number-err\"></div> </div> </div> <div class=timezone> <div class=cap-text>Timezone:</div> <div class=timezone-dropdown-wrapper> <div class=\"capping-timezone-dropdown weekly-timezone-dropdown\"></div> <div class=\"rrp-error-msg timezone-err\"></div> </div> <div id=conditional-capping-tooltip class=ld-tooltip-hint style=display:none;margin-top:4px;margin-left:5px></div> </div> </div> </div> </div> </div> </div> <% if (!isCalendaringRRPage) { %> <div class=\"capping-section conditional-container capping-section-conditional <%- Capping_Type__c === 'conditional' ? 'selected' : '' %> <%- advancedRRFeaturesEnabled ? '' : 'disabled' %>\"> <div style=display:flex> <div id=conditional-capping-section> <input type=radio name=capping id=capping-conditional value=conditional <%- Capping_Type__c === 'conditional' ? 'checked' : '' %> > <label style=\"padding:5px 10px 20px 25px\" for=capping-conditional>Conditional</label> <span class=rrp-error-msg></span> </div> <div id=conditional-capping-tooltip class=ld-tooltip-hint style=display:none;margin-top:4px;margin-left:5px></div> </div> <div id=conditional-capping-table-wrapper class=capping-section-detail></div> </div> <% } %> </div> </div>"},function(e,t){e.exports='<td class=capping-rule-dropdown></td> <td class=capping-rule-description style=padding-top:18px!important><%- description %></td> <td class=capping-rule-amount><input style=height:25px class="lds-field-small capping-rule-limit-input" value="<%- cappingLimit %>"/></td> <td class=button-group colspan=2> <button type=button class="lds-tertiary-small-button capping-rule-cancel-btn">Cancel</button> <button type=button class="lds-tertiary-small-button capping-rule-done-btn">Done</button> </td>'},function(e,t){e.exports=' <button type=button class=lds-secondary-small-button style=width:140px id=add-capping-rule-button> Add Capping Rule</button> <div class="ld-table vacations conditional-capping-table" style=margin-top:10px> <table class=hoverable> <thead> <tr> <th style=background-color:var(--lt-grey-1_5)>Capping Rule</th> <th style=background-color:var(--lt-grey-1_5)>Description</th> <th style=background-color:var(--lt-grey-1_5)>Capping Amount</th> <th style=background-color:var(--lt-grey-1_5)></th> <th style=background-color:var(--lt-grey-1_5)></th> </tr> </thead> </table> <div class=inner-scroll> <table> <tbody> <tr class=new-capping-rule-row style=display:none></tr> <% _.each(appliedRulesetsToDetailsMap, function(rulesetDetailsMap, i){ %> <tr class="parent-row collapsed" style=background-color:#fff data-id="<%- rulesetDetailsMap[\'config id\'] %>"> <td><%- i+1 %><div class=pivot-table-arrow style=margin-right:10px;margin-left:15px></div><%- rulesetDetailsMap.name %></td> <td><%- rulesetDetailsMap.description %></td> <td><%- rulesetDetailsMap[\'capping amount\']%></td> <td><button type=button class="edit-capping-rule-button lds-tertiary-small-button" style=margin-top:-5px data-index="<%-i%>">Edit</button></td> <td><div class="deleteIcon ld-cross-icon-grey-large delete-capping-rule-button" style=visibility:inherit data-index="<%-i%>"></div></td> </tr> <tr class=child-row data-id="<%- rulesetDetailsMap[\'config id\']%>"> <td colspan=5 style=padding-left:80px!important;background-color:var(--lt-grey-1_5);white-space:normal><%- rulesetDetailsMap[\'soql condition\'] %></td> </tr> <% }); %> </tbody> </table> <% if(_.isEmpty(appliedRulesetsToDetailsMap)) { %> <div class="empty-placeholder ld-body-large" style=margin-top:15px;margin-left:15px;font-weight:400;text-align:center> No Capping Rules exist. Click "Add Capping Rule" to add a new rule. </div> <% } else { %> <div class=rule-logic-row style=display:flex;margin-top:20px> <div class=ld-field-label-small style=margin-top:3px;width:40px>Rule Logic</div> <input class="tuple-rule-logic-input lds-field-small" disabled=true style=width:150px value="<%-ruleLogicString%>"> <div class="ld-tooltip-hint capping-table-rule-logic" style=margin-top:5px;margin-left:10px></div> </div> <% } %> </div> </div>'},function(e,t){e.exports="<div class=distribution-tab> <ld-heroku-distribution-tab-angular></ld-heroku-distribution-tab-angular> </div>"},function(e,t){e.exports='<div class=metadata-editors id=pools-info-tab> <table class="metadata-editor left-pane"> <tr class=pool-name-table-row> <td><span class="column-label-text ld-field-label-large">Pool Name</span></td> <td> <div class="pool-name-data-wrapper name"> <input id=name-field data-field-name=Grouping_Name__c class="write-to-model lds-field-large ld-body-large" style=width:300px value="" placeholder="Enter Name for Pool" autocomplete=chrome-off> <div class=rrp-error-msg></div> </div> </td> </tr> <% if (isCalendaringRRPage) { %> <tr class=distribution-table-row> <td><span class="column-label-text ld-field-label-large">Distribution Type</span></td> <td> <div class="distribution-data-wrapper distribution-type" style=display:flex;align-items:center> <div id=distribution-dropdown></div> <div class="ld-tooltip-hint distribution-field"></div> <div class=rrp-error-msg></div> </div> </td> </tr> <% } else { %> <tr class=pool-type-table-row> <td><span class="column-label-text ld-field-label-large">Pool Type</span></td> <td> <div class="pool-type-data-wrapper pool-type" style=display:flex;align-items:center> <div id=pool-type-dropdown></div> <div class="ld-tooltip-hint pool-field"></div> <div class=rrp-error-msg></div> </div> </td> </tr> <tr class="business-unit-table-row <%- !dashboardController.viewObject.statuses.multigraphEnabled ? \'hidden\' : \'\' %>"> <td><span class="column-label-text ld-field-label-large">Business Unit</span></td> <td> <div class="business-unit-data-wrapper business-unit" style=display:flex;align-items:center> <div style=width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=business-unit-dropdown> </ld-typeahead-angular> </div> <div class="ld-tooltip-hint bu-field"></div> <div class=rrp-error-msg></div> </div> </td> </tr> <tr class=object-type-table-row> <td><span class="column-label-text ld-field-label-large">Object Type</span></td> <td> <div class="object-type-data-wrapper object-type" style=display:flex;align-items:center> <div id=object-type-dropdown> <ld-typeahead-angular class=angular-component-in-magellan id=object-type-dropdown-api> </ld-typeahead-angular> </div> <div class="ld-tooltip-hint object-field"></div> <div class=rrp-error-msg></div> </div> </td> </tr> <tr class=respect-user-table-row> <td> <div style=position:relative> <span class="column-label-text ld-field-label-large">Routing Schedule</span> <% if (!advancedRRFeaturesEnabled) { %> <ldc-message-badge-angular class=angular-component-in-magellan></ldc-message-badge-angular> <% } %> </div> </td> <td> <div style=display:flex;align-items:center> <label class="cb-container-small <%- advancedRRFeaturesEnabled || Respect_User_Schedules__c ? \'\' : \'disabled\' %>" style=font-size:14px> <div>Respect User Schedule</div> <input class=respect-user-schedules type=checkbox data-field-name=Respect_User_Schedules__c> <span class=checkmark></span> </label> <div class="ld-tooltip-hint respect-user-schedules"></div> </div> </td> </tr> <tr class="schedule-type-table-row <%- advancedRRFeaturesEnabled ? \'\' : \'disabled\' %>"> <td><span></span></td> <td style=padding-top:.5px;padding-left:30px> <div style="align-items:center;padding:5px 0"> <label class=cb-container-small style=vertical-align:middle;padding-left:25px;font-size:14px> <div>Working Hours</div> <input type=checkbox class=respect-user-schedules data-field-name=Respect_Working_Hours_Schedule__c> <span class=checkmark></span> </label> </div> <div style="align-items:center;padding:5px 0"> <label class=cb-container-small style=vertical-align:middle;padding-left:25px;font-size:14px> <div>Vacation</div> <input type=checkbox class=respect-user-schedules data-field-name=Respect_Vacation_Schedule__c> <span class=checkmark></span> </label> </div> <div style="align-items:center;padding:5px 0"> <label class=cb-container-small style=vertical-align:middle;padding-left:25px;font-size:14px> <div>Holiday</div> <input type=checkbox class=respect-user-schedules data-field-name=Respect_Holiday_Schedule__c> <span class=checkmark></span> </label> </div> <div style="align-items:center;padding:5px 0"> <label class=cb-container-small style=vertical-align:middle;padding-left:25px;font-size:14px> <div>Pausing</div> <input type=checkbox class=respect-user-schedules data-field-name=Respect_Pausing_Schedule__c> <span class=checkmark></span> </label> </div> </td> </tr> <% } %> <% if (isCalendaringRRPage) { %> <tr class=product-access-table-row> <td style=vertical-align:top><span class="column-label-text ld-field-label-large">Product Access</span></td> <td> <div class=product-access-wrapper style=position:relative> <div style=margin-bottom:10px> <label class=cb-container-large> <div>BookIt For Forms</div> <input id=bff type=checkbox name=product-access-forms class=product-access-checkbox <%- canCheckForms ? \'\' : \'disabled\' %> <%- formsChecked ? \'checked\' : \'\' %> > <span class=checkmark></span> </label> </div> <% if (poolType === \'count-based\') { %> <div style=margin-bottom:10px> <label class=cb-container-large> <div>BookIt Handoff</div> <input id=bha type=checkbox name=product-access-handoff class=product-access-checkbox <%- canCheckHandoff ? \'\' : \'disabled\' %> <%- handoffChecked ? \'checked\' : \'\' %> > <span class=checkmark></span> </label> </div> <div style=margin-bottom:10px> <label class=cb-container-large> <div>BookIt Links</div> <input id=bl type=checkbox name=product-access-links class=product-access-checkbox <%- canCheckLinks ? \'\' : \'disabled\' %> <%- linksChecked ? \'checked\' : \'\' %> > <span class=checkmark></span> </label> </div> <% } %> <div id=no-product-access class=rrp-error-msg></div> </div> </td> </tr> <% } %> <tr class=description-table-row> <td style=vertical-align:top;padding-top:15px> <span class="column-label-text ld-field-label-large">Description</span><br> <span class=ld-hint-medium style=margin-right:10px>optional</span> </td> <td style=padding-top:13px> <div class=description> <textarea id=description-field class="description-context write-to-model lds-textarea-large ld-body-large" data-field-name=Description__c style="resize:none;height:80px;width: <%- isCalendaringRRPage ? \'300px\' : \'325px\' %>" placeholder="Enter Description">\n          </textarea> <div class=rrp-error-msg></div> </div> </td> </tr> </table> <div class="pool-manager-row metadata-editor right-pane" style=width:40%> <div class=pool-manager-header> <span class="pool-manager-label-text ld-field-label-large" style=float:left>Pool Manager(s) </span> <div class="ld-tooltip-hint tooltip-on-left managers-field" style=float:left;width:30px;height:20px;position:relative;top:-2px> </div> <div class=ld-hint-medium style=clear:both>optional</div> </div> <div class=pool-manager-data-wrapper style=vertical-align:top;padding-top:10px> <div> <ld-typeahead-angular class=angular-component-in-magellan id=manager-dropdown> </ld-typeahead-angular> </div> <div class=ld-body-medium id=manager-loading style="display: <%- initialManagerFetchDone ? \'none;\' : \'block;\' %>text-align: center;width:300px;padding:20px">Loading Pool Managers...</div> <div id=manager-list style="padding-top:10px;display: <%- initialManagerFetchDone ? \'block;\' : \'none;\' %>"></div> </div> </div> </div> '},function(e,t){e.exports='<div class=members-table> <div class="flexbox-container center-y gap10"> <span class=lds-section-header>Pool Members (<%- members.length %>)</span> <button type=button style=display:block class="lds-secondary-small-button edit-members-btn" <%= disableMemberEdit ? \'disabled\' : \'\' %>> <%- members.length > 0 ? \'Edit Members\' : \'Add Members\' %> <div class="p-tooltip ui-widget p-tooltip-right edit-member-btn-tooltip"> <div class=p-tooltip-arrow></div> <div class="p-tooltip-text ui-shadow ui-corner-all">Please select an Object Type to edit Pool Membership</div> </div> </button> <% if (!isBookitPool) { %> <button type=button class="lds-secondary-small-button manage-credits-btn" style=gap:0> <span class=manage-credits-btn-text></span> <ldc-message-badge-angular style=display:none;margin-left:10px> </ldc-message-badge-angular> <div class="p-tooltip ui-widget p-tooltip-right manage-credits-btn-tooltip"> <div class=p-tooltip-arrow></div> <div class="p-tooltip-text ui-shadow ui-corner-all">There are currently no credits.</div> </div> </button> <div id=next-credit-section> <span class="status-circle-small next-credit-dot" style=margin-left:10px;margin-right:10px></span> <div style=font-size:12px><strong>Next Credit:</strong> <span style=font-weight:400 id=next-up-text></span></div> </div> <% } %> <div style=margin-left:auto> <% if (conditionalMembershipEnabled && isScheduledConditionalPool) { %> <div class=ld-body-medium style=display:flex;justify-content:right> <div class=conditional-pool-icon-wrapper style=display:flex;align-items:center title="Conditional Membership and Scheduled Sync are enabled."> <svg class=conditional-pool-icon-large viewBox="0 0 17 15"> <use href=#scheduled-sync-pool-icon></use> </svg> </div> <span id=sync-frequency-string style=margin-left:5px><%- conditionalCron %> <%- this.formattedIntegrationsUserTZ %></span> <div id=conditional-sync-notification-icon class=sync-notification-icon-wrapper style=margin-left:5px;display:flex;align-items:center title="<%- conditionalNotifications %>"> <svg class=email-notification-content style=width:15px viewbox="0 0 12.5 10"> <use href=#mail-notification-icon></use> </svg> </div> </div> <% } %> <% if (lastMemberUpdate) { %> <div class=ld-body-small> <i>Members Last Saved on <%- lastMemberUpdate %></i> </div> <% } %> </div> </div> <span class=rrp-error-msg></span> <ldc-data-table-angular class=angular-component-in-magellan></ldc-data-table-angular> <ld-manage-credits-modal-angular class=angular-component-in-magellan> </ld-manage-credits-modal-angular> </div> '},function(e,t){e.exports='<div class=round-robin-pool-header id=roundrobin-pools> <div class=dirty-bar-wrapper> <div class="dirty-bar save-bar-wrapper"> <button type=button class="cancel lds-tertiary-small-button on-dark close-pool-editor">Close</button> <button type=button class="save lds-primary-small-button on-dark save-pool" disabled=disabled>Save Pool</button> </div> <div class="dirty-bar error-bar-wrapper" style=display:none> <div class=error-bar-text>Please correct the error(s) on the highlighted tabs to save this pool.</div> <button type=button class="error-bar lds-tertiary-small-button on-dark close-error-bar">Close</button> </div> </div> <div> <div class=header-container style=overflow:hidden> <div class=lds-header style=margin-top:15px;width:800px;display:inline-block><%- Grouping_Name__c ? Grouping_Name__c : \'Create Round Robin Pool\' %></div> </div> <div class=ld-tabs-div style=width:100%> <div class="ld-tab info"> General <div class=dot-indicator style=display:none> <span class=dot-tooltip>Error(s) detected on this tab. Please click into the tab to fix the errors.</span> </div> </div> <div class="ld-tab members"> Members <div class=dot-indicator style=display:none> <span class=dot-tooltip>Error(s) detected on this tab. Please click into the tab to fix the errors.</span> </div> </div> <% if (isCountBased) { %> <div id=distribution class="ld-tab distribution"> Distribution <div class=dot-indicator style=display:none> <span class=dot-tooltip>Error(s) detected on this tab. Please click into the tab to fix the errors.</span> </div> </div> <% } %> <div id=advanced-settings class="ld-tab advanced-settings"> Advanced Settings <div class=dot-indicator style=display:none> <span class=dot-tooltip>Error(s) detected on this tab. Please click into the tab to fix the errors.</span> </div> </div> <div class="ld-tab usage"> Usage <div class=dot-indicator style=display:none> <span class=dot-tooltip>Error(s) detected on this tab. Please click into the tab to fix the errors.</span> </div> </div> <% if (lastSavedBy) { %> <div class=ld-body-small style=margin-left:auto> <i>Last modified by <%- lastSavedBy %> on <%- lastSavedDate %></i> </div> <% } %> </div> <div id=tab-content></div> </div> </div> '},function(e,t){e.exports='<div class=usage-table> <div class=usage-header> <div class=location-col>Location</div> <div class=node-col>Node Name</div> <div class=ts-col>Territory Segment</div> <div class=ts-col>Data Table</div> <div class=is-live-col>Status</div> </div> <div class=usage-rows> <% _.forEach(tableDataRows, (row)=>{ %> <div class="usage-row ld-table-data-large"> <% if (row.isLinks) { %> <div class=location-col> <a class=lds-link href="<%- row.linkURL %>" target=_blank title="<%= row.graphName %>"><%= row.graphName %></a> </div> <% } else { %> <div class=location-col> <a class=lds-link href="<%- row.graphURL %>" target=_blank title="<%= row.graphName %>"><%= row.graphName %></a> </div> <% } %> <div class=node-col title="<%= row.nodeName %>"><%= row.nodeName %></div> <% if (row.segmentName == \'â€”\') { %> <div class=ts-col><%= row.segmentName %></div> <% } else { %> <div class=ts-col> <a class=lds-link href="<%- row.segmentURL %>" target=_blank title="<%= row.segmentName %>"><%= row.segmentName %></a> </div> <% } %> <div class=ts-col> <% if (!row.datatableURL) {%> <%- row.datatableName %> <% } else {%> <a class=lds-link href="<%- row.datatableURL %>" target=_blank title="<%- row.datatableName %>"><%- row.datatableName %></a> <% } %> </div> <div class=is-live-col><%= row.isLive %></div> </div> <% }); %> </div> </div> '},function(e,t){e.exports='<ld-round-robin-sync-modal></ld-round-robin-sync-modal> <div id=roundrobin-pools class="<%- hasAdminPermissions ? \'\' : \'not-admin\' %>"> <div class=lds-header style=margin-top:18px><%- headerText %></div> <div class="flexbox-container space-between" style=padding-top:5px> <div class=left-col> <div class=lds-subheader><%- subheaderText %></div> </div> <div class=right-col> <div class="search-filter table-search-typeahead" id=round-robin-table-filter style=width:275px></div> <button type=button class=clear-search-filter-btn style=float:right;margin-top:-15px></button> </div> </div> <div class="flexbox-container space-between" style=padding-top:5px;align-items:center> <div class=left-col> <button type=button id=add-pool-button class="lds-primary-small-button rrp-button">Create Round Robin Pool</button> </div> <div class=right-col> <label class=cb-container-small> <div>Only Display Conditional Pools</div> <input type=checkbox name=conditional-filter class=conditional-filter-checkbox <%- toggleConditionalPool ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> </div> </div> <div style="display:flex;margin:10px 0;justify-content:space-between"> <div class=left-col> <button type=button class="lds-secondary-small-button import-export-buttons" id=import-pools-button>Import</button> <input type=file name=something id=uploadPools style=display:none;margin-top:20px /> <ldc-tiered-dropdown-angular id=tiered-Dropdown class=_tiered-dropdown label="Bulk Actions" size=small style=display:inline-block> </ldc-tiered-dropdown-angular> </div> <div class=right-col style=display:flex;align-items:center;text-align:right> <div class="pool-table-filter inline-block distribution-type-multiselect <%- !isCalendaringRRPage ? \'hidden\' : \'\' %>"></div> <div class="pool-table-filter inline-block usage-type-multiselect"></div> <div class="pool-table-filter inline-block object-type-multiselect <%- isCalendaringRRPage ? \'hidden\' : \'\' %>"></div> <div class="pool-table-filter inline-block pool-type-multiselect <%- isCalendaringRRPage ? \'hidden\' : \'\' %>"></div> <div class="pool-table-filter inline-block bu-multiselect <%- isCalendaringRRPage || !multigraphEnabled ? \'hidden\' : \'\' %>"></div> <div class="pool-table-filter inline-block pool-num-limit"></div> </div> </div> <div class=show-selected-pools-button style=height:10px;margin-bottom:20px> <div style=display:flex> <div class=ld-body-medium-bold><span id=selected-pools-count>0</span> Selected</div> <div class=ld-body-medium style="margin:0 2px 0 2px">|</div> <div id=selected-pools-button class="ld-body-medium lds-link">Show Selected Only</div> </div> </div> <div class="pools-table-container ld-table-standard-styling"></div> </div> '},function(e,t){e.exports='<div class=manager-list-container data-id="<%- userId %>"> <div><%- name %></div> <div><%- userId %></div> <div class="ld-cross-icon-grey-medium delete-icon"></div> </div>'},function(e,t){e.exports='<span class=section>CSV Requirements<a class=link href="<%- resourceURL %>/images/Territory_Sample.csv" download=LeanData-Territory-Example.csv>Download sample CSV</a></span> <hr class=horizontal-line-separator *ngif=!decryptedData> <div style=width:100%> <div class=body-copy-lrg style=margin-bottom:10px>When creating your CSV, remember that the following columns must be present and spelled correctly in your CSV:</div> <ul> <li>Territory</li> <li>Owner Id, OR Round Robin Name</li> <li>PostalCode</li> <li>City</li> <li>State</li> <li>Country</li> </ul> <div class="samplecsv territory-sample-csv-preview" style="background-image:url(<%- resourceURL %>/images/sample_csv_screenshot.png)"></div> <div class=body-copy-lrg style=margin-bottom:20px;clear:both>Each row in your CSV should represent a complete Territory or a portion of a Territory. That is, a Territory may require multiple rows to define.</div> <div class=gray-container> <p class="section gray-container-title"> Learn more about creating a Segment</p> <div class="section collapsed separator" style=display:flex;align-items:center><div class=pivot-table-arrow style=margin-right:5px></div>Territory Ownership</div> <div class=section-body> <p class=body-copy-lrg> Owner Id is required to assign ownership of a Territory to a user in your Salesforce instance. You can find this Id on the owner\'s user object in Salesforce.</p> <p class=body-copy-lrg>When creating the Territories in your Segment, keep in mind that each of the rows in your CSV should contain complete data, with the exception of the Owner Id and Round Robin Name columns; only one of these is required per row. That is, a given Territory cannot be owned by a specific user and a Round Robin pool, so only fill out one of these two when creating that Territory.</p> </div> <div class="section collapsed separator" style=display:flex;align-items:center><div class=pivot-table-arrow style=margin-right:5px></div>Auto-Naming</div> <div class=section-body> <p class=body-copy-lrg>If you upload a CSV that contains a Territory with multiple owners, you will notice that the Territory has been split into multiple rows and renamed based on ownership. Example: "Southern CA" was owned by Bob and Jim in your CSV. After upload, you will notice that we have renamed the Territory to "Southern CA - Bob" and "Southern CA - Jim". We do this in order to maintain the best practice of having one owner per Territory.</p> </div> </div> <div class=modal-button-section> <button type=button class="lds-secondary-large-button close-btn" data-bs-dismiss=modal>Close</button> <label for=upload> <button type=button class="lds-primary-large-button selectFile" style="" id=selectFile>Select a File To Upload</button> </label> <span><input type=file id=upload style=display:none accept=.csv class=required /></span> </div> </div> '},function(e,t){e.exports='<style>.ui-autocomplete{max-height:250px;overflow-y:visible;overflow-x:visible;border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding:5px 0}.ui-menu .ui-state-focus{margin:0}.ui-autocomplete .ui-menu-item{background:0 0;border:none;font-weight:200;padding:4px 10px}.ui-autocomplete .ui-menu-item:hover{background-color:var(--lt-green-1);color:#fff;border:none}.button-div{width:600px;float:left;clear:left;display:flex;justify-content:center}.ul{margin-bottom:0}.ui-icon{background:url("{!URLFOR($Resource.Reporting_Images, \'Down_Arrow_Icon.png\')}") no-repeat right!important;transform:rotate(-90deg);background-size:9px 6px!important;background-position-x:3.5px!important}select:hover{cursor:pointer}.ui-front{width:150px;word-wrap:break-word}.ui-state-focus{background:#45b7e6;font-weight:600;border:0}.ui-menu-icon{display:flex!important}.empty-table-text{text-align:center;vertical-align:middle}</style> <div class=mainDiv id=territory-assignments> <div class=dirty-bar-wrapper> <div class="dirty-bar static" style=display:none> <button type=button class="segment-assignment-btn cancel lds-tertiary-small-button on-dark">Cancel</button> <button type=button class="segment-assignment-btn save lds-primary-small-button on-dark">Save Changes</button> </div> </div> <div class=secondDiv style=width:auto> <div id=territory-routing-assignments style=display:block> <div style=margin-top:20px> <span class="ld-breadcrumb static" id=segments-breadcrumb style=margin-top:20px;width:40px>Segments</span> <span class="" style=margin-top:20px>&gt;</span> <span class="ld-breadcrumb current" style=margin-top:20px>Ownership</span> </div> <div class="lds-header mt20">Territory Management</div> <div style=display:flex;justify-content:space-between;margin-top:10px> <div style=display:flex> <span id=assignmentSubHeader2 class=lds-subheader style=margin-top:0;display:inline-block><%- collection.segmentName %></span> <ldc-tooltip-angular id=managers-tooltip class="angular-component-in-magellan mb10 ml5"></ldc-tooltip-angular> </div> </div> <div class=mb20> <span id=assignmentSubHeader3 class="ld-body-large <%- !dashboardController.viewObject.statuses.multigraphEnabled && collection.buName === \'Single Graph\' ? \'hidden\' : \'\' %>" style=margin-top:0;display:inline-block> Business Unit: <%- collection.buName %> </span> </div> <div class="flex justify-between mt10"> <div> <button type=button class=lds-primary-large-button id=manage-segment-button style=position:relative>Manage Territories</button> <% if(!collection.isDraft) { %> <button type=button class=lds-secondary-large-button id=edit-segment-button style=position:relative>Edit Segment Info</button> <% } else { %> <button title="Territory segment info cannot be edited for drafts of live territory segments. Please edit the territory segment info on the live territory segment." type=button disabled=disabled class=lds-secondary-large-button id=edit-segment-button style=position:relative>Edit Segment Info</button> <% } %> </div> <div class=search-filter id=territory-segments-searchbar> <input required id=segments-assignments-search-filter-input placeholder="Search Users" autocomplete=off /> <div class=clear-search-filter-btn style=margin-top:-15px></div> </div> </div> <div class=ld-tabs-div style=line-height:15px;margin-top:20px> <span class="ld-tab owners active">Owner Assignments</span> <span class="ld-tab territories">Territory Assignments</span> </div> <div id=pivotByOwner> <table class="ld-table territory-table territory-owner-table"> <tbody> <tr> <th class=ownerHeader>Owner Name</th> <th class=subTable>Territories</th> <th></th> </tr> </tbody> </table> <div> <table class="ld-table territory-table territory-owner-table" style=margin-top:0> <tbody> <% if (ownerIds.length > 0) { %> <% _.each(ownerIds, function(ownerId) { %> <% var searchMap = {}; searchMap[ns+\'Owner__c\'] = ownerId; %> <% var ownedTerritories = collection.where(searchMap); %> <% \n                                        let ownerName = getOwnerName(ownerId); \n                                        let isError = _.startsWith(ownerName, "[error]");\n                                        if (isError) ownerName = ownerName.replace("[error]", "").trim();  \n                                    %> <tr class="owner-row collapsed" data-ownerid="<%- ownerId %>"> <td style=" <%-collection.inactiveOwnerMap[ownerId] != null || (collection.ownerIdToNameMap[ownerId.toLowerCase()] == null && collection.ownerIdToNameMap[ownerId] == null) ? \'color: #d91e18;\' : \'\'%>"> <div class=pivot-table-arrow></div> <plain title="<%- ownerName %>"> <span class="<%- isError ? \'ld-text-danger\' : \'\'%>"> <%- _LeanData.Util.truncateText(ownerName, 75) %> </span> </plain> </td> <td><%- ownedTerritories.length %></td> <td class=pivot-table-dropdown-container><button type=button class="assign-owner-dropdown lds-secondary-small-button dk-grey-1 bg-white">Select a new owner</button></td> </tr> <% _.each(ownedTerritories, function(territory) { %> <tr class="owner-pivot-row no-hover" data-territoryid="<%- _.escape(territory.get(\'Id\'))%>" data-ownerid="<%- ownerId %>"> <td class=subRow> <plain title="<%- territory.get(ns+\'Name__c\')%>"> <%- _LeanData.Util.truncateText(territory.get(ns+\'Name__c\'),50)%> </plain> </td> <td></td> <td class=pivot-table-dropdown-container><button type=button class="assign-owner-dropdown lds-secondary-small-button dk-grey-1 bg-white">Select a new owner</button></td> </tr> <% }) %> <% }) %> <% } else { %> <tr><td class="empty-table-text ld-body-large" colspan=2>User not found. Click "Edit Segment" to assign an owner to a territory.</td></tr> <% } %> </tbody> </table> </div> </div> </div> <div id=pivotByTerritory style=display:block> <table class="ld-table territory-table" style=margin-top:20px> <tbody> <tr class=dataHeaders style=height:30px> <th>Territory Name</th> <th>Owner</th> <th></th> </tr> </tbody> </table> <div> <table class="ld-table territory-table territory-owner-table" style=margin-top:0> <tbody> <% if (territoryModels.length > 0) { %> <% _.each(territoryModels, function(territory) { %> <%  \n                                let ownerId = territory.get(ns + \'Owner__c\');\n                                let ownerNameTerritory = getOwnerName(ownerId); \n                                let isError = _.startsWith(ownerNameTerritory, \'[error]\');\n                                if (isError) ownerNameTerritory = ownerNameTerritory.replace("[error]", "").trim();\n                            %> <tr data-territoryid="<%-territory.get(\'Id\')%>" class="dataRowHover territory-row"> <td> <plain title="<%- territory.get(ns+\'Name__c\')%>"> <%- _LeanData.Util.truncateText(territory.get(ns+\'Name__c\'), 55)%> </plain> </td> <td id="<%- ownerId %>" style="<%-collection.inactiveOwnerMap[territory.get(ns+\'Owner__c\')] != null || (collection.ownerIdToNameMap[territory.get(ns+\'Owner__c\')] == null && collection.ownerIdToNameMap[territory.get(ns+\'Owner__c\').toLowerCase()] == null) ? \'color: #d91e18;\' : \'\'%>"> <plain title="<%- ownerNameTerritory%>"> <span class="<%- isError ? \'ld-text-danger\': \'\'%>"> <%- _LeanData.Util.truncateText(ownerNameTerritory, 60) %> </span> </plain> </td> <td class=pivot-table-dropdown-container><button type=button class="assign-owner-dropdown lds-secondary-small-button dk-grey-1 bg-white">Select a new owner</button></td> </tr> <% }) %> <% } else { %> <tr><td class="empty-table-text ld-body-large" colspan=2>User not found. Click "Edit Segment" to assign an owner to a territory.</td></tr> <% } %> </tbody> </table> </div> </div> </div> </div> '},function(e,t){e.exports='<style>.ui-autocomplete{border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding:5px 0;overflow:visible}.ui-menu .ui-state-focus{margin:0}.ui-autocomplete .ui-menu-item{background:0 0;border:none;font-weight:200;padding:4px 10px}.ui-autocomplete .ui-menu-item:hover{background:#65d2bd;color:#fff;border:none}.autoCompReassign.ui-autocomplete-input{padding-left:4px}.autoCompReassign.ui-autocomplete-input:focus{outline:0;border:1px solid #b2e8de;border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}</style> <div class=mainDiv id=territory-editor> <div class=dirty-bar-wrapper> <div class="dirty-bar static" style=display:none> <button type=button class="segment-edit-btn cancel lds-tertiary-small-button on-dark">Cancel</button> <button type=button class="segment-edit-btn save lds-primary-small-button on-dark">Save Changes</button> </div> </div> <div class=secondDiv style=width:auto> <div id=territory-routing-editor style=display:block> <div style=margin-top:20px> <span class="ld-breadcrumb static" style=width:40px id=segments-breadcrumb>Segments</span> <span>&gt;</span> <span class="ld-breadcrumb static" style=width:40px id=assignments-breadcrumb>Ownership</span> <span>&gt;</span> <span class="ld-breadcrumb current">Manage Territories</span> </div> <div class=lds-header style=margin-top:18px>Manage Territories</div> <div style=margin-top:10px> <div> <span id=editorSubHeader2 class=lds-subheader style=margin-top:0><%- collection.segmentName %></span> <span class="imgHover edit-icon" style=margin-top:-8px id=rename-button></span> </div> <div class="ld-body-large <%- !dashboardController.viewObject.statuses.multigraphEnabled && collection.buName === \'Single Graph\' ? \'hidden\' : \'\' %>" style=margin-top:10px> Business Unit: <%- collection.buName %> </div> <div class=add-btn-search-input-wrapper style=display:flex;justify-content:space-between;top:-4px;margin-top:15px> <button type=button id=add-territory-buttton class=lds-secondary-small-button style=position:relative>Add Territory</button> <div class=search-filter id=territory-segment-editor-searchbar> <input required id=territory-segment-editor-search-filter-input placeholder="Search Segment" autocomplete=off /> <div class=clear-search-filter-btn style=margin-top:-15px></div> </div> </div> </div> <div class="territorySegmentsDiv tableWrapper outer-panel" style=line-height:15px> <div class=inner-panel> <table class="list ld-table territory-table" cellspacing=0 cellpadding=0 style=table-layout:fixed id=territoryGeosTable> <thead class=territorySegmentsTableHead> <tr class=headerRow role=row> <th></th> <th>Territory Name</th> <th>Owner Name</th> <th>PostalCode</th> <th>City</th> <th>State</th> <th>Country</th> <th>Custom Field</th> <th></th> </tr> </thead> <tbody class=territorySegmentsTableBody> </tbody> </table> </div> </div> </div> </div> </div> '},function(e,t){e.exports="<table class=hoverable> <tbody> <tr style=height:30px> <th> <label class=cb-container-small> <input type=checkbox id=all-territory-segments-checkbox /> <span class=checkmark></span> </label> </th> <% if(isLoading) { %> <th><span class=tm-progress-spinner></span></th> <% } else { %> <th></th> <% } %> <th>Segment Name</th> <th class=\"<%- !dashboardController.viewObject.statuses.multigraphEnabled ? 'hidden' : '' %>\">Business Unit</th> <th>Territories</th> <th>Segment Manager</th> <th>CSV File</th> <th>Created by</th> <th>Date created</th> <th>Date modified</th> <th></th> </tr> </tbody> </table> <div> <% if(segments.length > 0) { %> <table> <tbody> <% _.each(segments, function(segment){ %> <tr class=dataRowHover style=height:20px data-id=\"<%- segment.Id %>\" data-cid=\"<%- segment._cid %>\" data-segmenttype=\"<%- segment.segmentType %>\" data-namestring=\"<%- segment[ns+'Name__c'] %>\"> <td class=checkbox-action-cell> <label class=\"cb-container-small checkbox-action\" style=padding:0> <input type=checkbox id=checkSegment <%- segment.segmentType === 'draft' ? 'disabled' : '' %>/> <span class=checkmark></span> </label> </td> <td style=overflow:visible!important> <% const inactiveOwner = segment['inactiveOwner']; %> <% const incorrectBUPool = segment['incorrectBUPool'];%> <% const hasErrors = (inactiveOwner || incorrectBUPool || segmentsWithUnprovisionedPools[segment.Id] || (segment[ns+'Upload_Status__c'] != null && ((segment[ns+'Upload_Status__c'].startsWith('Upload Failed') && segment.segmentType !== 'draft') || (segment[ns+'Upload_Status__c'].startsWith('Upload Draft Failed') && segment.segmentType === 'draft')))); %> <% if(hasErrors) { %> <% let errorMessage =  segment.uploadStatus %> <% if (inactiveOwner && incorrectBUPool) { %> <% errorMessage = \"This segment contains invalid users, deleted Round Robin Pools, or Pools that do not belong to the specified Business Unit\"%> <% } else if (inactiveOwner) { %> <% errorMessage = \"This segment contains invalid users or deleted round robin pools\"%> <% } else if (incorrectBUPool) { %> <% errorMessage = \"This segment contains deleted Round Robin Pools, or Pools belonging to a different Business Unit than the one selected.  Please select existing Pools from the specified Business Unit.  \"%> <% } else if (segmentsWithUnprovisionedPools[segment.Id]) { %> <% errorMessage = 'This Segment contains Pools with Advanced Round Robin setting(s) unavailable in your current package. Upgrade or remove pools with unsupported settings to use this segment.'; %> <% } %> <img class=errorIcon src=\"<%- resourceURL + '/images/Triangle_Error_Icon_node.png' %>\" height=20px width=20px> <div class=error-messages style=display:none><%= errorMessage %></div> <% } %> </td> <td> <%- segment[ns+'Name__c'] + (segment.segmentType === 'draft' ? ' - Draft' : '') + ((segment[ns+'Upload_Status__c'] != null && segment[ns+'Upload_Status__c'.startsWith('Upload')]) ? ((segment[ns+'Upload_Status__c'] != null && segment[ns+'Upload_Status__c'].startsWith('Upload Failed')) ? '<span style=\"color:red;display:block;\">Upload Failed</span>' : '<span style=\"display:block\">Upload In Progress</span>') : '') %> </td> <td class=\"<%- !dashboardController.viewObject.statuses.multigraphEnabled ? 'hidden ' : '' %> <%-segment.buName ? '' : 'italic '%>\" title=\"<%- segment.buName ? segment.buName : 'Deleted BU' %>\"><%- segment.buName ? segment.buName : 'Deleted BU' %></td> <td> <%- ( segment.segmentCount )%> </td> <td> <% const managerNames = segmentToManagers[segment.Id] || []; %> <%= _LeanData.Util.createUserListOverflow(managerNames, 60, 'territory-manager-column truncate-with-ellipsis') %> </td> <td title=\"<%- (segment.segmentType !== 'draft') ? (segment[ns+'FileName__c']) : (segment[ns+'Draft_FileName__c']) %>\"> <%- ( (segment.segmentType !== 'draft') ? (segment[ns+'FileName__c']) : (segment[ns+'Draft_FileName__c']) ) %> </td> <td><%- segment.CreatedBy.Name %></td> <td><%- formatMomentDate(segment.CreatedDate, 'MM/DD/YYYY') %></td> <td> <%- formatMomentDate(segment.LastModifiedDate, 'MM/DD/YYYY') %> <% if(segment.isDeployed && !(segment.segmentType === 'draft')) { %> <div class=live-icon style=margin-left:5px></div> <% } %> </td> <td class=segment-action-cell> <% if((segment[ns+'Version__c'] >= 0) && (segment.segmentType !== 'draft' || (segment[ns+'Upload_Status__c'] == null || !segment[ns+'Upload_Status__c'].startsWith('Upload Draft')))) { %> <div class=segment-action> Actions <div class=ld-select-dropdown> <% if(segment.segmentType === 'draft') { \n                                  if (hasErrors) { %> <div class=disabled>Deploy</div> <% } else { %> <div class=deploy-action>Deploy</div> <% }} %> <% if(segment.segmentType === 'default' && dashboardController.viewObject.statuses.hasReadWriteAccess) { %> <div class=copy-action>Copy</div> <% } %> <% if(segment.segmentType === 'default') { %> <div class=edit-action>Edit Segment Info</div> <% } %> <% if(segment.segmentType === 'default') { %> <div class=manage-action>Manage Territories</div> <% } %> <% if(segment.segmentType === 'empty') { %> <div class=upload-action>Upload</div> <% } %> <% if(segment.segmentType === 'default') { %> <div class=replace-action>Replace</div> <% } %> <% if(segment.segmentType === 'default') { %> <div class=export-action>Export</div> <% } %> <% if(segment.segmentType === 'empty') { %> <div class=rename-action>Rename</div> <% } %> <% if(dashboardController.viewObject.statuses.hasReadWriteAccess) { %> <% if(!segment.isDeployed || segment.segmentType === 'draft') { %> <div class=delete-action>Delete</div> <% } else { %> <div title=\"Unable to delete Territory Segments that exists in Live Graphs.\" class=disabled>Delete</div> <% } %> <% } %> </div> </div> <% } %> </td> </tr> <% }); %> </tbody> </table> <% } else { %> <div class=ld-body-large style=text-align:center;padding:40px><%- emptyTableText %></div> <% } %> </div> "},function(e,t){e.exports='<div class=mainDiv id=territory-main> <div class=secondDiv style=width:auto> <div class="ld-breadcrumb current" style=margin-top:20px>&zwnj;</div> <div class=lds-header> <%- pageTitle %> </div> <div style=display:flex;justify-content:space-between> <div style=display:flex> <span id=segmentSubheader class=lds-subheader style=display:inline-block><%- pageTitle === \'BookIt\' ? \'Territory \' : \'\' %>Segments (<%- segments.length %>)</span> <span class="ld-text-navigation ld-body-large" style=margin-top:2px;margin-left:13px id=csv-upload-instructions>CSV Upload Instructions</span> </div> </div> <div class="flex justify-between align-center"> <div> <button type=button class="lds-primary-large-button territory-button mt10" id=create-segment <% if (!dashboardController.viewObject.statuses.hasReadWriteAccess && !dashboardController.viewObject.statuses.hasBUAdminAccess) { %> style=display:none <% } %> > Create Segment </button> <ldc-tiered-dropdown-angular id=tiered-Dropdown class="_tiered-dropdown mt10" label="Bulk Actions" size=large style=display:inline-block> </ldc-tiered-dropdown-angular> </div> <div class=flex> <div class="territory-table-filter inline-block bu-multiselect <%- !dashboardController.viewObject.statuses.multigraphEnabled ? \'hidden\' : \'\' %> pr10"></div> <div class=search-filter id=territory-segments-searchbar> <input required id=territory-segments-search-filter-input placeholder="Search Users" autocomplete=off /> <div class=clear-search-filter-btn style=margin-top:-15px></div> </div> </div> </div> <div class="ld-table territory-table" id=territorySegmentTable style=margin-top:20px></div> </div> </div> '},function(e,t){e.exports='<div id=action-node-atm-partial class=node-partial data-node-type=action-assign-account-team-members data-form-title="Action â€“ Assign Account Team Members"> <div class=main-div> <div class=account-teams-not-enabled><b>Account Teams are disabled in your SFDC org.</b> To enable Account Teams, go to <a id=account-teams-setup-link target=_blank>Account Team Setup.</a></div> <div class=atm-header-container> <div class=left-header> <div class=header-font>Assign Team Members</div> </div> <div class=right-header> <label class="cb-container-small success-notification-toggle"> <div style=margin-top:1px>Replace Existing Account Team Members in Selected Roles</div> <input type=checkbox name=send-notif-form-cb class=replace-atm <%- (model.nodeInfo[\'replace atm\']? "checked" : "" )%>/> <span class=checkmark></span> </label> <div class="ld-tooltip-hint atm-tooltip small-tooltip"></div> </div> </div> <div id=add-team-members-wrapper> <div class=table-header-row> <div>Team Member</div> <div>Role</div> </div> <div id=edit-atm-fields-wrapper class=single-mapping-row></div> </div> <div class=variable-insert-button style=margin-left:10px;margin-bottom:15px></div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div class=rule-div> <div style=margin-right:15px> <div class=write-field-dropdown style=width:300px></div> </div> <div style=width:300px;margin-right:7px> <div class=read-field-dropdown></div> </div> <div class="ld-input-group-addon merge-field-insert-button-container" style="margin:17px 5px 0 5px"></div> <div class=delete-column data-rule-number="<%- ruleNum %>"></div> </div> <div class=error-message-section> <div class="error-message ld-text-danger invalid-user"></div> <div class="error-message ld-text-danger invalid-role"></div> </div> <hr class=horizontal-line-separator>'},function(e,t){e.exports="<div id=additional-account-fields> <span class=header-font>Additional Account Fields <i style=font-weight:200>(Optional)</i></span><br/> <div>Select additional fields on the new Account to update.</div> <div id=edit-account-fields-wrapper class=single-mapping-row></div> <div class=single-mapping-row> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>Add Field</div> </div> </div> </div> "},function(e,t){e.exports="<div id=additional-task-fields> <span class=header-font>Additional <%- eventNode ? 'Event' : 'Task' %> Fields</span><br/> <div style=color:grey;font-size:11px>optional</div> <div class=single-mapping-row>Select additional fields on the new <%- eventNode ? 'event' : 'task' %> to update.</div> <div id=edit-task-fields-wrapper class=single-mapping-row></div> <div class=single-mapping-row> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>Add Field</div> </div> </div> </div>"},function(e,t){e.exports=' <% if (showRecordType == true) { %> <div> <span class=header-font>Record Type</span><br/> <div>Select a Record Type for the Created Opportunity.</div><br/> <div id=recordTypeDropdown style="margin:0 300px 0 0"></div> <div id=recordTypeDropdownErrorText style=color:var(--ld-red);margin-top:5px></div> </div> <hr class=horizontal-line-separator> <% } %> <div id=additional-opp-fields> <span class=header-font>Additional Opportunity Fields <i style=font-weight:200>(Optional)</i></span> <div>Select additional fields on the new opportunity to update.</div> <div id=edit-opp-fields-wrapper class=single-mapping-row></div> <div class="add-opp-field-wrapper single-mapping-row"> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>Add Field</div> </div> </div> </div>'},function(e,t){e.exports='<div class="<%- isCampaignMemberTrigger ? \'campaign-member-trigger-filters\' : \'\' %>"> <% if (isCampaignMemberTrigger) { %> <div style=margin-bottom:15px class=multi-condition-headers> Campaigns </div> <div style=margin-left:10px> <div id=conditions-edit-partial style=margin-bottom:10px> <div class=control-group id=campaign-filter-type-radio-control> <label class="control control--radio checked"><span class=has-object-label>All Campaigns</span> <input class=filter-type-radio type=radio id=campaign-filter-radio-none-control name=campaign-radio data-filter-type=none <%- campaignFilterType === "none" ? "checked" : ""%>> <div class=control__indicator></div> </label> <label class="control control--radio" style=display:flex>Campaigns meeting these conditions: <input class=filter-type-radio type=radio id=campaign-filter-radio-include-control name=campaign-radio data-filter-type=inclusion <%- campaignFilterType === "inclusion" ? "checked" : ""%>> <div class=control__indicator></div> </label> </div> </div> <div id=edit-campaign-rules-div class="reference-filter-conditions <%- showCampaignAddCondition ? \'\' : \'hidden\' %>"> </div> <div class="add-campaign-rule add-reference-filter-rule <%- showCampaignAddCondition ? \'\' : \'hidden\' %>"> <div class=add-rule-row-item> <div class="add-trigger-rule-div lds-link" data-add-type=campaign>Add Condition</div> <div class=empty-row-space></div> </div> </div> </div> <hr class=horizontal-line-separator-lt-grey-2-large> <div style=margin-bottom:15px class=multi-condition-headers> <%- _LeanData.StringUtil.pluralizeString(objectType) %> </div> <% } %> <div style="<%- isCampaignMemberTrigger ? \'margin-left: 10px;\' : \'\' %>"> <div id=conditions-edit-partial style="margin-bottom: <%- showAddCondition ? \'10px;\' : \'0px;\'%>"> <div class=control-group id=filter-type-radio-control> <label class="control control--radio checked"><span class=has-object-label>All <%- _LeanData.StringUtil.pluralizeString(objectType) %></span> <input class=filter-type-radio type=radio id=filter-radio-none-control name=radio data-filter-type=none <%- filterType === "none" ? "checked" : ""%>> <div class=control__indicator></div> </label> <label class="control control--radio" style=display:flex;margin-bottom:0><%- _LeanData.StringUtil.pluralizeString(objectType)%> meeting these conditions: <input class=filter-type-radio type=radio id=filter-radio-include-control name=radio data-filter-type=inclusion <%- filterType === "inclusion" ? "checked" : ""%>> <div class=control__indicator></div> </label> </div> </div> <div id=edit-rules-div class="reference-filter-conditions <%- showAddCondition ? \'\' : \'hidden\' %>"> </div> <div class="add-rule add-reference-filter-rule <%- showAddCondition ? \'\' : \'hidden\' %>" style="<%- !isCampaignMemberTrigger && showLogic ? \'\' : \'padding-bottom: 20px;\'%>"> <div class=add-rule-row-item> <div class="add-trigger-rule-div lds-link" data-add-type=routingObjectType>Add Condition</div> <div class=empty-row-space></div> </div> </div> </div> <% if (isCampaignMemberTrigger && showLogic) { %> <hr class=horizontal-line-separator-lt-grey-2-large> <div style=margin-bottom:15px class=multi-condition-headers> How do you want to evaluate Campaign & <%- objectType %> conditions? </div> <% } %> <div class="rule-logic-div <%-isCampaignMemberTrigger ? \'cm-reference-filters-rule-logic\' : \'reference-filters-rule-logic\'%> <%-showLogic ? \'\' : \'hidden\'%>"> <div class=trigger-rule-div> <span class=rule-logic-label>Rule Logic</span> <input value="<%- logic %>" type=text data-name=rule-logic class="rule-logic-input lds-field-small" style="height:30px;width:560px;border-radius:3px;margin:0 10px"/> <div class="reset-default-logic ld-body-medium-small lds-link <%- disableDefaultButton ? \'disabled\' : \'\' %>">Default</div> </div> <div class=rule-logic-feedback style="font-size:.9em;color:#d91e18; <%-isCampaignMemberTrigger ? \'margin-left:0px;\' : \'margin-left:20px;\' %>"></div> </div> </div> '},function(e,t){e.exports='<div class="advanced-settings-view collapsible-outer-container <%- openPanel ? \'open\' : \'\' %>"> <div class="collapsible-section-header header-font">Advanced Settings <% if (newSetting) { %> <span style=color:var(--dk-grey-1);background-color:var(--lt-green-1);padding-left:5px;padding-right:5px>NEW Edge Added</span> <% } %> </div> <div class=collapsible-section> <div class=l2a-match-parent-settings-container></div> <span id=advanced-settings-text style=margin-bottom:10px> <% if (_LeanData.AppState.PrimarySObjectType != "Meeting") { %> Specify the target node, if any, when a condition below is met. </span> <% } else { %> Specify backup actions to take in cases where primary scheduling action meets a condition below. <% } %> <div id=criteria-list-partial class=advanced-settings-criteria-list> </div> </div> </div> '},function(e,t){e.exports="<div> <div id=conditions-edit-partial style=\"margin-bottom: <%- isAdditionalObjectTrigger ? '15px' : '12px' %>\"> <% if (partnerTriggerName) { %> <div class=header-container style=display:flex> <div style=font-weight:600;margin-top:15px>Trigger Conditions</div> <div class=\"ld-tooltip-hint partner-trigger-tooltip medium-tooltip\" style=align-self:flex-end;margin-left:8px></div> </div> <div style=margin-top:5px;margin-bottom:12px><%= triggerConditionDescription %></div> <% } %> <div id=edit-rules-div style=\"margin-top:3px;margin-bottom:15px;margin-left: <%-partnerTriggerName ? '10px' : '0px'%>\"> </div> <div class=add-rule-container style=\"margin-top: <%- isAdditionalObjectTrigger ? '5px' : '10px' %>;margin-left: <%-partnerTriggerName ? '10px' : '33px'%>\"> <div class=add-rule-row-item> <% if (isAdditionalObjectTrigger) { %> <div class=\"add-trigger-rule-div lds-link\">Add Trigger Condition</div> <div class=empty-row-space></div> <% } else { %> <div class=add-rule-div></div> <div class=header-font>New condition</div> <div class=empty-row-space></div> <% } %> </div> </div> <div class=\"rule-logic-div <%-showLogic ? '' : 'hidden'%>\" style=\"margin-top:20px;margin-left: <%- isAdditionalObjectTrigger ? '12px' : '0px'%>\"> <% if (isAdditionalObjectTrigger) { %> <div class=trigger-rule-div> <span class=rule-logic-label>Rule Logic</span> <input value=\"<%- logic %>\" type=text data-name=rule-logic class=\"rule-logic-input lds-field-small\" <%= isUpdateTrigger ? 'disabled' : '' %> style=\"height:30px;border-radius:3px;width: <%- isUpdateTrigger ? '600px' : '560px'%>;margin:0 10px\"/> <% if (!isUpdateTrigger) { %> <div class=\"reset-default-logic ld-body-medium-small lds-link <%- disableDefaultButton ? 'disabled' : '' %>\">Default</div> <% } %> </div> <div class=rule-logic-feedback style=font-size:.9em;color:#d91e18;margin-left:20px></div> <% } else { %> <div class=header-input-container> <div class=rule-logic-label> Rule Logic </div> <input class=rule-logic-input value=\"<%- logic %>\" type=text data-name=rule-logic /> <div><a href=javascript:void(0); class=\"rule-logic-label reset-default-logic lds-link\">Default</a></div> </div> <div class=logic-error-div style=display:flex> <div class=rule-logic-feedback style=font-size:.9em;color:#d91e18;margin-top:7px;margin-left:68px></div> </div> <% } %> </div> <% if (showDescription) { %> <div class=line-divider style=\"margin:20px 0 7px\"></div> <div class=\"description-div collapsible-outer-container\" style=\"margin-top:7px;display:block;margin-left: <%-partnerTriggerName ? '10px' : '0px'%>\"> <div class=\"description-label collapsible-section-header\" style=margin-bottom:2px;display:inline-block>Description</div><br/> <textarea class=\"description-input collapsible-section change-parameter-input lds-textarea-small\" data-parameter=description id=conditions-description-input><%- description %></textarea> </div> <% } %> </div> </div>"},function(e,t){e.exports=' <div class="task-related-to section-wrapper-spacing"> <div class="header-font header-spacing">Related to</div> <div class=related-to-typeahead-wrapper style=margin-left:10px;width:475px> <ld-typeahead-angular id=relatedTo class=angular-component-in-magellan> </ld-typeahead-angular> <div id=invalidRelatedTo class=node-form-error-text style=margin-left:10px;margin-top:5px></div> </div> </div> <hr class=horizontal-line-separator style="margin:20px 0!important"> <div class=task-assigned-to class=section-wrapper-spacing> <div class="header-font header-spacing">Assigned To</div> <div class="horizontal-tabbing-option-div control-group" id=assigned-to-radio-control> <% if (eventNode) { %> <label class="control control--radio"> Main Host <input type=radio name=assigned-to-radio-control data-category=assignedTo data-type=assignedToMeetingOwner /> <div class=control__indicator></div> </label> <% } %> <label class="control control--radio"> Specific User <input type=radio name=assigned-to-radio-control data-category=assignedTo data-type=assignedToExplicitOwner /> <div class=control__indicator></div> </label> <div class=radio-sub-div style=margin-left:30px;width:500px> <ld-typeahead-angular id=assignedToExplicit class=angular-component-in-magellan> </ld-typeahead-angular> </div> <div id=invalidExplicitOwner class=node-form-error-text></div> <label class="control control--radio" style=display:flex;align-items:center> User from a Variable <input type=radio name=assigned-to-radio-control data-category=assignedTo data-type=assignedToVariable %> <div class=control__indicator></div> </label> <div class=radio-sub-div style=margin-left:30px;width:500px> <ld-typeahead-angular id=assignedToVariable class=angular-component-in-magellan> </ld-typeahead-angular> </div> </div> </div> '},function(e,t){e.exports='<div class=rule-div> <div class=matched-field-column> <div style=margin-right:10px> <span style=font-weight:600>Custom Parameter</span> <input class="width-fill change-parameter-input" style="outline:1px solid #9eb7cb;margin-top:1px;min-height:20px;color:#000;text-shadow:none" data-parameter=parameter value="<%- customParameter %>"/> </div> </div> </div>'},function(e,t){e.exports="<% if (!isAccountSettingsPage) { %> <div class=\"criteria-table-header header-font\"> <% if (!hideDragColumn) { %> <div class=drag-column></div> <% } %> <div class=decision-criteria-column> Conditions </div> <% if (!hideLabel) { %> <div class=edge-label-column> Label </div> <% } %> <% if (isTrigger && (showRoutingPriorityColumn)) { %> <div class=edge-priority-column> <span class=priority-label>Priority</span> <div class=\"ld-tooltip-hint edge-priority-tooltip small-tooltip\" style=vertical-align:middle></div> <% if(!isRoutingInsightsView || isDeploymentLive) { %> <span class=ld-badge-small><%- ccioPrioEnabled ? 'ON' : 'OFF'%></span> <% } %> </div> <% } %> <div class=next-node-column> Target </div> <% if (!hideDragColumn || alwaysShowDeleteIcon) { %> <div class=delete-column></div> <% } %> </div> <% } %> <ul id=criteria-sortable class=\"criteria-list list-unstyled\" style=list-style-type:none;margin:0> <% _.each(edges, function(edge, idx) { %> <li class=\"criteria-list-item <%- edge['type'] === 'default' && edge['condition'] !== 'Not Met' ? 'criteria-list-default' : '' %> <%- edge['condition'] === 'Not Met' || edge['name'] === 'Time Expired' ? 'criteria-type-fixed' : 'criteria-type-'+ edge['type'] %> <%- (edge['type'] === 'system') || (criteriaEdgesOnly && !isCriteriaEdge(edge)) || (hideCriteriaEdges && isCriteriaEdge(edge)) || customEdgeHiddenFilter(edge) ? 'hidden' : '' %>\" data-criteria-number=\"<%- idx %>\" data-criteria-name=\"<%- edge['name'] %>\" data-criteria-type=\"<%- edge['type'] %>\"> <div style=background-color:#ccc;width:100%;height:1px;margin-top:-1px;background-clip:content-box> </div> <div class=\"criteria-table-row <%- (!trueFalseNode && _LeanData.ConditionValidatorUtil.criterionEmpty(edge)) ? 'empty' : (_LeanData.ConditionValidatorUtil.criterionInvalid(edge) ? 'invalid' : '') %>\"> <% if (!hideDragColumn) { %> <div class=drag-column style=\"\"> <% if (edge[\"type\"] !== \"default\") { %> <img class=grab src=\"<%- resourceURL %>/images/Directional_Arrow.png\"> <% } %> </div> <% } %> <div class=\"decision-criteria-column edit-icon-div\" style=\"cursor: <%-disabled ? 'default' : 'pointer'%>\" data-criteria-number=\"<%- idx %>\" data-criteria-name=\"<%- edge['name'] %>\" data-criteria-type=\"<%- edge['type'] %>\"> <div style=overflow-wrap:anywhere> <% if (disabled && edge.type !== 'default') { %> <div class=disabled-message><%- disabledMessage %></div> <% } %> <% if (isMultipleObjectMenu) { %> <div style=font-size:10px;color:var(--dk-grey-1)> <% if ((edge.objectType === 'Task' || edge.objectType === 'Event') && (edge.objectType.toUpperCase() !== (_LeanData.AppState.PrimarySObjectType).toUpperCase())) { %> NEW <%= edge.objectType.toUpperCase() %> ON ROUTED <%= (_LeanData.AppState.PrimarySObjectType).toUpperCase() %> <% } else if (isEnrichmentHUNode) { %> ENRICHED <%= (edge.objectType || _LeanData.AppState.PrimarySObjectType).toUpperCase() %> <% } else { %> ROUTED <%= (edge.objectType || _LeanData.AppState.PrimarySObjectType).toUpperCase() %> (UPDATED) <% } %> </div> <% } %> <div class=decision-criteria-text> <%= formattedConditionTextTemplate({\n                edgesWithAssociatedWarnings: edgesWithAssociatedWarnings,\n                criterion: edge,\n                trueFalseNode: trueFalseNode,\n                useLabelAsCondition: useLabelAsCondition,\n\t\t\t\t\t\t\t\tgetFieldLabel: isMultipleObjectMenu && edge.objectType ? _LeanData.Util.getFieldLabel.bind(this, edge.objectType) : getFieldLabel,\n\t\t\t\t\t\t\t\tgetOperandFieldLabel: isMultipleObjectMenu && edge.objectType ? _LeanData.Util.getFieldLabel.bind(this, edge.objectType) : getOperandFieldLabel,\n                getOperandValueLabel: getOperandValueLabel,\n                getAdditionalObjectFieldLabel: getAdditionalObjectFieldLabel,\n                getAdditionalObjectOperandFieldLabel: getAdditionalObjectFieldLabel,\n                getObjectFieldLabel: getObjectFieldLabel,\n                getObjectOperandFieldLabel: getObjectOperandFieldLabel,\n                isCampaignMemberTrigger: isCampaignMemberTrigger,\n                isAdditionalObjectTrigger: isAdditionalObjectTrigger,\n                objectType: objectType,\n                disabled: disabled\n\t\t\t\t\t\t\t}) %> <img class=\"warning-sign <%-validateEdge(edge) || trueFalseNode ? 'hidden' : ''%>\" src=\"<%- resourceURL %>/images/Triangle_Error_Icon_form.png\" width=15px /> </div> <a class=\"empty-criteria-label <%-disabled ? 'disabled' : ''%>\">Edit condition</a> <% if(edge[\"description\"] && edge[\"description\"].length > 0) { %> <div class=criteria-description-text style=margin-left:20px;margin-right:4px><%- edge[\"description\"]  %></div> <% } %> </div> </div> <% if (!hideLabel) { %> <div class=edge-label-column style=overflow-wrap:anywhere> <input class=\"ld-input-component edge-name-input\" value=\"<%-edge['name']%>\" data-criteria-number=\"<%- idx %>\" data-criteria-name=\"<%- edge['name'] %>\" data-criteria-type=\"<%- edge['type'] %>\"/> </div> <% } %> <% if (isTrigger && (showRoutingPriorityColumn)) { %> <div class=edge-priority-column></div> <% } %> <% if (!isAccountSettingsPage) { %> <div class=next-node-column> <div class=\"edge-connect-icon <%- getEdgeSelectionIconClass(edge['target']) %>\" data-index=\"<%-idx%>\"> <span class=tooltip-content>Connect Edge on Graph</span> </div> <div class=node-edge-connector-vertical-line></div> <div class=\"end-of-flow-icon <%- getEdgeSelectionIconClass(edge['target']) %>\" style=margin-right:10px data-index=\"<%-idx%>\"> <span class=tooltip-content>Set to End of Flow</span> </div> <div class=next-node-column-dropdown style=max-width:200px> </div> </div> <% } %> <% if (!hideDragColumn || alwaysShowDeleteIcon) { %> <ldc-svg-icon-wrapper class=\" <%- edge['type'] !== 'default' && ((edges.length - numDefaultEdges) !== 1 || alwaysShowDeleteIcon) ? 'delete-rule-icon' : '' %> <%- _LeanData.AppState.isReadOnlyView ? '__hidden' : '' %> \" style=\"max-width:20px;max-height:20px;margin-right:10px;align-self:center; <%- _LeanData.AppState.isReadOnlyView ? 'visibility: hidden' : '' %> \" data-criteria-number=\"<%- idx %>\" data-criteria-name=\"<%- edge['name'] %>\" data-criteria-type=\"<%- edge['type'] %>\"></ldc-svg-icon-wrapper> <% } %> </div> <div style=background-color:#ccc;width:100%;height:1px;margin-top:-1px;background-clip:content-box></div> <div class=conditions-edit-partial-wrapper data-criteria-number=\"<%- idx %>\" data-criteria-name=\"<%- edge['name'] %>\" data-criteria-type=\"<%- edge['type'] %>\"></div> </li> <% }); %> </ul> <% if (!hideDragColumn && !hideAddRuleRow) { %> <div class=\"add-rule-container new-rule-container\" style=\"<%- isAdditionalObjectTrigger ? 'margin-top: 6px;' : 'margin-top: 10px;' %>\"> <% if (!hideAddRuleRow) { %> <% if (isAdditionalObjectTrigger) { %> <div class=add-rule-row-item> <button type=button class=\"lds-secondary-small-button rule-type\" data-rule-type=logic>Add Trigger Rule</button> </div> <% } else if (isPartnerTriggerNode) { %> <div class=add-rule-row-item> <div class=\"add-rule-div rule-type\" data-rule-type=logic></div> <div class=header-font>Add Trigger Rule</div> <div class=empty-row-space></div> </div> <% } else if (isTrigger) { %> <div class=add-rule-row-item> <div class=\"add-rule-div rule-type\" data-rule-type=logic></div> <div class=header-font>New Rule</div> <div class=empty-row-space></div> </div> <% } else { %> <div class=add-rule-row-item> <div class=add-rule-div></div> <div class=header-font>New Rule</div> <div class=empty-row-space></div> </div> <div class=add-rule-row-item> <div class=rule-type-selection> <div class=\"rule-type-circle rule-type\" data-rule-type=logic> <div class=\"single-line header-font\" style=line-height:1;font-size:10px>LOGIC</div> </div> <% if (objectType !== 'variables' && objectType !== 'Activity' && nodeObjectType !== 'Meeting') { %> <div class=\"rule-type-circle rule-type\" data-rule-type=soql> <div class=\"single-line header-font\" style=line-height:1;font-size:10px>SOQL</div> </div> <% } %> <% if (allowOptimaNode) { %> <div class=\"rule-type-circle rule-type\" data-rule-type=optima> <div class=\"single-line header-font\" style=line-height:1;font-size:10px;margin-left:1px>MIN</div> <div class=\"single-line header-font\" style=line-height:1;font-size:10px;margin-left:1px>MAX</div> </div> <% } %> </div> <div class=empty-row-space></div> </div> <% } %> <% } %> </div> <% } %> "},function(e,t){e.exports='<% if (!triggerNode) { %> <div class=filter-div style=margin-bottom:15px> <% if (!hideNumber){ %><div class=circle><%- elementOrderInNode %></div><%}%> <div id=customized-header class="header-font has-object-label" style=display:inline-block>Filter <%- isDupeNode ? "Duplicate" : "Matched" %> <%- pluralObjects %></div> <div style=margin-left:30px> <div id=customized-header-subtext class=has-object-label> Identify <%- isDupeNode ? "duplicate" : "matched" %> <%- pluralObjects %> to be considered/excluded:</div> </div> <div class=control-group id=filter-type-radio-control> <label class="control control--radio"> <span class=has-object-label>Include <%- isDupeNode ? "duplicate" : "matched" %> <%- pluralObjects %> based on conditions:</span> <input class=filter-type-radio type=radio id=filter-radio-include data-text-type=inclusion name=radio <%- filterType === "inclusion" ? "checked" : ""%>> <div class=control__indicator id=filter-radio-include-control data-filter-type=inclusion></div> </label> <div id=inclusion-filter-rules style=margin-left:30px></div> <label class="control control--radio"> <span class=has-object-label>Exclude <%- isDupeNode ? "duplicate" : "matched" %> <%- pluralObjects %> based on conditions:</span> <input class=filter-type-radio type=radio id=filter-radio-exclude data-text-type=exclusion name=radio <%- filterType === "exclusion" ? "checked" : ""%>> <div class=control__indicator id=filter-radio-exclude-control data-filter-type=exclusion></div> </label> <div id=exclusion-filter-rules style=margin-left:30px></div> <% if (actionNodeMetaData.hasCustomFilter) { %> <label class="control control--radio">Custom Interface Filter <input class=filter-type-radio type=radio id=filter-radio-custom data-text-type=custom name=radio <%- (filterType === "custom") ? "checked" : ""%>> <div class=control__indicator id=filter-radio-custom-control data-filter-type=custom><input type=radio></div> </label> <div id=custom-filter-rules style=margin-left:30px></div> <% } %> <label class="control control--radio">Do not filter <input class=filter-type-radio type=radio id=filter-radio-none data-text-type=none name=radio <%- (filterType !== "inclusion" && filterType !== "exclusion" && filterType !== "custom") ? "checked" : ""%>> <div class=control__indicator id=filter-radio-none-control data-filter-type=none></div> </label> <div style=margin-top:10px></div> </div> </div> <% } else { %> <div class=control-group id=filter-type-radio-control> <% if (!isUpdateTrigger) { %> <label class="control control--radio"> <span class=has-object-label>All <%- pluralObjects %></span> <input class=filter-type-radio type=radio id=filter-radio-none-control name=radio data-filter-type=none <%- (filterType === "none" || (filterType !== "all" && filterType !== "inclusion")) ? "checked" : ""%>> <div class=control__indicator></div> </label> <% } %> <label class="control control--radio checked"><span class=has-object-label>None</span> <input class=filter-type-radio type=radio id=filter-radio-exclude-control name=radio data-filter-type=all <%- filterType === "all" ? "checked" : ""%>> <div class=control__indicator></div> </label> <label class="control control--radio" style=display:flex;align-items:center>Include the <%- pluralObjects %> below: <div class="ld-tooltip-hint trigger-tooltip short-tooltip small-tooltip" style=margin-left:5px></div> <input class=filter-type-radio type=radio id=filter-radio-include-control name=radio data-filter-type=inclusion <%- filterType === "inclusion" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div id=criteria-list-partial></div> </div> <% } %> <% if(node && node.nodeInfo.objectType === \'L2O\') { // not a great way to check for L2O, but we currently don\'t pass full node info%> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Restrict Opportunities to a Specific Account</span> <input type=checkbox id=restrict-l2o-to-chosen-account name=restrict-l2o-to-chosen-account <%- restrictL2OToChosenAccount ? \'checked="checked"\' : \'\' %>/> <span class=checkmark></span> </label> <%if (restrictL2OToChosenAccount) {%> <ld-variable-setter-angular class=angular-component-in-magellan id=account-variable> </ld-variable-setter-angular> <% } %> <% } %> <% if (showInactiveOwnerCheckbox) {  // checking for L2L or Contact DupeC %> <label class=cb-container-small style="margin:10px 0!important"> <span class=toggleText>Exclude matched <%- pluralObjects.toLowerCase() %> with inactive owners</span> <input type=checkbox id=exclude-inactive-owned name=exclude-inactive-owned <%- excludeInactiveOwned ? \'checked="checked"\' : \'\' %> /> <span class=checkmark></span> </label> <% } %> '},function(e,t){e.exports=' <% if (trueFalseNode) { %> <%- criterion.condition %> <% } else if (_LeanData.ConditionValidatorUtil.criterionEmpty(criterion)){ %> <% if (isAdditionalObjectTrigger) { %> <a class=empty-criteria-label>Edit Trigger Rule</a> <% } else { %> <a class="empty-criteria-label <%-disabled ? \'disabled\' : \'\' %>">Edit condition</a> <% } %> <% } else if (criterion.type === "conditions") { %> <% var referenceFilters = criterion.referenceFilters %> <% if (referenceFilters && referenceFilters.conditions && referenceFilters.conditions.length !== 0) { %> <div style=padding-bottom:10px> <% if (isCampaignMemberTrigger) { %> <div class="ld-body-medium-small-bold italic">Campaigns & <%= _LeanData.StringUtil.pluralizeString(objectType) + \' Included\' %></div> <%= _LeanData.Util.formatTupleCriterionHtml(referenceFilters, getObjectFieldLabel, getObjectOperandFieldLabel, getOperandValueLabel)%> <% } else { %> <div class="ld-body-medium-small-bold italic"><%= _LeanData.StringUtil.pluralizeString(objectType) + \' Included\'%></div> <%= _LeanData.Util.formatTupleCriterionHtml(referenceFilters, getFieldLabel, getOperandFieldLabel, getOperandValueLabel)%> <% } %> </div> <% } %> <% if (trueFalseNode) { %> <%- criterion.name %> <% } else if (criterion.conditions && criterion.conditions.length !== 0) { %> <% if (isAdditionalObjectTrigger) { %> <div class="ld-body-medium-small-bold italic">Trigger Conditions</div> <%= _LeanData.Util.formatTupleCriterionHtml(criterion, getAdditionalObjectFieldLabel, getAdditionalObjectOperandFieldLabel, getOperandValueLabel)%> <% } else { %> <%= _LeanData.Util.formatTupleCriterionHtml(criterion, getFieldLabel, getOperandFieldLabel, getOperandValueLabel)%> <% } %> <% } %> <% } else if (criterion.type === "default") { %> <% if (useLabelAsCondition) { %> <%- criterion.name %> <% } else { %> <%- \'Default\' %> <% } %>  <% } else if (criterion.type === "optima") { %> <%- getFieldLabel(criterion.field) || criterion.field %> <span style=color:#1b527f> <%- criterion.direction.toUpperCase() %> </span> <% } else if (criterion.type === "fixed") { %> <div style=display:inline-flex;align-items:center> <% if (criterion.isNew) { %> <span class=new-edge-text>NEW!</span> <% } %> <% if (!edgesWithAssociatedWarnings.has(criterion)) { %> <%- _LeanData.FlowBuilderUtil.getFormattedEdgeName(criterion.name) %> <% } else { %> <%- _LeanData.FlowBuilderUtil.getFormattedEdgeName(criterion.name) + \'*\' %> <% } %> <% if (_LeanData._tooltip.criteriaNameToTooltipMap[criterion.source] && !(criterion.source === \'Configuration Error\' && !_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph)) { %> <span class="ld-tooltip-hint small-tooltip <%- _LeanData._tooltip.criteriaNameToTooltipMap[criterion.source].selector %>" style=margin-left:5px></span> <% } else if (_LeanData._tooltip.criteriaNameToTooltipMap[criterion.name] && !(criterion.name === \'Configuration Error\' && !_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph)) { %> <span class="ld-tooltip-hint small-tooltip <%- _LeanData._tooltip.criteriaNameToTooltipMap[criterion.name].selector %>" style=margin-left:5px></span> <% } %> </div> <% } else if (criterion.type === "soql") { %> <span style=font-style:italic><%- criterion.soqlCondition %></span> <% } else if (criterion.type === "custom") { %> Custom Tiebreaker: <%- criterion.parameter %> <% } %> '},function(e,t){e.exports="<div class=L2A-match-parent-settings style=margin-bottom:20px> <label class=cb-container-small> <div>Match to Parent Account</div> <input type=checkbox name=l2a-match-parent-toggle class=\"subcontent-toggle l2a-match-parent-toggle\" <%- model.nodeInfo.hasOwnProperty('matchToParent') ? 'checked' : '' %> /> <span class=checkmark></span> </label> <div class=\"control-group l2a-match-parent-choices <%- !model.nodeInfo.hasOwnProperty('matchToParent') ? 'hidden' : ''%>\" style=margin-left:30px> <label class=\"control control--radio\"> <input type=radio class=l2a-match-parent-choice name=l2a-match-parent-choice value=\"<%- 'parent' %>\" <%- model.nodeInfo['matchToParent'] === 'parent' ? 'checked' : '' %> /> <div class=control__indicator></div> Parent </label> <label class=\"control control--radio\"> <input type=radio class=l2a-match-parent-choice name=l2a-match-parent-choice value=\"<%- 'ultimate parent' %>\" <%- model.nodeInfo['matchToParent'] === 'ultimate parent' ? 'checked' : '' %> /> <div class=control__indicator></div> Ultimate Parent </label> </div> </div> "},function(e,t){e.exports='<div class=rule-div> <div class=matched-field-column> <div style=margin-right:10px> <span style=font-weight:600><%- condition.comparand ? condition.comparand : "" %> Field</span> <div class=nested-dropdown-container></div> </div> </div> <div class=operator-column> <div style=margin-right:10px> <span style=font-weight:600>Operator</span> <div class="dropdown width-fill"> <div class=dropdown-toggle id=operator-dropdown- data-bs-toggle=dropdown aria-haspopup=true aria-expanded=true> <span class="dropdown-selection operator-value"><%- condition["direction"] %></span> <span class=ld-caret></span> </div> <ul class="dropdown-menu list-unstyled" aria-labelledby=operator-dropdown-> <li class="dropdown-choice change-parameter-dropdown" data-parameter=direction data-value=max>max</li> <li class="dropdown-choice change-parameter-dropdown" data-parameter=direction data-value=min>min</li> </ul> </div> </div> </div> <br/> </div> <div class=rule-div> <div class="description-div collapsible-outer-container" style=display:block> <div class="description-label collapsible-section-header" style=margin-bottom:2px;display:inline-block>Description</div><br/> <textarea class="description-input collapsible-section change-parameter-input lds-textarea-small" id=conditions-description-input data-parameter=description><%- condition.description %></textarea> </div> </div> '},function(e,t){e.exports="<div> <div id=multi-conditions-edit-partial> <% if (isAdditionalObjectTrigger) { %> <div style=margin-top:5px class=multi-condition-headers> Which <%- isCampaignMemberTrigger ? ' Campaigns & ' : '' %><%- _LeanData.StringUtil.pluralizeString(primaryObjectType) %> do you want to Include? </div> <% } %> <div id=reference-filters-div style=\"<%- isCampaignMemberTrigger ? 'margin: 13px 10px 0px 10px;' : 'margin: 13px 10px 20px 10px;' %>\"> </div> <% if (!isCampaignMemberTrigger) { %> <hr class=horizontal-line-separator-lt-grey-2-large> <% } %> <div style=\"margin-top: <%- isUpdateTrigger ? '23px' : '20px' %>\" class=multi-condition-headers> Which <%- isUpdateTrigger ? (isCampaignMemberTrigger ? 'Campaign Member updates' : secondaryObjectType) : (isCampaignMemberTrigger ? 'Campaign Members' : _LeanData.StringUtil.pluralizeString(secondaryObjectType)) %> should trigger <%- primaryObjectType %> Routing? </div> <div id=conditions-div style=margin-bottom:0> </div> </div> </div>"},function(e,t){e.exports='<div id=node-properties-wrapper> <div id=node-properties-panel> <% if (optionRequired) { %> <div id=option-wrapper> </div> <% } else { %> <div id=node-type> <%- nodeFormHeaderText %> <% if (showNoOwnerWarning) { %> <% if (currentNode instanceof _LeanData.GraphModels.Action_SendNotification) { %> <div class="highlighted-note subheader legacy"> <%- _LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType, true).label %> does not have an Owner field to use as a recipient for notifications.</div> <% } else { %> <div class="highlighted-note subheader" style=line-height:1.3em> <%- _LeanData.MetaDataController.getObjectMetaDataObject(_LeanData.AppState.PrimarySObjectType, true).label %> does not have an Owner field to use as a recipient for this record. Assign Alternate Field instead of Owner must be selected.</div> <% } %> <% } %> <% if ((currentNode instanceof _LeanData.GraphModels.Action_SendNotification) && (_LeanData.AppState.PrimarySObjectType !== \'Meeting\') && (!_LeanData.Util.isAnyObject(_LeanData.AppState.PrimarySObjectType))) { %> <div id=slack-reminder class=ld-body-medium> To send a Slack or Teams Notification, add the node from the <i> Integrations </i> node menu. </div> <% } else if (_LeanData.Util.isAnyObject(_LeanData.AppState.PrimarySObjectType) && currentNode instanceof _LeanData.GraphModels.Action_SendNotification && _LeanData.AppState.PrimarySObjectType !== \'Meeting\') { %> <div id=slack-reminder class=ld-body-medium> To send a Slack Notification, add the node from the <i> Integrations </i> node menu. </div> <% } else if (!(currentNode instanceof _LeanData.GraphModels.Action_MergeContactDuplicate) && (currentNode instanceof _LeanData.GraphModels.Action_MergeDuplicateLead || currentNode instanceof _LeanData.GraphModels.Action_MergeDuplicateContact)) { %> <div style=color:#4d4d4d>Manage preferences in <div id=merge-lead-contact class=lds-link onclick=\'window.open("#routing/"+_LeanData.AppState.PrimarySObjectType.toLowerCase()+"/merge_duplicates","_blank","noopener,noreferrer")\'>Merge Duplicate Settings.</div></div> <% } %> <% if (_LeanData.FlowBuilderGraph.nodeEditorCtrl.isHandoffGraph && currentNode instanceof _LeanData.GraphModels.ActionNode && !(currentNode instanceof _LeanData.GraphModels.Action_SetVariable)) { %> <div class=ld-body-medium style=padding-top:5px>Suggest host(s) for meetings scheduled through BookIt Handoff.</div> <% } %> </div> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\' && (currentNode instanceof _LeanData.GraphModels.MatchNode)) {%> <div class="node-section-text description-note-box" style=font-style:italic> Note: Before a variable can be used, it must be mapped in <span style=font-weight:600>ALL</span> trigger nodes connecting to this match node. </div> <% } else if (_LeanData.AppState.PrimarySObjectType === \'Contact\' && (currentNode instanceof _LeanData.GraphModels.MatchNode) && isC2aNode && !c2aEnabled) { %> <div class=ld-body-medium style=padding-bottom:15px> <div class="description-note-box warning-note light-warning"><span><%- c2aErrMessage %></span> </div> </div> <% } %> <div id=node-name-and-description-div> <% if (!(currentNode instanceof _LeanData.GraphModels.TriggerNode)) { %> <div class=node-name-div> <div class=header-font style=margin-bottom:4px>Node Name</div> <input type=text value="<%- currentName %>" data-name=name id=node-name-input class=lds-field-large /> <div style=display:flex;justify-content:space-between;width:285px> <div id=node-name-error-message class=error-message></div> <div id=node-name-char-count style=color:var(--med-grey-2)></div> </div> </div> <hr class=horizontal-line-separator> <% } %> <div class="description-div collapsible-outer-container" style=display:block> <div class="description-label collapsible-section-header">Description</div> <br/> <textarea class="description-input collapsible-section lds-textarea-small" id=node-description-input><%- currentNode.nodeInfo.description %></textarea> </div> </div> <hr class=horizontal-line-separator> <div id=node-partial-wrapper> </div> <div class=button-div style="margin:20px 0;text-align:center"> <% if (!_LeanData.AppState.isReadOnlyView) { %> <button type=button class="lds-tertiary-large-button node-panel-button cancel" style=margin-right:4px>Cancel</button> <button type=button class="lds-primary-large-button node-panel-button ok" style=margin-left:4px>Done</button> <% } else { %> <button type=button class="lds-tertiary-large-button node-panel-button ok" style=margin-left:4px>Close</button> <% } %> </div> <% } %> </div> </div> '},function(e,t){e.exports='<div id=node-properties-wrapper> <div id=node-type style=font-size:11px><%- nodeType %></div> <div id=hat-choosing-div> <span class=header-font>Please select one of the following:</span> <div class=control-group> <% _.each(hatOptions, function(option) { %> <label class="control control--radio" data-value="<%- option.value %>"><span class=header-font><%- option.name %></span><%- option.description ? " - " + option.description : "" %> <input type=radio id=hat-radio-l2a name=radio data-hat="<%- option.value %>" <%- selectedOption === option.value ? "checked" : "" %>/> <div class=control__indicator data-value="<%- option.value %>"></div> </label> <% }); %> </div> <div class=button-div style="margin:20px 0;text-align:center"> <% if (!_LeanData.AppState.isReadOnlyView) { %> <div class="ld-button cancel" style=margin-right:4px>Cancel</div> <div class="ld-button ok" style=margin-left:4px>OK</div> <% } else { %> <div class="ld-button ok" style=margin-left:4px>Close</div> <% } %> </div> </div> </div> '},function(e,t){e.exports='<% if (!eventNode) { %> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Task Status</div> <div class=createTaskTypeahead style="margin:0 300px 0 0"> <ld-typeahead-angular class=angular-component-in-magellan id=taskStatusDropdown> </ld-typeahead-angular> </div> </div> <div id=invalidTaskStatus class=node-form-error-text></div> <% } %> <div class=section-wrapper-spacing> <div class="header-font header-spacing"><%- eventNode ? \'Event\' : \'Task\' %> Subject</div> <div id=task-subject class="task-subject-container ld-input-group" style=height:auto> <div class=ld-input-group-control style=width:330px;position:relative> <input type=text id=task-subject-input class=lds-field-small style=height:28px;font-size:11px!important placeholder="Enter <%- eventNode ? \'Event\' : \'Task\' %> Subject"/> </div> <div style=padding-left:10px class="ld-input-group-addon merge-field-insert-button-container"></div> </div> <div class="task-subject-error error-message" style=margin-top:5px></div> </div> <% if (!eventNode) { %> <div class=section-wrapper-spacing> <div class="header-font header-spacing">Task Priority</div> <div class=createTaskTypeahead style="margin:0 300px 0 0"> <ld-typeahead-angular class=angular-component-in-magellan id=taskPriorityDropdown> </ld-typeahead-angular> </div> </div> <div id=invalidTaskPriority class=node-form-error-text></div> <div class=section-wrapper-spacing> <div class=control-group id=oc-date-radio-control> <div class="header-font header-spacing">Due Date</div> <div class=horizontal-tabbing-option-div> <label class="control control--radio"> <div>None</div> <input type=radio name=oc-date-radio-control data-date-type=noDueDate /> <div class=control__indicator></div> </label> <label class="control control--radio"> <div>Relative Date</div> <input type=radio name=oc-date-radio-control data-date-type=taskDays /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=margin-left:30px> (Task Creation Date) + <input type=text id=dueDateDays class="lds-field-small <%- taskDays >= 0 ? \'\' : \'lds-field-invalid\' %>" value="<%- taskDays >= 0 ? taskDays : \'\' %>" style=width:30px /> days </div> </div> <label class="control control--radio"> Specific Date <input type=radio name=oc-date-radio-control data-date-type=specificDate /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=display:inline-flex;margin-left:30px> <input type=text class="dg_date-input <%- dueDateInvalid ? \'input-invalid\' : \'\' %>" id=dueDatePicker /> <label class=dg_date-label for=dueDatePicker style=top:0></label> </div> </div> </div> </div> </div> <% } %> '},function(e,t){e.exports=' <div id=radio-container style="display:flex;background-color:var(--lt-grey-1);padding:15px 0 15px 15px;margin:20px 0 20px -15px"> <div class=circle>1</div> <div class=primary-matched-select-radio> <div class=header-font>Select the Related Object</div> <div id=customized-header-subtext class=has-object-label> Select the Object (variable) that the <%- objectTypeLabel %> is related to. </div> <% if (_LeanData.AppState.PrimarySObjectType != "Meeting") { %> <div class=control-group> <label class="control control--radio"> Routed <%- primaryData.label %> <input class=primary-matched-radio type=radio name=primary-matched-radio-control-option data-type=primary data-value="<%- primaryData.label %>"/> <span class=object-type id=object-type-primary>Data Type: Object-<%- primaryData.label %></span> <div class=control__indicator></div> </label> <% _.forEach(referenceTypes, (objectType) => { %> <label class="control control--radio"> <%- objectType %> <input class=primary-matched-radio type=radio name=primary-matched-radio-control-option data-type=reference data-value="<%- objectType %>"/> <span class=object-type id="object-type-<%-objectType%>">Data Type: Object-<%- objectType %></span> <div class=control__indicator></div> </label> <% }) %> <label class="control control--radio" style=display:flex;align-items:center> <span class=matched-object-label style="<%- !hasValidVariables ? \'color: var(--med-grey-1);\' : \'\' %>">Object from another Variable</span> <input class=primary-matched-radio type=radio name=primary-matched-radio-control-option data-type=variable <%- !hasValidVariables ? \'disabled\' : \'\' %> /> <div class=control__indicator></div> </label> <% if (toggledVariableOption) { %> <div class=radio-sub-div style=margin-left:20px;width:500px> <ld-variable-setter-angular id=variable-selection class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <% } %> </div> <% } else { %> <div style=display:flex;margin-left:15px;margin-top:10px> <div class=matched-object-label style=display:flex;align-items:center;font-size:11px;font-weight:var(--semi-bold)>Object from Variable</div> <div class=variable-setter-div style=width:500px> <ld-variable-setter-angular id=variable-selection class=angular-component-in-magellan> </ld-variable-setter-angular> </div> </div> <% } %> </div> </div> '},function(e,t){e.exports=' <div> <span style=display:inline-block>Opportunity Record Type</span> <div id=recordTypeDropdown style="display:inline-block;margin:0 300px 0 0"></div> <div id=recordTypeDropdownErrorText style=display:inline-block;color:var(--ld-red);margin-top:5px></div> </div> '},function(e,t){e.exports='<div class="node-opp-stage-div section-wrapper-spacing"> <div class="header-font header-spacing">Stage</div> <div id=opportunityStageDropdown style="margin:0 300px 0 0"></div> </div> <hr class=horizontal-line-separator> <div class="node-opp-date-div section-wrapper-spacing"> <div class=control-group id=oc-date-radio-control> <div class="header-font header-spacing">Close Date</div> <div class=horizontal-tabbing-option-div> <label class="control control--radio"> <div>Relative Date</div> <input type=radio name=oc-date-radio-control data-date-type=closeDays /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=margin-left:30px> (Opportunity Creation Date) + <input type=text id=oppDateDays class="<%- closeDays >= 0 ? \'\' : \'input-invalid\' %>" value="<%- closeDays >= 0 ? closeDays : \'\' %>" style=width:30px /> days </div> </div> <label class="control control--radio"> Specific Date <input type=radio name=oc-date-radio-control data-date-type=specificDate /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div style=display:inline-flex;margin-left:30px> <input type=text class="dg_date-input <%- closeDateInvalid ? \'input-invalid\' : \'\' %>" id=oppDatePicker /> <label class=dg_date-label for=oppDatePicker style=margin-top:0;top:5px></label> </div> </div> </div> </div> </div>'},function(e,t){e.exports='<div style=display:flex;align-items:center;position:relative> <span class=header-font>Routing Schedule</span> <span class="ld-tooltip-hint respect-schedules-tooltip small-tooltip" style=margin-left:5px></span> </div> <div class="horizontal-tabbing-option-div respect-schedules-container"> <label class=cb-container-small> <div>Respect User\'s Schedule</div> <input type=checkbox name=respect-schedules-cb class=respect-schedules-cb data-type=respect-schedules-on /> <span class=checkmark></span> </label> <div class=schedule-types-container style="margin:10px 25px" hidden> <label class=cb-container-small> <div>Working Hours</div> <input type=checkbox name=respect-schedules-cb class=schedule-type-cb data-type=W /> <span class=checkmark style=margin-top:3px></span> </label> <label class=cb-container-small> <div>Vacation</div> <input type=checkbox name=respect-schedules-cb class=schedule-type-cb data-type=V /> <span class=checkmark style=margin-top:3px></span> </label> <label class=cb-container-small> <div>Holiday</div> <input type=checkbox name=respect-schedules-cb class=schedule-type-cb data-type=H /> <span class=checkmark style=margin-top:3px></span> </label> <label class=cb-container-small> <div>Pausing</div> <input type=checkbox name=respect-schedules-cb class=schedule-type-cb data-type=P /> <span class=checkmark style=margin-top:3px></span> </label> </div> </div> '},function(e,t){e.exports='<% if (showGroupBooking) { %> <div class="additional-attendee-section collapsible-outer-container open"> <div class="collapsible-section-header header-font header-with-badge" style=display:inline-flex;align-items:center> <div>Additional Host(s)<span class="ld-tooltip-hint small-tooltip additional-host-schedules-tooltip" style=margin-left:5px;top:1px></span></div> <% if (!_LeanData.AppState.isHandoffGraph) { %> <ldc-message-badge-angular class=angular-component-in-magellan style=padding-left:5px></ldc-message-badge-angular> <% } %> </div> <div class=optional-subheader>optional</div> <div class=collapsible-section> <div class=additional-attendee-header style=margin-bottom:10px> <% if (showAdditionalHostsModalLink) { %> <div class=additional-attendee-description style=line-height:1.3;padding-bottom:10px> <div id=additional-hosts-modal-link class=lds-link>Learn more about Adding Additional Hosts</div> </div> <% } %> <%if (_LeanData.AppState.isHandoffGraph && showAdditionalAttendeeLock) { %> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockAdditionalAttendees> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1 style=margin-bottom:0!important> <% } %> <ldc-user-variable-list-angular class=angular-component-in-magellan></ldc-user-variable-list-angular> </div> </div> </div> <hr class=horizontal-line-separator> <% } %> <div class=schedule-radio-section> <span class=header-font>Respect User Schedules</span> </div> <div class="horizontal-tabbing-option-div respect-vacation-schedules-container flex align-center"> <label class="cb-container-small respect-vacation-label"> <span class="scheduling-vacation-option respect-vacation-checkbox-option">Vacations </span> <input type=checkbox name=respect-vacation-schedules-cb class=respect-vacation-schedules-cb data-type=respect-vacations-on /> <span class=checkmark></span> </label> <span class="ld-tooltip-hint small-tooltip respect-vacation-schedules-tooltip"></span> </div> <hr class=horizontal-line-separator style=margin-top:10px> <div class="schedule-radio-section collapsible-outer-container open"> <div class="collapsible-section-header header-font" style=display:inline-flex;align-items:center>Meeting Type <div class="ld-tooltip-hint meeting-type-tooltip small-tooltip" style=margin-left:5px;top:1px></div> </div> <% if (_LeanData.AppState.isHandoffGraph) { %> <div class=optional-subheader>optional</div> <% } %> <div class="ld-body-small collapsible-section" style=margin-top:5px> <div class=ld-field-label-small style=margin-right:5px> Select the BookIt <%= _LeanData.AppState.isHandoffGraph ? \'Handoff\' : \'for Forms\' %> <a class=lds-link href=#calendaring/meetings/v2/management target=_blank>meeting type</a> to use for the meeting. </div> <div class=meeting-type-typeahead> <ld-typeahead-angular class=angular-component-in-magellan id=meeting-type-typeahead> </ld-typeahead-angular> </div> <div class=deleted-meeting-type-message> Invalid: select a valid Meeting Type </div> <div class=expired-meeting-type-message style=display:none> Invalid: this Meeting Type has expired </div> </div> </div> <hr class=horizontal-line-separator> <div class="event-creation-section collapsible-outer-container open"> <div class="collapsible-section-header header-font">Event Creation</div> <div class=optional-subheader>optional</div> <div class=collapsible-section style=padding-left:20px> <label class="cb-container-small ld-field-label-small bold"> <span class=node-section-header-text style=line-height:18px>Create Salesforce Event <% if (_LeanData.AppState.isHandoffGraph) { %> <div class="ld-tooltip-hint event-creation-tooltip small-tooltip" style=margin-left:5px></div> <% } %> </span> <input class=create-event-checkbox type=checkbox <%- createEventOn ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> <div id=create-event-section-wrapper class="<%- createEventOn ? \'\' : \'hidden\' %>" style=margin-left:25px> <div style="margin:10px 0 20px">Create a Salesforce Event when a meeting is booked with the suggested host(s).</div> <div id=create-event-radio-options-wrapper class="event-related-to section-wrapper-spacing backbone-component"></div> <hr class=horizontal-line-separator style="margin:20px 0!important"> <div id=other-event-fields-wrapper class="section-wrapper-spacing backbone-component"></div> <hr class=horizontal-line-separator style="margin:20px 0!important"> <div id=additional-event-fields-wrapper class="section-wrapper-spacing backbone-component"></div> </div> </div> </div> <% if (fieldMappingStatus !== \'hidden\' && !_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator style="margin:20px 0!important"> <div class=form-field-mapping-section> <div class=node-section-header-text style=margin-bottom:10px> Form Field Mapping </div> <div class=form-field-description-text style=margin-bottom:10px;line-height:1.3> Map information collected in routing to webform fields (populate hidden fields or overwrite initial inputs) to send to Marketing Automation. Webform inputs entered by your prospect prior to routing will automatically be sent to Marketing Automation. <br/> <i>Note: Combining multiple fields and/or variables will create a value with a text data type.</i> </div> <div style=padding-left:5px> <ld-form-field-mapping-angular class=angular-component-in-magellan> </ld-form-field-mapping-angular> </div> </div> <% } %> '},function(e,t){e.exports='<% if (showFailureNotificationForm) { %> <div class="flex align-center" style=position:relative> <span class=header-font>Email Notifications</span> <span class="ld-tooltip-hint small-tooltip email-notifications-tooltip" style=margin-left:5px></span> </div> <% } %> <% if (notSendingNotifications) { %> <div style=font-style:italic;height:20px;line-height:20px;margin-top:5px;margin-bottom:15px class=highlighted-note> *Notifications are <span style=font-size:11px;font-weight:var(--semi-bold)>not sent</span> for records that route through the â€ <span style=font-size:11px;font-weight:var(--semi-bold)>*</span> â€ marked edges in the â€˜Advanced Settingsâ€™ Section </div> <% } %> <div class=collapsible-section style=margin-right:20px> <div class=channel-wrapper> <% if (!showFailureNotificationForm) { %> <div style=display:flex;align-items:center;position:relative;margin-bottom:10px> <span class=header-font>Channel</span> </div> <div class="chatter-notification-wrapper horizontal-tabbing-option-div"> <label class="cb-container-small chatter-notification-toggle"> <div class="ld-field-label-small send-notification-header">Chatter</div> <input type=checkbox name=send-notif-form-cb class=send-notif-form-cb data-type=chatter <%- showChatterContent ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> <div class="chatter-notification-content <%- showChatterContent ? \'\' : \'hidden\' %> " style=margin-left:25px> <div class="send-notification-subcontent chatter-notification-recipient-selector"></div> <div class="header-font flex align-center" style="border-bottom:1px solid var(--lt-grey-1)"> Message <span class="ld-tooltip-hint chatter-message-tooltip small-tooltip" style=margin-left:5px></span> </div> <div class="send-notification-subcontent chatter-notification-message-selector" style=margin-top:10px></div> </div> </div> <% } %> <div class=success-notification-wrapper> <% if (showFailureNotificationForm) { %> <div class=horizontal-tabbing-option-div> <label class="cb-container-small success-notification-toggle"> <div>Success Notifications</div> <input type=checkbox name=send-notif-form-cb class=send-notif-form-cb data-type=success <%- showSuccessContent ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> </div> <% } else { %> <div class=horizontal-tabbing-option-div> <label class="cb-container-small email-notification-toggle"> <div class="ld-field-label-small send-notification-header">Email</div> <input type=checkbox name=send-notif-form-cb class=send-notif-form-cb data-type=success <%- showSuccessContent ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> </div> <% } %> <div class="success-notification-content <%- showSuccessContent ? \'\' : \'hidden\' %>" style=margin-left:35px> <div class="send-notification-subcontent success-notification-recipient-selector"></div> <% if (!hideEmailTemplates) { %> <div class=header-font style="border-bottom:1px solid var(--lt-grey-1)">Message</div> <div class="send-notification-subcontent control-group"> <label class="control control--radio email-radio"> Email Template <input type=radio name=success value=template <%- useEmailComposer.success ? \'\' : \'checked="checked"\' %>/> <div class=control__indicator></div> </label> <div class="<%- useEmailComposer.success ? \'hidden\' : \'\' %> success-email-template-wrapper" style=margin-left:30px> <div class="send-notification-subcontent success-notification-template-selector"></div> </div> <label class="control control--radio email-radio"> Compose Email <input type=radio name=success value=custom <%- useEmailComposer.success ? \'checked="checked"\' : \'\' %>/> <div class=control__indicator></div> </label> <div class="<%- useEmailComposer.success ? \'\' : \'hidden\' %> success-email-message-wrapper" style=margin-left:30px> <div class="send-notification-subcontent success-email-notification-message-selector"></div> </div> </div> <% } else { %> <div class="send-notification-subcontent success-email-notification-message-selector"></div> <% } %> </div> </div> <% if (showFailureNotificationForm) { %> <div class=failure-notification-wrapper> <div class=horizontal-tabbing-option-div> <label class="cb-container-small failure-notification-toggle"> <div>Failure Notifications</div> <input type=checkbox name=send-notif-form-cb class=send-notif-form-cb data-type=failure <%- showFailureContent ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> </div> <div class="failure-notification-content <%- showFailureContent ? \'\' : \'hidden\' %>" style=margin-left:35px> <div class="send-notification-subcontent failure-notification-recipient-selector"></div> <div class="send-notification-subcontent control-group"> <label class="control control--radio email-radio"> Email Template <input type=radio name=failure value=template <%- useEmailComposer.failure ? \'\' : \'checked="checked"\' %>/> <div class=control__indicator></div> </label> <div class="<%- useEmailComposer.failure ? \'hidden\' : \'\' %> failure-email-template-wrapper" style=margin-left:30px> <div class="send-notification-subcontent failure-notification-template-selector"></div> </div> <label class="control control--radio email-radio"> Compose Email <input type=radio name=failure value=custom <%- useEmailComposer.failure ? \'checked="checked"\' : \'\' %>/> <div class=control__indicator></div> </label> <div class="<%- useEmailComposer.failure ? \'\' : \'hidden\' %> failure-email-message-wrapper" style=margin-left:30px> <div class="send-notification-subcontent failure-email-notification-message-selector"></div> </div> </div> </div> </div> <% } %> </div> </div> <% if (!showFailureNotificationForm) { %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> <% } %> '},function(e,t){e.exports='<div class=condition-wrapper> <div class=rule-div style="<% (!isUpdateTrigger && !isCampaignMemberTrigger && !hideExtraRowHeaders) || isFirstCondition ? \'min-height: 62px\' : \'height:49px\' %>"> <div class=match-column style="<%- matchedFieldColumnWidth ? matchedFieldColumnWidth : \'\' %>"> <div class="rule-number-column header-font <%- ((!isUpdateTrigger && !isCampaignMemberTrigger && !hideExtraRowHeaders) || isFirstCondition) ? \'\' : \'no-header\'%>"> <div style=margin-left:3px;margin-right:12px><%- ruleNum + 1 %>.</div> </div> <div class=matched-field-column> <% if ((!isUpdateTrigger && !isCampaignMemberTrigger && !hideExtraRowHeaders) || isFirstCondition) { %> <% if (conditionObjects.leftOperand.excludeField) { %> <div class=matched-field-column-header> <%- conditionObjects.leftOperand.label %> </div> <% } else if (conditionObjects["leftOperand"].label && conditionObjects["leftOperand"].label.length > 18) { %> <div class=matched-field-column-header> <%- conditionObjects["leftOperand"].label %> Field </div> <% } else {%> <div class=matched-field-column-header><%- (_LeanData.Util.truncateText(conditionObjects["leftOperand"].label, 24) + \' Field\').trim() %></div> <% } %> <% } %> <div class=nested-dropdown-container style=width:auto;background-color:#fff></div> </div> </div> <div class=operator-column style="<%- operatorColumnWidth ? operatorColumnWidth : \'\' %>"> <% if ((!isUpdateTrigger && !isCampaignMemberTrigger && !hideExtraRowHeaders) || isFirstCondition) { %> <div class=operator-label> <%- conditionObjects["operator"].label || "Operator" %> <span class="ld-tooltip-hint small-tooltip wew-tooltip" style=margin-bottom:-2px></span> </div> <% } %> <div class=operator-dropdown></div> </div> <div class="value-field-column <%- unaryOperators.has(condition.operator) ? \'unary-operator\' : \'\' %>" style="<%- valueFieldColumnWidth ? valueFieldColumnWidth : \'\' %>"> <div class=value-field-container> <% if (!unaryOperators.has(condition.operator)) { %> <% if ((!isUpdateTrigger && !isCampaignMemberTrigger && !hideExtraRowHeaders) || isFirstCondition) { %> <% if (hideFieldValueColumn) { %> <div class=value-field-header> <span>Value</span> </div> <% } else {%> <div class=value-field-header> <span class="value-field-selector <%- condition["value/field"] == "value" ? "selected" : "" %>" data-value=value> Value </span> <span> / </span> <span class="value-field-selector <%- condition["value/field"] == "field" ? "selected" : "" %>" data-value=field> <%- conditionObjects["rightOperand"].label %> <%- hasVariables ? "Variable" : "Field"%> </span> </div> <% } %> <% } %> <% if (condition["value/field"] === "field" || useBooleanDropdown || usePicklistDropdown || useMultiPicklistDropdown) { %> <div class=right-operand-dropdown id=right-operand-dropdown></div> <% } else if (condition["type"] === "DATETIME" || condition["type"] === "DATE") { %> <input class="<%- dropdownValid ? \'\' : \'input-invalid\' %> change-condition-value width-fill dropdown-nested operand" type=text value="<%- condition.operand || \'\' %>"> <% } else { %> <textarea class="<%- dropdownValid ? \'\' : \'lds-textarea-invalid\' %> change-condition-value vertical-resize-only lds-textarea-small" placeholder="Enter Value"><%- _LeanData.Util.truncateText(condition.operand, 28) || \'\' %></textarea> <% } %> <div class=temp-operand-dropdown id=temp-operand-dropdown></div> <% } %> </div> <% if (!isUpdateTrigger && !isNewTrigger && !isTimebasedNode && !unaryOperators.has(condition.operator) && !(condition[\'value/field\'] === \'field\' || useBooleanDropdown || useMultiPicklistDropdown)) { %> <div class="ld-input-group-addon merge-field-insert-button-container" style=margin-top:12px></div> <% } %> <% if (conditionsOptional || !isOnlyCondition) { %> <div class="delete-column <%- (isUpdateTrigger && !isFirstCondition) ? \'no-header\' : \'\'%>" style="<%- (!isUpdateTrigger && !isCampaignMemberTrigger && !hideExtraRowHeaders) || isFirstCondition ? \'margin-top: 11px;\' : \'margin-top: 0px;\' %>" data-rule-number="<%- ruleNum %>"></div> <% }%> </div> <% if (isUpdateTrigger && !isCampaignMemberTrigger) { %> <div class="and-column <%- (isUpdateTrigger && !isFirstCondition) ? \'no-header\' : \'\'%>" style="<%- (ruleNum > 0) ? \'margin-top:12px;\' : \'\'%>"><%- !isLastCondition ? \'AND\' : \'\' %></div> <% } %> </div> <div class="hint-message ld-hint-medium" style="margin:5px 0 12px 34px"></div> <div class="error-message ld-text-danger" style="margin:5px 0 12px 34px;font-size:1em"></div> </div> '},function(e,t){e.exports='<div class=rule-div> <div class=value-field-selection-column> <div class=vertically-centered-container> <div class=val-field-header style=margin-bottom:5px;font-size:11px>Value / Variable</div> <div class="side-by-side-control-group val-field-content"> <label class="side-by-side-control control--radio"> <input class=match-type type=radio name="vf_radio_<%- ruleNum %>" value=value data-rule-number="<%- ruleNum %>" <%- fieldType == "value" ? "checked" : "" %>> <div class=control__indicator></div> </label> <label class="side-by-side-control control--radio"> <input class=match-type type=radio name="vf_radio_<%- ruleNum %>" value=field data-rule-number="<%- ruleNum %>" <%- fieldType == "field" ? "checked" : "" %>> <div class=control__indicator></div> </label> </div> </div> </div> <div class=value-field-column> <div style=margin-right:8px> <div class="value-field-label text-capitalize" style=font-weight:600;margin-bottom:5px;font-size:11px><%- writeType %> Field</div> <div class=write-field-dropdown></div> </div> </div> <div class=matched-field-column> <div> <div style=font-weight:600;margin-bottom:5px;font-size:11px><%- fieldType == "field" ? readFieldHeader : \'Value\' %></div> <% if (fieldType == "value") { %> <% if (dataType == "BOOLEAN" || dataType == "PICKLIST" || dataType == "MULTIPICKLIST") { %> <div class=boolean-dropdown></div> <% } else if (dataType == "DATE" || dataType == "DATETIME") { %> <input type=text class="change-condition-value width-fill" style=height:32px value="<%- _.escape(fieldValue) || \'\' %>"/> <% } else { %> <label> <textarea class="change-condition-value width-fill vertical-resize-only lds-textarea-small" style=width:220px;height:15px;line-height:1.5!important;box-sizing:content-box!important><%- fieldValue || \'\' %></textarea> </label> <% } %> <% } else { %> <div class=read-field-dropdown></div> <% } %> </div> </div> <div class="ld-input-group-addon merge-field-insert-button-container" style="margin:17px 5px 0 5px"></div> <div class=delete-column data-rule-number="<%- ruleNum %>"></div> </div> <div class="error-message ld-text-danger" style=font-size:.9em;margin-top:10px></div> '},function(e,t){e.exports='<div class=rule-div> <div class=matched-field-column> <div> <span style=font-weight:600>SOQL Condition</span> <textarea class="soql-rule width-fill change-parameter-input <%- isValid ? \'\' : \'input-invalid\' %>" style="<%- isValid ? \'outline: 1px solid #9eb7cb;\' : \'outline: none;\' %>" data-parameter=soqlCondition placeholder="Enter SOQL String"><%- soqlCondition %></textarea> <span class=soqlFeedback style=font-size:10px;color:#d91e18></span> </div> </div> </div> <div class=rule-div> <div class="description-div collapsible-outer-container" style=display:block> <div class="description-label collapsible-section-header" style=margin-bottom:2px;display:inline-block>Description</div><br/> <textarea class="description-input collapsible-section change-parameter-input lds-textarea-small" id=conditions-description-input data-parameter=description><%- description %></textarea> </div> </div>'},function(e,t){e.exports="<hr class=horizontal-line-separator> <div class=\"update-account-owner-view collapsible-outer-container\"> <span class=header-font>Update <%- objectType %> Account Owner</span> </div> <div class=horizontal-tabbing-option-div> <label class=cb-container-small style=\"margin:10px 0!important\"> <span class=toggleText>Update <%- objectType %>'s Account Owner</span> <input type=checkbox id=updatePrimaryAccountOwner <%- checked ? 'checked' : '' %>> <span class=checkmark></span> </label> </div> "},function(e,t){e.exports='<% if (model.nodeInfo.actionType !== \'Route to Account\') { %> <div> <ld-variable-setter-angular id=account-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <% } %> <div id=action-node-account-owner-partial data-node-type=action-account-owner data-form-title="Action â€“ Assign to Matched Account Owner"> <div id=main-div> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\') { %> <div class=header-font>Schedule Meeting with:</div> <% } else if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class="ld-tooltip-hint main-host-tooltip small-tooltip" style=margin-left:5px></span></div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } else {%> <span class=header-font><%- primaryObject %> Ownership</span> <% } %> <div class="horizontal-tabbing-option-div control-group" id=abr-radio-control style="<%- _LeanData.AppState.isHandoffGraph ? \'margin-left: 20px !important\' : \'\' %>"> <label class="control control--radio"><%- model.nodeInfo.actionType !== \'Route to Account\' ? "Matched " : ""%>Account Owner <input type=radio class=default-radio-option name=radio data-abr-type="account owner"/> <div class=control__indicator></div> </label> <label class="control control--radio"><%- model.nodeInfo.actionType !== \'Route to Account\' ? "Matched " : ""%>Account Custom User Field <input type=radio name=radio data-abr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container style=margin-left:4px id=matched-account-custom-user-field-div> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%- primaryObject.toLowerCase() %> to</div></div> <div class=horizontal-tabbing-dropdown-input style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> <div class="control-wrapper account-team-option <%- primaryObject === \'Meeting\' || accountTeamsProvisioned ? \'\' : \'disabled\' %>" style=margin-top:8px;margin-bottom:5px> <label class="control control--radio" style=display:inline>Account Team <input type=radio name=radio data-abr-type="account team"/> <div class=control__indicator></div> </label> <% if (!(primaryObject === \'Meeting\' || accountTeamsProvisioned)) { %> <ldc-message-badge-angular class=angular-component-in-magellan style=display:inline-block;margin-left:5px></ldc-message-badge-angular> <% } %> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=dropdown-label id=account-teams>Account teams</div> <div id=account-team-div></div> <div class=account-team-view-team-link style=margin-left:20px><div id=view-team-link class=lds-link>View Team</div></div> </div> </div> </div> <label class="control control--radio">Owner Mapping <input type=radio name=radio data-abr-type="owner mapping"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class=dropdown-label id=available-mappings>Available mappings</div> <div id=owner-mapping-div></div> <div style=margin-left:8px id=view-mapping-link class=lds-link>View Owner Mappings</div> </div> </div> <% if (actionNodeMetaData.hasCustomAccountBasedRouting && primaryObject === "Lead") { %> <label class="control control--radio">Custom Interface <input type=radio name=radio data-abr-type="custom interface"/> <div class=control__indicator></div> </label> <% } %> </div> </div> <% if (_LeanData.AppState.PrimarySObjectType !== \'Meeting\' && !_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div> <ld-variable-setter-angular id=activity-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-lead-owner-partial class=node-partial data-node-type=action-lead-owner data-form-title="Action â€“ Assign to Matched Activity Owner"> <div id=main-div> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\') { %> <div class=header-font>Schedule Meeting with:</div> <% } else if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class="ld-tooltip-hint main-host-tooltip small-tooltip" style=margin-left:5px></span></div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } else {%> <span class=header-font><%- primaryObject %> Ownership</span> <% } %> <div class="horizontal-tabbing-option-div control-group" id=rabr-radio-control style="<%- _LeanData.AppState.isHandoffGraph ? \'margin-left: 20px !important\' : \'\' %>"> <label class="control control--radio">Matched Activity Owner <input type=radio class=default-radio-option name=radio data-rabr-type="activity owner"/> <div class=control__indicator></div> </label> <label class="control control--radio">Matched Activity Custom User Field <input type=radio name=radio data-rabr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container id=matched-activity-custom-user-field-selector> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%-primaryObject.toLowerCase()%> to</div></div> <div class="col horizontal-tabbing-dropdown-input" style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> </div> </div> <% if (_LeanData.AppState.PrimarySObjectType !== \'Meeting\' && !_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports=' <div class=action-node-alternate-field-assignment-partial> <span class=header-font>Alternate Field Assignment</span> </div> <div class=horizontal-tabbing-option-div> <label class=cb-container-small> <span class=toggleText>Assign Alternate Field Instead of Owner</span> <input type=checkbox <%- required ? "disabled" : "" %> id=alternateFieldAssignment /> <span class=checkmark></span> </label> <div class=label-dropdown-container style=display:flex id=alternate-field-assignment-div> <div class="horizontal-tabbing-checkbox-option-sub-div dropdown-label typeahead-label-section"> Select the <%- primaryObject %> user field to assign </div> <div id=alternate-field-assignment-typeahead style=margin-left:5px;display:inline-block;min-width:150px></div> </div> </div> '},function(e,t){e.exports="<div id=trigger-node-partial class=node-partial data-node-type=trigger data-form-title=Trigger> <% if (!isUpdateTrigger) { %> <div style=font-weight:600> Specify <span class=text-capitalize style=font-weight:600><%=pluralObjectType%></span> to route: </div> <% } %> <% if (isUpdateTrigger) { %> <div class=ld-body-medium style=margin-top:10px> <span class=text-capitalize><%=pluralObjectType%></span> with updated Campaign Members meeting the following trigger rules will be routed. </div> <% } %> <div class=filter-div id=criteria-list-partial></div> <hr class=horizontal-line-separator> <% if (!isUpdateTrigger) { %> <div id=advanced-settings-wrapper></div> <% } %> </div> "},function(e,t){e.exports='<div> <ld-variable-setter-angular id=campaignmember-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-campaignmember-owner-partial class=node-partial data-node-type=action-campaignmember-owner data-form-title="Action â€“ Assign to Related Campaign Member"> <div id=main-div> <span class=header-font><%-primaryObject%> Ownership</span> <div class="horizontal-tabbing-option-div control-group" id=rcmbr-radio-control> <label class="control control--radio">Matched Campaign Member\'s Campaign Owner <input type=radio class=default-radio-option name=radio data-rcmbr-type="campaign member owner"/> <div class=control__indicator></div> </label> <label class="control control--radio">Matched Campaign Member Custom User Field <input type=radio name=radio data-rcmbr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container id=matched-campaignmember-custom-user-field-selector> <div class=horizontal-tabbing-radio-option-sub-div><div class=dropdown-label>Select the user field to assign the <%-primaryObject.toLowerCase()%> to</div></div> <div class="col horizontal-tabbing-dropdown-input" style=width:50%><div class=custom-user-field-selector></div></div> </div> </div> </div> </div> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div id=action-node-convert-partial class=node-partial data-node-type=action-convert data-form-title="Action â€“ Convert"> <% if (!explicitAccountConversion) { %> <ld-variable-setter-angular id=account-variable class=angular-component-in-magellan> </ld-variable-setter-angular> <% } %> <div id=main-div> <div style=padding-top:15px;font-weight:600>Select a Converted Lead Status</div> <div class=label-dropdown-container style=margin-top:10px> <div class=dropdown-label style=margin-right:5px>Converted Lead Status</div> <div class=convert-status-dropdown-div id=convert-status-dropdown-div></div> <div style=margin-left:8px id=view-lead-statuses class=lds-link>View Lead Statuses</div> </div> <div class="lead-status-error-message error-message"></div> <hr class=horizontal-line-separator> <div> <span class=header-font>Options</span> <div class="horizontal-tabbing-option-div checkbox-toggler-wrapper"> <div class="convert-lead-option <%- !doNotCreateOpportunity || createOpportunityProvisioned ? \'\' : \'disabled\' %> flex align-center"> <label class=cb-container-small style=display:inline> <span class=toggleText>Create an opportunity upon lead conversion</span> <input type=checkbox class=convert-node id=do-not-create-opportunity <%- doNotCreateOpportunity ? \'\' : \'checked="checked"\' %>/> <span class=checkmark></span> </label> <div class="ld-tooltip-hint convert-lead-tooltip small-tooltip"></div> <% if (!createOpportunityProvisioned) { %> <ldc-message-badge-angular class=angular-component-in-magellan style=display:inline-block;margin-left:5px></ldc-message-badge-angular> <% } %> </div> <div id=additional-opp-fields-wrapper class="additional-opp-type single-mapping-row <%- createOpportunityProvisioned ? \'\' : \'disabled\' %>" style="margin:5px 0 5px 35px"></div> <label class=cb-container-small style="display:inline-block;margin-bottom:15px;margin:10px 0!important"> <span class=toggleText>Convert under specified Account</span> <input type=checkbox id=explicit-account-conversion <%- explicitAccountConversion ? \'checked="checked"\' : \'\' %>/> <span class=checkmark></span> </label> <div class=account-finder-component id=account-finder-component style="display:inline-block;width:200px;vertical-align:top;margin:4px 0 0 10px"> </div> <div class=selected-owner-label-container style=display:inline-block;width:200px> <a href=/ class=selected-account-link style=display:inline-block;margin-left:5px target=_blank>View Account</a> <span class="selected-account-text error-message" style=display:inline-block;margin-left:5px></span> </div> </div> </div> </div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper> </div> '},function(e,t){e.exports='<div id=create-new-account-partial> <div class=header-font id=radio-label>Choose an action:</div> <div class="horizontal-tabbing-option-div control-group"> <label class="control control--radio"> Create Account <span class="<%- convertLeadToContact ? \'hidden\' : \'\' %>"> <a href="<%- fieldMappingLink %>" target=_blank>Lead-to-Account Field Mapping</a> </span> <input type=radio name=account-creation-choice value="create account only" <%- convertLeadToContact ? \'\' : \'checked="checked"\' %>/> <div class=control__indicator></div> </label> <% if (!convertLeadToContact) { %> <div class=horizontal-tabbing-radio-option-sub-div id=ld-create-opp-subform> <div class="create-opportunity-option <%- !doNotCreateOpportunity || createOpportunityProvisioned ? \'\' : \'disabled\' %>" style=margin-top:10px!important> <label class=cb-container-small style=display:inline-block;margin-bottom:20px!important> <span class=toggleText>Create Opportunity</span> <input type=checkbox class=create-new-node id=do-not-create-opportunity <%- doNotCreateOpportunity ? \'\' : \'checked="checked"\' %>> <span class=checkmark></span> </label> <% if (!createOpportunityProvisioned) { %> <ldc-message-badge-angular class="angular-component-in-magellan opportunity-badge" style=display:inline-block></ldc-message-badge-angular> <% } %> <% if (!doNotCreateOpportunity) { %> <div class="create-opportunity-container horizontal-tabbing-radio-option-sub-div"></div> <% } %> </div> </div> <% } %> <div class="control-wrapper convert-lead-option <%- convertLeadProvisioned ? \'\' : \'disabled\' %>" style=margin-top:8px> <label class="control control--radio" style=display:inline-block;margin:0> Create Account and Convert Lead to Contact Under New Account <input type=radio name=account-creation-choice value="convert lead to contact" id=convert-to-contact <%- convertLeadToContact ? \'checked="checked"\' : \'\' %>/> <div class=control__indicator></div> </label> <% if (!convertLeadProvisioned) { %> <ldc-message-badge-angular class="angular-component-in-magellan convert-badge" style=display:inline-block;margin-left:5px></ldc-message-badge-angular> <% } %> <% if (convertLeadToContact) { %> <div class=warning-text style="font-weight:200;padding:0 0 0 30px;margin-bottom:5px;font-size:11px;line-height:20px"><b>Important:</b> This option uses the default Salesforce new account field mapping, not the user-defined LeanData ones.</div> <% } %> <div class="<%-convertLeadToContact ? \'\' : \'hidden\'%> horizontal-tabbing-radio-option-sub-div"> <div class=label-dropdown-container id=convert-status-dropdown-div> <div class=dropdown-label style=margin-right:5px>Converted Lead Status</div> <div id=convert-status-typeahead-dropdown style=min-width:240px></div> </div> <div class="lead-status-error-message error-message"></div> <% if (convertLeadProvisioned) { %> <hr class=horizontal-line-separator> <div class="flexbox-container center-y create-opportunity-option <%- !doNotCreateOpportunity || createOpportunityProvisioned ? \'\' : \'disabled\' %>"> <label class=cb-container-small style="margin:15px 0!important;display:flex"> <span class=toggleText>Create Opportunity</span> <input type=checkbox class=create-new-node id=do-not-create-opportunity <%- doNotCreateOpportunity ? \'\' : \'checked="checked"\' %>> <span class=checkmark></span> </label> <div class="ld-tooltip-hint create-account-tooltip"></div> <% if (!createOpportunityProvisioned) { %> <ldc-message-badge-angular class="angular-component-in-magellan opportunity-badge" style=display:inline-block;margin-left:5px></ldc-message-badge-angular> <% } %> </div> <% } %> </div> </div> </div> <% if (showRecordType) { %> <hr class=horizontal-line-seperator style="margin:10px 0 10px 0"> <div id=record-type-typeahead-dropdown-wrapper class=section-wrapper-spacing> <div id=additional-account-fields> <span class=header-font>Record Type</span> <div>Select a Record Type for the Created Account.</div> <div class=label-dropdown-container style=margin-top:10px> <div id=record-type-typeahead-dropdown style=min-width:240px></div> <span class="ld-tooltip-hint record-type-tooltip" style=margin-left:7px></span> </div> </div> </div> <% } %> <hr class=horizontal-line-separator> <div id=additional-account-fields-wrapper class=section-wrapper-spacing></div> <% if (!convertLeadToContact) { %> <ld-variable-setter-angular id=created-account class=angular-component-in-magellan> </ld-variable-setter-angular> <% } %> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper> </div> </div>'},function(e,t){e.exports='<div id=create-new-opportunity-partial class=node-partial data-node-type=action-create-opportunity data-form-title="Action - Create Opportunity"> <div id=account-create-opp-div> <div class="node-opp-name-div section-wrapper-spacing"> <% if (!isInternalView && _LeanData.AppState.PrimarySObjectType === \'Lead\') { %> <ld-variable-setter-angular id=account-variable class=angular-component-in-magellan> </ld-variable-setter-angular> <% } %> <div class="flex align-center" style=margin-bottom:5px> <span class=header-font style=margin-right:5px>Opportunity Name</span> <% if (_LeanData.AppState.PrimarySObjectType == \'Contact\') { %> <span class="ld-tooltip-hint create-opp-tooltip small-tooltip"></span> <% } %> </div> <div id=opportunity-subject class=ld-input-group style=width:50%> <div class=ld-input-group-control style=width:99%> <textarea style=height:17px;width:350px;margin-right:10px;overflow:hidden class="<%- oppName.length === 0 ? \'lds-textarea-invalid\' : \'\' %> ld-opp-name vertical-resize-only lds-textarea-small" placeholder="Enter Opportunity Name" data-name=name id=node-opp-name-input><%- _LeanData.Util.truncateText(oppName, 57) %></textarea> </div> <div class="ld-input-group-addon merge-field-insert-button-container" style=vertical-align:top></div> </div> <div class="opportunity-name-error error-message" style=margin-top:5px></div> </div> <hr class=horizontal-line-separator> <div class=node-opp-owner-div class=section-wrapper-spacing> <div class="header-font header-spacing">Owner</div> <div class="horizontal-tabbing-option-div control-group" id=oc-owner-radio-control> <% if (objectType != \'Account\') { %> <label class="control control--radio"> <%- objectType + \' Owner\' %> <input type=radio name=oc-owner-radio-control data-owner-type=ownerAssignment /> <div class=control__indicator></div> </label> <% } %> <label class="control control--radio"> <%- \'Account Owner\' %> <input type=radio name=oc-owner-radio-control data-owner-type=accountOwnerAssignment /> <div class=control__indicator></div> </label> <div class="control-wrapper account-team-option <%- accountTeamsProvisioned ? \'\' : \'disabled\' %>"> <label class="control control--radio" style=display:inline> Account Team <input type=radio name=oc-owner-radio-control data-owner-type=accountTeamAssignment /> <div class=control__indicator></div> </label> <% if (!accountTeamsProvisioned) { %> <ldc-message-badge-angular class=angular-component-in-magellan style=display:inline-block;margin-left:5px></ldc-message-badge-angular> <% } %> <div class=radio-sub-div> <div id=account-team-typeahead class=node-detail-input></div> <div id=invalidAccountTeamText style=margin-left:30px;color:red></div> </div> </div> <label class="control control--radio"> Explicit Owner <input type=radio name=oc-owner-radio-control data-owner-type=explicitOwnerAssignment /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=ownerListDropdown class=node-detail-input>Loading...</div> <div id=invalidExplicitOwnerText style=margin-left:30px;color:red></div> </div> <label class="control control--radio"> Custom User Field <input type=radio name=oc-owner-radio-control data-owner-type=customUserField /> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div id=custom-user-field-typeahead class=node-detail-input></div> </div> </div> </div> <hr class=horizontal-line-separator> <div id=required-opp-fields-wrapper class=section-wrapper-spacing></div> <hr class=horizontal-line-separator> <div id=additional-opp-fields-wrapper class=section-wrapper-spacing></div> </div> <ld-variable-setter-angular id=created-opportunity class=angular-component-in-magellan> </ld-variable-setter-angular> <% if (!isInternalView) { %> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> <% } %> </div>'},function(e,t){e.exports='<div id=create-new-opportunity-partial class=node-partial data-node-type=action-create-task data-form-title="Action - Create Task"> <div id=create-task-form-container> <div id=create-task-radio-options-wrapper class=section-wrapper-spacing></div> <div id=other-task-fields-wrapper class=section-wrapper-spacing></div> <div id=additional-task-fields-wrapper class=section-wrapper-spacing></div> </div> <ld-variable-setter-angular id=created-task class=angular-component-in-magellan> </ld-variable-setter-angular> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div id=action-node-custom-interface-partial class=node-partial data-node-type=action-custom-interface data-form-title="Action â€“ Custom Interface"> <div id=main-div> <% if(Object.keys(customInterfaceNodesAndEdges).length === 0) { %> <div class=header-font>Custom Parameter</div> <div>Enter the parameter to be used with this Custom Interface node.</div> <div class=custom-interface-parameter-column> <textarea class="custom-interface-parameter width-fill" rows=1 style=overflow:hidden;word-wrap:break-word;height:22px><%- customParameter %></textarea> </div> <% } else { %> <div class="header-font header-spacing">Node Type</div> <div id=customInterfaceNodeDropdown class=customInterfaceNodeTypeahead style="margin:0 300px 0 0"></div> <% } %> <% if (customParameter in customInterfaceVariables) { %> <div class=section-wrapper-spacing></div> <ld-variable-setter-angular></ld-variable-setter-angular> <% } %> <div class=section-wrapper-spacing></div> <div class=so-field-updater-container></div> <div class=section-wrapper-spacing></div> </div> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports='<div id=action-node-custom-interface-partial class=node-partial data-node-type=action-custom-interface data-form-title="Action â€“ Custom Interface"> <div id=main-div> <% if (customParameter in customInterfaceVariables) { %> <div class=section-wrapper-spacing></div> <ld-variable-setter-angular></ld-variable-setter-angular> <% } %> <% if(Object.keys(customInterfaceNodesAndEdges).length === 0) { %> <div class=header-font>Custom Parameter</div> <div>Enter the parameter to be used with this Custom Interface node.</div> <div class=custom-interface-parameter-column> <textarea class="custom-interface-parameter width-fill" rows=1 style=overflow:hidden;word-wrap:break-word;height:22px><%- customParameter %></textarea> </div> <% } else { %> <div class="header-font header-spacing">Node Type</div> <div id=customInterfaceNodeDropdown class=customInterfaceNodeTypeahead style="margin:0 300px 0 0"></div> <% } %> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\' || _LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <div class=section-wrapper-spacing></div> <div class=so-field-updater-container></div> <div class=section-wrapper-spacing></div> </div> <div id=advanced-settings-wrapper></div> </div>'},function(e,t){e.exports="<% if (showMatchSelector) {%> <div class=node-editor-section> <ld-match-selector-angular></ld-match-selector-angular> </div> <% }%> <div class=node-editor-section> <div id=conditions-header-section> <div class=header-font>Conditions</div> <div class=sub-header-font>Create Condition(s) for each path the flow can take. Specify criteria to be met for the Routed <%- primaryObject %> to take that path.</div> <i class=sub-header-font>Note: If no Conditions are met, the Routed <%- primaryObject %> will take the Default path.</i> </div> <div id=criteria-list-partial class=decision-criteria-list></div> </div> "},function(e,t){e.exports=' <div> <ld-variable-setter-angular id=contact-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-merge-partial class=node-partial data-node-type=action-merge data-form-title="Action â€“ Merge Dupe Contact"> <div class=instruction-text>To merge a Lead with a Contact, LeanData must convert the Lead first. Select a Converted Lead Status for the merged Lead.</div> <div class=label-dropdown-container id=merge-status-dropdown-div> <div class=dropdown-label style=margin-right:5px>Merged Lead Status</div> <div id=merge-status-typeahead-dropdown></div> <div style=margin-left:8px id=view-lead-statuses class=lds-link>View Lead Statuses</div> </div> <div class="merge-contact-error-message error-message"></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper /> </div>'},function(e,t){e.exports='<div> <ld-variable-setter-angular id=opportunity-variable class=angular-component-in-magellan> </ld-variable-setter-angular> </div> <div id=action-node-opportunity-owner-partial class=node-partial data-node-type=action-opportunity-owner data-form-title="Action â€“ Assign to Matched Opportunity Owner"> <div id=main-div> <% if (_LeanData.AppState.PrimarySObjectType === \'Meeting\') { %> <div class=header-font>Schedule Meeting with:</div> <% } else if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class="ld-tooltip-hint main-host-tooltip small-tooltip" style=margin-left:5px></span></div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } else {%> <span class=header-font><%- primaryObject %> Ownership</span> <% } %> </div> <div class="horizontal-tabbing-option-div control-group" id=obr-radio-control style="<%- _LeanData.AppState.isHandoffGraph ? \'margin-left: 20px !important\' : \'\' %>"> <label class="control control--radio" style=margin-right:0>Matched Opportunity Owner <input type=radio class=default-radio-option name=radio data-obr-type="opportunity owner"/> <div class=control__indicator></div> </label> <label class="control control--radio">Matched Opportunity Custom User Field <input type=radio name=radio data-obr-type="custom field"/> <div class=control__indicator></div> </label> <div class=radio-sub-div> <div class=label-dropdown-container> <div class="horizontal-tabbing-radio-option-sub-div dropdown-label" id=select-user>Select the user field to assign the <%- primaryObject.toLowerCase() %> to</div> <div id=matched-opportunity-custom-user-field-div style=width:50%></div> </div> </div> </div> <% if (_LeanData.AppState.PrimarySObjectType !== \'Meeting\' && !_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div style=display:inline-block class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div id=outreach-add-to-sequence-partial class=node-partial data-node-type=action-outreach-add-to-sequence data-form-title="Action - Add to Sequence"> <% if (_LeanData.MetaDataController.getPartnerNodeAuthorization(\'outreachAddToSequence\').state === \'ON\' && \n  (!_LeanData.MetaDataController.getPartnerAuthorization(\'outreach\') || !_LeanData.MetaDataController.getPartnerConfiguration(\'outreach\').leadProspectIdField ||\n  !_LeanData.MetaDataController.getPartnerConfiguration(\'outreach\').contactProspectIdField || !_LeanData.MetaDataController.getPartnerConfiguration(\'outreach\').userIdField)\n  ) { %> <div class=ld-body-medium><span class=error-message> Outreach is not authorized; please authorize under Integrations > Outreach </span></div> <% } %> <% if (_LeanData.MetaDataController.getPartnerNodeAuthorization(\'outreachAddToSequence\').state === \'OFF\') { %> <div class=ld-body-medium><span class=error-message> Callouts have been disabled for this node. </span></div> <% } %> <div class=section-wrapper-spacing style=margin-top:20px;margin-bottom:20px> <div class="header-font header-spacing">Which Sequence do you want to add the prospect to?</div> <div style=display:flex;align-items:center;margin-left:20px> <div class=control-group style=margin-left:7px;font-weight:600> Add Prospect to Sequence </div> <div class=outreach-sequences-typeahead style=margin-left:10px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=outreach-sequences-typeahead> </ld-typeahead-angular> </div> <div id=refresh-sequences-typeahead class="refresh-icon large" style=cursor:pointer;height:20px;margin-left:10px></div> </div> </div> <hr class=horizontal-line-separator /> <div class=section-wrapper-spacing> <div class="header-font header-spacing" style=display:flex;margin-top:20px> <span>Mailbox for Email Delivery</span> <div class="ld-tooltip-hint mailbox-user-tooltip" style=margin-left:5px></div> </div> </div> <div style=margin-left:20px;margin-bottom:20px> <div id=radio-record-owner></div> <div style=display:flex;height:30px> <div id=radio-custom-user-field></div> <div id=outreach-user-field-typeahead-container style=display:flex;align-items:center> <span class=custom-user-field-typeahead style=margin-left:17px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=custom-user-field-typeahead> </ld-typeahead-angular> </span> </div> </div> <div> <div style=display:flex;height:30px> <div id=radio-specific-user></div> <div id=outreach-users-typeahead-container> <div style=display:flex;align-items:center> <span class=outreach-users-typeahead style=margin-left:17px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=outreach-users-typeahead> </ld-typeahead-angular> </span> <div id=refresh-users-typeahead class="refresh-icon large" style=cursor:pointer;height:20px;margin-left:10px></div> </div> </div> </div> </div> </div> <hr class=horizontal-line-separator /> <div class=section-wrapper-spacing style=margin-top:20px> <div class="header-font header-spacing" style=display:flex;margin-top:20px> <span>Outreach Ownership Assignment</span> <div class="ld-tooltip-hint owner-user-tooltip" style=margin-left:5px></div> </div> <div class="reauth-warning highlighted-note" style=padding:10px> Please reauthorize your <a href=/apex/Dashboard#integrations target=_blank class=lds-link>Outreach Integration</a> to use Update Ownership in Outreach </div> <div style=margin-top:15px;margin-left:20px;margin-bottom:20px> <label class="ownership-checkbox-label cb-container-small" style=display:inline;margin-top:10px> <span class=toggleText>Update Ownership in Outreach</span> <input class=ownership-checkbox type=checkbox id=update-ownership <%- showOwnership ? \'checked="checked"\' : \'\' %> /> <span class=checkmark></span> </label> <div class=update-owner-type style=margin-left:20px;margin-bottom:20px;margin-top:15px> <div id=radio-record-ownership></div> <div style=display:flex;height:30px> <div id=radio-custom-owner-field></div> <div id=outreach-owner-field-typeahead-container style=display:flex;align-items:center> <span class=custom-owner-field-typeahead style=margin-left:17px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=custom-owner-field-typeahead> </ld-typeahead-angular> </span> </div> </div> <div> <div style=display:flex;height:30px> <div id=radio-specific-owner></div> <div id=outreach-owners-typeahead-container> <div style=display:flex;align-items:center> <span class=outreach-owners-typeahead style=margin-left:17px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=outreach-owners-typeahead> </ld-typeahead-angular> </span> <div id=refresh-owners-typeahead class="refresh-icon large" style=cursor:pointer;height:20px;margin-left:10px></div> </div> </div> </div> </div> </div> </div> <hr class=horizontal-line-separator /> <div id=advanced-settings-wrapper style=margin-top:20px></div> </div></div>'},function(e,t){e.exports='<div class=reroute-node-form> <div class="ld-body-medium highlighted-note" style="margin:5px 0"> The â€œHold Untilâ€ node is the recommended method to enforce and report on SLAs. Records can be held until they meet specified criteria, rather than waiting for the full time to elapse before criteria is checked. Read more <a href=https://leandatahelp.zendesk.com/hc/en-us/articles/1260803413769 target=_blank class=lds-link>here</a>. </div> <br/> <div class=reroute-time-config-container> <span class=ld-field-label-small style=font-weight:600;color:#1f1f1f> Time Frame </span> <div class=ld-body-medium style="margin:5px 0"> Set the time frame when the following rules will be evaluated <span style=font-style:italic>(based on system performance, a delay of a few minutes may occur).</span> </div> <br/> <div class=reroute-time-options-container> <div class=control-group> <label class="control control--radio"> <span class=ld-field-label-small style=font-weight:600;color:#1f1f1f>Evaluate after Defined Time Frame</span> <input type=radio class=reroute-time-choice name=reroute-time-choice data-category=timeFrameChoice value="defined time"/> <div class=control__indicator></div> </label> <div class=radio-sub-div style=padding-left:40px> <div style=display:flex;width:250px> <div style=flex:3> <div class=ld-body-small style=margin:5px>Days</div> <div class=time-days-container style=display:inline-flex;margin-left:0;width:75px;vertical-align:middle></div> </div> <div style=flex:3> <div class=ld-body-small style="margin:5px 15px">Hours</div> <div class=time-hours-container style=display:inline-flex;margin-left:10px;width:75px;vertical-align:middle> <% if (model.get(\'respectSchedules\')) { %> <input type=number min=0 max=720 class=time-hours-input value="<%- model.get(\'hours\') ? model.get(\'hours\') : 0 %>" style=width:75px;height:27px /> <% }%> </div> </div> <div style=flex:3> <div class=ld-body-small style="margin:5px 15px">Minutes</div> <div class=time-minutes-container style=display:inline-flex;margin-left:10px;width:75px;vertical-align:middle> <% if (model.get(\'respectSchedules\')) { %> <input type=number min=0 max=59 class=time-minutes-input value="<%- model.get(\'minutes\') ? model.get(\'minutes\') : 0 %>" style=width:75px;height:27px /> <% }%> </div> </div> </div> <label class=cb-container-small style="margin:20px 0!important;display:inline-block"> <span class=toggleText id=respect-schedules-toggle>Respect User\'s Schedule</span> <input type=checkbox id=alternatefieldassignment <%= model.get(\'respectSchedules\') ? \'checked\' : \'\' %> /> <span class=checkmark></span> </label> <span class="ld-tooltip-hint respect-user-schedule-tooltip" title=""></span> </div> <label class="control control--radio"> <span class=ld-field-label-small style=font-weight:600;color:#1f1f1f>Evaluate during Working Hours</span> <span class="ld-tooltip-hint reroute-working-hours-tooltip"></span> <input type=radio class=reroute-time-choice name=reroute-time-choice data-category=timeFrameChoice value="working hours"/> <div class=control__indicator></div> </label> <div class=radio-sub-div style=padding-left:40px> <div class=label-dropdown-container style=margin-bottom:5px> <label class=dropdown-label style=width:150px;max-width:200px;font-weight:400;margin-right:10px>Working Hours Schedule: </label> <div class=working-hours-dropdown style=display:inline-block;width:300px></div> </div> <div class=wh-timezone-container style=width:300px;margin-left:210px></div> <div class=label-dropdown-container style=margin-top:15px> <label class=dropdown-label style=width:150px;max-width:200px;font-weight:400;margin-right:10px>Holidays Schedule (optional): </label> <div class=holidays-dropdown style=display:inline-block;width:300px></div>&nbsp; <div class=clear-holidays-container style=display:inline-block><a href=javascript:void(0); class=clear-holidays>Clear</a></div> </div> <div class=hs-timezone-container style=width:300px;margin-left:210px></div> </div> </div> <div class="error-message time-frame-error" style=margin-top:5px></div> </div> </div> <br/> <hr class=horizontal-line-separator> <div style=margin-bottom:10px> <span class=ld-field-label-small style=font-weight:600>Rules</span> </div> <div id=criteria-list-partial class=reroute-edges-config-container></div> </div> '},function(e,t){e.exports='<div id=salesloft-add-to-cadence-partial class=node-partial data-node-type=action-salesloft-add-to-cadence data-form-title="Action - Add to Cadence"> <% if (_LeanData.MetaDataController.getPartnerNodeAuthorization(\'salesloftAddToCadence\').state === \'ON\' && !_LeanData.MetaDataController.getPartnerAuthorization(\'salesloft\')) { %> <div class=ld-body-medium><span class=error-message> Salesloft is not authorized; please authorize under Integrations > Salesloft </span></div> <% } %> <% if (_LeanData.MetaDataController.getPartnerNodeAuthorization(\'salesloftAddToCadence\').state === \'OFF\') { %> <div class=ld-body-medium><span class=error-message> Callouts have been disabled for this node. </span></div> <% } %> <div class=section-wrapper-spacing style=margin-top:20px;margin-bottom:20px> <div class="header-font header-spacing">Which Cadence do you want to add the person to?</div> <div style=display:flex;align-items:center;margin-left:20px> <div class=control-group style=margin-left:7px;font-weight:600> Add Person to Cadence </div> <div class=salesloft-cadences-typeahead style=margin-left:10px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=salesloft-cadences-typeahead> </ld-typeahead-angular> </div> <div id=refresh-cadences-typeahead class="refresh-icon large" style=cursor:pointer;height:20px;margin-left:10px> </div> </div> <div class="cadence-error-message error-message" style=padding:5px></div> </div> <hr class=horizontal-line-separator /> <div class=section-wrapper-spacing> <div class="header-font header-spacing" style=display:flex;margin-top:20px> <span>Who do you want to assign cadence task and Salesloft ownership to?</span> <div class="ld-tooltip-hint assignee-user-tooltip" style=margin-left:5px></div> </div> </div> <div style=margin-left:20px;margin-bottom:20px> <div id=radio-record-owner></div> <div style=display:flex;height:30px> <div id=radio-custom-user-field></div> <div id=salesloft-user-field-typeahead-container style=display:flex;align-items:center> <span class=custom-user-field-typeahead style=margin-left:17px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=custom-user-field-typeahead> </ld-typeahead-angular> </span> </div> </div> <div> <div style=display:flex;height:30px> <div id=radio-specific-user></div> <div id=salesloft-users-typeahead-container> <div style=display:flex;align-items:center> <span class=salesloft-users-typeahead style=margin-left:17px;width:300px> <ld-typeahead-angular class=angular-component-in-magellan id=salesloft-users-typeahead> </ld-typeahead-angular> </span> <div id=refresh-users-typeahead class="refresh-icon large" style=cursor:pointer;height:20px;margin-left:10px></div> </div> </div> </div> </div> </div> <hr class=horizontal-line-separator /> <div id=advanced-settings-wrapper style=margin-top:20px></div> </div> '},function(e,t){e.exports='<% if (applicableScheduledJobs.length > 0) { %> <hr class=horizontal-line-separator> <div class="collapsible-section-header header-font"> Scheduled Routing Edge </div> <div class=collapsible-section> <div class=scheduled-job-description> This graph is associated with one or more scheduled jobs in <a class=lds-link href=#routing/routing_scheduler target=_blank>Routing Scheduler</a>.<br> An <i>Edge</i> must be selected as a starting point for each scheduled job. </div> <div class=scheduled-job-header> <div class=scheduled-job-name-col>Job Name</div> <div class=scheduled-job-edge-col>Edge</div> </div> <div class=scheduled-job-rows-wrapper> <% applicableScheduledJobs.forEach((scheduledJob) => { %> <div class=scheduled-job-row data-id="<%- scheduledJob.Id %>"> <div class=scheduled-job-name-col><%- scheduledJob.jobName %></div> <div class=scheduled-job-edge-col></div> </div> <% }) %> </div> </div> <% } %> '},function(e,t){e.exports="<div id=action-node-territory-routing-partial class=node-partial data-node-type=action-territory-routing data-form-title=\"Action â€“ Route To Territory\"> <div id=main-div> <% if (_LeanData.AppState.PrimarySObjectType === 'Meeting') { %> <div class=header-font>Schedule Meeting with:</div> <% } else if (_LeanData.AppState.isHandoffGraph) { %> <div class=header-font style=margin-bottom:12px>Main Host<span class=\"ld-tooltip-hint main-host-tooltip small-tooltip\" style=margin-left:5px></span></div> <div class=node-section-text>Suggest the main host Handoff users should schedule the meeting with.</div> <ld-lock-suggestion-angular class=angular-component-in-magellan id=lockHost> </ld-lock-suggestion-angular> <hr class=horizontal-line-separator-lt-grey-1> <% } %> <div class=label-dropdown-container id=segment-dropdown-div> <div class=dropdown-label style=\"margin-right:10px;display:flex;align-items:center;padding-left: <%- _LeanData.AppState.PrimarySObjectType === 'Meeting' || _LeanData.AppState.isHandoffGraph ? '20px' : '0px' %>\"> <%- _LeanData.AppState.PrimarySObjectType === 'Meeting' || _LeanData.AppState.isHandoffGraph ? 'Territory Segment' : 'Choose a Territory Segment' %> <span class=\"ld-tooltip-hint territory-bu-graph-tooltip small-tooltip <%- _LeanData.AppState.businessUnitId ? '' : 'hidden' %>\" style=margin-left:5px></span> </div> <div id=territory-segment-typeahead-dropdown style=width:250px></div> <div class=territory-view style=margin-left:8px><div id=territory-view-group-link class=\"lds-link disabled\">View Territory Segments</div></div> </div> <div id=territory-segment-error-text style=\"padding-left: <%- _LeanData.AppState.PrimarySObjectType === 'Meeting' || _LeanData.AppState.isHandoffGraph ? '20px' : '0px' %>\"></div> <% if (_LeanData.AppState.isHandoffGraph) { %> <div class=availability-checkbox-wrapper style=width:fit-content;margin-left:135px> <label class=\"cb-container-small ld-field-label-small bold\" style=margin-top:15px!important;height:auto> <span class=ld-field-label-small style=line-height:18px> Display All Pool Members' Availability <div class=\"ld-tooltip-hint availability-tooltip small-tooltip\" style=vertical-align:top;top:2px></div> </span> <input class=availability-checkbox type=checkbox <%- model.nodeInfo.displayAllPoolAvailability ? 'checked' : ''%>/> <span class=checkmark></span> <div class=description-text style=margin-top:5px><i>If pool is selected in Territory Segment, the meeting will be scheduled with the pool member available at the time selected by the guest.</i></div> </label> </div> <% } %> <div id=territory-routing-field-mapping-title style=\"display:none;margin-bottom:10px;margin-top:20px;padding-left: <%- _LeanData.AppState.PrimarySObjectType === 'Meeting' || _LeanData.AppState.isHandoffGraph ? '20px' : '0px' %>\"> <div class=header-font>Fields Used for Assignment</div> <div style=margin-bottom:10px>Select the fields to be checked for a Territory assignment.</div> <div style=margin-bottom:30px class=territory-routing-field-mapping id=territory-routing-field-mapping></div> </div> </div> <% if (_LeanData.AppState.PrimarySObjectType !== 'Meeting' && !_LeanData.AppState.isHandoffGraph) { %> <hr class=horizontal-line-separator> <div id=respect-schedules-wrapper></div> <hr class=horizontal-line-separator> <div class=alternate-field-assignment-container></div> <div id=update-account-owner></div> <hr class=horizontal-line-separator> <div id=populateTerritoryFieldDiv class=action-node-alternate-field-assignment-partial style=margin-top:10px> <span class=header-font>Territory Field Tagging</span> <label class=cb-container-small style=margin:10px!important> <span class=toggleText>Tag LD Territory Field on <%- objectType || _LeanData.AppState.PrimarySObjectType %> Record When Routed</span> <input type=checkbox id=populateTerritoryField> <span class=checkmark></span> </label> <div class=label-dropdown-container id=populateTerritoryDropdown style=display:inline-block> <div class=\"horizontal-tabbing-checkbox-option-sub-div dropdown-label typeahead-label-section\" style=top:6px;line-height:1.1em>Select the field on the <%- objectType || _LeanData.AppState.PrimarySObjectType %> to tag</div> <span id=populateTerritoryFieldDropdown style=margin-left:10px></span></div> <div id=onlyTagTerritoryDropdown style=display:none;margin-left:10px;padding-bottom:10px> <label class=cb-container-small> <span class=toggleText>Only tag the <%- objectType || _LeanData.AppState.PrimarySObjectType %> with the Territory Field. The <%- objectType || _LeanData.AppState.PrimarySObjectType %> will not be routed/assigned.</span> <input type=checkbox id=onlyTagTerritory> <span class=checkmark></span> </label> </div> </div> </div> <hr class=horizontal-line-separator> <div id=email-notification-wrapper></div> <% } else { %> <% if (fieldMappingStatus === 'logIdAndAdditional' && _LeanData.AppState.PrimarySObjectType === 'Meeting') { %> <label class=cb-container-small style=\"margin:10px 20px!important\"> <span class=toggleText> Tag LeanData Territory <div class=\"ld-tooltip-hint tag-territory-tooltip\" style=vertical-align:top></div> </span> <input type=checkbox id=populateTerritoryField> <span class=checkmark></span> </label> <% } %> <hr class=horizontal-line-separator> <div id=scheduling-container></div> <% } %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> "},function(e,t){e.exports='<div id=trigger-node-partial class=node-partial data-node-type=trigger data-form-title=Trigger> <div class=header-font id=radio-label><%- isUpdateTrigger ? "Updated" : "New" %> <span class=text-capitalize><%-pluralObjectType%></span> to be sent through the <%- objectType.toLowerCase() %> workflow </div> <div class=filter-div></div> <% if (displayOutputVariable) { %> <div style=margin-top:20px;margin-bottom:20px> <ld-variable-setter-angular class=angular-component-in-magellan id="routed-<%- objectTypeAPI %>"> </ld-variable-setter-angular> </div> <% } %> <% if (!isUpdateTrigger) { %> <hr class=horizontal-line-separator> <div id=advanced-settings-wrapper></div> <% } %> <div id=scheduled-routing-edge-list></div> </div>'},function(e,t){e.exports='<% if (showMatchSelector) { %> <ld-match-selector-angular></ld-match-selector-angular> <hr class=horizontal-line-separator> <% } %> <div class=control-group id=filter-type-radio-control> <div class=header-font>Logic Rules</div> <% if (objectType === \'RA\' || objectType === \'Meeting\') { %> <i class=ld-body-medium style="display:inline-block;margin:5px 0">SOQL Rules Unavailable for <%- objectType === \'RA\' ? "Related Activity" : "Prospect nodes"%> </i> <% if (objectType === \'RA\') {%> <span class="ld-tooltip-hint true_false_RA-tooltip small-tooltip" style=margin-left:5px;vertical-align:middle></span> <% }} %> <label class="control control--radio"><span class=has-object-label>SOQL Rule</span> <input class=rule-type-radio type=radio name=radio data-rule-type=soql <%- ruleType === "soql" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div class=radio-subsection> <div id=soql-rule-wrapper></div> </div> <label class="control control--radio"><span class=has-object-label>Logic Rule</span> <input class=rule-type-radio type=radio name=radio data-rule-type=conditions <%- ruleType === "conditions" ? "checked" : ""%>> <div class=control__indicator></div> </label> <div class=radio-subsection> <div id=conditions-header-section> <div class=header-font>Conditions</div> <div class=sub-header-font>Create Condition(s) to form a new path the flow can take. Specify criteria to be met for the Routed <%- primaryObject %> to take the \'Met\' path.</div> <i class=sub-header-font>Note: If no conditions are met, the Routed <%- primaryObject %> will take the \'Not Met\' path.</i> </div> <div id=condition-set-wrapper></div> </div> <hr class=horizontal-line-separator> <div id=criteria-list-partial class=decision-criteria-list></div> <div id=advanced-settings-wrapper></div> </div> '},function(e,t){e.exports='<div class="node-partial zoominfo-enrichment-container" data-form-title="Action - ZoomInfo Enrich" style=margin-right:20px> <% if (!authorized) { %> <div class=ld-body-medium><span class=error-message> ZoomInfo is not authorized; please authorize under Integrations > ZoomInfo </span></div> <% } else { %> <% if (appInstalled === false) { %> <div class=ld-body-medium><span class=error-message> Please install and configure the ZoomInfo app in Salesforce to proceed. </span></div> <% } %> <% } %> <div style=margin-top:5px;display:flex;justify-content:space-between;align-items:center> </div> </div> <hr class=horizontal-line-separator /> <div id=advanced-settings-wrapper></div> '},function(e,t){e.exports='<div class="ld-header-wrapper ld-header-wrapper-margins"> <div class=lds-header>Routing Insights Details</div> </div> <div id=daterange-inputs> <div class=input-title>Date Range</div> <div> <input id=pending-datepick-start type=text /> <label class=dg_date-label for=pending-datepick-start></label> to <input id=pending-datepick-end type=text /> <label class=dg_date-label for=pending-datepick-end></label> </div> </div> <% var objectType = this.parsedMetrics.objectType + \'s\'; %> <% if (objectType == \'Opportunitys\') objectType = \'Opportunities\'%> <div id=outcome-wrapper> <div class=dg_inner-wrapper-header-legacy> <div class="title title-left"><%- decodeURIComponent(nodeName) %></div> <div class="title title-separator">/</div> <div class="title title-right">PENDING <%-objectType%></div> </div> <div id=limit-message>Showing last 2000 entries</div> <div id=outcome-table-wrapper></div> </div> '},function(e,t){e.exports='<table id=metrics-detail-table> <thead id=metrics-detail-head> <tr> <% _.each(columnLayout, function(col) { %> <th> <%- col[0] %> </th> <% }); %> </tr> </thead> <tbody id=metrics-detail-body> </tbody> </table> <div class=pagination-wrapper> <span data-direction=previous class="pagination-item pagination-back">Previous</span> <span data-direction=next class="pagination-item pagination-next">Next</span> </div> '},function(e,t){e.exports='<% _.each(columnLayout, function(col, i) { %> <% if (col[2](log) === \'Abort\') { %> <td class=abort><button type=button class="abort-action lds-primary-x-small-button on-dark" id="<%- col[1](log) %>"> <%- col[2](log) %> </button></td> <% } else { %> <td> <% if (col[1](log)) { %> <% if (col[0].endsWith(\' Object ID\')) { %> <a title="<%- col[2](log) %>" href="<%- col[1](log) %>" target=_blank><%- col[2](log) %></a> <% } else { %> <a title="<%- col[2](log) %>" href="<%- col[1](log) %>" target=_blank class=text-overflow-115><%- col[2](log) %></a> <% } %> <% } else { %> <%- col[2](log) %> <% } %> </td> <% } %> <% }); %> '}]);