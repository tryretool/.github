<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Notification</name>
        <label>Send Notification</label>
        <locationX>998</locationX>
        <locationY>840</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Update_Journey_Resting</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>$Record.Owner:User.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>{!$Record.Contact__r.Email} at {!$Record.Account__r.Name} is ready to re-engage!</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>Re_Engage_Email</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>59.0</apiVersion>
    <assignments>
        <name>Auto_close</name>
        <label>Auto-close</label>
        <locationX>386</locationX>
        <locationY>541</locationY>
        <assignmentItems>
            <assignToReference>$Record.Ended_Reason__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Auto-Closed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Ended_Reason_Details__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Stage__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Close_Method__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Auto-close</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Closed_At__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Stage_Ended</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Auto_close_No_Rep_Context</name>
        <label>Auto-close No Rep Context</label>
        <locationX>567</locationX>
        <locationY>548</locationY>
        <assignmentItems>
            <assignToReference>$Record.Ended_Reason__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Auto-Closed</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Ended_Reason_Details__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>No disposition/context provided by Journey Owner after 14 days</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Close_Method__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Auto-close; No Context</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Closed_At__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Stage_Ended</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Journey_Which_Triggered_End</name>
        <label>Journey Which Triggered End</label>
        <locationX>998</locationX>
        <locationY>732</locationY>
        <assignmentItems>
            <assignToReference>$Record.Journey_Which_Triggered_End__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Create_Re_engage_Journey</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Send_Notification</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Remove_Resting</name>
        <label>Remove Resting</label>
        <locationX>1130</locationX>
        <locationY>408</locationY>
        <assignmentItems>
            <assignToReference>$Record.Is_Resting__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Re_engage_Post_Rest</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Stage_Ended</name>
        <label>Stage Ended</label>
        <locationX>558</locationX>
        <locationY>1332</locationY>
        <assignmentItems>
            <assignToReference>$Record.Stage__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Ended</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Close_Journey</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Journey_Stage_Is</name>
        <label>Journey Stage Is</label>
        <locationX>558</locationX>
        <locationY>300</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Identified</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Identified</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Stage_Duration__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>14.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Auto_close</targetReference>
            </connector>
            <label>Identified</label>
        </rules>
        <rules>
            <name>Accepted</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Accepted</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Stage_Duration__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>14.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Auto_close</targetReference>
            </connector>
            <label>Accepted</label>
        </rules>
        <rules>
            <name>Approached</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Approached</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Days_Since_Most_Recent_Outbound_Email__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>14.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Auto_close</targetReference>
            </connector>
            <label>Approached</label>
        </rules>
        <rules>
            <name>Engaged</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Engaged</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Days_Action_Overdue__c</leftValueReference>
                <operator>GreaterThanOrEqualTo</operator>
                <rightValue>
                    <numberValue>14.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Auto_close_No_Rep_Context</targetReference>
            </connector>
            <label>Engaged</label>
        </rules>
        <rules>
            <name>Meeting_Booked</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Meeting Booked</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Days_Action_Overdue__c</leftValueReference>
                <operator>GreaterThanOrEqualTo</operator>
                <rightValue>
                    <numberValue>14.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Auto_close_No_Rep_Context</targetReference>
            </connector>
            <label>Meeting Booked</label>
        </rules>
        <rules>
            <name>Is_Resting</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Is_Resting__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Rest_Until__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Flow.CurrentDateTime</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Remove_Resting</targetReference>
            </connector>
            <label>Is Resting in Past?</label>
        </rules>
    </decisions>
    <decisions>
        <name>Re_engage_Post_Rest</name>
        <label>Re-engage Post Rest?</label>
        <locationX>1130</locationX>
        <locationY>516</locationY>
        <defaultConnector>
            <targetReference>Update_Journey_Resting</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Just Resting</defaultConnectorLabel>
        <rules>
            <name>Re_engage</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Re_engage_Post_Rest__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Re_engage_Journey</targetReference>
            </connector>
            <label>Re-engage</label>
        </rules>
    </decisions>
    <description>Adding Autoclose to Engaged and Meeting Booked</description>
    <environments>Default</environments>
    <formulas>
        <name>today</name>
        <dataType>Date</dataType>
        <expression>TODAY()</expression>
    </formulas>
    <interviewLabel>Scheduled: Journey {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Scheduled: Journey</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Re_engage_Journey</name>
        <label>Create Re-engage Journey</label>
        <locationX>998</locationX>
        <locationY>624</locationY>
        <connector>
            <targetReference>Journey_Which_Triggered_End</targetReference>
        </connector>
        <inputAssignments>
            <field>Accepted_At__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Account__c</field>
            <value>
                <elementReference>$Record.Account__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact__c</field>
            <value>
                <elementReference>$Record.Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Create_Method__c</field>
            <value>
                <stringValue>Re-engage Post Rest</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Created_From_Moment__c</field>
            <value>
                <elementReference>$Record.Created_From_Moment__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Outbound_Sequence__c</field>
            <value>
                <elementReference>$Record.Outbound_Sequence__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Owner__c</field>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Stage__c</field>
            <value>
                <stringValue>Accepted</stringValue>
            </value>
        </inputAssignments>
        <object>Journey__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordUpdates>
        <name>Close_Journey</name>
        <label>Close Journey</label>
        <locationX>558</locationX>
        <locationY>1440</locationY>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Journey_Resting</name>
        <label>Update Journey Resting</label>
        <locationX>1130</locationX>
        <locationY>1032</locationY>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>432</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>Journey_Stage_Is</targetReference>
        </connector>
        <filterLogic>1 OR 2 OR 3 OR 4 OR (( 5 OR 6) AND 7)</filterLogic>
        <filters>
            <field>Is_Resting__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Stage__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Identified</stringValue>
            </value>
        </filters>
        <filters>
            <field>Stage__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Accepted</stringValue>
            </value>
        </filters>
        <filters>
            <field>Stage__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Approached</stringValue>
            </value>
        </filters>
        <filters>
            <field>Stage__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Engaged</stringValue>
            </value>
        </filters>
        <filters>
            <field>Stage__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Meeting Booked</stringValue>
            </value>
        </filters>
        <filters>
            <field>Days_Action_Overdue__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <numberValue>14.0</numberValue>
            </value>
        </filters>
        <object>Journey__c</object>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2024-10-29</startDate>
            <startTime>20:00:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>Re_Engage_Email</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hi {!$Record.Owner__r.FirstName},
A new Journey has been created to re-engage with {!$Record.Contact__r.Email} at {!$Record.Account__r.Name}.
Please review and follow up accordingly: https://retool.lightning.force.com/lightning/r/Journey__c/{!Create_Re_engage_Journey}/view</text>
    </textTemplates>
</Flow>
