<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>62.0</apiVersion>
    <choices>
        <name>False</name>
        <choiceText>False</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>False</stringValue>
        </value>
    </choices>
    <choices>
        <name>True</name>
        <choiceText>True</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>True</stringValue>
        </value>
    </choices>
    <decisions>
        <name>Check_Opt_Out</name>
        <label>Check Opt Out</label>
        <locationX>1291</locationX>
        <locationY>260</locationY>
        <defaultConnector>
            <targetReference>Opted_In_Screen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Opted In</defaultConnectorLabel>
        <rules>
            <name>Opted_Out</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>recordId.Opt_Out_Sales__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>True</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>recordId.HasOptedOutOfEmail</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opted_Out_Screen</targetReference>
            </connector>
            <label>Opted Out</label>
        </rules>
    </decisions>
    <description>Checks for Opt Out (Sales). If TRUE, provides the user an option to opt them back into Sales communication. If FALSE or NULL, provides the user an option to manually opt them out of Sales communication.</description>
    <environments>Default</environments>
    <formulas>
        <name>Opt_In_Details</name>
        <dataType>String</dataType>
        <expression>{!$User.Full_Name_with_Role__c} + &#39; - &#39; + &#39;Opt In Details: &#39; + {!Details}</expression>
    </formulas>
    <interviewLabel>Contact - Opt Out/In Button {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Contact - Opt Out/In Button</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordUpdates>
        <name>Opt_In_Update</name>
        <label>Opt In Update</label>
        <locationX>1122</locationX>
        <locationY>645</locationY>
        <connector>
            <targetReference>Opt_In_Confirmation</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Contact_Notes__c</field>
            <value>
                <elementReference>Opt_In_Details</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email_Opt_Out_Date__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>HasOptedOutOfEmail</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Opt_Out_Sales_Date__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Opt_Out_Sales__c</field>
        </inputAssignments>
        <object>Contact</object>
    </recordUpdates>
    <recordUpdates>
        <name>Opt_Out_Update</name>
        <label>Opt Out Update</label>
        <locationX>1494</locationX>
        <locationY>639</locationY>
        <connector>
            <targetReference>Opt_Out_Confirmation</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Opt_Out_Sales_Date__c</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Opt_Out_Sales__c</field>
            <value>
                <stringValue>True</stringValue>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <screens>
        <name>Opt_In_Confirmation</name>
        <label>Opt In Confirmation</label>
        <locationX>1122</locationX>
        <locationY>847</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>Opt_In_Confirmation_Text</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;{!recordId.Name}&lt;/strong&gt; (&lt;em&gt;{!recordId.Email}&lt;/em&gt;) has been opted back in to communications with Sales!&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Opt_Out_Confirmation</name>
        <label>Opt Out Confirmation</label>
        <locationX>1494</locationX>
        <locationY>842</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>Opt_Out_Confirmation_Text</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;{!recordId.Name}&lt;/strong&gt; (&lt;em&gt;{!recordId.Email}&lt;/em&gt;) has been opted out of future communications with Sales!&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Opted_In_Screen</name>
        <label>Opted In Screen</label>
        <locationX>1494</locationX>
        <locationY>437</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Opt_Out_Update</targetReference>
        </connector>
        <fields>
            <name>Email_Opt_In_Text</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;color: rgb(0, 0, 0);&quot;&gt;{!recordId.Name} &lt;/strong&gt;&lt;span style=&quot;color: rgb(0, 0, 0);&quot;&gt;(&lt;/span&gt;&lt;em style=&quot;color: rgb(0, 0, 0);&quot;&gt;{!recordId.Email}&lt;/em&gt;&lt;span style=&quot;color: rgb(0, 0, 0);&quot;&gt;) has not opted out of Sales communication.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;If you would like to manually opt them out of receiving future Emails from Sales, please use the &lt;strong&gt;Opt Out (Sales) &lt;/strong&gt;drop down and click &lt;strong&gt;Next &lt;/strong&gt;to save your changes.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;This will prevent future outbound emails from being sent, and auto-close any new Journeys that are created.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Opt_Out_Sales</name>
            <choiceReferences>True</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Opt Out (Sales)</fieldText>
            <fieldType>DropdownBox</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>Product_Marketing_Opt_Out_Text</name>
            <fieldText>&lt;p&gt;&lt;em style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;If this contact is requesting to be opted back into marketing or product emails, please let the Revenue Operations team know in the #rev_ops-team channel.&lt;/em&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Opted_Out_Screen</name>
        <label>Opted Out Screen</label>
        <locationX>1122</locationX>
        <locationY>438</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Opt_In_Update</targetReference>
        </connector>
        <fields>
            <name>Email_Opt_Out_Text</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;font-size: 14px; color: rgb(255, 0, 0);&quot;&gt;{!recordId.Name} &lt;/strong&gt;&lt;span style=&quot;font-size: 14px; color: rgb(255, 0, 0);&quot;&gt;(&lt;/span&gt;&lt;em style=&quot;font-size: 14px; color: rgb(255, 0, 0);&quot;&gt;{!recordId.Email}&lt;/em&gt;&lt;span style=&quot;font-size: 14px; color: rgb(255, 0, 0);&quot;&gt;) is currently opted out of Sales communication.&lt;span class=&quot;ql-cursor&quot;&gt;ï»¿&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Sales_Opted_Out_Date</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Opt Out (Sales) Date: &lt;/strong&gt;&lt;em&gt;{!recordId.Opt_Out_Sales_Date__c}&lt;/em&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>recordId.Opt_Out_Sales_Date__c</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>Opt_In_Instructions_Text</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;ï»¿If this contact has given consent to receive new emails from our Sales team (i.e. currently engaged in a sales conversation,  trying to set up a call etc..), please use the &lt;/span&gt;&lt;strong style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;Opt Back In (Sales)&lt;/strong&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt; dropdown below to button to opt them back into receiving future emails from Sales, and also provide &lt;/span&gt;&lt;strong style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;Details&lt;/strong&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt; around why we are opting them back in. This will also prevent open Journey records from being auto closed.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;ï»¿&lt;/span&gt; Click &lt;/span&gt;&lt;strong style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;Next&lt;/strong&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt; to save these changes. &lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Opt_Back_In_Sales</name>
            <choiceReferences>True</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Opt Back In (Sales)</fieldText>
            <fieldType>DropdownBox</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Details</name>
            <dataType>String</dataType>
            <fieldText>Details</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;Please keep your description to 120 characters or less&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!Details}) &lt; 120</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>Product_Marketing_Opt_In_Text</name>
            <fieldText>&lt;p&gt;&lt;em style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;If this contact is requesting to be opted back into marketing or product emails, please let the Revenue Operations team know in the #rev_ops-team channel.&lt;/em&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>1173</locationX>
        <locationY>46</locationY>
        <connector>
            <targetReference>Check_Opt_Out</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>recordId</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
</Flow>
