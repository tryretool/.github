<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Post_approval_to_thread</name>
        <label>Post approval to thread</label>
        <locationX>729</locationX>
        <locationY>896</locationY>
        <actionName>Centro__SendMessageFlow</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Set_reaction_check_mark</targetReference>
        </connector>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>channelId</name>
            <value>
                <stringValue>{!last_mile_deal_desk_channel_id}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>InterviewGuid</name>
            <value>
                <stringValue>{!$Flow.InterviewGuid}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>&lt;p&gt;{!approval_notification_slack}&lt;/p&gt;</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>pinMessage</name>
            <value>
                <stringValue>false</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>postReply</name>
            <value>
                <stringValue>true</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>replyMessageTs</name>
            <value>
                <elementReference>message_ts</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>startThread</name>
            <value>
                <stringValue>false</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>updateMessage</name>
            <value>
                <stringValue>false</stringValue>
            </value>
        </inputParameters>
        <nameSegment>Centro__SendMessageFlow</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <actionCalls>
        <name>Set_reaction_check_mark</name>
        <label>Set reaction check mark</label>
        <locationX>722</locationX>
        <locationY>1071</locationY>
        <actionName>Centro__AddReactionFlow</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>channelId</name>
            <value>
                <elementReference>last_mile_deal_desk_channel_id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emojiName</name>
            <value>
                <stringValue>white_check_mark</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>messageTs</name>
            <value>
                <elementReference>message_ts</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Centro__AddReactionFlow</nameSegment>
    </actionCalls>
    <apiVersion>59.0</apiVersion>
    <assignments>
        <name>Stamp_deal_desk_cert</name>
        <label>Stamp deal desk cert</label>
        <locationX>704</locationX>
        <locationY>374</locationY>
        <assignmentItems>
            <assignToReference>recordId.Deal_Desk_Review__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>deal_desk_cert</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_opp</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>has_message_TS</name>
        <label>has message TS?</label>
        <locationX>460</locationX>
        <locationY>744</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>message_ts</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Post_approval_to_thread</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Fixed link to contract links.</description>
    <environments>Default</environments>
    <formulas>
        <name>deal_desk_cert</name>
        <dataType>String</dataType>
        <expression>{!$User.FirstName}&amp;&quot; &quot;&amp;{!$User.LastName}&amp;&quot; &quot;&amp;TEXT({!$Flow.CurrentDate})</expression>
    </formulas>
    <interviewLabel>Opportunity - Deal Desk Approval Button {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Opportunity - Deal Desk Approval Button</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordUpdates>
        <name>Update_docusign_ID</name>
        <label>Update docusign ID</label>
        <locationX>725</locationX>
        <locationY>697</locationY>
        <connector>
            <targetReference>has_message_TS</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.ContractId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>DocuSign_Envelope_ID__c</field>
            <value>
                <elementReference>DocuSign_ID</elementReference>
            </value>
        </inputAssignments>
        <object>Contract</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_opp</name>
        <label>Update opp</label>
        <locationX>701</locationX>
        <locationY>522</locationY>
        <connector>
            <targetReference>Update_docusign_ID</targetReference>
        </connector>
        <inputReference>recordId</inputReference>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <screens>
        <name>Deal_Desk_Review</name>
        <label>Deal Desk Review</label>
        <locationX>703</locationX>
        <locationY>209</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Stamp_deal_desk_cert</targetReference>
        </connector>
        <fields>
            <name>last_mile_checklist</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Links:&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;{!recordId.Link_to_Contract__c}&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Contract PDF&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;{!recordId.Contract.Deal_Desk_Link__c}&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;RevOps Deal&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://retool.lightning.force.com/{!recordId.Id}&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Opportunity&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Last Mile Deal Review Checklist:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Complete Signatures:&lt;/strong&gt; All parts of the agreement (order form + MSA) have a name, date and signature date from all customer signers and Retool counter signer. Alternatively, the DocuSign cert with all relevant information may be usable if there is an ID left on the document linking the two together.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Complete MSA:&lt;/strong&gt; If an MSA is included, it must not have blank spaces (check first paragraph) or evidence of redlining. Must be clean.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;RevOps sync: &lt;/strong&gt;Sync to&lt;strong&gt; &lt;/strong&gt;Salesforce should read Successful (not partial or errored)&lt;/li&gt;&lt;li&gt;&lt;strong&gt;No obvious structural issues:&lt;/strong&gt; Read the commercials one more time and make sure everything ties and looks right&lt;/li&gt;&lt;li&gt;&lt;strong&gt;If non-standard paper is used:&lt;/strong&gt; Make sure we all relevant parts of the standard agreement are represented in the PDF package (e.g., evidence of mutual execution, all commercial terms, etc.)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;If all of the above looks good, input the DocuSign ID from the top of the PDF below and click &lt;strong&gt;Approve&lt;/strong&gt; to notify the deal owner in &lt;a href=&quot;https://retooled.slack.com/archives/C06GJE03FNU&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;#last-mile-deal-review&lt;/a&gt; to mark the deal as Closed Won&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>DocuSign_ID</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>recordId.Contract.DocuSign_Envelope_ID__c</elementReference>
            </defaultValue>
            <fieldText>DocuSign ID (input NA if not available)</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
        </fields>
        <nextOrFinishButtonLabel>Approve</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>576</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>Deal_Desk_Review</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>approval_notification_slack</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$User.Slack_Mention_Handle_Only__c} has approved this deal. {!recordId.Owner.Slack_Mention_Handle_Only__c} you may move this deal to Closed Won.</text>
    </textTemplates>
    <variables>
        <name>last_mile_deal_desk_channel_id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>C06GJE03FNU</stringValue>
        </value>
    </variables>
    <variables>
        <name>message_ts</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>recordId.Contract.Last_Mile_Review_Message_Queue_ID__c</elementReference>
        </value>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
</Flow>
