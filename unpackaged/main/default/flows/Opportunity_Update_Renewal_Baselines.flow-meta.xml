<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <assignments>
        <name>Add_revenue_to_baselines</name>
        <label>Add revenue to baselines</label>
        <locationX>246</locationX>
        <locationY>1480</locationY>
        <assignmentItems>
            <assignToReference>New_Renewal_Baseline_MRR</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_parent_and_child_opps.Total_MRR__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>New_Renewal_Baseine_ARR_New</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_parent_and_child_opps.Total_ARR__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Opp_has_line_items</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_revenue_to_forecasts</name>
        <label>Add revenue to forecasts</label>
        <locationX>788</locationX>
        <locationY>1358</locationY>
        <assignmentItems>
            <assignToReference>New_Forecast_MRR</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_line_items.Total_MRR__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>New_Forecast_ARR_New</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_line_items.Total_ARR__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_line_items</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_revenue_to_forecasts_0</name>
        <label>Add revenue to forecasts</label>
        <locationX>430</locationX>
        <locationY>1387</locationY>
        <assignmentItems>
            <assignToReference>New_Forecast_MRR</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_parent_and_child_opps.Total_MRR__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>New_Forecast_ARR_New</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_through_parent_and_child_opps.Total_ARR__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_parent_and_child_opps</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_equal_to_opp_record_updated</name>
        <label>Set equal to opp_record_updated</label>
        <locationX>423</locationX>
        <locationY>511</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_target_opp</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Is_renewal</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_error</name>
        <label>Set error</label>
        <locationX>2688</locationX>
        <locationY>1164</locationY>
        <assignmentItems>
            <assignToReference>error_message</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Set_error_0</name>
        <label>Set error</label>
        <locationX>351</locationX>
        <locationY>664</locationY>
        <assignmentItems>
            <assignToReference>error_message</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>NOT_RENEWAL</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Set_starting_baselines</name>
        <label>Set starting baselines</label>
        <locationX>165</locationX>
        <locationY>806</locationY>
        <assignmentItems>
            <assignToReference>starting_baseline_mrr</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>opp_record_updated.Renewal_Baseline_MRR__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>starting_amount</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>opp_record_updated.Amount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>starting_baseline_arr_new</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>opp_record_updated.Renewal_Baseline_ARR__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Booking_Type</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_target_opp</name>
        <label>Update target opp</label>
        <locationX>1463</locationX>
        <locationY>1183</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated.Renewal_Baseline_MRR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>New_Renewal_Baseline_MRR</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Renewal_Baseline_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>New_Renewal_Baseine_ARR_New</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Forecast_method</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_target_opp_0</name>
        <label>Update target opp</label>
        <locationX>1947</locationX>
        <locationY>956</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated.Renewal_Baseline_MRR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>calc_debook_renewal_baseline_mrr</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Renewal_Baseline_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>calc_debook_renewal_baseline_arr_new</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_opp_dec</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_total_revenue</name>
        <label>Update total revenue</label>
        <locationX>1405</locationX>
        <locationY>1342</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_MRR__c</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Baseline_MRR_Change</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Amount</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Baseline_ARR_Change_New</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_target_opp</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_total_revenue_0</name>
        <label>Update total revenue</label>
        <locationX>1473</locationX>
        <locationY>1480</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_MRR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>New_Forecast_MRR</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Amount</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>New_Forecast_ARR_New</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>New_Forecast_ARR_New</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_target_opp</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_total_revenue_0_0</name>
        <label>Update total revenue</label>
        <locationX>2242</locationX>
        <locationY>1652</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_MRR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>new_forecast_mrr_adjusted</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Amount</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>new_forecast_arr_adjusted_new</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Forecast_Total_AR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>new_forecast_arr_adjusted_new</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>force_update_opp</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>new_forecast_arr_adjusted_new</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_opp_dec</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_total_revenue_0_0_0</name>
        <label>Update total revenue</label>
        <locationX>1861</locationX>
        <locationY>1088</locationY>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_MRR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Forecast_Total_AR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>opp_record_updated.Total_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_opp_dec</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Booking_Type</name>
        <label>Booking Type</label>
        <locationX>152</locationX>
        <locationY>1021</locationY>
        <defaultConnector>
            <targetReference>Get_prior_term_opps</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Putback</defaultConnectorLabel>
        <rules>
            <name>Standard</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.Booking_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Standard</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_prior_term_opps</targetReference>
            </connector>
            <label>Standard</label>
        </rules>
        <rules>
            <name>Debook</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.Booking_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Debook</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_originating_opportunity</targetReference>
            </connector>
            <label>Debook</label>
        </rules>
    </decisions>
    <decisions>
        <name>Forecast_method</name>
        <label>Forecast method</label>
        <locationX>1664</locationX>
        <locationY>1185</locationY>
        <defaultConnector>
            <targetReference>Update_opp_dec</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Manual / Other</defaultConnectorLabel>
        <rules>
            <name>Churn</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Churn</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_total_revenue_0_0_0</targetReference>
            </connector>
            <label>Churn</label>
        </rules>
        <rules>
            <name>Closed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.IsClosed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_opp_dec</targetReference>
            </connector>
            <label>Closed</label>
        </rules>
        <rules>
            <name>Automatic</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.Forecast_Method__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Automatic</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>opp_record_updated.HasOpportunityLineItem</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_forecast_setting</targetReference>
            </connector>
            <label>Automatic (No Line Items)</label>
        </rules>
    </decisions>
    <decisions>
        <name>Has_line_items</name>
        <label>Has line items?</label>
        <locationX>993</locationX>
        <locationY>1189</locationY>
        <defaultConnector>
            <targetReference>Is_auto_close</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Churn_stah</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Churn</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_target_opp</targetReference>
            </connector>
            <label>Churn</label>
        </rules>
        <rules>
            <name>Yes_has_line_Items</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.HasOpportunityLineItem</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_target_opp</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_auto_close</name>
        <label>Is auto-close?</label>
        <locationX>996</locationX>
        <locationY>1472</locationY>
        <defaultConnector>
            <targetReference>Is_open</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.Auto_close__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_total_revenue_0</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_open</name>
        <label>Is open?</label>
        <locationX>1194</locationX>
        <locationY>1273</locationY>
        <defaultConnector>
            <targetReference>Update_target_opp</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Closed</defaultConnectorLabel>
        <rules>
            <name>Open</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.IsClosed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_total_revenue</targetReference>
            </connector>
            <label>Open</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_renewal</name>
        <label>Is renewal?</label>
        <locationX>158</locationX>
        <locationY>597</locationY>
        <defaultConnector>
            <targetReference>Set_error_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_renewal</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.RecordType.Name</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Renewal</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_starting_baselines</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opp_has_line_items</name>
        <label>Opp has line items?</label>
        <locationX>386</locationX>
        <locationY>1603</locationY>
        <defaultConnector>
            <targetReference>Add_revenue_to_forecasts_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_has_line_items_loop</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_through_parent_and_child_opps.HasOpportunityLineItem</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_line_items</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>OppId_Provided</name>
        <label>OppId Provided?</label>
        <locationX>136</locationX>
        <locationY>274</locationY>
        <defaultConnector>
            <targetReference>Is_renewal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - use opp_record_updated</defaultConnectorLabel>
        <rules>
            <name>Yes_opp_id</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>OppId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_target_opp</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Run_automatic_forecast</name>
        <label>Run automatic forecast?</label>
        <locationX>1661</locationX>
        <locationY>1520</locationY>
        <defaultConnector>
            <targetReference>Update_opp_dec</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - forecast setting not found</defaultConnectorLabel>
        <rules>
            <name>Won_Auto_Close</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>opp_record_updated.Auto_close__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_opp_dec</targetReference>
            </connector>
            <label>No - Won Auto Close</label>
        </rules>
        <rules>
            <name>Yes_forecast_setting_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_forecast_setting</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_total_revenue_0_0</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Update_opp_dec</name>
        <label>Update opp?</label>
        <locationX>2237</locationX>
        <locationY>1200</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_changed</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>opp_record_updated.Renewal_Baseline_MRR__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>starting_baseline_mrr</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>opp_record_updated.Amount</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>starting_amount</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>force_update_opp</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>opp_record_updated.Renewal_Baseline_ARR__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>starting_baseline_arr_new</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_opp</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Remove references to old revenue fields</description>
    <environments>Default</environments>
    <formulas>
        <name>Baseline_ARR_Change_New</name>
        <dataType>Currency</dataType>
        <expression>{!New_Renewal_Baseine_ARR_New}-{!opp_record_updated.Renewal_Baseline_ARR__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>Baseline_MRR_Change</name>
        <dataType>Currency</dataType>
        <expression>{!New_Renewal_Baseline_MRR}-{!opp_record_updated.Renewal_Baseline_MRR__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>calc_debook_renewal_baseline_arr_new</name>
        <dataType>Currency</dataType>
        <expression>{!Get_originating_opportunity.Renewal_Baseline_ARR__c}*-1</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>calc_debook_renewal_baseline_mrr</name>
        <dataType>Currency</dataType>
        <expression>{!Get_originating_opportunity.Renewal_Baseline_MRR__c}*-1</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>new_forecast_arr_adjusted_new</name>
        <dataType>Currency</dataType>
        <expression>{!New_Forecast_ARR_New}*({!Get_forecast_setting.Adjustment_Factor__c} / 100)</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>new_forecast_mrr_adjusted</name>
        <dataType>Currency</dataType>
        <expression>{!New_Forecast_MRR}*({!Get_forecast_setting.Adjustment_Factor__c} / 100)</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>Prior_Term</name>
        <dataType>Number</dataType>
        <expression>{!opp_record_updated.Term_Number__c}-1</expression>
        <scale>0</scale>
    </formulas>
    <interviewLabel>Opportunity - Update Renewal Baselines {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Opportunity - Update Renewal Baselines</label>
    <loops>
        <name>Loop_through_line_items</name>
        <label>Loop through line items</label>
        <locationX>612</locationX>
        <locationY>1358</locationY>
        <collectionReference>Get_line_items</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_revenue_to_forecasts</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_through_parent_and_child_opps</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_through_parent_and_child_opps</name>
        <label>Loop through parent and child opps</label>
        <locationX>390</locationX>
        <locationY>1186</locationY>
        <collectionReference>Get_prior_term_opps</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_revenue_to_baselines</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Has_line_items</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_forecast_setting</name>
        <label>Get forecast setting</label>
        <locationX>1673</locationX>
        <locationY>1344</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Run_automatic_forecast</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Label</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>opp_record_updated.Renewal_Risk__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Net Expansion Forecast Rate</stringValue>
            </value>
        </filters>
        <filters>
            <field>Subtype__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>opp_record_updated.Subtype__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Segment__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>opp_record_updated.Segment__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Forecast_Setting__mdt</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_line_items</name>
        <label>Get line items</label>
        <locationX>608</locationX>
        <locationY>1602</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_through_line_items</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_through_parent_and_child_opps.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Discount_Type__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>One-time</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>OpportunityLineItem</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_originating_opportunity</name>
        <label>Get originating opportunity</label>
        <locationX>508</locationX>
        <locationY>951</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_target_opp_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>opp_record_updated.Originating_Opportunity__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_prior_term_opps</name>
        <label>Get prior term opps</label>
        <locationX>169</locationX>
        <locationY>1266</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_through_parent_and_child_opps</targetReference>
        </connector>
        <filterLogic>1 AND 2 AND 3 AND 4 AND (5 OR 6)</filterLogic>
        <filters>
            <field>Business_Unit__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>opp_record_updated.Business_Unit__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Is_Committed_Booking__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Term_Number__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Prior_Term</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>IgnoreOppId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Opportunity_Record_Type_Name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Enterprise</stringValue>
            </value>
        </filters>
        <filters>
            <field>Opportunity_Record_Type_Name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Renewal</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_target_opp</name>
        <label>Get target opp</label>
        <locationX>394</locationX>
        <locationY>259</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_equal_to_opp_record_updated</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OppId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_opp</name>
        <label>Update opp</label>
        <locationX>2498</locationX>
        <locationY>1164</locationY>
        <faultConnector>
            <targetReference>Set_error</targetReference>
        </faultConnector>
        <inputReference>opp_record_updated</inputReference>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <start>
        <locationX>16</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>OppId_Provided</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>error_message</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>force_update_opp</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>IgnoreOppId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>New_Forecast_ARR_New</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>New_Forecast_MRR</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>New_Renewal_Baseine_ARR_New</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>New_Renewal_Baseline_MRR</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>opp_record_updated</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>OppId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>starting_amount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>starting_baseline_arr_new</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>starting_baseline_mrr</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
</Flow>
